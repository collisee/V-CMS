<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>

	
		<title>
			VMware Communities: ghettoVCB.sh - Free alternative for backing up 
VM's for ESX(i) 3.5 and 4.x+ - Updated 09/28/2010
		</title>
		<meta name="verify-v1" 
content="7eQcOXhDkoEs9sTxIP+shsTTZSvAkb6EybrBqtaIF5s=">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="Content-Language" content="en-us">
		<meta name="robots" content="all"> 
		<meta name="copyright" content="VMware"> 
		<meta name="author" content="VMware"> 
		<link rel="search" href="http://communities.vmware.com/opensearch.xml"
 title="VMware Communities" type="application/opensearchdescription+xml">
		<link rel="shortcut icon" type="image/x-icon" 
href="http://www.vmware.com/favicon.ico">
		<link rel="stylesheet" href="DOC-8760_files/jive-global.css" 
type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="DOC-8760_files/jive-userbar.css" 
type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="DOC-8760_files/jive-sidebar.css" 
type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" type="text/css" 
href="DOC-8760_files/template.css">
		<link rel="stylesheet" type="text/css" href="DOC-8760_files/fce.css">
		<link rel="stylesheet" type="text/css" href="DOC-8760_files/print.css"
 media="print">
			<link rel="stylesheet" href="DOC-8760_files/jive-external.css" 
type="text/css" media="screen" title="" charset="utf-8">
		<link rel="stylesheet" href="DOC-8760_files/community.css" 
type="text/css" media="screen" title="" charset="utf-8">
		<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="/styles/ie6.css" media="screen" /><![endif]-->
		<script type="text/javascript" src="DOC-8760_files/library.js"></script>
		<script type="text/javascript" src="DOC-8760_files/jquery-1.js"></script>
		<script type="text/javascript" charset="utf-8">
			var $j = jQuery.noConflict();
			if (typeof _jive_base_url == 'undefined') {
				var _jive_base_url = "http://communities.vmware.com";
			}
		</script>
		<link rel="stylesheet" href="DOC-8760_files/jive-wiki.css" 
type="text/css" charset="utf-8">
			<link rel="alternate" type="application/rss+xml" title="ghettoVCB.sh -
 Free alternative for backing up VM's for ESX(i) 3.5 and 4.x+ - Updated 
09/28/2010 Version History Feed" 
href="http://communities.vmware.com/community/feeds/document-history/DOC-8760">
			<link rel="alternate" type="application/rss+xml" title="ghettoVCB.sh -
 Free alternative for backing up VM's for ESX(i) 3.5 and 4.x+ - Updated 
09/28/2010 Comments Feed" 
href="http://communities.vmware.com/community/feeds/document-comments/DOC-8760">
	<script src="DOC-8760_files/mergeglobal" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			var _isIE6 = (typeof window.XMLHttpRequest == "undefined");
			if(_isIE6){
				DD_belatedPNG.fix('div.visual-entry h2');
			}
		</script>
		<script src="DOC-8760_files/trim-to-line.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			// shorten all H1s and H2 inside intro boxes to one line
			jQuery(function() {
				$$('#jive-body-intro-content h1, #jive-body-intro-content h2').each(function(item) {
					item.trimToLine();
				});
			});
		</script>
	</head><body>
		<div id="container">
			<strong class="seo">VMware</strong>
			<div id="content-container" class="wide">
				<div id="jive-wrapper">
					<div id="jive-body">
						<div id="jive-body-wrapper">
							<script type="text/javascript" src="DOC-8760_files/engine.js"></script>
		<script type="text/javascript" src="DOC-8760_files/util.js"></script>
		<script type="text/javascript" src="DOC-8760_files/Watches.txt"></script>
		<script type="text/javascript" src="DOC-8760_files/Comment.txt"></script>
		<form id="documentRestoreForm" method="post" 
action="/docs/DOC-8760/restore">
			<input name="version" value="-1" type="hidden">
<input name="webwork.token.name" value="document.restore.token.DOC-8760"
 type="hidden">
<input name="document.restore.token.DOC-8760" 
value="88L4FEUNPQY5JQJM5AKF5Z5Z8A5M991I" type="hidden">
		</form>
		<form id="documentDeleteForm" method="post" 
action="/docs/DOC-8760/delete">
<input name="webwork.token.name" value="document.delete.token.DOC-8760" 
type="hidden">
<input name="document.delete.token.DOC-8760" 
value="OC5QXP26XPMA5LZ5LLHWYWD5LUG4Z7RY" type="hidden">
		</form>
		<form id="documentPublishForm" method="post" 
action="/doc-publish.jspa">
<input name="webwork.token.name" value="document.publish.token.DOC-8760"
 type="hidden">
<input name="document.publish.token.DOC-8760" 
value="QFJ6TSTR1MMYQAFWXTBL1DCFL2UYUVK8" type="hidden">
			<input name="documentID" value="DOC-8760" type="hidden">
		</form>
		<script type="text/javascript" charset="utf-8">
		<!--
			function publishDraft() {
				$('documentPublishForm').submit();
			}
			function restoreVersion(version) {
			if (confirm('Are you sure you want to restore this version of the document text?')){
					$('documentRestoreForm').submit();
			}
			}
			function deleteDocument() {
				if (confirm('Are you sure you want to delete this document?')){
					$('documentDeleteForm').submit();
				}
			}
			var documentID = 8760;
			DWREngine._defaultPath = "/dwr";
		// -->
		</script>
	
	
		<div style="padding: 0pt 25px;">
			<div class="jive-body-thread">
				<a 
href="http://communities.vmware.com/community/vmtn/vi/esx3.5?view=documents"
 class="jive-link-more">Up to Documents in VI: VMware ESXâ„¢ 3.5</a>
			</div>
		</div>
		<!-- BEGIN main body -->
		<div id="jive-body-main">
			<!-- BEGIN main body column -->
			<div id="jive-body-maincol-container">
				<div id="jive-body-maincol">
					<div id="thread.watch.notify" class="jive-info-box" style="display:
 none;"></div>

						
					<!-- BEGIN document -->
<div class="jive-wiki">
    <div class="jive-wiki-subject">
        <div class="jive-wiki-subject-content">
            <div class="jive-wiki-subject-content-title">
                <div>
                    <h2>ghettoVCB.sh - Free alternative for backing up 
VM's for ESX(i) 3.5 and 4.x+ - Updated 09/28/2010</h2>
                </div>
            </div>
            <div class="jive-wiki-version">
                <span class="jive-wiki-version-details">
                    <span>VERSION 64</span>
                        <a 
href="http://communities.vmware.com/docs/DOC-8760/diff?secondVersionNumber=64"
 class="jive-link-search-small" alt="Click to view document history"></a>

                </span>

                <span class="jive-wiki-publishstate">Published</span>
            </div>

            <h3>Created on: Nov 17, 2008 7:04 PM by
lamw

 <span>-</span> Last Modified:&nbsp;
Sep 29, 2010 6:52 AM
by lamw

</h3>
        </div>
    </div>
    <div class="jive-wiki-body">

        <div class="jive-wiki-body-content">
    <h1>Table of Contents:</h1>
<ul>

<ul>
<li>Description</li>
<li>Features</li>
<li>Requirements</li>
<li>Setup</li>
<li>Configurations</li>
<li>Usage</li>
<li>Sample Execution
<ul>
<li>Backup VMs stored in a list</li>
<li>Backup All VMs residing on specific ESX(i) host</li>
<li>Backup All VMs residing on specific ESX(i) host and exclude the VMs 
in the exclusion list</li>
<li>Backup VMs using individual backup policies </li>
<li>Debug backup Mode</li>
<li>Dry run Mode</li>
</ul>
</li>
<li>Enable compression for backups</li>
<li>Email Backup Logs </li>
<li>Restore backups (ghettoVCB-restore.sh)</li>
<li>Cronjob FAQ</li>
<li>FAQ</li>
<li>Our NFS Server Configuration</li>
<li>Useful Links</li>
<li>Change Log</li>
</ul>
</ul>
<br>
<h1>Description:</h1>
<br>
This script performs backups of virtual machines residing on <b>ESX(i) 
3.5/4.x+</b> servers using methodology similar to <a 
class="jive-link-external" 
href="http://www.vmware.com/products/vi/consolidated_backup.html">VMware's
 VCB</a> tool. The script takes snapshots of live virtual machines, 
backs up the master VMDK(s) and then upon completion, deletes the 
snapshot until the next backup. The only caveat is that it utilizes 
resources available to the Service Console of the ESX server running the
 backups as opposed to following the traditional method of offloading 
virtual machine backups through a VCB proxy.<br>
<br>
This script has been tested on <b>ESX 3.5/4.x and ESXi 3.5/4.x</b> and 
supports the following backup mediums: <b>LOCAL STORAGE</b>, <b>SAN</b> 
and <b>NFS</b>. The script is non-interactive and can be setup to run 
via crontab. Currently, this script accepts a text file that lists the 
display names of virtual machine(s) that are to be backed up. 
Additionally, one can specify a folder containing configuration files on
 a per VM basis for granular control over backup policies.<br>
<br>
Additionally, for ESX environments that don't have persistent NFS 
datastores designated for backups, the script offers the ability to 
automatically connect the ESX server to a NFS exported folder and then 
upon backup completion, disconnect it from the ESX server. The 
connection is established by creating an NFS datastore link which 
enables monolithic (or thick) VMDK backups as opposed to using the usual
 *nix mount command which necessitates breaking VMDK files into the 
2gbsparse format for backup. Enabling this mode is self-explanatory and 
will evidently be so when editing the script (Note: <b>VM_BACKUP_VOLUME</b>
 variable is ignored if <b>ENABLE_NON_PERSISTENT_NFS=1</b> ).<br>
<br>
In its current configuration, the script will allow up to 3 unique 
backups of the Virtual Machine before it will overwrite the previous 
backups; this however, can be modified to fit procedures if need be. 
Please be diligent in running the script in a test or staging 
environment before using it on production live Virtual Machines; this 
script functions well within our environment but there is a chance that 
it may not fit well into other environments.<br>
<br>
<b><span style="color: red;">Please read <u>ALL</u> documentation + 
FAQ's before posting a question about an issue or problem</span></b> 
Thank you<br>
<p>
</p><h1>Features</h1>
<ul>
<li>Support for multiple VMDK disk(s) backup per VM</li>
<li>Only valid VMDK(s) presented to the VM will be backed up</li>
<li>Online back up of VM(s)</li>
<li>Ability to shutdown guestOS and initiate backup process and power on
 VM afterwards with the option of hardpower timeout </li>
<li>Allow spaces in VM(s) backup list (not recommended and not a best 
practice)</li>
<li>Ensure that snapshot removal process completes prior to to 
continuing onto the next VM backup</li>
<li>VM(s) that intially contain <b>snapshots</b> will not be backed up 
and will be ignored</li>
<li>Ability to specify the number of backup rotations for VM</li>
<li>Output back up VMDK(s) in either <b>ZEROEDTHICK</b> (default 
behavior) or <b>2GB SPARSE</b> or <b>THIN</b> or <b>EAGERZEROEDTHICK</b>
 format</li>
<li>Support for both SCSI and IDE disks</li>
<li>Non-persistent NFS backup </li>
<li>Fully support VMDK(s) stored across multiple datastores</li>
<li>Ability to compress backups (Experimental Support - Please refer to 
FAQ #25)</li>
<li>Ability to configure individual VM backup policies</li>
<li>Ability to include/exclude specific VMDK(s) per VM (requires 
individual VM backup policy setup)</li>
<li>Ability to configure logging output to file</li>
<li>Independent disk awareness (will ignore VMDK)</li>
<li>New timeout variables for shutdown and snapshot creations</li>
<li>Ability to configure snapshots with both memory and/or quiesce 
options</li>
<li>Ability to configure disk adapter format</li>
<li>Additional debugging information including dry run execution</li>
<li>Support for VMs with both virtual/physical RDM (pRDM will be ignored
 and not backed up)</li>
<li>Support for global ghettoVCB configuration file*</li>
<li>Support for VM exclusion list*</li>
<li>Ability to backup all VMs residing on a specific host w/o specifying
 VM list*</li>
<li>Implemented simple locking mechenism to ensure only 1 instance of 
ghettoVCB is running per host*</li>
<li>Updated backup directory structure - rsync friendly*</li>
<li>Additional logging and final status output*</li>
<li><b><span style="color: blue;">Email backup logs (Experimental 
Suppport)</span></b> <b><span style="color: green;">NEW!</span></b></li>
<li><b><span style="color: blue;">Logging of ghettoVCB PID (proces id)</span></b>
 <b><span style="color: green;">NEW!</span></b></li>
<li><b><span style="color: blue;">Additional email support + debugging 
functionality (Experimental Suppport)</span></b> <b><span style="color: 
green;">NEW!</span></b></li>
<li><b><span style="color: blue;">Rsync Support (Experimental Suppport)</span></b>
 <b><span style="color: green;">NEW!</span></b></li>
</ul>
<br>
<hr>
<br>
<h1>Requirements:</h1>
<ul>
<li>VMs running on ESX(i) 3.5/4.x+</li>
<li>SSH console access to ESX/ESXi host</li>
</ul>
<br>
<hr>
<br>
<h1>Setup:</h1>
<br>
1) Download <b>ghettoVCB.tar.gz</b> and upload to either your ESX or 
ESXi system (use scp or WinSCP to transfer the file)<br>
<br>
2) Extract the contents of the tarball:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# tar -zxvf ghettoVCB.tar.gz
ghettoVCB/
ghettoVCB/ghettoVCB.sh
ghettoVCB/ghettoVCB-vm_backup_configuration_template
</code></pre><br>
<br>
3) The script is now ready to be used and is located in a directory 
named <b>ghettoVCB</b><br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ghettoVCB]# ls -l
total 36
-rwxr-xr-x 1 root root 28775 Mar 27 11:31 ghettoVCB.sh
-rw-r--r-- 1 root root   380 Mar 27 11:31 ghettoVCB-vm_backup_configuration_template
</code></pre><br>
<br>
<hr>
<br>
<h1>Configurations:</h1>
<br>
The following variables need to be defined within the script or in VM 
backup policy prior to execution. <br>
<br>
<b>Defining the backup datastore and folder in which the backups are 
stored (if folder does not exist, it will automatically be created):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">VM_BACKUP_VOLUME=/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
</code></pre><br>
<br>
<b>Defining the backup disk format (zeroedthick, eagerzeroedthick, thin,
 and 2gbsparse are available):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">DISK_BACKUP_FORMAT=thin
</code></pre><br>
<br>
<b>Defining the backup rotation per VM:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">VM_BACKUP_ROTATION_COUNT=3
</code></pre><br>
<br>
<b>Defining whether the VM is powered down or not prior to backup (1 = 
enable, 0 = disable):</b><br>
<br>
<b><span style="color: green;">Note: VM(s) that are powered off will not
 require snapshoting</span></b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">POWER_VM_DOWN_BEFORE_BACKUP=0
</code></pre><br>
<br>
<b>Defining whether the VM can be hard powered off when 
"POWER_VM_DOWN_BEFORE_BACKUP" is enabled and VM does not have VMware 
Tools installed</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">ENABLE_HARD_POWER_OFF=0
</code></pre><br>
<br>
<b>If "ENABLE_HARD_POWER_OFF" is enabled, then this defines the number 
of (60sec) iterations the script will before executing a hard power off 
when:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">ITER_TO_WAIT_SHUTDOWN=3
</code></pre><br>
<br>
<b>The number (60sec) iterations the script will wait when powering off 
the VM and will give up and ignore the particular VM for backup:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">POWER_DOWN_TIMEOUT=5
</code></pre><br>
<br>
<b>The number (60sec) iterations the script will wait when taking a 
snapshot of a VM and will give up and ignore the particular VM for 
backup:</b><br>
<br>
<b><span style="color: green;">Default value should suffice</span></b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">SNAPSHOT_TIMEOUT=15
</code></pre><br>
<br>
<b>Defining whether or not to enable compression (1 = enable, 0 = 
disable):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">ENABLE_COMPRESSION=0
</code></pre><br>
<br>
<b><span style="color: red;">NOTE:</span></b> With ESXi 3.x &amp; 4.x, 
there is a limitation of the maximum size of a VM for compression. This 
is a limitation within the unsupported Busybox Console and <u>should</u>
 not affect backups running classic ESX 3.x or 4.x, on ESXi 3.x the 
largest supported VM is 4GB for compression and on ESXi 4.x the largest 
supported VM is 8GB. If you try to compress a larger VM, you <u>may</u> 
run into issues when trying to extract upon a restore. <b>PLEASE TEST 
THE RESTORE PROCESS BEFORE MOVING TO PRODUCTION SYSTEMS!</b><br>
<br>
<b>Defining the adapter type for backed up VMDK (buslogic and lsilogic 
are available):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">ADAPTER_FORMAT=buslogic
</code></pre><br>
<br>
<b>Defining whether virtual machine memory is snapped and if quiescing 
is enabled (1 = enable, 0 = disable):</b><br>
<br>
<b><span style="color: green;">Note: By default both are disabled</span></b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">VM_SNAPSHOT_MEMORY=0
VM_SNAPSHOT_QUIESCE=0
</code></pre><br>
<br>
<b><span style="color: red;">NOTE:</span></b> <b>VM_SNAPSHOT_MEMORY</b> 
is only used to ensure when the snapshot is taken, it's memory contents 
are also captured. This is only relevant to the actual snapshot and it's
 not used in any shape/way/form in regards to the backup. All backups 
taken whether your VM is running or offline will result in an offline VM
 backup when you restore. This was originally added for debugging 
purposes and in generally should be left disabled<br>
<br>
<b>Defining VMDK(s) to backup from a particular VM either a list of 
vmdks or "all"</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">VMDK_FILES_TO_BACKUP="myvmdk.vmdk"
</code></pre><br>
<br>
<b><span style="color: red;">NOTE:</span></b> Only supported if you are 
running vSphere 4.1 and this feature is experimental. The reason this is
 listed as experimental is it may not be compatible with all email 
servers as the script utlizes <b>nc</b> (netcat) utility to communicate 
to an email server. This feature is provided as-is with no guarantees. 
If you enable this feature, a seperate log will be generated along side 
any normal logging which will be used to email recipient. If for 
whatever reason, the email fails to send, an entry will appear per the 
normal logging mechenisum. <br>
<br>
<b>Defining whether or not to email backup logs (1 = yes, 0 = no):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">EMAIL_LOG=1
</code></pre><br>
<br>
<b>Defining whether or not to email message will be deleted off the host
 whether it is successful in sending, this is used for debugging 
purposes. (1 = yes, 0 = no):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">EMAIL_DEBUG=1
</code></pre><br>
<br>
<b>Defining email server:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">EMAIL_SERVER=auroa.primp-industries.com
</code></pre><br>
<br>
<b>Defining email server port:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">EMAIL_SERVER_PORT=25
</code></pre><br>
<br>
<b>Defining recipient of he email:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">EMAIL_TO=auroa@primp-industries.com
</code></pre><br>
<br>
<b>Defining from user which may require specific domain entry depending 
on email server configurations:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">EMAIL_FROM=root@ghettoVCB
</code></pre><br>
<br>
<b>Defining to support RSYNC symbolic link creation (1 = yes, 0 = no):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">RSYNC_LINK
</code></pre><br>
<p>
<br>
</p><ul>
<li>A sample global ghettoVCB configuration file is included with the 
download called <b>ghettoVCB.conf</b>. It contains the same variables as
 defined from above and allows a user to customize and define multiple 
global configurations based on a user's environment. </li>
</ul>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ghettoVCB]# cat ghettoVCB.conf
VM_BACKUP_VOLUME=/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
DISK_BACKUP_FORMAT=thin
VM_BACKUP_ROTATION_COUNT=3
POWER_VM_DOWN_BEFORE_BACKUP=0
ENABLE_HARD_POWER_OFF=0
ITER_TO_WAIT_SHUTDOWN=3
POWER_DOWN_TIMEOUT=5
ENABLE_COMPRESSION=0
ADAPTER_FORMAT=buslogic
VM_SNAPSHOT_MEMORY=0
VM_SNAPSHOT_QUIESCE=0
ENABLE_NON_PERSISTENT_NFS=0
UNMOUNT_NFS=0
NFS_SERVER=172.30.0.195
NFS_MOUNT=/nfsshare
NFS_LOCAL_NAME=nfs_storage_backup
NFS_VM_BACKUP_DIR=mybackups
SNAPSHOT_TIMEOUT=15
EMAIL_LOG=0
EMAIL_DEBUG=0
EMAIL_SERVER=auroa.primp-industries.com
EMAIL_SERVER_PORT=25
EMAIL_TO=auroa@primp-industries.com
EMAIL_FROM=root@ghettoVCB
</code></pre><br>
<br>
To override any existing configurations within the ghettoVCB.sh script 
and to use a global configuration file, user just needs to specify the 
new flag -g and path to global configuration file (For an example, 
please refer to the sample execution section of the documenation)<br>
<br>
<b>Ensure that you do not edit past this section:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">########################## DO NOT MODIFY PAST THIS LINE ##########################
</code></pre><br>
<br>
<hr>
<br>
<h1>Usage:</h1>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ghettoVCB]# ./ghettoVCB.sh
###############################################################################
#
# ghettoVCB for ESX/ESXi 3.5 &amp; 4.x+
# Author: William Lam
# http://www.virtuallyghetto.com/
# Created: 11/17/2008
# Last modified: 07/27/2010
#
###############################################################################

Usage: ghettoVCB/ghettoVCB.sh -f [VM_BACKUP_UP_LIST] -c [VM_CONFIG_DIR] -l [LOG_FILE] -d [DEBUG_LEVEL] -g [GLOBAL_CONF] -e [VM_EXCLUSION_LIST]

OPTIONS:
   -a     Backup all VMs on host
   -f     List of VMs to backup
   -c     VM configuration directory for VM backups
   -g     Path to global ghettoVCB configuration file
   -l     File to output logging
   -d     Debug level [info|debug|dryrun] (default: info)

(e.g.)

Backup VMs stored in a list
        ghettoVCB/ghettoVCB.sh -f vms_to_backup

Backup all VMs residing on this host
        ghettoVCB/ghettoVCB.sh -a

Backup all VMs residing on this host except for the VMs in the exclusion list
        ghettoVCB/ghettoVCB.sh -a -e vm_exclusion_list

Backup VMs based on specific configuration located in directory
        ghettoVCB/ghettoVCB.sh -f vms_to_backup -c vm_backup_configs

Backup VMs using global ghettoVCB configuration file
        ghettoVCB/ghettoVCB.sh -f vms_to_backup -g /global/ghettoVCB.conf

Output will log to /tmp/ghettoVCB.log
        ghettoVCB/ghettoVCB.sh -f vms_to_backup -l /tmp/ghettoVCB.log

Dry run (no backup will take place)
        ghettoVCB/ghettoVCB.sh -f vms_to_backup -d dryrun

</code></pre><br>
<br>
The input to this script is a file that contains the display name of the
 virtual machine(s) separated by a newline. When creating this file on a
 non-Linux/UNIX system, you may introduce ^M character which can cause 
the script to miss-behave. To ensure this does not occur, plesae create 
the file on the ESX/ESXi host.<br>
<br>
Here is a sample of what the file would look like:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# cat vms_to_backup
VCAP
VIMA
vMA-2
</code></pre><br>
<br>
<hr>
<br>
<h1>Sample Execution:</h1>
<ul>
<li>Backup VMs stored in a list</li>
<li>Backup All VMs residing on specific ESX(i) host</li>
<li>Backup VMs based on individual VM backup policies</li>
<li>Debug Mode</li>
<li>Dry run Mode</li>
</ul>
<br>
<h2>Backup VMs stored in a list</h2>
<ul>
<li>Log verbosity: info (default)</li>
<li>Log output: stdout (default)</li>
</ul>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# ./ghettoVCB.sh -f vms_to_backup

2009-11-12 06:14:10 -- info: ============================== ghettoVCB LOG START ==============================

2009-11-12 06:14:10 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:14:10 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:14:10 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:14:10 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:14:10 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:14:10 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:14:10 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-11-12 06:14:10 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:14:10 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:14:10 -- info: CONFIG - LOG_LEVEL = info
2009-11-12 06:14:10 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-12 06:14:10 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-12 06:14:10 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:14:10 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-12 06:14:15 -- info: Initiate backup for VCAP
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP_2.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP_1.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP-0.vmdk'...
Clone: 100% done.
2009-11-12 06:15:15 -- info: Backup Duration: 60 Seconds
2009-11-12 06:15:15 -- info: Successfully completed backup for VCAP!

2009-11-12 06:15:17 -- info: Initiate backup for VIMA
2009-11-12 06:15:17 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-11-12" for VIMA
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Savvio/VIMA/VIMA.vmdk'...
Clone: 100% done.
2009-11-12 06:16:40 -- info: Removing snapshot from VIMA ...
2009-11-12 06:16:43 -- info: Backup Duration: 1.43 Minutes
2009-11-12 06:16:43 -- info: Successfully completed backup for VIMA!

2009-11-12 06:16:47 -- info: Initiate backup for vMA-2
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Constellation/vMA-2/vMA-2.vmdk'...
Clone: 100% done.
2009-11-12 06:18:14 -- info: Backup Duration: 1.45 Minutes
2009-11-12 06:18:14 -- info: Successfully completed backup for vMA-2!

2009-11-12 06:18:14 -- info: ============================== ghettoVCB LOG END ================================

</code></pre><br>
<br>
<h2>Backup All VMs residing on specific ESX(i) host</h2>
<ul>
<li>Log verbosity: info (default)</li>
<li>Log output: stdout (default)</li>
</ul>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/ghettoVCB # ./ghettoVCB.sh -a
2010-04-20 23:42:48 -- info: ============================== ghettoVCB LOG START ==============================

2010-04-20 23:42:48 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2010-04-20 23:42:48 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2010-04-20 23:42:48 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 2010-04-20_23-42-48
2010-04-20 23:42:48 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2010-04-20 23:42:48 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-04-20 23:42:48 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-04-20 23:42:48 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-04-20 23:42:48 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-04-20 23:42:48 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-04-20 23:42:48 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-04-20 23:42:48 -- info: CONFIG - LOG_LEVEL = info
2010-04-20 23:42:48 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2010-04-20 23:42:48 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-04-20 23:42:48 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-04-20 23:42:48 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-04-20 23:42:52 -- info: Initiate backup for goldmaster
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/esxi4-1-local-storage-1/goldmaster/goldmaster.vmdk'...
Clone: 100% done.
2010-04-20 23:42:53 -- info: Backup Duration: 1 Seconds
2010-04-20 23:42:53 -- info: Successfully completed backup for goldmaster!

2010-04-20 23:42:55 -- info: Initiate backup for ft-test-vm
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/iSCSI-2/ft-test-vm/ft-test-vm.vmdk'...
Clone: 100% done.
2010-04-20 23:43:18 -- info: Backup Duration: 23 Seconds
2010-04-20 23:43:18 -- info: Successfully completed backup for ft-test-vm!

2010-04-20 23:43:18 -- info: Snapshot found for VA-Tomcat, backup will not take place

2010-04-20 23:43:19 -- info: Initiate backup for vMA
2010-04-20 23:43:19 -- info: Creating Snapshot "ghettoVCB-snapshot-2010-04-20" for vMA
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/esxi4-1-local-storage-1/vMA/vMA.vmdk'...
Clone: 100% done.
2010-04-20 23:43:25 -- info: Removing snapshot from vMA ...
2010-04-20 23:43:30 -- info: Backup Duration: 11 Seconds
2010-04-20 23:43:30 -- info: Successfully completed backup for vMA!

2010-04-20 23:43:30 -- info: ###### Final status: ERROR: Only some of the VMs backed up! ######

2010-04-20 23:43:30 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
<h2>Backup All VMs residing on specific ESX(i) host and exclude the VMs 
in the exclusion list</h2>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/ghettoVCB # ./ghettoVCB.sh -a -e vm_exclusion_list
</code></pre><br>
<br>
<h2>Backup VMs based on individual VM backup policies and log output to 
/tmp/ghettoVCB.log</h2>
<ul>
<li>Log verbosity: info (default)</li>
<li>Log output: /tmp/ghettoVCB.log (default)</li>
</ul>
<br>
1. Create folder to hold individual VM backup policies (can be named 
anything):<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# mkdir backup_config
</code></pre><br>
<br>
2. Create individual VM backup policies for each VM that ensure each 
file is named exactly as the display name of the VM being backed up (use
 provided template to create duplicates):<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya backup_config]# cp ghettoVCB-vm_backup_configuration_template VCAP
[root@himalaya backup_config]# cp ghettoVCB-vm_backup_configuration_template VIMA
</code></pre><br>
<br>
Listing of VM backup policy within backup configuration directory<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya backup_config]# ls
ghettoVCB-vm_backup_configuration_template  VCAP  VIMA
</code></pre><br>
<br>
Backup policy for "VCAP" (backup only 2 specific VMDKs)<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya backup_config]# cat VCAP
VM_BACKUP_VOLUME=/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
DISK_BACKUP_FORMAT=thin
VM_BACKUP_ROTATION_COUNT=3
POWER_VM_DOWN_BEFORE_BACKUP=0
ENABLE_HARD_POWER_OFF=0
ITER_TO_WAIT_SHUTDOWN=4
POWER_DOWN_TIMEOUT=5
SNAPSHOT_TIMEOUT=15
ENABLE_COMPRESSION=0
ADAPTER_FORMAT=buslogic
VM_SNAPSHOT_MEMORY=0
VM_SNAPSHOT_QUIESCE=0
VMDK_FILES_TO_BACKUP="VCAP.vmdk,VCAP_2.vmdk"
</code></pre><br>
<br>
Backup policy for VM "VIMA" (backup all VMDKs found)<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya backup_config]# cat VIMA
VM_BACKUP_VOLUME=/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
DISK_BACKUP_FORMAT=thin
VM_BACKUP_ROTATION_COUNT=3
POWER_VM_DOWN_BEFORE_BACKUP=0
ENABLE_HARD_POWER_OFF=0
ITER_TO_WAIT_SHUTDOWN=4
POWER_DOWN_TIMEOUT=5
SNAPSHOT_TIMEOUT=15
ENABLE_COMPRESSION=0
ADAPTER_FORMAT=buslogic
VM_SNAPSHOT_MEMORY=1
VM_SNAPSHOT_QUIESCE=0
VMDK_FILES_TO_BACKUP="all"

</code></pre><br>
<br>
<span style="color: red;"><b>Note:</b></span> When specifying -c option 
(individual VM backup policy mode) if a VM is listed in the backup list 
but <b>DOES NOT</b> have a corresponding backup policy, the VM will be 
backed up using the default configuration found within the ghettoVCB.sh 
script.<br>
<br>
Execution of backup<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# ./ghettoVCB.sh -f vms_to_backup -c backup_config -l /tmp/ghettoVCB.log

Logging output to "/tmp/ghettoVCB.log" ...
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP_2.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Savvio/VIMA/VIMA.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Constellation/vMA-2/vMA-2.vmdk'...
Clone: 100% done.

</code></pre><br>
<br>
<span style="color: red;"><b>Note:</b></span> When specifying the -l 
option (log output to file), vmkfstools copy is also logged to stdout. 
This is done primarily for debugging purposes.<br>
<br>
Log output from backup<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# cat /tmp/ghettoVCB.log

2009-11-12 06:26:53 -- info: ============================== ghettoVCB LOG START ==============================

2009-11-12 06:26:56 -- info: CONFIG - USING CONFIGURATION FILE = backup_config/VCAP
2009-11-12 06:26:56 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:26:56 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:26:56 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:26:56 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:26:56 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:26:56 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:26:56 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4
2009-11-12 06:26:56 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:26:56 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:26:56 -- info: CONFIG - LOG_LEVEL = info
2009-11-12 06:26:56 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB.log
2009-11-12 06:26:56 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-12 06:26:56 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:26:56 -- info: CONFIG - VMDK_FILES_TO_BACKUP = VCAP.vmdk,VCAP_2.vmdk

2009-11-12 06:26:58 -- info: Initiate backup for VCAP
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP_2.vmdk'...
Clone: 100% done.
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP.vmdk'...
Clone: 100% done.
2009-11-12 06:26:59 -- info: Backup Duration: 1 Seconds
2009-11-12 06:26:59 -- info: Successfully completed backup for VCAP!

2009-11-12 06:26:59 -- info: CONFIG - USING CONFIGURATION FILE = backup_config/VIMA
2009-11-12 06:26:59 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:26:59 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:26:59 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:26:59 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:26:59 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:26:59 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:26:59 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4
2009-11-12 06:26:59 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:26:59 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:26:59 -- info: CONFIG - LOG_LEVEL = info
2009-11-12 06:26:59 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB.log
2009-11-12 06:26:59 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1
2009-11-12 06:26:59 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:26:59 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-12 06:27:02 -- info: Initiate backup for VIMA
2009-11-12 06:27:02 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-11-12" for VIMA
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Savvio/VIMA/VIMA.vmdk'...
Clone: 100% done.
2009-11-12 06:29:28 -- info: Removing snapshot from VIMA ...
2009-11-12 06:29:31 -- info: Backup Duration: 2.48 Minutes
2009-11-12 06:29:31 -- info: Successfully completed backup for VIMA!

2009-11-12 06:29:31 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:29:31 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:29:31 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:29:31 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:29:31 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:29:31 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:29:31 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-11-12 06:29:31 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:29:31 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:29:31 -- info: CONFIG - LOG_LEVEL = info
2009-11-12 06:29:31 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB.log
2009-11-12 06:29:31 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-12 06:29:31 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:29:31 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-12 06:29:35 -- info: Initiate backup for vMA-2
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Constellation/vMA-2/vMA-2.vmdk'...
Clone: 100% done.
2009-11-12 06:31:05 -- info: Backup Duration: 1.50 Minutes
2009-11-12 06:31:05 -- info: Successfully completed backup for vMA-2!

2009-11-12 06:31:05 -- info: ============================== ghettoVCB LOG END ================================

</code></pre><br>
<br>
<h2>Debug backup mode</h2>
<ul>
<li>Log verbosity: debug</li>
<li>Log output: stdout</li>
</ul>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# ./ghettoVCB.sh -f vms_to_backup -c backup_config -d debug
2009-11-13 19:51:47 -- info: ============================== ghettoVCB LOG START ==============================

2009-11-13 19:51:47 -- debug: HOST BUILD: VMware ESX 4.0.0 build-164009
2009-11-13 19:51:47 -- debug: HOSTNAME: himalaya.primp-industries.com

2009-11-13 19:51:51 -- info: CONFIG - USING CONFIGURATION FILE = backup_config/VCAP
2009-11-13 19:51:51 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-13 19:51:51 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-13 19:51:51 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-13 19:51:51 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-13 19:51:51 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-13 19:51:51 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-13 19:51:51 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4
2009-11-13 19:51:51 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-13 19:51:51 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-13 19:51:51 -- info: CONFIG - LOG_LEVEL = debug
2009-11-13 19:51:51 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-13 19:51:51 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-13 19:51:51 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-13 19:51:51 -- info: CONFIG - VMDK_FILES_TO_BACKUP = VCAP.vmdk,VCAP_2.vmdk

2009-11-13 19:51:52 -- info: Initiate backup for VCAP
2009-11-13 19:51:52 -- debug: findVMDK() - Searching for VMDK: "VCAP_2.vmdk" to backup
2009-11-13 19:51:52 -- debug: findVMDK() - Found VMDK! - "VCAP_2.vmdk" to backup
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP_2.vmdk'...
Clone: 100% done.
2009-11-13 19:51:53 -- debug: findVMDK() - Searching for VMDK: "VCAP_1.vmdk" to backup
2009-11-13 19:51:53 -- debug: findVMDK() - Searching for VMDK: "VCAP.vmdk" to backup
2009-11-13 19:51:53 -- debug: findVMDK() - Found VMDK! - "VCAP.vmdk" to backup
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP.vmdk'...
Clone: 100% done.
2009-11-13 19:51:53 -- debug: findVMDK() - Searching for VMDK: "VCAP-0.vmdk" to backup
2009-11-13 19:51:54 -- info: Backup Duration: 2 Seconds
2009-11-13 19:51:54 -- info: Successfully completed backup for VCAP!

2009-11-13 19:51:54 -- info: CONFIG - USING CONFIGURATION FILE = backup_config/VIMA
2009-11-13 19:51:54 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-13 19:51:54 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-13 19:51:54 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-13 19:51:54 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-13 19:51:54 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-13 19:51:54 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-13 19:51:54 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4
2009-11-13 19:51:54 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-13 19:51:54 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-13 19:51:54 -- info: CONFIG - LOG_LEVEL = debug
2009-11-13 19:51:54 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-13 19:51:54 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1
2009-11-13 19:51:54 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-13 19:51:54 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-13 19:51:56 -- info: Initiate backup for VIMA
2009-11-13 19:51:56 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-11-13" for VIMA
2009-11-13 19:51:58 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2009-11-13" to be created
2009-11-13 19:51:58 -- debug: Snapshot timeout set to: 900 seconds
2009-11-13 19:52:01 -- debug: Waiting for snapshot creation to be completed - Iteration: 0 - sleeping for 60secs (Duration: 0 seconds)
2009-11-13 19:53:03 -- debug: findVMDK() - Searching for VMDK: "VIMA.vmdk" to backup
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Savvio/VIMA/VIMA.vmdk'...
Clone: 100% done.
2009-11-13 19:54:27 -- info: Removing snapshot from VIMA ...
2009-11-13 19:54:32 -- info: Backup Duration: 2.60 Minutes
2009-11-13 19:54:32 -- info: Successfully completed backup for VIMA!

2009-11-13 19:54:32 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-13 19:54:32 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-13 19:54:32 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-13 19:54:32 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-13 19:54:32 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-13 19:54:32 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-13 19:54:32 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-11-13 19:54:32 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-13 19:54:32 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-13 19:54:32 -- info: CONFIG - LOG_LEVEL = debug
2009-11-13 19:54:32 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-13 19:54:32 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-13 19:54:32 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-13 19:54:32 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-13 19:54:35 -- info: Initiate backup for vMA-2
2009-11-13 19:54:35 -- debug: findVMDK() - Searching for VMDK: "vMA-2.vmdk" to backup
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/himalaya-local-SAS.Constellation/vMA-2/vMA-2.vmdk'...
Clone: 100% done.
2009-11-13 19:56:10 -- info: Backup Duration: 1.58 Minutes
2009-11-13 19:56:10 -- info: Successfully completed backup for vMA-2!

2009-11-13 19:56:10 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
<h2>Dry run Mode (no backup will take place)</h2>
<ul>
<li>Log verbosity: drymode</li>
<li>Log output: stdout</li>
</ul>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# ./ghettoVCB.sh -f vms_to_backup -c backup_config -d dryrun

2009-11-12 06:32:57 -- info: ============================== ghettoVCB LOG START ==============================

2009-11-12 06:33:01 -- info: CONFIG - USING CONFIGURATION FILE = backup_config/VCAP
2009-11-12 06:33:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:33:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:33:01 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:33:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:33:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:33:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:33:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4
2009-11-12 06:33:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:33:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:33:01 -- info: CONFIG - LOG_LEVEL = dryrun
2009-11-12 06:33:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-12 06:33:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-12 06:33:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:33:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = VCAP.vmdk,VCAP_2.vmdk

2009-11-12 06:33:01 -- dryrun: ###############################################
2009-11-12 06:33:01 -- dryrun: Virtual Machine: VCAP
2009-11-12 06:33:01 -- dryrun: VM_ID: 2784
2009-11-12 06:33:01 -- dryrun: VMX_PATH: /vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP/VCAP.vmx
2009-11-12 06:33:01 -- dryrun: VMX_DIR: /vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/VCAP
2009-11-12 06:33:01 -- dryrun: VMX_CONF: VCAP/VCAP.vmx
2009-11-12 06:33:01 -- dryrun: VMFS_VOLUME: himalaya-local-SATA.RE4-GP:Storage
2009-11-12 06:33:01 -- dryrun: VMDK(s):
2009-11-12 06:33:01 -- dryrun:  VCAP_2.vmdk
2009-11-12 06:33:01 -- dryrun:  VCAP_1.vmdk
2009-11-12 06:33:01 -- dryrun:  VCAP.vmdk
2009-11-12 06:33:01 -- dryrun:  VCAP-0.vmdk
2009-11-12 06:33:01 -- dryrun: ###############################################

2009-11-12 06:33:01 -- info: CONFIG - USING CONFIGURATION FILE = backup_config/VIMA
2009-11-12 06:33:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:33:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:33:01 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:33:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:33:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:33:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:33:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4
2009-11-12 06:33:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:33:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:33:01 -- info: CONFIG - LOG_LEVEL = dryrun
2009-11-12 06:33:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-12 06:33:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1
2009-11-12 06:33:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:33:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-12 06:33:01 -- dryrun: ###############################################
2009-11-12 06:33:01 -- dryrun: Virtual Machine: VIMA
2009-11-12 06:33:01 -- dryrun: VM_ID: 4064
2009-11-12 06:33:01 -- dryrun: VMX_PATH: /vmfs/volumes/himalaya-local-SAS.Savvio/VIMA/VIMA.vmx
2009-11-12 06:33:01 -- dryrun: VMX_DIR: /vmfs/volumes/himalaya-local-SAS.Savvio/VIMA
2009-11-12 06:33:01 -- dryrun: VMX_CONF: VIMA/VIMA.vmx
2009-11-12 06:33:01 -- dryrun: VMFS_VOLUME: himalaya-local-SAS.Savvio
2009-11-12 06:33:01 -- dryrun: VMDK(s):
2009-11-12 06:33:01 -- dryrun:  VIMA.vmdk
2009-11-12 06:33:01 -- dryrun: ###############################################

2009-11-12 06:33:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-12 06:33:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-12 06:33:01 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2009-11-12 06:33:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-12 06:33:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-12 06:33:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-12 06:33:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-11-12 06:33:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-12 06:33:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-12 06:33:01 -- info: CONFIG - LOG_LEVEL = dryrun
2009-11-12 06:33:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-12 06:33:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-12 06:33:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-12 06:33:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-12 06:33:01 -- dryrun: ###############################################
2009-11-12 06:33:01 -- dryrun: Virtual Machine: vMA-2
2009-11-12 06:33:01 -- dryrun: VM_ID: 4960
2009-11-12 06:33:01 -- dryrun: VMX_PATH: /vmfs/volumes/himalaya-local-SAS.Constellation/vMA-2/vMA-2.vmx
2009-11-12 06:33:01 -- dryrun: VMX_DIR: /vmfs/volumes/himalaya-local-SAS.Constellation/vMA-2
2009-11-12 06:33:01 -- dryrun: VMX_CONF: vMA-2/vMA-2.vmx
2009-11-12 06:33:01 -- dryrun: VMFS_VOLUME: himalaya-local-SAS.Constellation
2009-11-12 06:33:01 -- dryrun: VMDK(s):
2009-11-12 06:33:02 -- dryrun:  vMA-2.vmdk
2009-11-12 06:33:02 -- dryrun: ###############################################

2009-11-12 06:33:02 -- info: ============================== ghettoVCB LOG END ================================

</code></pre><br>
<br>
<hr>
<br>
<h1>Enable compression for backups ( <span style="color: red;"> 
EXPERIMENTAL SUPPORT</span> ):</h1>
<br>
Please take a look at FAQ #25 for more details before continuing<br>
<br>
To make use of this feature, modify the variable <b>ENABLE_COMPRESSION</b>
 from 0 to 1. Please note, do not mix  uncompressed backups with 
compressed backups. Ensure that directories selected for backups do not 
contain any backups with previous versions of ghettoVCB before enabling 
and implementing the compressed backups feature.<hr>
<br>
<h1>Email Backup Logs  ( <span style="color: red;"> EXPERIMENTAL SUPPORT</span>
 ):</h1>
<br>
nc (netcat) utility must be present for email support to function.<hr>
<br>
<h1>Rsync Support  ( <span style="color: red;"> EXPERIMENTAL SUPPORT</span>
 ):</h1>
<br>
To make use of this feature, modify the variable <b>RSYNC_LINK</b> from 0
 to 1. Please note, this is an experimental feature request from users 
that rely on rsync to replicate changes from one datastore volume to 
another datastore volume. The premise of this feature is to have a 
standardized folder that rsync can monitor for changes to replicate to 
another backup datastore. When this feature is enabled, a symbolic link 
will be generated with the format of "&lt;VMNAME&gt;-symlink" and will 
reference the latest successful VM backup. You can then rely on this 
symbolic link to watch for changes and replicate to your backup 
datastore. <br>
<br>
Here is an example of what this would look like:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ghettoVCB]# ls -la /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS/vcma/
total 0
drwxr-xr-x 1 nobody nobody 110 Sep 27 08:08 .
drwxr-xr-x 1 nobody nobody  17 Sep 16 14:01 ..
lrwxrwxrwx 1 nobody nobody  89 Sep 27 08:08 vcma-symlink -&gt; /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS/vcma/vcma-2010-09-27_08-07-37
drwxr-xr-x 1 nobody nobody  58 Sep 27 08:04 vcma-2010-09-27_08-04-26
drwxr-xr-x 1 nobody nobody  58 Sep 27 08:06 vcma-2010-09-27_08-05-55
drwxr-xr-x 1 nobody nobody  58 Sep 27 08:08 vcma-2010-09-27_08-07-37
</code></pre><br>
<br>
<b><span style="color: red;">FYI - </span></b> This feature has not been
 tested, please provide feedback if this does not work as expected.<hr>
<br>
<h1>Restore backups (ghettoVCB-restore.sh):</h1>
<br>
To recover a VM that has been processed by ghettoVCB, please take a look
 at this document: <a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10595">Ghetto Tech Preview -
 ghettoVCB-restore.sh - Restoring VM's backed up from ghettoVCB to 
ESX(i) 3.5 and 4.x+</a><br>
<br>
<hr>
<br>
<h1>Cronjob FAQ:</h1>
<br>
<a class="jive-link-external" 
href="http://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/">Please
 take a moment to read over what is a cronjob and how to set one up, 
before continuing</a><br>
<br>
The task of configuring cronjobs on classic ESX servers (with Service 
Console) is no different than traditional cronjobs on *nix operating 
systems (this procedure is outlined in the link above). With ESXi on the
 other hand, additional factors need to be taken into account when 
setting up cronjobs in the limited shell console called Busybox because 
changes made do not persist through a system reboot. The following 
document will outline steps to ensure that cronjob configurations are 
saved and present upon a reboot. <br>
<br>
<b>Task</b>: Configure ghettoVCB.sh to execute a backup five days a week
 (M-F) at 12AM (midnight) everyday and send output to a unique log file<br>
<br>
<u><b>Configure on ESX:</b></u><br>
<br>
1. As root, you'll install your cronjob by issuing:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# crontab -e
</code></pre><br>
<br>
2. Append the following entry:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">0 0 * * 1-5 /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/ghettoVCB.sh -f /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/backuplist &gt; /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/ghettoVCB-backup-$(date +\%s).log
</code></pre><br>
<br>
3. Save and exit<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya dlgCore-NFS-bigboi.VM-Backups]# crontab -e
no crontab for root - using an empty one
crontab: installing new crontab
</code></pre><br>
<br>
4. List out and verify the cronjob that was just created:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya dlgCore-NFS-bigboi.VM-Backups]# crontab -l
0 0 * * 1-5 /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/ghettoVCB.sh -f /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/backuplist &gt; /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/ghettoVCB-backup-$(date +\%s).log
</code></pre><br>
<br>
You're ready to go!<br>
<br>
<u><b>Configure on ESXi:</b></u><br>
<br>
1. Setup the cronjob by appending the following line to <u>/var/spool/cron/crontabs/root</u>:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">0 0 * * 1-5 /vmfs/volumes/simplejack-local-storage/ghettoVCB.sh -f /vmfs/volumes/simplejack-local-storage/backuplist &gt; /vmfs/volumes/simplejack-local-storage/ghettoVCB-backup-$(date +\%s).log
</code></pre><br>
<br>
2. Kill the current crond (cron daemon) and then restart the crond for 
the changes to take affect:<br>
<br>
On ESXi &lt; 3.5u3<br>
<pre class="jive-pre"><code class="jive-code jive-plain">kill $(ps | grep crond | cut -f 1 -d ' ')
</code></pre><br>
<br>
On ESXi 3.5u3+<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # kill $(pidof crond)
~ # crond
</code></pre><br>
<br>
On ESXi 4.0<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # kill $(cat /var/run/crond.pid)
~ # busybox crond
</code></pre><br>
<br>
3. Now that the cronjob is ready to go, you need to ensure that this 
cronjob will persist through a reboot. You'll need to add the following 
two lines to <b>/etc/rc.local</b> (ensure that the cron entry matches 
what was defined above)<br>
<br>
On ESXi 3.5<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/bin/kill $(pidof crond)
/bin/echo "0 0 * * 1-5 /vmfs/volumes/simplejack-local-storage/ghettoVCB.sh -f /vmfs/volumes/simplejack-local-storage/backuplist &gt; /vmfs/volumes/simplejack-local-storage/ghettoVCB-backup-\$(date +\\%s).log" &gt;&gt; /var/spool/cron/crontabs/root
crond
</code></pre><br>
<br>
On ESXi 4.0<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/bin/kill $(cat /var/run/crond.pid)
/bin/echo "0 0 * * 1-5 /vmfs/volumes/simplejack-local-storage/ghettoVCB.sh -f /vmfs/volumes/simplejack-local-storage/backuplist &gt; /vmfs/volumes/simplejack-local-storage/ghettoVCB-backup-\$(date +\\%s).log" &gt;&gt; /var/spool/cron/crontabs/root
/bin/busybox crond
</code></pre><br>
<br>
Afterwards the file should look like the following: <br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # cat /etc/rc.local
#! /bin/ash
export PATH=/sbin:/bin

log() {
   echo "$1"
   logger init "$1"
}

#execute all service retgistered in /etc/rc.local.d
if [http:// -d /etc/rc.local.d |http:// -d /etc/rc.local.d ]; then
   for filename in `find /etc/rc.local.d/ | sort`
      do
         if [ -f $filename ] &amp;&amp; [ -x $filename ]; then
            log "running $filename"
            $filename
         fi
      done
fi

/bin/kill $(cat /var/run/crond.pid)
/bin/echo "0 0 * * 1-5 /vmfs/volumes/simplejack-local-storage/ghettoVCB.sh -f /vmfs/volumes/simplejack-local-storage/backuplist &gt; /vmfs/volumes/simplejack-local-storage/ghettoVCB-backup-\$(date +\\%s).log" &gt;&gt; /var/spool/cron/crontabs/root
/bin/busybox crond

</code></pre><br>
<br>
This will ensure that the cronjob is re-created upon a reboot of the 
system through a startup script<br>
<br>
2. To ensure that this is saved in the ESXi configuration, we need to 
manually initiate an ESXi backup by running:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # /sbin/auto-backup.sh
config implicitly loaded
local.tgz
etc/vmware/vmkiscsid/vmkiscsid.db
etc/dropbear/dropbear_dss_host_key
etc/dropbear/dropbear_rsa_host_key
etc/opt/vmware/vpxa/vpxa.cfg
etc/opt/vmware/vpxa/dasConfig.xml
etc/sysconfig/network
etc/vmware/hostd/authorization.xml
etc/vmware/hostd/hostsvc.xml
etc/vmware/hostd/pools.xml
etc/vmware/hostd/vmAutoStart.xml
etc/vmware/hostd/vmInventory.xml
etc/vmware/hostd/proxy.xml
etc/vmware/ssl/rui.crt
etc/vmware/ssl/rui.key
etc/vmware/vmkiscsid/initiatorname.iscsi
etc/vmware/vmkiscsid/iscsid.conf
etc/vmware/vmware.lic
etc/vmware/config
etc/vmware/dvsdata.db
etc/vmware/esx.conf
etc/vmware/license.cfg
etc/vmware/locker.conf
etc/vmware/snmp.xml
etc/group
etc/hosts
etc/inetd.conf
etc/rc.local
etc/chkconfig.db
etc/ntp.conf
etc/passwd
etc/random-seed
etc/resolv.conf
etc/shadow
etc/sfcb/repository/root/interop/cim_indicationfilter.idx
etc/sfcb/repository/root/interop/cim_indicationhandlercimxml.idx
etc/sfcb/repository/root/interop/cim_listenerdestinationcimxml.idx
etc/sfcb/repository/root/interop/cim_indicationsubscription.idx
Binary files /etc/vmware/dvsdata.db and /tmp/auto-backup.31345.dir/etc/vmware/dvsdata.db differ
config implicitly loaded
Saving current state in /bootbank
Clock updated.
Time: 20:40:36   Date: 08/14/2009   UTC

</code></pre><br>
<br>
Now you're really done!<br>
<p>
If you're still having trouble getting the cronjob to work, ensure that 
you've specified the correct parameters and there arenâ€™t any typos in 
any part of the syntax. <br>
<br>
Ensure crond (cron daemon) is running:<br>
<br>
<b>ESX:</b><br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya dlgCore-NFS-bigboi.VM-Backups]# ps -ef | grep crond | grep -v grep
root      2625     1  0 Aug13 ?        00:00:00 crond
</code></pre><br>
<br>
<b>ESXi:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # ps | grep crond | grep -v grep
5196 5196 busybox              crond
</code></pre><br>
<br>
Ensure that the date/time on your ESX(i) host is setup correctly:<br>
<br>
<b>ESX(i):</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya dlgCore-NFS-bigboi.VM-Backups]# date
Fri Aug 14 23:44:47 PDT 2009
</code></pre><br>
<p>
<span style="color: red;"><b>Note:</b></span> Careful attention must be 
noted if more than one backup is performed per day. Backup windows 
should be staggered to avoid contention or saturation of resources 
during these periods.</p><hr>
<br>
<h1>FAQ:</h1>
<br>
<b>0Q:</b> I'm getting error X when using the script or I'm not getting 
any errors, the backup didnâ€™t even take place. What can I do?<br>
<b>0A:</b> First off, before posting a comment/question, please 
thoroughly read through the <b>ENTIRE</b> documentation <u>including</u>
 the FAQs to see if your question has already been ansered.<br>
<br>
<b>1Q:</b> I've read through the entire documentation + FAQs and still 
have not found my answer to the problem I'm seeing. What can I do? <br>
<b>1A:</b> Please provide the entire output of a manual execution (debug
 &amp; dryrun mode) and paste the output to <a 
class="jive-link-external" href="http://pastebin.com/">http://pastebin.com/</a>
 and provide a description of your environment and link to the pastebin 
post:<br>
<br>
<ul>
<li><b>ESX or ESXi</b></li>
<li><b>Version + Build</b></li>
<li><b>Number of VMs and Size</b></li>
<li><b>Backup datastore type (NFS,iSCSI/FC SAN, LOCAL)</b></li>
<li><b>OS Type hosting the backup datastore (if applicable)</b></li>
</ul>
<br>
Please do not paste the contents of the script or output of the script 
when you post, it's very hard to read and to follow.<br>
<br>
<b>2Q:</b> I've sent you private message or email but I haven't received
 a response? What gives?<br>
<b>2A:</b> I do not accept issues/bugs reported via PM or email, I will 
reply back, directing you to post on the appropriate VMTN forum (that's 
what it's for). If the data/results you're providing is truely senstive 
to your environment I will hear you out, but 99.99% it is not, so please
 do not messsage/email me directly. I do monitor all forums that contain
 my script including the normal VMTN forums and will try to get back to 
your question as soon as I can and as time permits. Please do be patient
 as you're not the only person using the script (200,000+ views), thank 
you.<br>
<br>
<b>3Q:</b> Can I schedule backups to take place hourly, daily, monthly, 
yearly?<br>
<b>3A:</b> Yes, do a search online for <b>crontab</b>. <br>
<br>
<b>4Q:</b> I would like to setup cronjob for ESX(i) 3.5 or 4.0?<br>
<b>4A:</b> Take a look at the Cronjob FAQ section in this document. <br>
<br>
<b>5Q:</b> I want to schedule my backup on Windows, how do I do this?<br>
<b>5A:</b> Do a search for <b>plink</b>. Make sure you have paired SSH 
keys setup between your Windows system and ESX/ESXi host.<br>
<br>
<b>6Q:</b> I only have a single ESXi host. I want to take backups and 
store them somewhere else. The problem is: I don't have NFS, iSCSI nor 
FC SAN. What can I do?<br>
<b>6A:</b> You can use local storage to store your backups assuming that
 you have enough space on the destination datastore.  Afterwards, you 
can use scp (WinSCP/FastSCP) to transfer the backups from the ESXi host 
to your local desktop.<br>
<br>
<b>7Q:</b> Iâ€™m pissed; the backup is taking too long. My datastore is of
 type X?<br>
<b>7A:</b> YMMV, take a look at your storage configuration and make sure
 it is optimized.  <br>
<br>
<b>8Q:</b> I noticed that the backup rotation is occurring after a 
backup. I don't have enough local storage space, can the process be 
changed?<br>
<b>8A:</b> This is primarily done to ensure that you have at least one 
good backup in case the new backup fails. If you would like to modify 
the script, you're more than welcome to do so. <br>
<br>
<b>9Q:</b> What is the best storage configuration for datastore type X?<br>
<b>9A:</b> Search the VMTN forums; there are various configurations for 
the different type of storage/etc.  <br>
<br>
<b>10Q:</b> I want to setup an NFS server to run my backups. Which is 
the best and should it be virtual or physical?  <br>
<b>10A:</b> Please refer to answer 7A. From experience, weâ€™ve seen 
physical instances of NFS servers to be faster than their virtual 
counterparts.  As always, YMMV. <br>
<br>
<b>11Q:</b> I have VMs that have snapshots. I want to back these things 
up but the script doesnâ€™t let me do it. How do I fix that?<br>
<b>11A:</b> VM snapshots are not meant to be kept for long durations. 
When backing up a VM that contains a snapshot, you should ensure all 
snapshots have been committed prior to running a backup. No exceptions 
will be madeâ€¦ever.<br>
<br>
<b>12Q:</b> I would like to restore from backup, what is the best 
method?<br>
<b>12A:</b> The restore process will be unique for each environment and 
should be determined by your backup/recovery plans. At a high level you 
have the option of mounting the backup datastore and registering the VM 
in question or copy the VM from the backup datastore to the ESX/ESXi 
host. The latter is recommended so that you're not running a VM living 
on the backup datastore or inadvertently modifying your backup VM(s).  <br>
<br>
<b>13Q:</b> When I try to run the script I get: <b>"-bash: 
./ghettoVCB.sh: Permission denied"</b>, what is wrong?<br>
<b>13A:</b> You need to change the permission on the script to be 
executable, chmod +x ghettoVCB.sh<br>
<br>
<b>14Q:</b> Where can I download the latest version of the script?<br>
<b>14A:</b> The latest version is available on this page at the bottom. 
Please take a look at the screenshot below if you still can not locate 
the download<br>
<br>
 <img class="jive-image-thumbnail" 
src="DOC-8760_files/ghettoVCBdownload.png" alt="ghettoVCBdownload.png" 
onclick="myJiveImage.start(this, 
'http://communities.vmware.com/servlet/JiveServlet/downloadImage/102-8760-64-10942/ghettoVCBdownload.png');return
 false;" height="100" width="249"> <br>
<br>
<b>15Q:</b> I would like to suggest/recommend feature X, can I get it?  
When can I get it? Why isn't it here, what gives?  <br>
<b>15A:</b> The general purpose of this script is to provide a backup 
solution around VMware VMs. Any additional features outside of that 
process will be taken into consideration depending on the amount of 
time, number of requests and actual usefulness as a whole to the 
community rather than to an individual.<br>
<br>
<b>16Q:</b> I have found this script to be very useful and would like to
 contribute back, what can I do?<br>
<b>16A:</b> To continue to develop and share new scripts and resources 
with the community, we need your support. You can donate <a 
class="jive-link-external" 
href="http://www.virtuallyghetto.com/p/how-you-can-help.html">here</a> 
Thank You!<br>
<br>
<b>17Q:</b> What are the different type of backup uses cases that are 
supported with ghettoVCB? <br>
<b>17A:</b> 1) Live backup of VM with the use of a snapshot and 2) 
Offline backup of a VM without a snapshot. These are the only two use 
cases supported by the script.<br>
<br>
<b>18Q:</b> When I execute the script on ESX(i) I get some funky errors 
such as ": not found.sh" or "command not found". What is this?<br>
<b>18A:</b> Most likely you have some ^M characters within the script 
which may have come from either editing the script using Windows editor,
 uploading the script using the datastore browser OR using wget. The 
best option is to either using WinSCP on Windows to upload the script 
and edit using vi editor on ESX(i) host OR Linux/UNIX scp to copy the 
script into the host. If you still continue to have the issue, do a 
search online on various methods of removing this Windows return 
carriage from the script<br>
<br>
<b>19Q:</b> My backup works fine but I get an error message 
"Input/output error" or "-ash: YYYY-MM-DD: not found" during the 
snapshot removal process. What is this?<br>
<b>19A:</b> All issues regarding this problem has been pin-pointed back 
to the NFS server during a deletion of a large file, this seems to be an
 environmental issue with NFS server and you can validate this by 
creating a larger file of either equal/greater than your backup file and
 try to delete the file by using 'rm -f' and you should also see no 
response. This is most likely what's occuring during the backup process 
and the script is trying to process the rotations but can not and throws
 the error. Ensure that you follow all best practices in setting up your
 NFS server and you have sufficent hardware and network to run your NFS 
server. <br>
<br>
<b>20Q:</b> Will this script function with vCenter and DRS enabled?<br>
<b>20Q:</b> No, if the ESX(i) hosts are in a DRS enabled cluster, VMs 
that are to be backed up could potentially be backed up twice or never 
get backed up. The script is executed on a per host basis and one would 
need to come up a way of tracking backups on all hosts and perhaps write
 out to external file to ensure that all VMs are backed up. The main use
 case for this script are for standalone ESX(i) host<br>
<br>
<b>21Q:</b> I'm trying to use WinSCP to manually copy VM files but it's 
very slow or never completes on huge files, why is that?<br>
<b>21A:</b> WinSCP was not designed for copying VM files out of your 
ESX(i) host, take a look at Veeam's FastSCP which is designed for moving
 VM files and is a free utility.<br>
<br>
<b>22Q:</b> Can I use setup NFS Server using Windows Services for UNIX 
(WSFU) and will it work?<br>
<b>22A:</b> I've only heard a handful of users that have successfully 
implemented WSFU and got it working, YMMV. VMware also has a KB article 
decribing the setup process here: <a class="jive-link-external" 
href="http://kb.vmware.com/kb/1004490">http://kb.vmware.com/kb/1004490</a>
 for those that are interested. <br>
<br>
<b>23Q:</b> How do VMware Snapshots work?<br>
<b>23A:</b> <a class="jive-link-external" 
href="http://kb.vmware.com/kb/1015180">http://kb.vmware.com/kb/1015180</a><br>
<br>
<b>24Q:</b> What files make up a Virtual Machine?<br>
<b>24A:</b> <a class="jive-link-external" 
href="http://virtualisedreality.wordpress.com/2009/09/16/quick-reminder-of-what-files-make-up-a-virtual-machine/">http://virtualisedreality.wordpress.com/2009/09/16/quick-reminder-of-what-files-make-up-a-virtual-machine/</a><br>
<br>
<b>25Q:</b> I'm having some issues restoring a compressed VM backup?<br>
<b>25A:</b> There is a limitation in the size of the VM for compression 
under ESXi 3.x &amp; 4.x, this limitation is in the unsupported Busybox 
console and <u>should</u> not affect classic ESX 3.x/4.x. On ESXi 3.x, 
the maximum largest supported VM is 4GB for compression and on ESXi 4.x 
the largest supported VM is 8GB. If you try to compress a larger VM, you
 <u>may</u> run into issues when trying to extract upon a restore. <b>PLEASE
 TEST THE RESTORE PROCESS BEFORE MOVING TO PRODUCTION SYSTEMS!</b><br>
<br>
<b>26Q:</b> I'm backing up my VM as "thin" format but I'm still not 
noticing any size reduction in the backup? What gives?<br>
<b>2bA:</b> Please refer to this blog post which explains what's going 
on: <a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/">http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/</a><br>
<br>
<b>27Q:</b> I've enabled <b>VM_SNAPSHOT_MEMORY</b> and when I restore my
 VM it's still offline, I thought this would keep it's memory state?<br>
<b>27A:</b> <b>VM_SNAPSHOT_MEMORY</b> is only used to ensure when the 
snapshot is taken, it's memory contents are also captured. This is only 
relavent to the actual snapshot itself and it's not used in any 
shape/way/form in regards to the backup. All backups taken whether your 
VM is running or offline will result in an offline VM backup when you 
restore. This was originally added for debugging purposes and in 
generally should be left disabled<br>
<br>
<b>28Q:</b> Can I rename the directories and the VMs after a VM has been
 backed up?<br>
<b>28A:</b> The answer yes, you can ... but you may run into all sorts 
of issues which may break the backup process. The script expects a 
certain layout and specific naming scheme for it to maintain the proper 
rotation count. If you need to move or rename a VM, please take it out 
of the directory and place it in another location<br>
<br>
<b>29Q:</b> I'm running into an issue when I backup my VMs using NFS on 
Linux, I'm able to either get 1 successful backup and all subsequent 
backups fail OR I'm having issues where snapshots are not being removed 
upon completition and future backups fail. <br>
<b>29A:</b> This problem/issue has been reported by quite a few users in
 the community and only affects a very small percentage of users overall
 under a specific configuration. The problem as I understand it today 
which is still an on-going investigation by myself and the community is 
as follows:<br>
<br>
<h3>The Setup</h3>
Setup: NFS on Linux where the underlying volume is <a 
class="jive-link-external" href="http://en.wikipedia.org/wiki/Ext3">EXT3
 filesystem</a> and backups are failing primarily around larger sized 
VMs ( &gt; 150GB). <br>
<br>
<h3>The Observed Problem</h3>
The issue is during the final phase of a VM being backed-up in the 
rotation function where a request is sent out to the NFS server to 
either A) rotate/rename a directory B) delete an old backup. There is 
either a disconnect or delay that severely affects the backup process 
that may lead to a whole slew of "unexpected" behavior from having only 1
 backup complete successful and all subsquent backups failing/etc. <br>
<br>
First off, there is nothing wrong with the script from what we've found 
it and has to do with NFS server and specifically the volume that the 
backup datastore is hosted on. Thanks to community user <b>ralfoertner</b>
 who had a simliar problem using <b><a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=2411&amp;subject=D-984">ghettoVCBg2</a></b>
 using Debian with EXT3 base filesystem for his NFS volume. He decided 
to do some additional troubleshooting to further isolate the problem and
 actually found by changing the underlying filesystem from EXT3 to XFS 
that the issue went away and resolve all issues he had ran into 
regarding an NFS on Linux backup solution. <br>
<br>
<h3>The Theory</h3>
Now, we're still 100% sure why the above solution has resolved the 
problem or what the actual problem is but I'll explain the current 
theory:<br>
<br>
<a class="jive-link-external" href="http://en.wikipedia.org/wiki/Ext3">EXT3</a>
 is a journaled filesystem, you can do a search online for more 
information. There's a few advantages with EXT3 from it's predcessor 
EXT2, but one difference is in the approach it takes with journaling as 
explained here in greater detail: <a class="jive-link-external" 
href="http://www.ibm.com/developerworks/library/l-fs7.html">http://www.ibm.com/developerworks/library/l-fs7.html</a><br>
<br>
Basically EXT2 does only "metadata journling" whereas EXT3 does both 
data and metadata journaling, this would ensure that all changes to the 
filesystem where it's data or metadata is consistent in the event of an 
unexpected system crash. With EXT3, there are 3 journaling options: ( <b>data=writeback
 mode,data=ordered mode,data=journal mode</b> ) and by default it uses <b>data=ordered
 mode</b> to ensure the consistency as described from above. <br>
<br>
One easy method to check what mount options are configured, on a Linux 
system you can check /proc/mounts:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[vi-admin@scofield ~]$ cat /proc/mounts
rootfs / rootfs rw 0 0
/dev/root / ext3 rw,data=ordered 0 0
/dev /dev tmpfs rw 0 0
/proc /proc proc rw 0 0
/sys /sys sysfs rw 0 0
/proc/bus/usb /proc/bus/usb usbfs rw 0 0
devpts /dev/pts devpts rw 0 0
/dev/VolGroup00/var /var/log ext3 rw,data=ordered 0 0
/dev/sda1 /boot ext3 rw,data=ordered 0 0
tmpfs /dev/shm tmpfs rw 0 0
none /proc/sys/fs/binfmt_misc binfmt_misc rw 0 0
</code></pre><br>
<br>
So now what does this have to do with XFS and EXT3? With the defaults of
 EXT3, it may not always give you the best performance due to the extra 
overhead of the way it does its journaling, if you were to change the 
options to <b>data=writeback mode</b>, you'll notice that this is 
simliar journaling method found in <u>XFS</u>,JFS and ResierFS as 
described here: <a class="jive-link-external" 
href="http://www.ibm.com/developerworks/library/l-fs8.html">http://www.ibm.com/developerworks/library/l-fs8.html</a><br>
<br>
<h3>The Conclusion</h3>
I believe that there are some additional overheads that maybe caused by 
using NFS on EXT3, which may explain the issue that users are seeing and
 that moving from EXT3 to XFS has "seemed" to solve the issues for those
 who have implemented the change. Though, before you go out and make 
this change, you need to understand your environment and what this 
change would exactly mean, please refer to differences in EXT2/XFS and 
EXT3, especially around a power interruption or system crash. <br>
<br>
In conclusion, I'm not recommending one way or the other, it really 
depends on your environment. Though this has shown to resolve the issue 
as users have implemented to get around this problem, but it's 
definitely worth while to really understand the problem in your 
environment and figure out why and decide on the best solution. I would 
also recommend users perform their own tests to further isolate the 
problem in their environment and try local storage, using iSCSI to see 
if they can pin-point the problem.<hr>
<br>
<h1>Our NFS Server Configuration</h1>
<br>
Many have asked what is the best configuration and recommendation for 
setting up a cheap NFS Server to run backups for VMs. This has been a 
question we've tried to stay away from just because the possiblities and
 solutions are endless. One can go with physical vs. virtual, use VSA 
(Virtual Storage Appliances) such as OpenFiler or Lefthand Networks, 
Windows vs. Linux/UNIX. We've not personally tested and verify all these
 solutions and it all comes down to "it depends" type of answer. Though 
from our experience, we've had much better success with a physical 
server than a virtual. <br>
<br>
It is also well known that some users are experiencing backup issues 
when running specifically against NFS, primarily around the rotation and
 purging of previous backups. The theory from what we can tell by 
talking to various users is that when the rotation is occuring, the 
request to delete the file(s) may take awhile and does not return within
 a certain time frame and causes the script to error out with unexpected
 messages. Though the backups were successful, it will cause unexpected 
results with directory structures on the NFS target. We've not been able
 to isolate why this is occuring and maybe due to NFS 
configuration/exports or hardware or connection not being able to 
support this process. <br>
<br>
We'll continue to help where we can in diagonising this issus but we 
wanted to share our current NFS configuration, perhaps it may help some 
users who are new or trying to setup their system. ( <b>Disclaimer:</b> 
These configurations are not recommendations nor endorsement for any of 
the components being used)<br>
<br>
<b>UPDATE:</b> Please also read FAQ #29 for details + potential 
resolution<br>
<br>
<b>Server Type:</b> Physical<br>
<b>Model:</b> HP DL320 G2<br>
<b>OS:</b> Arch linux 2.6.28<br>
<b>Disks:</b> 2 x 1.5TB<br>
<b>RAID:</b> Software RAID1<br>
<b>Source Host Backups:</b> ESX 3.5u4 and ESX 4.0u1 (We don't run any 
ESXi hosts)<br>
<br>
<b>uname -a output</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">Linux XXXXX.XXXXX.ucsb.edu 2.6.28-ARCH #1 SMP PREEMPT Sun Jan 18 20:17:17 UTC 2009 i686 Intel(R) Pentium(R) 4 CPU 3.06GHz GenuineIntel GNU/Linux
</code></pre><br>
<br>
<b>NICs:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">00:05.0 Ethernet controller: Broadcom Corporation NetXtreme BCM5702X Gigabit Ethernet (rev 02)
00:06.0 Ethernet controller: Broadcom Corporation NetXtreme BCM5702X Gigabit Ethernet (rev 02)
</code></pre><br>
<br>
<b>NFS Export Options:</b><br>
<pre class="jive-pre"><code class="jive-code jive-plain">/exports/vm-backups XXX.XXX.XXX.XXX/24(rw,async,all_squash,anonuid=99,anongid=99)
</code></pre><br>
<p>
*One important thing to check is to verify that your NFS exportion 
options are setup correctly, <b>"async"</b> should be configured to 
ensure that all IO requests are processed and reply back to the client 
before waiting for the data to be written to the storage. <br>
<br>
*Recently VMware released a KB article describing the various "Advanced 
NFS Options" and their meanings and recommendations: <a 
class="jive-link-external" href="http://kb.vmware.com/kb/1007909">http://kb.vmware.com/kb/1007909</a>
 We've not personally had to touch any of these, but for other vendors 
such as EMC and NetApp, there are some best practices around configuring
 some of these values depending on the number of NFS volumes or number 
of ESX(i) host connecting to a volume. You may want to take a look to 
see if any of these options may help with NFS issue that some are seeing<br>
<br>
*Users should also try to look at their ESX(i) host logs during the time
 interval when they're noticing these issues and see if they can find 
any correlation along with monitoring the performance on their NFS 
Server. <br>
<br>
*Lastly, there are probably other things that can be done to improve NFS
 performance or further optimization, a simple search online will also 
yield many resources.</p><hr>
<br>
<h2>Useful Links:</h2>
<br>
Windows utility to email ghettoVCB Backup Logs - <a 
class="jive-link-external" 
href="http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/">http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/</a><br>
Windows front-end utility to ghettoVCB -  <a class="jive-link-external" 
href="http://www.magikmon.com/mkbackup/ghettovcb.en.html">http://www.magikmon.com/mkbackup/ghettovcb.en.html</a><br>
<br>
<b><span style="color: red;">Note:</span></b> Neither of these tools are
 supported, for questions or comments regarding these utilities please 
refer to the author's pages. <br>
<br>
Detail instructions on how to configure/schedule ghettoVCB on Windows (<a
 class="jive-link-external" 
href="http://blog.theworldrunsontechnology.com/">Raj Perumal's The World
 Runs on Technology Blog</a>):<br>
<br>
<a class="jive-link-external" 
href="http://blog.theworldrunsontechnology.com/2009/04/backing-up-your-virtual-machines-in.html">Part
 1</a><br>
<a class="jive-link-external" 
href="http://blog.theworldrunsontechnology.com/2009/04/creating-virtual-machine-backups-in.html">Part
 2</a><br>
<a class="jive-link-external" 
href="http://blog.theworldrunsontechnology.com/2009/04/how-to-schedule-ghettovcb-backup-job-or.html">Part
 3</a><br>
<br>
If you have found this script or other scripts to be useful and would 
like to contribute back, please click <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/p/how-you-can-help.html">here</a> 
to donate! Thank You<br>
<br>
<hr>
<br>
<h2>Change log:</h2>
<br>
<h3>09/28/10 -</h3>
<br>
Enhancements:<br>
<ul>
<li>Additional email support for Microsoft IIS and email debugging 
functionality (Experimental Support)</li>
<li>ghettoVCB PID is now captured in the logs</li>
<li>Rsync support, please take a look at the above documentation for <b>Rsync
 Support</b> (Experimental Support) </li>
</ul>
<br>
Fixes:<br>
<ul>
<li>Fixed a few typos in the script</li>
<li>Trapping SIG 13</li>
</ul>
<br>
<hr>
<br>
<h3>07/27/10 -</h3>
<br>
Enhancements:<br>
<ul>
<li>Support for emailing backup logs (Experimental Support)</li>
</ul>
<br>
<hr>
<br>
<h3>07/20/10 - </h3>
<br>
Enhancements:<br>
<ul>
<li>Support for vSphere 4.1 (ESX and ESXi)</li>
<li>Additional logging information for debugging purposes</li>
</ul>
<br>
<hr>
<br>
<h3>05/12/10 - </h3>
<br>
Enhancements:<br>
<ul>
<li>Thanks to user <b>Rodder</b> who submitted a patch for a workaround 
to handle the NFS I/O issue. The script will check to see if the return 
code of the "rm" operation for VMs that are to be rotated. If the return
 code has not returned right away, we may be running into the NFS I/O 
issue, the script will not sleep and check perodically to see if NFS 
volume is responsive and then continue to the next VM for backup. </li>
</ul>
<br>
Fixes:<br>
<ul>
<li>Resolved the problem when trying to specify ghettoVCB global 
configuration file with the fullpath</li>
</ul>
<br>
<hr>
<br>
<h3>05/11/10 -</h3>
<br>
<ul>
<li>Updated useful links to 2 utilties that were written by users for 
ghettoVCB</li>
</ul>
<br>
<hr>
<br>
<h3>05/05/10 - </h3>
<br>
Fixes:<br>
<ul>
<li>Resolved an issue where VMs with spaces were not being properly 
rotated. Thanks to user <b>chrb</b> for finding the bug</li>
</ul>
<br>
<hr>
<br>
<h3>04/24/10 - </h3>
<br>
Enhancements:<br>
<ul>
<li>Added the ability to include an exclusion list of VMs to not backup</li>
</ul>
<br>
Fixes:<br>
<ul>
<li>Resolved persistent NFS configuration bug due to the addition of the
 global ghettoVCB conf</li>
</ul>
<br>
<hr>
<br>
<h3>04/23/10 -</h3>
<br>
Fixes:<br>
<ul>
<li>Resolved a bug in the VM naming directory which may not delete 
backups properly</li>
</ul>
<br>
<hr>
<br>
<h3>04/20/10 - </h3>
<br>
<ul>
<li>Support for global ghettoVCB configuration file. Users no longer 
need to edit main script and can use multiple configuration files based 
on certain environment configurations</li>
<li>Ability to backup all VMs residing on a specific host w/o specifying
 VM list</li>
<li>Implemented simple locking mechenism to ensure only 1 instance of 
ghettoVCB is running per host</li>
<li>Updated backup directory structure - rsync friendly. All backup VM 
directories will now have the format of "VMNAME-YYYY-MM-DD_HH_MM_SS" 
which will not change once the backup has been completed. The script 
will keep N-copies and purge older backups based on the configurations 
set by the user. </li>
<li>Additional logging and final status output has been added to the 
script to provide more useful error/warning messages and an additoinal 
status will be printed out at the end of each backup to provide an 
overall report</li>
</ul>
<br>
Big thanks goes out to the community for the suggested features and to 
those that submitted snippet of their modifications.<hr>
<p>
</p><h3>03/27/10 - </h3>
<p>
</p><ul>
<li>Updated FAQ #0-1 &amp; #25-29 for common issues/questions.</li>
<li>For those experiencing NFS issue, please take a look at FAQ #29</li>
<li>Re-packaged ghettoVCB.sh script within a tarball (ghettoVCB.tar.gz) 
to help assist those users having the "Windows affect" when trying to 
execute the script</li>
</ul>
<p>
</p><hr>
<p>
<br>
</p><h3>02/13/10 - </h3>
<br>
Updated FAQ #20-24 for common issues/questions. 	Also included a new 
section about our "personal" NFS configuration and setup.<hr>
<p>
<br>
</p><h3>01/31/10 - </h3>
<br>
Fix the crontab section to reflect the correct syntax + updated FAQ 
#17,#18 and #19 for common issues.<hr>
<p>
</p><h3>11/17/09 - </h3>
<br>
The following enhancements and fixes have been implemented in this 
release of ghettoVCB. Special thanks goes out to all the ghettoVCB BETA 
testers for providing time and their environments to test features/fixes
 of the new script!<br>
<br>
Enhancements:<br>
<ul>
<li>Individual VM backup policy</li>
<li>Include/exclude specific VMDK(s)</li>
<li>Logging to file</li>
<li>Timeout variables</li>
<li>Configur snapshot memory/quiesce</li>
<li>Adapter format</li>
<li>Additional logging + dryrun mode</li>
<li>Support for both physical/virtual RDMs</li>
</ul>
<p>
Fixes:<br>
</p><ul>
<li>Independent disk aware</li>
</ul>


<div class="jive-attachments">
    <strong>Attachments:</strong>
    <ul>
                <li><a 
href="http://communities.vmware.com/servlet/JiveServlet/download/8760-64-43741/ghettoVCB.tar.gz"
 class="jive-icon-doctype-compressed">ghettoVCB.tar.gz</a> (9.6 K)</li>
    </ul>
</div>

    <!-- BEGIN content details -->
    <div class="jive-wiki-details">
    <div class="jive-wiki-details-container">

        <div class="jive-wiki-tags">Tags:
                <a 
href="http://communities.vmware.com/tags/4.1?communityID=2411">4.1</a>,
                <a 
href="http://communities.vmware.com/tags/esxi4.1?communityID=2411">esxi4.1</a>,
                <a 
href="http://communities.vmware.com/tags/esx4.1?communityID=2411">esx4.1</a>,
                <a 
href="http://communities.vmware.com/tags/vsphere?communityID=2411">vsphere</a>,
                <a 
href="http://communities.vmware.com/tags/vsphere4.1?communityID=2411">vsphere4.1</a>,
                <a 
href="http://communities.vmware.com/tags/3.5?communityID=2411">3.5</a>,
                <a 
href="http://communities.vmware.com/tags/esxi?communityID=2411">esxi</a>,
                <a 
href="http://communities.vmware.com/tags/backup?communityID=2411">backup</a>,
                <a 
href="http://communities.vmware.com/tags/vcb?communityID=2411">vcb</a>,
                <a 
href="http://communities.vmware.com/tags/esx3.5?communityID=2411">esx3.5</a>,
                <a 
href="http://communities.vmware.com/tags/vmkfstools?communityID=2411">vmkfstools</a>,
                <a 
href="http://communities.vmware.com/tags/snapshot?communityID=2411">snapshot</a>,
                <a 
href="http://communities.vmware.com/tags/4.0?communityID=2411">4.0</a>,
                <a 
href="http://communities.vmware.com/tags/esxi.40?communityID=2411">esxi.40</a>,
                <a 
href="http://communities.vmware.com/tags/esxi4?communityID=2411">esxi4</a>
        </div>

    </div>
    </div>

    <!-- END content -->

        </div>
    </div>
</div>
<!-- END document -->

						
						


    <script type="text/javascript" src="DOC-8760_files/Rate.txt"></script>


    <script type="text/javascript">

        var userRating = 0;
        var inProgress = false;

        var RateInclude = {

            update: function() {
                Rate.getMeanRating('102', '8760', {
                    callback:function(data) {
                        RateInclude.updateMeanRating(data);
                    }
                });
                Rate.getRatingCount('102', '8760', {
                    callback:function(data) {
                        RateInclude.updateRatingCount(data);
                    }
                });
                Rate.getUserRating('102', '8760', {
                    callback:function(data) {
                        RateInclude.updateUserRating(data);
                    }
                });
            },

            updateMeanRating: function(data) {
                // change the title of the span to reflect the new mean rating
                $('jive-content-avgrating-score').title = 'Average User Rating: ' + data;

                // loop though each mean rating icon and change according to the new mean rating
                    if (data >= 1) {
                        $('jive-icon-avgrating-1').className = 'jive-icon-avgrating-on';
                    } else if (data >= (1 - 0.50)) {
                        $('jive-icon-avgrating-1').className = 'jive-icon-avgrating-half'
                    } else {
                        $('jive-icon-avgrating-1').className = 'jive-icon-avgrating-off'
                    }
                    if (data >= 2) {
                        $('jive-icon-avgrating-2').className = 'jive-icon-avgrating-on';
                    } else if (data >= (2 - 0.50)) {
                        $('jive-icon-avgrating-2').className = 'jive-icon-avgrating-half'
                    } else {
                        $('jive-icon-avgrating-2').className = 'jive-icon-avgrating-off'
                    }
                    if (data >= 3) {
                        $('jive-icon-avgrating-3').className = 'jive-icon-avgrating-on';
                    } else if (data >= (3 - 0.50)) {
                        $('jive-icon-avgrating-3').className = 'jive-icon-avgrating-half'
                    } else {
                        $('jive-icon-avgrating-3').className = 'jive-icon-avgrating-off'
                    }
                    if (data >= 4) {
                        $('jive-icon-avgrating-4').className = 'jive-icon-avgrating-on';
                    } else if (data >= (4 - 0.50)) {
                        $('jive-icon-avgrating-4').className = 'jive-icon-avgrating-half'
                    } else {
                        $('jive-icon-avgrating-4').className = 'jive-icon-avgrating-off'
                    }
                    if (data >= 5) {
                        $('jive-icon-avgrating-5').className = 'jive-icon-avgrating-on';
                    } else if (data >= (5 - 0.50)) {
                        $('jive-icon-avgrating-5').className = 'jive-icon-avgrating-half'
                    } else {
                        $('jive-icon-avgrating-5').className = 'jive-icon-avgrating-off'
                    }
            },

            updateRatingCount: function(data) {
                // update the rating count based on the new rating
                var ratingString = (data == 1) ? 'rating' : 'ratings';
                $('jive-content-avgrating-count').innerHTML= '(' + data + ' ' + ratingString + ')';
            },

            updateUserRating: function(data) {
                // set the javascript variable userRating to the new user rating value
                userRating = data;

                // reload the user rating
                RateInclude.showUserRating(data);
            },

            addRating: function(score) {
                inProgress = true;

                var objectType = '102';
                var objectID = '8760';

                // hide user rating
                $('jive-content-userrating-score').style.display = 'none';

                // show saving message
                $('jive-content-userrating-saved').innerHTML = 'Saving...';
                $('jive-content-userrating-saved').style.display = '';

                // dwr call to add rating
                Rate.addRating(objectType, objectID, score, {
                    callback:function() {
                        RateInclude.update();

                        // changed saving message to saved
                        $('jive-content-userrating-saved').innerHTML = 'Saved.';

                        // hide saved message
                        Effect.Fade('jive-content-userrating-saved', {afterFinish:RateInclude.testShow});
     
                        inProgress = false;
                    }
                });
            },

            testShow: function() {
                $('jive-content-userrating-score').style.display = '';
            },

            showUserRating: function(score) {
                    if (score == 0 || inProgress) {
                        $('jive-content-userrating-desc').innerHTML = '';
                    }
                    if (score >= 1) {
                        $('jive-icon-userrating-1').className = 'jive-icon-userrating-on';
                        if (score == 1) {
                            $('jive-content-userrating-desc').innerHTML = 'Poor';
                        }
                    } else {
                        $('jive-icon-userrating-1').className = 'jive-icon-userrating-off'
                    }
                    if (score == 0 || inProgress) {
                        $('jive-content-userrating-desc').innerHTML = '';
                    }
                    if (score >= 2) {
                        $('jive-icon-userrating-2').className = 'jive-icon-userrating-on';
                        if (score == 2) {
                            $('jive-content-userrating-desc').innerHTML = 'Below Average';
                        }
                    } else {
                        $('jive-icon-userrating-2').className = 'jive-icon-userrating-off'
                    }
                    if (score == 0 || inProgress) {
                        $('jive-content-userrating-desc').innerHTML = '';
                    }
                    if (score >= 3) {
                        $('jive-icon-userrating-3').className = 'jive-icon-userrating-on';
                        if (score == 3) {
                            $('jive-content-userrating-desc').innerHTML = 'Average';
                        }
                    } else {
                        $('jive-icon-userrating-3').className = 'jive-icon-userrating-off'
                    }
                    if (score == 0 || inProgress) {
                        $('jive-content-userrating-desc').innerHTML = '';
                    }
                    if (score >= 4) {
                        $('jive-icon-userrating-4').className = 'jive-icon-userrating-on';
                        if (score == 4) {
                            $('jive-content-userrating-desc').innerHTML = 'Above Average';
                        }
                    } else {
                        $('jive-icon-userrating-4').className = 'jive-icon-userrating-off'
                    }
                    if (score == 0 || inProgress) {
                        $('jive-content-userrating-desc').innerHTML = '';
                    }
                    if (score >= 5) {
                        $('jive-icon-userrating-5').className = 'jive-icon-userrating-on';
                        if (score == 5) {
                            $('jive-content-userrating-desc').innerHTML = 'Exceptional';
                        }
                    } else {
                        $('jive-icon-userrating-5').className = 'jive-icon-userrating-off'
                    }
            }
        };

    </script>

    <div id="jive-content-rating">
        

            <div id="jive-content-avgrating">

                <div id="jive-content-avgrating-title">Average User 
Rating</div>

    <div id="jive-content-avgrating-score" title="Average User Rating: 
4.95">
            <span id="jive-icon-avgrating-1" 
class="jive-icon-avgrating-on"></span>
            <span id="jive-icon-avgrating-2" 
class="jive-icon-avgrating-on"></span>
            <span id="jive-icon-avgrating-3" 
class="jive-icon-avgrating-on"></span>
            <span id="jive-icon-avgrating-4" 
class="jive-icon-avgrating-on"></span>
            <span id="jive-icon-avgrating-5" 
class="jive-icon-avgrating-half"></span>
    </div>

                <div id="jive-content-avgrating-count">(20 ratings)</div>

            </div>

    </div>

    
    <br><br>
    <br><br>



						<a name="comments"></a>
						<!-- BEGIN tabs -->
						<div id="content">
							<div class="tabhead" style="margin: 0pt;">
								<ul>
										<li id="jive-comments-tab">
											<a class="active" href="#" 
onclick="vmwareToggleTabs('jive-comments', 'jive-authordiscussion'); 
return false;">
												<span>Comments (1,156)</span>
											</a>
										</li>
								</ul>
							</div>
						</div>
						<!-- END tabs -->
						<div class="jive-content-block-container">
							<div class="jive-content-block">
									<div id="jive-comments" style="">
		<div class="jive-content-commentbar">
		</div>
		<script type="text/javascript">var commentsCount = 1156;</script>
				<a name="comments-10353"></a>
				<div id="comment-10353" class="jive-content-comment ">
					<span>
						<span>
							Dec 17, 2008 10:16 AM
						</span>
							<!--<a href="/people/Shaveht" title="Click to view Shaveht's profile">
<img class="jive-avatar" src="/people/Shaveht/avatar/16.png?a=-1" height="16" width="16" title="Click to view Shaveht's profile" alt="Click to view Shaveht's profile" />
</a>--><a href="http://communities.vmware.com/people/Shaveht" 
id="jive-PsLM1Vhwcdw87IXU" class="jive-username-link" title="Click to 
view Shaveht's profile">Shaveht</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10353">
					How can i edit it to run on VIMA?
					</p>
				</div>
				<a name="comments-10372"></a>
				<div id="comment-10372" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 19, 2008 8:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-G7rvk45828IVLM20" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-10372">
					Forgot to mention, you can also find more scripts/resources located
 at:<br>
<br>
<a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10373"></a>
				<div id="comment-10373" class="jive-content-comment ">
					<span>
						<span>
							Dec 19, 2008 9:08 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-op7EBnM2vNXw41n0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10353" title="Go to message">Shaveht</a>
							</em>
					</span>
					<p id="comment-body-10373">
					Hi Shaveht,<br>
<br>
This script can not be locally executed on VMware VIMA, but can be 
remotely kicked off from VIMA or any other UNIX/Linux, even a Windows 
host using plink. <br>
<br>
The process is as follows:<br>
<br>
You store the <b>"ghettoVCB.sh"</b> on shared storage (FC/iSCSI SAN / 
NFS), including the list of Virtual Machines you would like to backup. 
You can then create a cron entry that will kick off the backup process 
say every Friday at 12am. To ensure this does not require a user to 
enter a password, you'll need to utilize public/private SSH Key 
Authentication. This would then ssh into the ESX/ESXi host(s) and 
execute this script passing in the list which is also stored on the 
shared storage and the backup process would be kicked off. <br>
<br>
This allows you to centralize your backup process without having to 
create separate cron entries on each of the ESX and ESXi hosts and 
storing a copy on each system. This does add an additional system to the
 process and if you know this VIMA host will always be accessible to the
 ESX/ESXi cluster, you should be fine.<br>
<br>
An entry to the cron for the command would look like the following:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">ssh root@A.B.C.D "/vmfs/volumes/SOME_DATASTORE/ghettoVCB.sh /vmfs/volumes/SOME_ADMIN_DATASTORE/virtual_machine_backup_list"
</code></pre><br>
<br>
Again, you would just create a cron entry for the set of ESX/ESXi hosts 
and ensure that the datastore that contains the backup script and backup
 list are presented and visiable to all hosts. This also includes the 
datastore that is used to backup all the VMs are also visible/presented 
to all hosts<br>
<br>
Hopefully this cleared up some of your questions and good luck
					
				</div>
				<a name="comments-10421"></a>
				<div id="comment-10421" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 29, 2008 12:35 AM
						</span>
							<!--<a href="/people/Shaveht" title="Click to view Shaveht's profile">
<img class="jive-avatar" src="/people/Shaveht/avatar/16.png?a=-1" height="16" width="16" title="Click to view Shaveht's profile" alt="Click to view Shaveht's profile" />
</a>--><a href="http://communities.vmware.com/people/Shaveht" 
id="jive-b0R4kNAyV1L3Qu4g" class="jive-username-link" title="Click to 
view Shaveht's profile">Shaveht</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10373" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10421">
					Hi lamw,<br>
Thanks for the explanation.<br>
in effect i was confused about how to use it.<br>
<br>
thanks again.
					</p>
				</div>
				<a name="comments-10442"></a>
				<div id="comment-10442" class="jive-content-comment ">
					<span>
						<span>
							Jan 9, 2009 6:43 PM
						</span>
							<!--<a href="/people/dan82" title="Click to view dan82's profile">
<img class="jive-avatar" src="/people/dan82/avatar/16.png?a=-1" height="16" width="16" title="Click to view dan82's profile" alt="Click to view dan82's profile" />
</a>--><a href="http://communities.vmware.com/people/dan82" 
id="jive-3rgJ3H515XUpKKhh" class="jive-username-link" title="Click to 
view dan82's profile">dan82</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10442">
					Hi,<br>
<br>
I have 7 blade servers with approx 50 VM's, is it possible to run this 
script from just one esxi host and have it back up all the VM's that are
 running on it locally and also the VM's running on the other blades?
					</p>
				</div>
				<a name="comments-10443"></a>
				<div id="comment-10443" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 10, 2009 10:53 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-YAz26BO5oKMR7KF6" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10442" title="Go to message">dan82</a>
							</em>
					</span>
					<p id="comment-body-10443">
					Take a look at the my previous comment. I would not suggest setting
 this up on an ESXi host, probably an administrative linux/windows or 
even VIMA host.<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10457"></a>
				<div id="comment-10457" class="jive-content-comment ">
					<span>
						<span>
							Jan 14, 2009 3:51 PM
						</span>
							<!--<a href="/people/tuxfan2183" title="Click to view tuxfan2183's profile">
<img class="jive-avatar" src="/people/tuxfan2183/avatar/16.png?a=-1" height="16" width="16" title="Click to view tuxfan2183's profile" alt="Click to view tuxfan2183's profile" />
</a>--><a href="http://communities.vmware.com/people/tuxfan2183" 
id="jive-gMS6T8ve07pOHev0" class="jive-username-link" title="Click to 
view tuxfan2183's profile">tuxfan2183</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10443" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10457">
					Nice script and Thanks for the same. The backup runs fine after few
 issues being faced in the start. I have the following queries.<br>
<br>
1. Is there a way I can backup the vm's without shutting them down?<br>
2. What is the ideal restore procedure? (assuming Its going to be a 
disk-to-disk restoration.)<br>
<br>
Thanks<br>
tux
					</p>
				</div>
				<a name="comments-10458"></a>
				<div id="comment-10458" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 14, 2009 4:05 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-JtL8WUn1uK1p3FpI" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10457" title="Go to message">tuxfan2183</a>
							</em>
					</span>
					<p id="comment-body-10458">
					Hi tuxfan2183,<br>
<br>
1) The power down feature was recently added, if you want to backup your
 VM(s) while they're live, just ensure the flag <b>"POWER_VM_DOWN_BEFORE_BACKUP"</b>
 is set to 0=no, 1=yes. By default this option is set to 0 which is to 
backup while the VM is running<br>
<br>
2) There are multitude of options, depending where and how the backups 
are being stored and what your backup scenario requires. You can either 
mount the backup datastore and register the VM either by browsing the VI
 Client datastore or manually using CLI tool like "vmware-cmd -s 
register" or "vim-cmd" for ESXi. If you do not want to directly mount 
your backup but rather restore back to your source ESX/ESXi host, you 
can just manually run "vmkfstools" copy from your backup datastore to 
your source datastore and then register your VM. Again, this will be 
environment specific, but those are your options and this can be easily 
scripted or done manually as this is a backup process which requires 
additional care. <br>
<br>
Hope this answered your questions. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10459"></a>
				<div id="comment-10459" class="jive-content-comment ">
					<span>
						<span>
							Jan 14, 2009 4:10 PM
						</span>
							<!--<a href="/people/tuxfan2183" title="Click to view tuxfan2183's profile">
<img class="jive-avatar" src="/people/tuxfan2183/avatar/16.png?a=-1" height="16" width="16" title="Click to view tuxfan2183's profile" alt="Click to view tuxfan2183's profile" />
</a>--><a href="http://communities.vmware.com/people/tuxfan2183" 
id="jive-B5Mx1dLNVG779iTo" class="jive-username-link" title="Click to 
view tuxfan2183's profile">tuxfan2183</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10458" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10459">
					Thanks william. You are the best
					</p>
				</div>
				<a name="comments-10502"></a>
				<div id="comment-10502" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 21, 2009 6:57 PM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-TtT4zzpxnImFmo47" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10502">
					does this only back up 1 vmdk file per virtual machine?  I ran it 
and it backed up teh vmdk of a vm i have but not another vmdk that is in
 the same directory
					</p>
				</div>
				<a name="comments-10515"></a>
				<div id="comment-10515" class="jive-content-comment ">
					<span>
						<span>
							Jan 21, 2009 7:43 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-n3waKnO3dcyYRUoT" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10502" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10515">
					No, it should backup all "valid" VMDK(s) that is associated with a 
VM. Yon can verify this by going into the VM's "edit virtual machine 
settings" and ensure that all disks are listed within the hardware tab.<br>
<br>
When you use the VIC to delete a disk and selecting the option <b>"Remove
 from virtual machine"</b>, this will only remove the disk from being 
accessible to the VM, but the actual disk will still be located on the 
datastore and within the .vmx file, the disk will have a present value 
of "false". If you want to truly delete the VM's disk, you need to 
select the other option, so be sure before doing so.<br>
<br>
Let me know if you have any other questions<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10527"></a>
				<div id="comment-10527" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 21, 2009 8:09 PM
						</span>
							<!--<a href="/people/tuxfan2183" title="Click to view tuxfan2183's profile">
<img class="jive-avatar" src="/people/tuxfan2183/avatar/16.png?a=-1" height="16" width="16" title="Click to view tuxfan2183's profile" alt="Click to view tuxfan2183's profile" />
</a>--><a href="http://communities.vmware.com/people/tuxfan2183" 
id="jive-ALM4FcViXc02T4iP" class="jive-username-link" title="Click to 
view tuxfan2183's profile">tuxfan2183</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10515" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10527">
					There are certain things which I as a user thought could add more 
value to this script. When taking backup to compress and store the 
backup in a compressed format in the remote location. makes sense?
					</p>
				</div>
				<a name="comments-10516"></a>
				<div id="comment-10516" class="jive-content-comment ">
					<span>
						<span>
							Jan 21, 2009 8:12 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8WewoHbplX4qLfhG" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10527" title="Go to message">tuxfan2183</a>
							</em>
					</span>
					<p id="comment-body-10516">
					That is a good suggestion, but unfortunately there are many options
 in terms of compression format/type/etc and I would leave that to the 
end user to implement if required. <br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10503"></a>
				<div id="comment-10503" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 21, 2009 8:27 PM
						</span>
							<!--<a href="/people/alubel" title="Click to view alubel's profile">
<img class="jive-avatar" src="/people/alubel/avatar/16.png?a=-1" height="16" width="16" title="Click to view alubel's profile" alt="Click to view alubel's profile" />
</a>--><a href="http://communities.vmware.com/people/alubel" 
id="jive-1vVPq7PKtmhRiW82" class="jive-username-link" title="Click to 
view alubel's profile">alubel</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10527" title="Go to message">tuxfan2183</a>
							</em>
					</span>
					<p id="comment-body-10503">
					Why dont you try to setup a solaris 10 or opensolaris box and use a
 compressed ZFS file system via NFS to ESXi host?<br>
<br>
Its extremely easy - and no expensive hardware required.
					</p>
				</div>
				<a name="comments-10504"></a>
				<div id="comment-10504" class="jive-content-comment ">
					<span>
						<span>
							Jan 21, 2009 8:52 PM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-ERvNKL2p77z0f32u" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10515" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10504">
					i found the problem. here is the 2nd disk in the .vmx file.  I can 
almost guaruntee you this wasn't modified by hand because I don't think 
the person who created it has no idea how to.<br>
<br>
scsi0:1.filename = "datastore_1.vmdk"<br>
<br>
the line in your script that finds the disks is <br>
<br>
                        VMDKS=`grep scsi "${VMX_PATH}" | grep fileName |
 awk -F "\"" '{print $2}'`<br>
<br>
it's a case issue.  maybe that should be changed to a "grep -i fileName"
					</p>
				</div>
				<a name="comments-10505"></a>
				<div id="comment-10505" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 21, 2009 9:47 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-L6eR4P5bMVU1rvp7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10504" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10505">
					Yea it should be -i, but from the various .vmx file I've viewed in 
the past for both 3.0 and 3.5 it's always been "fileName". What version 
of ESX are you running btw? This is the first I've heard of this issue<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10506"></a>
				<div id="comment-10506" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 3:31 AM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-aQahGRxDaBKnn38b" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10505" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10506">
					esx server 3i 3.5.0 build 123629<br>
<br>
i just reproduced this by adding a second hard disk with VIC to the 
virtual machine and it puts it in the vmx with filename not fileName
					</p>
				</div>
				<a name="comments-10528"></a>
				<div id="comment-10528" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 6:54 AM
						</span>
							<!--<a href="/people/Thomas BRETON" title="Click to view Thomas BRETON's profile">
<img class="jive-avatar" src="/people/Thomas BRETON/avatar/16.png?a=-1" height="16" width="16" title="Click to view Thomas BRETON's profile" alt="Click to view Thomas BRETON's profile" />
</a>--><a href="http://communities.vmware.com/people/Thomas%20BRETON" 
id="jive-nVke6DB390de2Gdf" class="jive-username-link" title="Click to 
view Thomas BRETON's profile">Thomas BRETON</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10506" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10528">
					Hello,<br>
I'm trying your script.<br>
Thanks for your work.<br>
Just a question relative to performance.<br>
In fact i was using vcbMounter on a local datastore and on an nfs 
server.<br>
Backup time for the same machine:<br>
with vcbmount on local datastore: 7 min<br>
with vcbmount on NFS: 13 min<br>
<br>
With your script on local datastore: 5 min<br>
With your script on NFS: 180 min<br>
<br>
Have you got an explanation for this or any clue?<br>
Regards<br>
Tom
					</p>
				</div>
				<a name="comments-10519"></a>
				<div id="comment-10519" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 7:09 AM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-sfQ6Xrcdd88yR49r" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10528" title="Go to message">Thomas
 BRETON</a>
							</em>
					</span>
					<p id="comment-body-10519">
					my first run of this script was really slow over nfs too, around 
25GB per hour.  i blamed that on my cheap nas device.<br>
<br>
i don't know what vcbmounter is, but does it copy with a straight copy 
or does it do a clone disk like this script does?
					</p>
				</div>
				<a name="comments-10520"></a>
				<div id="comment-10520" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 8:34 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-O5R3u6I6e2pQ9VdC" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10528" title="Go to message">Thomas
 BRETON</a>
							</em>
					</span>
					<p id="comment-body-10520">
					I'm not familiar with the vcbMounter tool, YMMV with different 
environments and I've seen various postings about the different 
performance with NFS and it all depends on your configuration and the 
type of NFS server you're running. It should not differ with over 
100+min so I'm not exactly sure what type of VM you're backing up/etc. 
Does this occur on all VM(s) or just this one?<br>
<br>
Also and FYI, the VMware VCB tools that come installed by default on the
 ESX host are only available with the version of ESX w/Service Console, 
this is not part of the ESXi releaese. <br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10521"></a>
				<div id="comment-10521" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 8:35 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-G4Y5EC0fhSsGJAy1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10506" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10521">
					Interesting, perhaps this is only with ESXi. I'll double check with
 my ESXi 3.5u3 and see if this is also the case, if so I'm surprised 
this is the first time it's been caught. I know there's quite a few 
people using this script on unlicensed version of ESXi. Thanks for the 
info<br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10529"></a>
				<div id="comment-10529" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 11:04 AM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-Sx2u7MaDG2drgI83" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10529">
					when I run the command sh ./ghetto.sh vm_list from path / 
vmfs/volumes/datastore1/ of esxi 3.5 returns the following error:<br>
. / ghetto.sh:. / ghetto.sh: 76: Syntax error: word unexpected 
(expecting "do").<br>
What could be the problem?<br>
Thank you.
					</p>
				</div>
				<a name="comments-10522"></a>
				<div id="comment-10522" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 11:27 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-50hqPRkdfsE9v5QV" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10529" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10522">
					I'm not exactly sure what the issue could be. I suggest 
re-downloading the script and ensure the script has been set to execute.
 If you download to a Windows system, you might have some ^M characters 
if you tried to edit prior to executing on ESX/ESXi host. Make sure you 
edit it on the host themselves to ensure you don't run into this issue. <br>
<br>
You can always run:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">sh -x ghetto.sh vm_list
</code></pre><br>
<br>
and see what might be causing the issue. <br>
<p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10523"></a>
				<div id="comment-10523" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 11:49 AM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-d36FSiic9Ll37gFB" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10523">
					Thanks for your answer, the script has been set to execute and the 
file has been downloaded and modified with ubuntu desktop.<br>
This is the result of the command:<br>
/vmfs/volumes/4975d95d-45fc3458-7ff4-001b212e4341 # sh -x ghetto.sh 
vm_list<br>
+ <br>
: not foundghetto.sh: 6: <br>
+ VM_BACKUP_VOLUME=/vmfs/volumes/datastore2/backupvm/<br>
+ <br>
: not foundghetto.sh: 9: <br>
+ ENABLE_2GB_SPARSE=0<br>
+ <br>
: not foundghetto.sh: 12: <br>
+ VM_BACKUP_ROTATION_COUNT=3<br>
+ <br>
: not foundghetto.sh: 15: <br>
+ date +%F<br>
+ VM_BACKUP_DIR_NAMING_CONVENTION=2009-01-22 <br>
: not foundghetto.sh: 17: <br>
+ <br>
: not foundghetto.sh: 18: <br>
+ POWER_VM_DOWN_BEFORE_BACKUP=0<br>
+ <br>
: not foundghetto.sh: 23: <br>
+ ENABLE_HARD_POWER_OFF=0<br>
+ <br>
: not foundghetto.sh: 26: <br>
+ ITER_TO_WAIT_SHUTDOWN=4<br>
+ <br>
: not foundghetto.sh: 31: <br>
+ <br>
: not foundghetto.sh: 36: <br>
+ ENABLE_NON_PERSISTENT_NFS=0<br>
+ <br>
: not foundghetto.sh: 38: <br>
+ UNMOUNT_NFS=0<br>
+ <br>
: not foundghetto.sh: 41: <br>
+ NFS_SERVER=172.30.0.195<br>
+ <br>
: not foundghetto.sh: 44: <br>
+ NFS_MOUNT=/nfsshare<br>
+ <br>
: not foundghetto.sh: 47: <br>
+ NFS_LOCAL_NAME=nfs_storage_backup<br>
+ <br>
: not foundghetto.sh: 50: <br>
+ NFS_VM_BACKUP_DIR=mybackups <br>
: not foundghetto.sh: 52: <br>
+ <br>
: not foundghetto.sh: 53: <br>
+ <br>
: not foundghetto.sh: 55: <br>
+ <br>
: not foundghetto.sh: 57: <br>
+ DEVEL_MODE=0<br>
+ <br>
: not foundghetto.sh: 59: <br>
+ basename ghetto.sh<br>
+ SCRIPT_PATH=ghetto.sh<br>
 <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_FILE_INPUT">VM_FILE_INPUT</a>\n
 ghetto.sh<br>
<br>
 <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_FILE_INPUT">VM_FILE_INPUT</a><br>
<br>
+ exit<br>
: not foundghetto.sh: 63: exit<br>
+ }<br>
: not foundghetto.sh: 64: }<br>
+ <br>
: not foundghetto.sh: 65: <br>
+ local BACKUP_DIR_PATH=vm_list<br>
+ local BACKUP_VM_NAMING_CONVENTION=<br>
+ ls -tr vm_list<br>
: No such file or directory<br>
+ LIST_BACKUPS=<br>
+ <br>
: not foundghetto.sh: 70: <br>
ghetto.sh: ghetto.sh: 76: Syntax error: word unexpected (expecting "do")<br>
/vmfs/volumes/4975d95d-45fc3458-7ff4-001b212e4341 # sh -x ./ghetto.sh 
vm_list<br>
+ <br>
: not found: ./ghetto.sh: 6: <br>
+ VM_BACKUP_VOLUME=/vmfs/volumes/datastore2/backupvm/<br>
+ <br>
: not found: ./ghetto.sh: 9: <br>
+ ENABLE_2GB_SPARSE=0<br>
+ <br>
: not found: ./ghetto.sh: 12: <br>
+ VM_BACKUP_ROTATION_COUNT=3<br>
+ <br>
: not found: ./ghetto.sh: 15: <br>
+ date +%F<br>
+ VM_BACKUP_DIR_NAMING_CONVENTION=2009-01-22 <br>
: not found: ./ghetto.sh: 17: <br>
+ <br>
: not found: ./ghetto.sh: 18: <br>
+ POWER_VM_DOWN_BEFORE_BACKUP=0<br>
+ <br>
: not found: ./ghetto.sh: 23: <br>
+ ENABLE_HARD_POWER_OFF=0<br>
+ <br>
: not found: ./ghetto.sh: 26: <br>
+ ITER_TO_WAIT_SHUTDOWN=4<br>
+ <br>
: not found: ./ghetto.sh: 31: <br>
+ <br>
: not found: ./ghetto.sh: 36: <br>
+ ENABLE_NON_PERSISTENT_NFS=0<br>
+ <br>
: not found: ./ghetto.sh: 38: <br>
+ UNMOUNT_NFS=0<br>
+ <br>
: not found: ./ghetto.sh: 41: <br>
+ NFS_SERVER=172.30.0.195<br>
+ <br>
: not found: ./ghetto.sh: 44: <br>
+ NFS_MOUNT=/nfsshare<br>
+ <br>
: not found: ./ghetto.sh: 47: <br>
+ NFS_LOCAL_NAME=nfs_storage_backup<br>
+ <br>
: not found: ./ghetto.sh: 50: <br>
+ NFS_VM_BACKUP_DIR=mybackups <br>
: not found: ./ghetto.sh: 52: <br>
+ <br>
: not found: ./ghetto.sh: 53: <br>
+ <br>
: not found: ./ghetto.sh: 55: <br>
+ <br>
: not found: ./ghetto.sh: 57: <br>
+ DEVEL_MODE=0<br>
+ <br>
: not found: ./ghetto.sh: 59: <br>
+ basename ./ghetto.sh<br>
+ SCRIPT_PATH=ghetto.sh<br>
 <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_FILE_INPUT">VM_FILE_INPUT</a>\n
 ghetto.sh<br>
<br>
 <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_FILE_INPUT">VM_FILE_INPUT</a><br>
<br>
+ exit<br>
: not found: ./ghetto.sh: 63: exit<br>
+ }<br>
: not found: ./ghetto.sh: 64: }<br>
+ <br>
: not found: ./ghetto.sh: 65: <br>
+ local BACKUP_DIR_PATH=vm_list<br>
+ local BACKUP_VM_NAMING_CONVENTION=<br>
+ ls -tr vm_list<br>
: No such file or directory<br>
+ LIST_BACKUPS=<br>
+ <br>
: not found: ./ghetto.sh: 70: <br>
./ghetto.sh: ./ghetto.sh: 76: Syntax error: word unexpected (expecting 
"do")<br>
/vmfs/volumes/4975d95d-45fc3458-7ff4-001b212e4341 #
					</p>
				</div>
				<a name="comments-10524"></a>
				<div id="comment-10524" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 11:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-40LzUs8V8HFduAt7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10523" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10524">
					It's kind of hard to tell what's going on with the output. What 
system are you running this on? Which version of the script did you 
download? Can you also list the contents of your vm_list<br>
<br>
Can you also try the following:<br>
<br>
Change <br>
<br>
</p><div class="jive-quote">
VM_BACKUP_VOLUME=/vmfs/volumes/datastore2/backupvm/<br>
</div>
<br>
to <br>
<br>
VM_BACKUP_VOLUME=/vmfs/volumes/datastore2/backupvm<br>
<br>
If that still yields the same results, can you also find the variable <b>DEVEL_MODE</b>
 and change that from 0 to 1 and see if the script progresses farther or
 continues to error out. <br>
<p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10507"></a>
				<div id="comment-10507" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 12:01 PM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-9cpYHNufKC1A0NvH" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10523" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10507">
					also, you didn't remove the first line with #!/bin/bash did you? or
 you're not using some wierd shell are you?
					</p>
				</div>
				<a name="comments-10508"></a>
				<div id="comment-10508" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 12:15 PM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-etweUnj0djwr7xcn" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10508">
					I downloaded version ghettoVCB-enhance.sh. The contents of the list
 is as follows:<br>
<br>
windows xp<br>
<br>
ubuntu server 32bit<br>
<br>
this change VM_BACKUP_VOLUME=/vmfs/volumes/datastore2/backupvm had no 
effect.<br>
<br>
Aalso the change of value DEVEL_MOdE variable had no effect.
					</p>
				</div>
				<a name="comments-10540"></a>
				<div id="comment-10540" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 12:20 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FmE8ix9Y03hPA1Wm" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10508" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10540">
					Are you running this on ESX or ESXi? I also noticed you're 
executing this script on one of your datastores, it should not matter 
but can you try to move the script to another location, perhaps /root. I
 just downloaded both scripts and they executed fine using the default 
and just modifying the backup path, the issue seems to be in your 
environment but I'm not sure what might be causing this issue. <br>
<br>
Could you also run the following on the shell:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">echo $SHELL
</code></pre><br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vmware -v 
</code></pre><br>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					
				</div>
				<a name="comments-10509"></a>
				<div id="comment-10509" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 12:24 PM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-3vgGcjh3Wo24TeLY" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10509">
					I have not touched the first line of the script and the shell I use
 is integrated into the system vmware ESXi 3.5.I try to move the script 
in the root.
					</p>
				</div>
				<a name="comments-10555"></a>
				<div id="comment-10555" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 12:32 PM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-kdY7JYFC7RHysJ5l" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10555">
					The command echo $SHELL returns:/bin/ash<br>
The command vmware -v returns:VMware ESX Server 3i 3.5.0 build-123629<br>
Moving the file in the root me back the message: Operation not permitted
					</p>
				</div>
				<a name="comments-10541"></a>
				<div id="comment-10541" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 12:38 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-OO7MHndGXD079tgS" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10555" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10541">
					Okay so looks like you're running the the latest ESXi 3.5u3, which 
is the same release I just finished testing as well and I don't see any 
issues. Since you're running on ESXi, there will not be a directory <b>/root</b>,
 just <b>/</b>.<br>
<br>
It's going to get pretty difficult to troubleshoot exactly what the 
issue is, for some reason the system isn't liking the script. If you 
understand what the script is doing or have some scripting experience, 
you can setup some basic echo statements and see exactly where the 
script stops execution. From the looks of it, it seems to get through 
all the user defined variables but halts right before the actual code 
starts. If you can narrow down on the junk of code that it fails on, 
perhaps I can assist you further. <br>
<br>
Also, your two VM(s) have the following displayName?<br>
<br>
</p><div class="jive-quote">
windows xp<br>
ubuntu server 32bit<br>
</div>
<p>
Actually locate the following line and change that from<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain"># DO NOT MODIFY PAST THIS LINE #
</code></pre><br>
<br>
to<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">exit

# DO NOT MODIFY PAST THIS LINE #
</code></pre><br>
<br>
I'm wondering if the issue is after the variable declaration or after. <br>
<p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10530"></a>
				<div id="comment-10530" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 12:53 PM
						</span>
							<!--<a href="/people/Thomas BRETON" title="Click to view Thomas BRETON's profile">
<img class="jive-avatar" src="/people/Thomas BRETON/avatar/16.png?a=-1" height="16" width="16" title="Click to view Thomas BRETON's profile" alt="Click to view Thomas BRETON's profile" />
</a>--><a href="http://communities.vmware.com/people/Thomas%20BRETON" 
id="jive-qioRDarKnmuwsg8U" class="jive-username-link" title="Click to 
view Thomas BRETON's profile">Thomas BRETON</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10520" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10530">
					Hello,<br>
I don't know really the difference between vcbmount and snapshots.<br>
I know that vcbmount work on vmdk files to compact them.<br>
The NFS server is a FreeNAS on a 2x3Ghz xeon with one disk of 300Gb 15K 
U320.<br>
I'm using ESX 3.5.<br>
<br>
I don't think it's related to nfs configuration or server performance 
because for the same vm and for the same nfs server the vcbmount take 13
 min and your script take 180 min<br>
And yes it's the same problem for all machines<br>
<br>
I'm still investigating on this<br>
Regards<br>
Tom
					</p>
				</div>
				<a name="comments-10531"></a>
				<div id="comment-10531" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 12:58 PM
						</span>
							<!--<a href="/people/RENATOG123" title="Click to view RENATOG123's profile">
<img class="jive-avatar" src="/people/RENATOG123/avatar/16.png?a=-1" height="16" width="16" title="Click to view RENATOG123's profile" alt="Click to view RENATOG123's profile" />
</a>--><a href="http://communities.vmware.com/people/RENATOG123" 
id="jive-J4ziJ6KrD117wXjf" class="jive-username-link" title="Click to 
view RENATOG123's profile">RENATOG123</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10531">
					Can you tell me what variables need to be changed (other than 
NFS_SERVER and VM_BACKUP_DIR) in order for this script to work?<br>
Also, how can I create a script that will initiate a snapshot of each 
VM, store them in the NFS (for daily backups) and another script that 
will do a full backup of each VM?<br>
We are using ESXi 3.5u3<br>
Thanks
					</p>
				</div>
				<a name="comments-10542"></a>
				<div id="comment-10542" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 1:00 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GMVFocd8IOQ95CpJ" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10531" title="Go to message">RENATOG123</a>
							</em>
					</span>
					<p id="comment-body-10542">
					Please take a look at the documentation for your questions, it 
should answer majority of them. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10556"></a>
				<div id="comment-10556" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 1:00 PM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-boH9v9R96RoX86sK" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10556">
					I am not an expert in scripting and general Linux environment, I am
 a beginner.<br>
Yes, my two VM(s) have that name.<br>
Also by entering the command exit the error is always in the same line 
in the script
					</p>
				</div>
				<a name="comments-10543"></a>
				<div id="comment-10543" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 1:11 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-j2nF1I0BVy6J2q09" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10556" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10543">
					The "exit' you inserted, allowed me to see where the issue is 
occuring. It's telling to the script to basically exit once it hits that
 line. This means the error is caused during the variable declaration 
section before it even starts to execute. <br>
<br>
This brings me to believe the file may have some additional characters 
that may not be part of the original script/etc, perhaps characters from
 a Windows system. Did you download this from your Ubuntu box and scp 
the script to your ESXi host?<br>
<br>
Can you run the following:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">wc -l ghettoVCB-enhance.sh
</code></pre><br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">wc -c ghettoVCB-enhance.sh
</code></pre><br>
<br>
Also can you paste the variables you've modified from the default script
 and please format the output using the following tags {quote} ...your 
output... {quote}, it makes it easier for me to read and try to 
troubleshoot<br>
<p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10532"></a>
				<div id="comment-10532" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 1:11 PM
						</span>
							<!--<a href="/people/RENATOG123" title="Click to view RENATOG123's profile">
<img class="jive-avatar" src="/people/RENATOG123/avatar/16.png?a=-1" height="16" width="16" title="Click to view RENATOG123's profile" alt="Click to view RENATOG123's profile" />
</a>--><a href="http://communities.vmware.com/people/RENATOG123" 
id="jive-4HOTm2bree5XjGFj" class="jive-username-link" title="Click to 
view RENATOG123's profile">RENATOG123</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10542" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10532">
					I'm sorry, can you provide a link for the documentation?<br>
Thanks
					</p>
				</div>
				<a name="comments-10544"></a>
				<div id="comment-10544" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 1:17 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5NA9s10V4lxXHqCh" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10532" title="Go to message">RENATOG123</a>
							</em>
					</span>
					<p id="comment-body-10544">
					If you're posting in this section of the forum, you're already 
looking at the documentation. Please go over the instructions carefully,
 I do ask that new users read through the documentation before posting a
 question as you can answer most of your questions this way. You'll see 
that both your use cases can be solved by using this script and may 
require slight modifications, again this script is intended to help 
backup VM(s) that may reside on ESX/ESXi 3.5+. This script will not 
cover <b>all</b> processes/requirements for a backup or recovery 
scenario, I leave it to the discretion of the end user to understand 
what this script is doing and making modifications that fit your 
operating environment and needs. <br>
<br>
You're welcome to post follow-up questions if you're still unsure of how
 the script operates or question about the functionality of the script. 
Hope this helps<br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10557"></a>
				<div id="comment-10557" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 2:04 PM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-r4U37c2AcEKBorqF" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10557">
					Problem solved: the file ghettoVCB-enhance.sh downloaded from the 
link higher contains the end of each line the notorious ^M, while the 
other file ghettoVCB.sh is clean<br>
Thanks to all.
					</p>
				</div>
				<a name="comments-10558"></a>
				<div id="comment-10558" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 2:47 PM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-CnkY9pVqldRdyMNA" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10558">
					William,<br>
<br>
I was wondering if you could recommend teh best way for recovering a vm 
from a backup like this.  Like say your esxi server blew up one day and 
you put a brand new one in it's place and hooked it up to the nas you 
had bacccked up your vms to.<br>
<br>
most of hte instructions out there involve manually creating a vm in vic
 like the one you used to have, deleting it's hard drive, cloning the 
backup disk into your vm dir with vmkfstools -i and then adding it to 
your virtual machine.  <br>
<br>
since all the vm information is stored in a .vmx it seems like it should
 be easier to restore a vm, is it just that there aren't vm creation 
tools at the command line that can be used?
					</p>
				</div>
				<a name="comments-10545"></a>
				<div id="comment-10545" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2009 3:16 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Jl6N00S6mGHFpF4V" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10558" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10545">
					There are many scenarios in terms of recovery and this really 
depends on your requirements/environment. If you look at the simplest 
case where you have a new ESX/ESXi host and you present the NFS 
datastore which contains the backup VM(s) to the host. All you really 
need to do is just browse the datastore using the VIC and click into 
each of your VM(s) and right click and add to inventory. You should see 
your VM registered to the host and you can power them VM on. This 
assumes that want your recovered VM(s) running on your backup datastore,
 it's probably best to definitely copy the VM to your new host, register
 and power on. Going off of that, yes you'll need to copy the .vmx and 
copy the VMDK(s) associated with that VM and you should be using 
vmfkstools -i as you've suggested. Again once you understand this 
process manually, it's relatively easy to automate and script this 
process. Again, this process will vary from user to user and based on 
your requirements, you'll come up with a solution hat fits your 
environment. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10546"></a>
				<div id="comment-10546" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2009 3:28 PM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-83aI0kr2OS2nw5tM" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10545" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10546">
					gotcha, thanks again for your work!
					</p>
				</div>
				<a name="comments-10533"></a>
				<div id="comment-10533" class="jive-content-comment ">
					<span>
						<span>
							Jan 23, 2009 6:38 AM
						</span>
							<!--<a href="/people/apignoloni" title="Click to view apignoloni's profile">
<img class="jive-avatar" src="/people/apignoloni/avatar/16.png?a=-1" height="16" width="16" title="Click to view apignoloni's profile" alt="Click to view apignoloni's profile" />
</a>--><a href="http://communities.vmware.com/people/apignoloni" 
id="jive-8EONUndVHp31e8h9" class="jive-username-link" title="Click to 
view apignoloni's profile">apignoloni</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10533">
					Good morning,<br>
I created the script backupvm in /usr/local/bin running:<br>
#!/bin/sh<br>
ssh root@192.168.100.165 "sh /vmfs/volumes/datastore1/ghettoVCB.sh 
/vmfs/volumes/datastore1/vm_list"<br>
#invio promemoria<br>
echo backup vm posmailbe del `date â€˜+%d-%B-%Yâ€™`|mail -s â€œbackup vm 
posmailbeâ€ \ aaaaaa@iol.it<br>
<br>
I also assigned the permission of execution.<br>
<br>
I changed the file cron as follows:<br>
<br>
americo@ubuntuserver32:/usr/local/bin$ sudo crontab -l<br>
</p><ol>
<li>m h  dom mon dow   command</li>
</ol>
15 15 * * * /usr/local/bin/backup_vm<br>
<br>
but at the established nothing happens. The commands are formally 
correct?<br>
Thank you
					
				</div>
				<a name="comments-10549"></a>
				<div id="comment-10549" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 23, 2009 7:31 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-rnTKa2l7MShmuXm0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10533" title="Go to message">apignoloni</a>
							</em>
					</span>
					<p id="comment-body-10549">
					When setting up a cron entry, make sure the paths to all the 
commands use are the fullpath.<br>
<br>
Please take a look at this thread to ensure they are: <a 
class="jive-link-external" 
href="http://communities.vmware.com/message/1151164#1151164">http://communities.vmware.com/message/1151164#1151164</a><br>
<br>
I believe the vmkfstools is not being passed in my script as the full 
path, so you'll probably have to fix at least that command. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10566"></a>
				<div id="comment-10566" class="jive-content-comment ">
					<span>
						<span>
							Jan 26, 2009 10:37 AM
						</span>
							<!--<a href="/people/ollivetti" title="Click to view ollivetti's profile">
<img class="jive-avatar" src="/people/ollivetti/avatar/16.png?a=-1" height="16" width="16" title="Click to view ollivetti's profile" alt="Click to view ollivetti's profile" />
</a>--><a href="http://communities.vmware.com/people/ollivetti" 
id="jive-R5T02OT4h4DU7f8R" class="jive-username-link" title="Click to 
view ollivetti's profile">ollivetti</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10373" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10566">
					Hello, I have a question: Is it possible to backup additional added
 disks too? We have the OS on disk1 and the files on disk2. Does this 
backupscript support this. I could not find anything and tying it only 
made a backup of disk1.<br>
Another thing I would like to ask is if you know any troubles using this
 script wiht ESX Version 3.02.<br>
<br>
Thank you very much - also for the hard work writing this script!<br>
Regards
					</p>
				</div>
				<a name="comments-10551"></a>
				<div id="comment-10551" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 26, 2009 10:38 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-fYmOyEhSmDCtp12F" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-10551">
					Yes, please download the latest script <b>ghettoVCB-enhance.sh</b> 
which will backup all <b>valid</b> VMDK(s) presented to the VM. This was
 added awhile back but I guess I must have forgotten to update the doc. 
I'll make sure I do that tonight and also remove the old instance of the
 script. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10567"></a>
				<div id="comment-10567" class="jive-content-comment ">
					<span>
						<span>
							Jan 26, 2009 11:13 AM
						</span>
							<!--<a href="/people/ollivetti" title="Click to view ollivetti's profile">
<img class="jive-avatar" src="/people/ollivetti/avatar/16.png?a=-1" height="16" width="16" title="Click to view ollivetti's profile" alt="Click to view ollivetti's profile" />
</a>--><a href="http://communities.vmware.com/people/ollivetti" 
id="jive-uPgte3AACeXxX1A8" class="jive-username-link" title="Click to 
view ollivetti's profile">ollivetti</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10551" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10567">
					I just read in the comments about the grep -i fileName change...It 
now works ...<br>
That's really great work you've done! Respect!<br>
Thank you
					</p>
				</div>
				<a name="comments-10568"></a>
				<div id="comment-10568" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 26, 2009 11:48 PM
						</span>
							<!--<a href="/people/ollivetti" title="Click to view ollivetti's profile">
<img class="jive-avatar" src="/people/ollivetti/avatar/16.png?a=-1" height="16" width="16" title="Click to view ollivetti's profile" alt="Click to view ollivetti's profile" />
</a>--><a href="http://communities.vmware.com/people/ollivetti" 
id="jive-6IlJefYw3bVsj1am" class="jive-username-link" title="Click to 
view ollivetti's profile">ollivetti</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10551" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10568">
					Sorry one more stupid question - does it also work on ESX3.02? I 
see the note "You*'re not running ESX 3.5+ ....<br>
Or are there known issues using the script with 3.02.<br>
Thank you!
					</p>
				</div>
				<a name="comments-10539"></a>
				<div id="comment-10539" class="jive-content-comment ">
					<span>
						<span>
							Jan 27, 2009 7:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-mFhsDqvHYuIx7y0c" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10568" title="Go to message">ollivetti</a>
							</em>
					</span>
					<p id="comment-body-10539">
					Hi ollivetti,<br>
<br>
Sorry, this script only supports ESX 3.5+, the requirement is stated in 
the title and also noted in the body of the document. This was 
intentional since majority of the users were also using this on ESXi and
 the only common toolset between ESXi and ESX is <b><a 
class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/#vmware_vimsh">vimsh</a></b>.
 You probably can slightly modify it to support older version of ESX, as
 <b>vimsh</b> does exists going back to 3.0, but I have not tested that 
far back. You can uncomment the section of the code that blocks it from 
executing if you're not running either ESXi or ESX 3.5+. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10554"></a>
				<div id="comment-10554" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 27, 2009 1:21 PM
						</span>
							<!--<a href="/people/RENATOG123" title="Click to view RENATOG123's profile">
<img class="jive-avatar" src="/people/RENATOG123/avatar/16.png?a=-1" height="16" width="16" title="Click to view RENATOG123's profile" alt="Click to view RENATOG123's profile" />
</a>--><a href="http://communities.vmware.com/people/RENATOG123" 
id="jive-MC2y0mQ5Lqyqr979" class="jive-username-link" title="Click to 
view RENATOG123's profile">RENATOG123</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10544" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10554">
					lamw,<br>
  I was finally able to get the NFS setup working with WSFU (in case 
anyone's pulling their hairs out, make that when you configure User Name
 Mapping, you map the LOCAL ADMIN account (not a domain admin) to 
"root")<br>
<br>
I tested with a live running VIMA and it did a full backup of the VM.<br>
<br>
I want to modify the script to do regular snapshots, not clone 
snapshots.  Where/What do I have to change on the ghettoVCB-enhanced.sh 
script?<br>
Thanks
					</p>
				</div>
				<a name="comments-10570"></a>
				<div id="comment-10570" class="jive-content-comment ">
					<span>
						<span>
							Jan 27, 2009 1:24 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-kolAytQ9zXOiXeLg" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10554" title="Go to message">RENATOG123</a>
							</em>
					</span>
					<p id="comment-body-10570">
					I'm not sure what you mean by <b>regular</b> snapshots, I'm aware 
of only one type and the snapshot can be taken with/without the state of
 the memory. Please look into script on where the snapshot is being 
taken, I believe it's documented in the script if you go through it. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10588"></a>
				<div id="comment-10588" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 28, 2009 5:56 AM
						</span>
							<!--<a href="/people/RENATOG123" title="Click to view RENATOG123's profile">
<img class="jive-avatar" src="/people/RENATOG123/avatar/16.png?a=-1" height="16" width="16" title="Click to view RENATOG123's profile" alt="Click to view RENATOG123's profile" />
</a>--><a href="http://communities.vmware.com/people/RENATOG123" 
id="jive-04YRfQ4w69OrQL1F" class="jive-username-link" title="Click to 
view RENATOG123's profile">RENATOG123</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10570" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10588">
					What would be the procedure to restore the ghettoVCB backups?
					</p>
				</div>
				<a name="comments-10571"></a>
				<div id="comment-10571" class="jive-content-comment ">
					<span>
						<span>
							Jan 28, 2009 6:13 AM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-147197UHhuPl397t" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10588" title="Go to message">RENATOG123</a>
							</em>
					</span>
					<p id="comment-body-10571">
					the procedure i use is <br>
<br>
If you just need to restore a vm to a state it was during the backup, 
and you still have your existing vm:<br>
<br>
1. delete the hard drive of the vm from within vic, choosing to remove 
tne files from the disk as well.<br>
2. clone the disk from backup to the directory of your vm with <br>
      vmkfstools -i /path/to/backup/disk.vmdk /path/to/vm/<br>
3. add the hard drive to your vm choosing to use an existing virtual 
disk, select the /path/to/vm/disk.vmdk that you just made<br>
<br>
If you need to restore the vm to another host or simply deleted it all 
together<br>
<br>
1. make a directory /vmfs/volumes/whatever/vm-name<br>
2. copy the .vmx file from backup to this dir<br>
3. clone the disk from backup to the directory of the vm<br>
      vmkfstools -i /path/to/backup/disk.vmdk 
/vmfs/volumes/whatever/vm-name/<br>
4. Browse the datastore in VIC, find the .vmx file, right click and 
select add to inventory.<br>
<br>
not sure if theres a better way of doing it but it works for me.
					</p>
				</div>
				<a name="comments-10589"></a>
				<div id="comment-10589" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 28, 2009 6:35 AM
						</span>
							<!--<a href="/people/RENATOG123" title="Click to view RENATOG123's profile">
<img class="jive-avatar" src="/people/RENATOG123/avatar/16.png?a=-1" height="16" width="16" title="Click to view RENATOG123's profile" alt="Click to view RENATOG123's profile" />
</a>--><a href="http://communities.vmware.com/people/RENATOG123" 
id="jive-qJ188914ohEqvYrf" class="jive-username-link" title="Click to 
view RENATOG123's profile">RENATOG123</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10571" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10589">
					How were you able to create a directory?  When I try "mkdir 
whatever" I get: Operation not permitted.<br>
I am logged in as "root". Am I missing something?<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-10605"></a>
				<div id="comment-10605" class="jive-content-comment ">
					<span>
						<span>
							Jan 29, 2009 1:38 AM
						</span>
							<!--<a href="/people/ollivetti" title="Click to view ollivetti's profile">
<img class="jive-avatar" src="/people/ollivetti/avatar/16.png?a=-1" height="16" width="16" title="Click to view ollivetti's profile" alt="Click to view ollivetti's profile" />
</a>--><a href="http://communities.vmware.com/people/ollivetti" 
id="jive-EQ06mNwP8AoRoq5t" class="jive-username-link" title="Click to 
view ollivetti's profile">ollivetti</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10539" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10605">
					Hi, first of all thank you again for your response! I see you have 
quite a lot of questions to answer. One thing I would like to ask 
because I have problems is: I am using 3.02 and don't have 
vmware-vim-cmd so I use vmware-cmd or shall I use vimsh -n -e to execute
 commands. Unfortunately the execution stops here: echo "Error: failed 
to extract VM_ID for ${VM_NAME}!" Does it mean that the script is 
looking for der VirtualMachine ID in /tmp/vms_list. <br>
Regards
					</p>
				</div>
				<a name="comments-10593"></a>
				<div id="comment-10593" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 29, 2009 8:27 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-JMMSFp3RRpdV2gQp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10605" title="Go to message">ollivetti</a>
							</em>
					</span>
					<p id="comment-body-10593">
					Please take a look at the <b>vimsh</b> documentation to understand 
how it works.<br>
<br>
<a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/#vmware_vimsh">http://engineering.ucsb.edu/~duonglt/vmware/#vmware_vimsh</a><br>
</p><p>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10607"></a>
				<div id="comment-10607" class="jive-content-comment ">
					<span>
						<span>
							Jan 30, 2009 9:07 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-5qk1Pv4KPK1B8d2z" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10593" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10607">
					Hello<br>
<br>
Thank you for this script! Really good work. The only thing that does 
not seem to work for me is backing up more than one vmdk in a vm. I 
tried several times with no luck. Do I have to do something special to 
get it to work?<br>
<br>
Thank you for an answer.
					</p>
				</div>
				<a name="comments-10608"></a>
				<div id="comment-10608" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 30, 2009 9:14 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-433M5imjReUCK53q" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10607" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10608">
					Are you running ESXi? If so, you might need to change the line 
"grep fileName" to' grep -i fileName".<br>
<br>
Multi-VMDK(s) are supported, so long they're valid and presented to the 
guestOS. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10610"></a>
				<div id="comment-10610" class="jive-content-comment ">
					<span>
						<span>
							Jan 30, 2009 11:01 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-E8ALff3L9neOa61g" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10608" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10610">
					Yes, I am running ESXi. If I run the command: <br>
<br>
VMDKS_FOUND=`grep scsi "${VMX_PATH}" | grep -i fileName | awk -F " " 
'{print $1}'` <br>
<br>
on a cmd-sh, it gives me both scsi-vm-hdd... so thats all ok. But when I
 run your script, only the first (50G) HDD is backed-up, the second HD 
(300GB) not.<br>
<br>
Do you have any ideas what could cause this problem?<br>
Thank you very much!
					</p>
				</div>
				<a name="comments-10579"></a>
				<div id="comment-10579" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 30, 2009 11:29 AM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-mX0D38iS1HJ4chOt" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10610" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10579">
					you have to modify the script to have grep -i as well, it only uses
 grep without the -i which only returns matches to the exact case 
fileName.  esxi servers sometimes have it as filename (lower case n)
					</p>
				</div>
				<a name="comments-10611"></a>
				<div id="comment-10611" class="jive-content-comment ">
					<span>
						<span>
							Jan 30, 2009 12:34 PM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-JMmc0N7ft357jX45" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10579" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10611">
					Thank you for the response. <br>
<br>
Of course I also modified the script... But still got only one vm-hdd 
backuped. I tried to troubleshoot in the script and what I found is the 
following. After the line:<br>
 grep "${SCSI_ID}.present" "${VMX_PATH}" | grep "true" &gt; /dev/null 
2&gt;&amp;1 <br>
it gives me the Value "1" for the second vm-hdd, which probably means it
 is not present??? But it is my data-disk which IS present in the vm... 
what do I have to modify?<br>
<br>
Thank you.
					</p>
				</div>
				<a name="comments-10580"></a>
				<div id="comment-10580" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 30, 2009 1:10 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ASUOkDsBwLA073EG" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10611" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10580">
					if you get a value of <b>1</b> for that particular line, it means 
that within the .vmx file for the ${SCSI_ID}.present = "true". This 
means that the VMDK was either removed from the VM but not deleted from 
the filesystem or it was removed and deleted from the filesystem. In 
either case, the reference is left in the .vmx file and the flag is just
 changed from true to false. <br>
<br>
To verify this, you can look at your .vmx file, and if the code is 
returning a 1, it means that disk is not present to the VM which means 
it should not be showing up in the VI Client when you go into it's 
properties unless the .vmx file has been manually modified without the 
ESX/ESXi knowing about it. <br>
</p><p>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10597"></a>
				<div id="comment-10597" class="jive-content-comment ">
					<span>
						<span>
							Jan 30, 2009 4:43 PM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-dffnLas52w3nyuwd" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10580" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10597">
					That seems to be strange... if you look at the content of my 
vmx-file:<br>
/vmfs/volumes/497b9254-df6992a6-9fc0-0090270f57c5/Win2K3 TS # cat 
Win2K3\ TS.vmx<br>
config.version = "8"<br>
virtualHW.version = "4"<br>
floppy0.present = "true"<br>
nvram = "Win2K3 TS.nvram"<br>
deploymentPlatform = "windows"<br>
virtualHW.productCompatibility = "hosted"<br>
tools.upgrade.policy = "useGlobal"<br>
powerType.powerOff = "default"<br>
powerType.powerOn = "default"<br>
powerType.suspend = "default"<br>
powerType.reset = "default"<br>
<br>
displayName = "Win2K3 TS"<br>
extendedConfigFile = "Win2K3 TS.vmxf"<br>
<br>
numvcpus = "2"<br>
scsi0.present = "true"<br>
scsi0.sharedBus = "none"<br>
scsi0.virtualDev = "lsilogic"<br>
memsize = "1024"<br>
scsi0:0.present = "true"<br>
scsi0:0.fileName = "Win2K3 TS.vmdk"<br>
scsi0:0.deviceType = "scsi-hardDisk"<br>
ide0:0.present = "true"<br>
ide0:0.clientDevice = "FALSE"<br>
ide0:0.deviceType = "cdrom-image"<br>
ide0:0.startConnected = "TRUE"<br>
floppy0.startConnected = "false"<br>
floppy0.clientDevice = "true"<br>
ethernet0.present = "true"<br>
ethernet0.networkName = "VM Network"<br>
ethernet0.addressType = "generated"<br>
guestOSAltName = "Microsoft Windows Server 2003, Standard Edition 
(32-bit)"<br>
guestOS = "winnetstandard"<br>
uuid.location = "56 4d 61 2a b1 4c 7f ca-b4 81 00 31 27 13 e1 0d"<br>
uuid.bios = "56 4d 61 2a b1 4c 7f ca-b4 81 00 31 27 13 e1 0d"<br>
toolScripts.afterPowerOn = "true"<br>
toolScripts.afterResume = "true"<br>
toolScripts.beforeSuspend = "true"<br>
toolScripts.beforePowerOff = "true"<br>
<br>
ide0:0.fileName = 
"/vmfs/volumes/497b9254-df6992a6-9fc0-0090270f57c5/Windows Server 
2003/Windows Server 2003.Enterprise.German.ISO"<br>
floppy0.fileName = "/dev/fd0"<br>
<br>
scsi0:0.redo = ""<br>
ethernet0.generatedAddress = "00:0c:29:13:e1:0d"<br>
tools.syncTime = "FALSE"<br>
sched.swap.derivedName = 
"/vmfs/volumes/497b9254-df6992a6-9fc0-0090270f57c5/Win2K3 TS/Win2K3 
TS-af7ea147.vswp"<br>
ethernet0.generatedAddressOffset = "0"<br>
hostCPUID.0 = "0000000a756e65476c65746e49656e69"<br>
guestCPUID.0 = "0000000a756e65476c65746e49656e69"<br>
userCPUID.0 = "0000000a756e65476c65746e49656e69"<br>
hostCPUID.1 = "00010676000208000008e39dbfebfbff"<br>
guestCPUID.1 = "0001067800010800000802010febbbff"<br>
userCPUID.1 = "0001067600020800000802010febbbff"<br>
hostCPUID.80000001 = "00000000000000000000000120100000"<br>
guestCPUID.80000001 = "00000000000000000000000000100000"<br>
userCPUID.80000001 = "00000000000000000000000120100000"<br>
evcCompatibilityMode = "FALSE"<br>
scsi0:1.present = "TRUE"<br>
scsi0:1.deviceType = "scsi-hardDisk"<br>
scsi0:1.filename = "Win2K3 TS_1.vmdk"<br>
scsi0:1.mode = "persistent"<br>
scsi0:1.redo = ""<br>
****************************************<br>
Here you can see that scsi0:0 as well as scsi0:1 is present and true....
 And I am working with this device every day, so it IS present...<br>
<br>
Do you have any idea? Thank you very much for your help, I am really out
 of any guess....
					</p>
				</div>
				<a name="comments-10612"></a>
				<div id="comment-10612" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 30, 2009 4:49 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-kBiFhy6RGcUdRE55" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10597" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10612">
					Look at what the script is doing .... it's grepping for <b>"true"</b>
 ... looks like your .vmx has <b>"TRUE"</b>, see the problem. <br>
<br>
I'm curious on why some of the user's .vmx files are slightly different 
from the one's I've worked with. I'm not sure if this is due to any 
specific version or user's are manually modifying their files. I've 
always seen the right hand side use lower case values, but I have seen 
it few times in older releases where it's all caps. I'll try to find 
some time this weekend to fix those two issues, it should be using grep 
-i. <br>
<br>
That should fix your issue<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10616"></a>
				<div id="comment-10616" class="jive-content-comment ">
					<span>
						<span>
							Jan 31, 2009 3:03 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-2sAOjS3nX5RhTyl0" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10612" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10616">
					Thank you, it's now working like a charme! <br>
<br>
But does somebody know how to start this script automatically with some 
kind of "cronjob" in ESXi? I tried the idea with "autobackup.sh" and 
included the "cron" directory in this script, but it does not seem to 
work... (Always get the following error: <br>
<br>
diff: Can't stat 
'/tmp/auto-backup.237536.dir/var/spool/cron/crontabs/root': No such file
 or directory<br>
which means this temporary directory/file has not been created by the 
script...<br>
<br>
Thank you!
					</p>
				</div>
				<a name="comments-10617"></a>
				<div id="comment-10617" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 31, 2009 3:52 AM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-Mr2p8GvJ7YFNMdrw" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10616" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10617">
					I did it by adding the following lines to /etc/rc.local<br>
<br>
/bin/echo "0 19 5 * * /vmfs/volumes/vmback/ghettoVCB.sh" &gt;&gt; 
/var/spool/cron/crontabs/root<br>
/bin/busybox crond -b<br>
</p><p>
then run auto-backup.sh it will backup the changes to the rc.local file<br>
<br>
basically this makes it so on boot the ghettovcb entry is added to the 
crontab and crond is restarted.
					</p>
				</div>
				<a name="comments-10613"></a>
				<div id="comment-10613" class="jive-content-comment ">
					<span>
						<span>
							Jan 31, 2009 8:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6zVMWPQrj52fbsHS" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10617" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10613">
					I believe these changes do not persist do a reboot? I remember 
talking to someone about this and on reboot these changes are reverted 
to their original configurations, including the cron entry. Is that 
correct?<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10598"></a>
				<div id="comment-10598" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 31, 2009 8:32 AM
						</span>
							<!--<a href="/people/nappyrat" title="Click to view nappyrat's profile">
<img class="jive-avatar" src="/people/nappyrat/avatar/16.png?a=-1" height="16" width="16" title="Click to view nappyrat's profile" alt="Click to view nappyrat's profile" />
</a>--><a href="http://communities.vmware.com/people/nappyrat" 
id="jive-sks5uPOD07x0NHrM" class="jive-username-link" title="Click to 
view nappyrat's profile">nappyrat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10613" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10598">
					the auto-backup.sh script which runs like every hour or so i think 
backs up a number of files in /etc to be persistant upon reboot.  this 
is why things like modifying inetd.conf to enable ssh still work after 
reboot.  /etc/rc.local is another one that changes will be saved.  that 
is why i put the code in there to add the crontab entry on boot.
					</p>
				</div>
				<a name="comments-10614"></a>
				<div id="comment-10614" class="jive-content-comment ">
					<span>
						<span>
							Jan 31, 2009 2:07 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ItLrcF21BFAYzgdo" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10598" title="Go to message">nappyrat</a>
							</em>
					</span>
					<p id="comment-body-10614">
					Ah good to know, I'm aware of the backup but I thought someone had 
mentioned earlier in another forum thread that files are not persisted 
through a reboot. That is good to hear, I'll try to find some time to 
update the doc stating that fact. Thanks<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10618"></a>
				<div id="comment-10618" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2009 2:42 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-s9aREz6Y4Ij3rRjK" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10614" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10618">
					Hello<br>
<br>
Yes, I can confirm the Backups are persistent when you write the stuff 
in rc.local. All runs without problems.<br>
<br>
Thank you for all the good tipps!
					</p>
				</div>
				<a name="comments-10709"></a>
				<div id="comment-10709" class="jive-content-comment ">
					<span>
						<span>
							Feb 10, 2009 1:50 PM
						</span>
							<!--<a href="/people/cybersayo" title="Click to view cybersayo's profile">
<img class="jive-avatar" src="/people/cybersayo/avatar/16.png?a=-1" height="16" width="16" title="Click to view cybersayo's profile" alt="Click to view cybersayo's profile" />
</a>--><a href="http://communities.vmware.com/people/cybersayo" 
id="jive-EU1gTfY7sANOyDW3" class="jive-username-link" title="Click to 
view cybersayo's profile">cybersayo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10618" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10709">
					First, thank for the great script lamw!<br>
<br>
Everything works well when I do ghetto from SAN to local hard drive, but
 when I try gheto to NFS I get<br>
"DiskLib_Check() failed for source disk The system cannot find the file 
specified (25)" after cloning and snapshot remove lasts about 2 mins 
with lot of "...missing *-delta.vmdk" in ESX's /var/log/messages. There 
is no difference with Windows or Linux NFS server - backed vmdk looks 
fine but I don't know is this only warning or something to worry about. 
It's same story with all my ESXs.
					</p>
				</div>
				<a name="comments-10721"></a>
				<div id="comment-10721" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 10, 2009 1:59 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0VWKIj3rSry2KpbN" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10709" title="Go to message">cybersayo</a>
							</em>
					</span>
					<p id="comment-body-10721">
					Usually when you get those warnings, it means it was not able to 
find the source VMDK for whatever reason. I know some user's have had 
issues in the past where their VMDK(s) were stored in other directories 
or if they had multiple VMDK(s), earlier versions of the script did not 
handle that use case. <br>
<br>
The latest script should be validating that certain VMDK(s) exists prior
 to trying to take a backup, though if you've manually edited the .VMX 
file, there could be some inconsistencies in the .vmx itself. You can 
always try the script with a <b>-x</b> flag which gives detail verbosity
 of what's happening while the script execute and see if you can 
anything that's off. If it works for SAN to Local, then it should also 
work for NFS unless you some miss-configurations on your NFS Server (you
 can always manually take a snapshot and manually run vmkfstools copy 
manually to make sure it's working with your NFS Server)<br>
<br>
(e.g.)<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">sh -x ghettoVCB.sh my_back_vm_list.txt
</code></pre><br>
<br>
If you're still not sure, you can direct that output to a file and 
attach to your reply and I can try to take a look. 
					
				</div>
				<a name="comments-10722"></a>
				<div id="comment-10722" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2009 12:41 AM
						</span>
							<!--<a href="/people/cybersayo" title="Click to view cybersayo's profile">
<img class="jive-avatar" src="/people/cybersayo/avatar/16.png?a=-1" height="16" width="16" title="Click to view cybersayo's profile" alt="Click to view cybersayo's profile" />
</a>--><a href="http://communities.vmware.com/people/cybersayo" 
id="jive-y72Rpyza2x8aJLSb" class="jive-username-link" title="Click to 
view cybersayo's profile">cybersayo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10721" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10722">
					Thanks, I'll try. <br>
<br>
Another thing; currently I do three kind of backups from san: daily to 
local hard drive (raid1), dayly to nfs (raid1) and weekly to tape. Since
 there is not enough space on local hard drives to do rotation, ghetto 
returns error every second day (and delete files then, so backup is ok 
tommorow). Rotation count is 0.<br>
<br>
What can I do to make this backup daily?
					</p>
				</div>
				<a name="comments-10725"></a>
				<div id="comment-10725" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 11, 2009 8:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1KVyUG8nBYh6Omk0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10722" title="Go to message">cybersayo</a>
							</em>
					</span>
					<p id="comment-body-10725">
					Well nothing is stopping the script do run daily backups, that is 
up to the end user's and the setup of their cron schedule. If you're 
looking for more elaborate backup processes such as transfer from SAN to
 local, then to NFS, etc, etc. You'll need to script that process, this 
script is intended to help provide a backup solution for your VM(s), 
it's left open for any modifications/specific requirements one may have 
for their environment. <br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10712"></a>
				<div id="comment-10712" class="jive-content-comment ">
					<span>
						<span>
							Feb 12, 2009 1:07 PM
						</span>
							<!--<a href="/people/ddigioia" title="Click to view ddigioia's profile">
<img class="jive-avatar" src="/people/ddigioia/avatar/16.png?a=-1" height="16" width="16" title="Click to view ddigioia's profile" alt="Click to view ddigioia's profile" />
</a>--><a href="http://communities.vmware.com/people/ddigioia" 
id="jive-EjCGNucustQx9il1" class="jive-username-link" title="Click to 
view ddigioia's profile">ddigioia</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10725" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10712">
					William,<br>
<br>
Thanks for sharing your great scripts and knowledge.<br>
<br>
Everyone,<br>
<br>
Thanks for the great forum.  I've learned a lot here.<br>
<br>
We are using ESXi with an NFS datastore on Openfiler 2.3.<br>
<br>
I've modified William's script to make ESXi "thin" disk format backups, 
as it was not too easy to add backups or clones of VMs back to the VM 
inventory when they were in 2gbsparse disk format, and I did not want to
 lose the disk space "thick" backups would have required.<br>
<br>
The backups and restore/clone seem to work fine with thin format, but I 
feel it seems too easy.  Am I missing something?<br>
<br>
Is there any reason why I should not use William's ghettoVCB.sh script 
to do thin backups rather than thick or 2gbsparse?<br>
<br>
(I realize the 2gbsparse format is more portable to other filesystems, 
other versions of VMware, etc.)<br>
<br>
Thanks,<br>
<br>
-David
					</p>
				</div>
				<a name="comments-10750"></a>
				<div id="comment-10750" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 13, 2009 5:54 AM
						</span>
							<!--<a href="/people/jaxislnad" title="Click to view jaxislnad's profile">
<img class="jive-avatar" src="/people/jaxislnad/avatar/16.png?a=-1" height="16" width="16" title="Click to view jaxislnad's profile" alt="Click to view jaxislnad's profile" />
</a>--><a href="http://communities.vmware.com/people/jaxislnad" 
id="jive-EPgzR71ikLJ5bWbd" class="jive-username-link" title="Click to 
view jaxislnad's profile">jaxislnad</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10750">
					First off, this is really some great work. Thank you for posting 
this. <br>
<br>
But, unfortunately I am having some issues. I downloaded the file 
yesterday 2-12-2009, onto my ubuntu machine. I opened it with gedit and 
it had the ^M throughout the file. I dont know if Ubuntu did that or the
 file up there has them but either way I fixed it with dostounix. So I 
set it up and ran it on a VM with 1 vmdk file and it worked like a 
charm. HDD to HDD on a 10 GB VM takes consistently less than 5 mins, 
which is great. <br>
</p><p>
My next step was I added a vmdk with the VIC, I used the VM and added a 
partition and put files on the new hard drive, works fine. When I run 
the backup it still only backups the main HDD, or the first vmdk. I 
checked the vmx file and they are both set to "true". I checked your 
script and it is grep -i. So I am totally at a loss at what could be 
preventing the script from backing up the second vmdk. <br>
</p><p>
Now my next question would be I have 4 HDD in the server. Disk 1 has a 
vmdk, Disk 2 has a vmdk, both for the same VM. Can I backup Disk 1 vmdk 
to Disk 3, and Disk 2 vmdk to Disk 4. All 4 drives are 1 TB drives. So 
both vmdk files are more than 1 TB which is the size of the other disk 
so I need each vmdk to go to a seperate location on the same server. I 
hope this makes sense if not let me know.<br>
</p><p>
Also my last question is how does this backup run while the machine is 
on, can I still get a restorable copy of my files if I do the backup 
when the machine is powered on? Is it best to power down then do the 
backup?<br>
</p><p>
<br>
********EDIT********02-13-2009 09:12<br>
The 2nd vmdk that doesnt get backed up is stored on another drive, I 
added a 3rd disk to the same directory as the vmx and it backs up both, 
so for some reason it cannot find the 2nd vmdk on another drive. <br>
Im also getting this when it tries to clone the disk:<br>
DiskLib_Check() failed for source disk The system cannot find the file 
specified (25).<br>
<br>
********EDIT********02-13-2009 09:45<br>
I have attached the portion of my file that I believe to show the issue.
 As you can see the _2.vmdk and regular vmdk that are in the same 
directory as the vmx file backup fine. These files are in 
/vmfs/volumes/Main<br>
<br>
Now the _1.vmdk is on /vmfs/volumes/Third, which it calls out by the 
long string of numbers which also match the string of numbers in the vmx
 file.<br>
<br>
What looks wrong to me is it is starting out in the /Main directory then
 tries to go find it but cant. I could use some guidance on this one.<br>
<br>
+ echo ################## Starting backup for MyVM ... 
#####################<br>
+ OLD_IFS=<br>
<br>
+ IFS=:<br>
+ VMDK=MyVM_2.vmdk<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+0+-eq+1+">
 0 -eq 1 </a><br>
+ vmkfstools -i /vmfs/volumes/Main/MyVM/MyVM_2.vmdk 
/vmfs/volumes/Secondary/MyVMbkup/MyVM/MyVM-2009-02-13/MyVM_2.vmdk<br>
+ 
VMDK=/vmfs/volumes/4896efad-39367fad-4058-00151762f7d0/MyVM/MyVM_1.vmdk<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+0+-eq+1+">
 0 -eq 1 </a><br>
+ vmkfstools -i 
/vmfs/volumes/Main/MyVM//vmfs/volumes/4896efad-39367fad-4058-00151762f7d0/MyVM/MyVM_1.vmdk
 
/vmfs/volumes/Secondary/MyVMbkup/MyVM/MyVM-2009-02-13//vmfs/volumes/4896efad-39367fad-4058-00151762f7d0/MyVM/MyVM_1.vmdk<br>
DiskLib_Check() failed for source disk The system cannot find the file 
specified (25).<br>
+ VMDK=MyVM.vmdk<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+0+-eq+1+">
 0 -eq 1 </a><br>
+ vmkfstools -i /vmfs/volumes/Main/MyVM/MyVM.vmdk 
/vmfs/volumes/Secondary/MyVMbkup/MyVM/MyVM-2009-02-13/MyVM.vmdk<br>
+ IFS=<br>
</p><p>
I hope you can help me out, I do appreciate you taking a look.<br>
<br>
Thanks again for the great work.<br>
<br>
-Ryan
					</p>
				</div>
				<a name="comments-10716"></a>
				<div id="comment-10716" class="jive-content-comment ">
					<span>
						<span>
							Feb 13, 2009 8:27 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-96c7XC299y5aiTPl" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10750" title="Go to message">jaxislnad</a>
							</em>
					</span>
					<p id="comment-body-10716">
					I noticed another user had a similar issue too, I may have to look 
at the case when the VMDK(s) are stored in another datastore other than 
the root VM directory. I'm curious when it tries to backup the other 
drives, is the location correct? In terms of how it's able to backup 
VM(s) while it's still running is with a snapshot. When you take a 
snapshot, the main VMDK is changed to readonly and a new delta file is 
created which will contain all changes after the snapshot has been 
taken. This then releases a file lock on the main disk which allows you 
to backup the disk. Once the snapshot has been removed (committed), all 
changes will merge back with the primary disk. Then on the next backup, 
it'll do the same and those changes will be captured. <br>
<br>
I'll take a look at the issue sometime next week ... need to spend 
sometime with the gf this weekend =)<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10751"></a>
				<div id="comment-10751" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 13, 2009 8:31 AM
						</span>
							<!--<a href="/people/jaxislnad" title="Click to view jaxislnad's profile">
<img class="jive-avatar" src="/people/jaxislnad/avatar/16.png?a=-1" height="16" width="16" title="Click to view jaxislnad's profile" alt="Click to view jaxislnad's profile" />
</a>--><a href="http://communities.vmware.com/people/jaxislnad" 
id="jive-82uLUM9J9Ledj08f" class="jive-username-link" title="Click to 
view jaxislnad's profile">jaxislnad</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10716" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10751">
					The location is correct that it comes up with. It matches the same 
string thats in the vmx file so it almost knows its there it just cannot
 copy it. <br>
<br>
Also is there a way to backup one vmdk to one location and a second vmdk
 to another, even though they are in the same VM?<br>
<br>
I thought it was using the snapshot feature, but I wasnt sure. I 
appreciate the update, and have a good weekend! <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":-)" 
border="0">
					</p>
				</div>
				<a name="comments-10717"></a>
				<div id="comment-10717" class="jive-content-comment ">
					<span>
						<span>
							Feb 13, 2009 8:37 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-WOrmxXdpGI6XuDNB" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10751" title="Go to message">jaxislnad</a>
							</em>
					</span>
					<p id="comment-body-10717">
					hm ... that's interesting. If the snapshot was taken successfully, 
then both those disks should be unlocked. You can always manually do 
what the script is doing to just verify that it should work. In terms of
 your second question, you would need to modify the script to duplicate 
it to two destinations. You can always just re-run the script with a 
second destination as a work around.<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10754"></a>
				<div id="comment-10754" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 14, 2009 2:01 PM
						</span>
							<!--<a href="/people/jsmithsd" title="Click to view jsmithsd's profile">
<img class="jive-avatar" src="/people/jsmithsd/avatar/16.png?a=-1" height="16" width="16" title="Click to view jsmithsd's profile" alt="Click to view jsmithsd's profile" />
</a>--><a href="http://communities.vmware.com/people/jsmithsd" 
id="jive-t3T11t2Qf3h4KV1i" class="jive-username-link" title="Click to 
view jsmithsd's profile">jsmithsd</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10717" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10754">
					Has anybody come up with a reliable method of monitoring this 
script for success/failure? Here's an idea off the top of my head for 
Windows users who use Kaseya/LPI for monitoring. I wouldn't have the 
expertise to write something like this but maybe somebody else would see
 value in this.<br>
<br>
</p><ul class="jive-dash">
<li>Have ghettoVCB produce a log file. Does it already do this?</li>
<li>Modify the .bat file in your scheduled task to download the log file
 to the Windows machine via Plink.</li>
</ul>
<br>
From there you could:<br>
<ul class="jive-dash">
<li>Launch a .vbs that would parse the log and write custom events to 
the event viewer. Monitor events with your monitoring tool of choice.</li>
<li>Parse the log file directly if your monitoring tools are capable of 
this (Kaseya is).</li>
</ul>

					
				</div>
				<a name="comments-10730"></a>
				<div id="comment-10730" class="jive-content-comment ">
					<span>
						<span>
							Feb 16, 2009 8:01 AM
						</span>
							<!--<a href="/people/jaxislnad" title="Click to view jaxislnad's profile">
<img class="jive-avatar" src="/people/jaxislnad/avatar/16.png?a=-1" height="16" width="16" title="Click to view jaxislnad's profile" alt="Click to view jaxislnad's profile" />
</a>--><a href="http://communities.vmware.com/people/jaxislnad" 
id="jive-CMIvbrN790yIAnU8" class="jive-username-link" title="Click to 
view jaxislnad's profile">jaxislnad</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10717" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10730">
					How do I run it with 2 destinations, wont it copy the first vmdk 
each time. So I would only end up with one of the 2 vmdks in 2 places?<br>
<br>
Im not sure where in the script I should try manually.<br>
<br>
Thanks for the help.
					</p>
				</div>
				<a name="comments-10719"></a>
				<div id="comment-10719" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 16, 2009 9:49 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-3yNN34IOvkoi419y" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10730" title="Go to message">jaxislnad</a>
							</em>
					</span>
					<p id="comment-body-10719">
					You'll have to add that logic into the script if you're looking to 
split your destination copy. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10766"></a>
				<div id="comment-10766" class="jive-content-comment ">
					<span>
						<span>
							Feb 17, 2009 2:16 AM
						</span>
							<!--<a href="/people/JoeyDE" title="Click to view JoeyDE's profile">
<img class="jive-avatar" src="/people/JoeyDE/avatar/16.png?a=-1" height="16" width="16" title="Click to view JoeyDE's profile" alt="Click to view JoeyDE's profile" />
</a>--><a href="http://communities.vmware.com/people/JoeyDE" 
id="jive-6oFD1e3SjPwQpCDt" class="jive-username-link" title="Click to 
view JoeyDE's profile">JoeyDE</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10766">
					Many thanks for your great script!!<br>
<br>
To everyone:<br>
<br>
Everything works great except the output to a log file. I have a 
scheduled task on a windows 2003 server machine to run batch file which 
executes ghettoVCB.sh via plink.exe. Thanks to Raj Perumal for his blog 
guide.<br>
<br>
The command looks like this:<br>
plink.exe root@192.168.100.200 -pw mypassword "nohup 
./vmfs/volumes/vmfs-storage/ghettoVCB.sh 
/vmfs/volumes/vmfs-storage/vmlist &gt; 
/vmfs/volumes/vmfs-storage/backuplog.txt &amp;"<br>
<br>
After a successful backup the backuplog.txt contains not a single line 
and the file size is 0 btyes. <br>
<br>
When I execute the command in a putty session the output to the 
backuplog.txt works great.<br>
<br>
Any ideas whats wrong?
					</p>
				</div>
				<a name="comments-10780"></a>
				<div id="comment-10780" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 9:59 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-XMc7bKD5EYF87sgT" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10766" title="Go to message">JoeyDE</a>
							</em>
					</span>
					<p id="comment-body-10780">
					I have a problem.....<br>
It all works find but VM_BACKUP_ROTATION_COUNT=1 does not do any thing.<br>
I have now<br>
.15_SpiceWorks-2009-02-17<br>
.15_SpiceWorks-2009-02-16<br>
as backups and if I run it now I get<br>
.15_SpiceWorks-2009-02-18<br>
<br>
any ideas?
					</p>
				</div>
				<a name="comments-10763"></a>
				<div id="comment-10763" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 10:04 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-zW1C00bdw2XuVF4H" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10780" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10763">
					Looks like something was modified in the script because the 
rotation count is kept track by a special extension "--X" ... I don't 
see that in your output, did you change something in the script?<br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10781"></a>
				<div id="comment-10781" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 10:11 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-sy8CqBCgEWH1GD53" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10763" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10781">
					Config part<br>
VM_BACKUP_VOLUME=/vmfs/volumes/489326a8-7adbcdf8-a9f4-00188bf6e6f5<br>
<br>
POWER_VM_DOWN_BEFORE_BACKUP=0<br>
<br>
Code part<br>
LIST_BACKUPS=$(ls -Atr ${BACKUP_DIR_PATH})<br>
This is due to that my VM names are .15_Name_XXXX
					</p>
				</div>
				<a name="comments-10782"></a>
				<div id="comment-10782" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 10:13 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-nVOokwa8IHqOCKdL" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10781" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10782">
					BTW, wnat can I comment out in order to run all but the actual 
cloning of the folder?
					</p>
				</div>
				<a name="comments-10783"></a>
				<div id="comment-10783" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 10:19 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-29VI4PrW4CeeIB7n" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10782" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10783">
					OK, I recopied the original code.<br>
this is my output.<br>
<br>
~ # /ghettoVCB.sh  /backup_vms<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for .15_SpiceWorks ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/Virtual_OS_V2/SpiceWorks/XP_Base_1.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from .15_SpiceWorks ...<br>
bash: 
/vmfs/volumes/489326a8-7adbcdf8-a9f4-00188bf6e6f5/.15_SpiceWorks/.15_SpiceWorks-2009-02-17:
 bad number<br>
/ghettoVCB.sh: /ghettoVCB.sh: 322: Syntax error: 
/vmfs/volumes/489326a8-7adbcdf8-a9f4-00188bf6e6f5/.15_SpiceWorks/.15_SpiceWorks-2009-02-17+1

					
				</div>
				<a name="comments-10764"></a>
				<div id="comment-10764" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 10:21 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-qLzo5OkoRf1bTw34" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10781" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10764">
					Ah, then I think you can just remove the <b>-A</b> param, as that 
ignores "." Any reason why you're naming convention is in that form? I 
would probably change that since that usually interpreted as hidden 
directories (just a thought). <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10773"></a>
				<div id="comment-10773" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 10:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-s2NsoprF7VxtD0gC" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10782" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10773">
					I'm not sure what you mean by actual cloning of the folder? If 
you're asking about the rotation count, you'll need to set that = 1, it 
does not make sense to set it to 0. <br>
<br>
You should give the script a read through, the logic should not be too 
difficult to follow and you're welcome to ask further questions. If you 
can manually run through this process, then the script will make more 
sense. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10774"></a>
				<div id="comment-10774" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 10:26 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Oz2cafpAW9AgcVQ4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10783" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10774">
					Again, this is probably due to your naming convention, so it's 
unable to rename the directory since it's looking for a "--X' extension.
 Please take a look at the previous reply for a fix or modify the way 
you VM directory. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10784"></a>
				<div id="comment-10784" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 10:31 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-ryHynTyD43CthAH5" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10774" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10784">
					Just changed the name of the VM. No .15_ as prefix.<br>
Running the code..... <br>
Lets see.
					</p>
				</div>
				<a name="comments-10785"></a>
				<div id="comment-10785" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 10:47 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-yB78yP7A629rTOIx" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10784" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10785">
					What I ment about cloning the folder... was that I would like to 
coment the part that actualy does the backup until I get the rotation 
count working<br>
<br>
BTW, VM_BACKUP_DIR_NAMING_CONVENTION="$(date +%F)" is what is set for 
the naming.
					</p>
				</div>
				<a name="comments-10786"></a>
				<div id="comment-10786" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 10:54 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-pikV89bgo5iHPcp5" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10785" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10786">
					is  Date: 11/01/2008 the last version of the file? I see updates 
later than that
					</p>
				</div>
				<a name="comments-10795"></a>
				<div id="comment-10795" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 10:57 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MAwMa73552w296pP" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10786" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10795">
					That is actually the date I started the project. The latest script 
will always be available in the download section<br>
<br>
To your other comemnt, that is the naming convention that is appended to
 the backup directory, this can be anything but I thought having the 
date as part of the backup directory might be useful. This can be 
changed to any string you would like. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10788"></a>
				<div id="comment-10788" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 11:15 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-f0l1rX6rlKHFlYcG" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10795" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10788">
					mmmm<br>
now its creating<br>
SpiceWorks-2009-02-18--1<br>
I will rename to 02-17--1 and run again.
					</p>
				</div>
				<a name="comments-10789"></a>
				<div id="comment-10789" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2009 12:11 PM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-Rs4MBx8l8ex85DPr" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10788" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10789">
					YES!!!!!!!!!!!!!!!!!!!!!!<br>
Thanks!!!!!!!!<br>
Now I need to just find a way to get the files of the ESXi server.<br>
</p><p>
Regards.<br>
George.
					</p>
				</div>
				<a name="comments-10796"></a>
				<div id="comment-10796" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2009 12:13 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-r1629nWEkG5rSOGl" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10789" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10796">
					Glad to hear. Try setting up an NFS Server, it's pretty simple and 
this will allow you to get the VM(s) off the host to other backup or 
tape storage.<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10800"></a>
				<div id="comment-10800" class="jive-content-comment ">
					<span>
						<span>
							Feb 19, 2009 7:08 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-gRoA6L6zqwkFfowx" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10796" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10800">
					When I am running the script I am getting the following error:<br>
DiskLib_Check() failed for source disk The system cannot find the file 
specified (25).<br>
<br>
I turned on tracing on the script and discovered it is happening as a 
result of this command:<br>
vmkfstools -i 
/vmfs/volumes/datastore2/OpenFiler//vmfs/volumes/4947b0ac-5b9a4e28-9b21-0011092a9380/OpenFiler/OpenFiler_2.vmdk
 
/vmfs/volumes/Disk1/vmbackups/OpenFiler/OpenFiler-2009-02-19//vmfs/volumes/4947b0ac-5b9a4e28-9b21-0011092a9380/OpenFiler/OpenFiler_2.vmdk<br>
<br>
Any ideas what is causing this?
					</p>
				</div>
				<a name="comments-10801"></a>
				<div id="comment-10801" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2009 7:12 AM
						</span>
							<!--<a href="/people/santalaus" title="Click to view santalaus's profile">
<img class="jive-avatar" src="/people/santalaus/avatar/16.png?a=-1" height="16" width="16" title="Click to view santalaus's profile" alt="Click to view santalaus's profile" />
</a>--><a href="http://communities.vmware.com/people/santalaus" 
id="jive-TRDLm0O5AxI2H9wp" class="jive-username-link" title="Click to 
view santalaus's profile">santalaus</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10800" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10801">
					Realy nice Work, but I found an Izzue <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
When you have multiple vmdks on different datastores in one vmx thd 
filename contains the fullpath to the vmdk<br>
So the Script could not save this vmdk because it is not in the VMX_DIR 
Path.<br>
<br>
I hope you understand this.
					</p>
				</div>
				<a name="comments-10776"></a>
				<div id="comment-10776" class="jive-content-comment ">
					<span>
						<span>
							Feb 19, 2009 7:16 AM
						</span>
							<!--<a href="/people/jaxislnad" title="Click to view jaxislnad's profile">
<img class="jive-avatar" src="/people/jaxislnad/avatar/16.png?a=-1" height="16" width="16" title="Click to view jaxislnad's profile" alt="Click to view jaxislnad's profile" />
</a>--><a href="http://communities.vmware.com/people/jaxislnad" 
id="jive-KbD3jnAwuOW10Uw0" class="jive-username-link" title="Click to 
view jaxislnad's profile">jaxislnad</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10800" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10776">
					Same issue Im having. Im trying to modify the script but no success
 so far.
					</p>
				</div>
				<a name="comments-10802"></a>
				<div id="comment-10802" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2009 7:17 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-724w42coreDte2s0" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10801" title="Go to message">santalaus</a>
							</em>
					</span>
					<p id="comment-body-10802">
					Nope, sorry you lost me.<br>
<br>
I do have a couple of different VMs on different datastores, but I got 
this error when I tried to back up just one of them.<br>
<br>
Are you saying that all my VMs need to be on the same datastore for the 
script to work?<br>
<br>
Or am I just not understanding this...
					</p>
				</div>
				<a name="comments-10777"></a>
				<div id="comment-10777" class="jive-content-comment ">
					<span>
						<span>
							Feb 19, 2009 7:20 AM
						</span>
							<!--<a href="/people/jaxislnad" title="Click to view jaxislnad's profile">
<img class="jive-avatar" src="/people/jaxislnad/avatar/16.png?a=-1" height="16" width="16" title="Click to view jaxislnad's profile" alt="Click to view jaxislnad's profile" />
</a>--><a href="http://communities.vmware.com/people/jaxislnad" 
id="jive-pDG7u9yFwjXA64PD" class="jive-username-link" title="Click to 
view jaxislnad's profile">jaxislnad</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10802" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10777">
					My situation is my VM's have 2 vmdk files. They are both on 
different datastores. When I run the script only the vmdk that is on the
 same datastore as the vmx gets backed up. The vmdk on the other 
datastore does not and it gives me the same error.
					</p>
				</div>
				<a name="comments-10803"></a>
				<div id="comment-10803" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2009 7:25 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-foAjxa8igNDcBO35" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10777" title="Go to message">jaxislnad</a>
							</em>
					</span>
					<p id="comment-body-10803">
					Oh wait, I think I (might) get it!<br>
<br>
So, yes the VM I am backing up also has a couple of disks which do 
reside on different data store.<br>
<br>
Fortunately I do not actually need to back those up (they are storage 
for openfiler which I am spanning across a software RAID).<br>
<br>
I really just need to backup the main disk associated with the VM.<br>
<br>
So I am guessing I can just ignore this error.<br>
<br>
If you do happen to extend the script to support this, you might 
consider allowing the user to specify which disks to back up and which 
to ignore...
					</p>
				</div>
				<a name="comments-10804"></a>
				<div id="comment-10804" class="jive-content-comment ">
					<span>
						<span>
							Feb 19, 2009 7:27 AM
						</span>
							<!--<a href="/people/santalaus" title="Click to view santalaus's profile">
<img class="jive-avatar" src="/people/santalaus/avatar/16.png?a=-1" height="16" width="16" title="Click to view santalaus's profile" alt="Click to view santalaus's profile" />
</a>--><a href="http://communities.vmware.com/people/santalaus" 
id="jive-t62TOOrhvL4fsI4N" class="jive-username-link" title="Click to 
view santalaus's profile">santalaus</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10777" title="Go to message">jaxislnad</a>
							</em>
					</span>
					<p id="comment-body-10804">
					Jepp, this is because the filename of the vmdk on the diffrent 
Datastore contains the fullPath.<br>
<br>
scsi0:0.fileName = "Fileserver.vmdk"<br>
scsi0:1.filename = 
"/vmfs/volumes/4982de6f-6ea7343b-c3c9-00221986180a/Fileserver/Fileserver_1.vmdk"<br>
<br>
So you could not easily use the VMDK Name as source or target for copy.<br>
You have to check first the path an the make 2 arrys VMDKS and 
VMDKFULLPATH
					</p>
				</div>
				<a name="comments-10778"></a>
				<div id="comment-10778" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2009 8:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-yezXgu14w7RNMtc1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10804" title="Go to message">santalaus</a>
							</em>
					</span>
					<p id="comment-body-10778">
					All, this has been acknowledged by a few as an issue, the current 
workaround is to only backup VM(s) that reside on the same datastore.<br>
<br>
I've been occupied with other projects recently and when I get some time
 I'll take a look and provide a fix. If anyone has implemented a a 
working solution, feel free to post or send me a PM. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10805"></a>
				<div id="comment-10805" class="jive-content-comment ">
					<span>
						<span>
							Feb 19, 2009 12:53 PM
						</span>
							<!--<a href="/people/docsys" title="Click to view docsys's profile">
<img class="jive-avatar" src="/people/docsys/avatar/16.png?a=-1" height="16" width="16" title="Click to view docsys's profile" alt="Click to view docsys's profile" />
</a>--><a href="http://communities.vmware.com/people/docsys" 
id="jive-GOqbW6UQSKl6fjce" class="jive-username-link" title="Click to 
view docsys's profile">docsys</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10778" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10805">
					Anyone having issues downloading the ghettoVCB.sh from this page? I
 get it and it doesn't run. It shows a "Bad Interpreter" File Not Found 
error. It seems to be corrupt or have some control characters in it 
(^M). I can't see them in vim or vi and I only downloaded to a windows 
xp system, didnt edit it at all on windows. <br>
<br>
It seems the ghettoVCB.sh on <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
 and here on VMware site are different revisions, but the one from the 
ucsb site is working OK.<br>
<br>
TIA.
					</p>
				</div>
				<a name="comments-10791"></a>
				<div id="comment-10791" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2009 1:01 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6S3tYeL7G506YryN" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10805" title="Go to message">docsys</a>
							</em>
					</span>
					<p id="comment-body-10791">
					Sorry about that, I must have forgotten to update the engineering 
account. They should be the same, I've uploaded the current version and 
can you try the download on the VMTN doc again? <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10792"></a>
				<div id="comment-10792" class="jive-content-comment ">
					<span>
						<span>
							Feb 19, 2009 1:18 PM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-Pd8Xi3gUPEUO3k95" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10791" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10792">
					If you do have a problem with the trailing "^M" line termination 
you can do the following to get a good version of the script:<br>
<br>
</p><div class="jive-quote">sed 's/.$//g' ghettoVCB.sh &gt; 
ghettoVCBFixed.sh</div>
<br>
Just make sure to turn the execution bit on...
					
				</div>
				<a name="comments-10806"></a>
				<div id="comment-10806" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2009 1:36 PM
						</span>
							<!--<a href="/people/docsys" title="Click to view docsys's profile">
<img class="jive-avatar" src="/people/docsys/avatar/16.png?a=-1" height="16" width="16" title="Click to view docsys's profile" alt="Click to view docsys's profile" />
</a>--><a href="http://communities.vmware.com/people/docsys" 
id="jive-RfokunW71uh2zQxe" class="jive-username-link" title="Click to 
view docsys's profile">docsys</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10792" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10806">
					Alright it seems the file from the vmware site still has the ^M 
somehow, tried the sed command and it was OK. <br>
The file from the ucsb site is updated and Good still.<br>
Thanks.
					</p>
				</div>
				<a name="comments-10825"></a>
				<div id="comment-10825" class="jive-content-comment ">
					<span>
						<span>
							Feb 20, 2009 10:19 AM
						</span>
							<!--<a href="/people/Gregori" title="Click to view Gregori's profile">
<img class="jive-avatar" src="/people/Gregori/avatar/16.png?a=-1" height="16" width="16" title="Click to view Gregori's profile" alt="Click to view Gregori's profile" />
</a>--><a href="http://communities.vmware.com/people/Gregori" 
id="jive-1l6Ctk43n9s91Ckt" class="jive-username-link" title="Click to 
view Gregori's profile">Gregori</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-10825">
					How to change the ghettoVCB.sh to delete the old backup before 
execute new backup?<br>
<br>
Thanks.
					</p>
				</div>
				<a name="comments-10811"></a>
				<div id="comment-10811" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 20, 2009 12:45 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-93O1RExfsdI1Aj97" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-10811">
					I'm looking at the issue and basically it boils down to the SOURCE 
and DESTINATION path, the VMDKS array will contain either the local VMDK
 disk names with respect to the VM's folder which you'll need to append 
the VMX_PATH variable or if the disk is stored in another datastore, 
it'll contain the full path to the VMDK. A quick fix would to check the 
variable that goes through each for loop iteration to see if it starts 
with <u>/vmfs/volumes</u>, if so then you know it's a disk that's 
located in another datastore and setup the variable accordlying. Running
 through some print statements, I noticed an issue with the DESTINATION 
which also needs similar logic. <br>
<br>
Though right now the issue from my basic test is the following: I have 
one Windows VM with 1 disk call it <b>Quentin.vmdk</b> which is the 
unique descriptor describing one of Quentin's disk that is stored in 
Datastore A. I know add a second disk and store i in Datastore B, I 
commit the changes and then look at the disk name from both the VIC and 
on the filesystem and what do I notice?<br>
<br>
The name of the .vmdk is the same as disk 1, this will be an issue when 
backing up the disks to your destination as these filenames are no 
unique and will most likely over write one another. I then added a third
 disk two the VM and stored it in Datastore B and the .vmdk now has a 
unique name appended with <b>_1</b>. <br>
<br>
The observation, at least on ESX w/SC (haven't tested on ESXi) if you 
have a VM with 1 disk and you add another and you're going to store it 
on another datastore the name will not be unique as it'll default to the
 VM's display name. This will cause a problem when backing up ... I'm 
trying to think of what changes would need to occur but it seems that 
it'll most likely requiring the modification of the .vmdk name's to the 
destination which may or may not be something end users want. <br>
<br>
I'm still pondering over the issue right now over lunch ... if anyone 
has any suggestions I'm open, but this may be a feature that may not be 
supported due to the way the disk's are not uniquely labeled across 
datastores. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10840"></a>
				<div id="comment-10840" class="jive-content-comment ">
					<span>
						<span>
							Feb 20, 2009 2:47 PM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-3aLlIp0L446EhoU1" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10811" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10840">
					I think what would make sense would be to create folders for the 
datastores names and put the files there. <br>
<br>
This would also make it a lot easier to restore since one can easily 
tell what when where...<br>
<br>
Make sense?
					</p>
				</div>
				<a name="comments-10841"></a>
				<div id="comment-10841" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 20, 2009 2:52 PM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-ydM9YY4xuPb9Fi4d" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10840" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10841">
					Or more technically, retain the path relative to /vmfs/volumes
					</p>
				</div>
				<a name="comments-10826"></a>
				<div id="comment-10826" class="jive-content-comment ">
					<span>
						<span>
							Feb 20, 2009 2:55 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5qnXJmn8e7SVb2h6" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10840" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10826">
					Unfortunately that does nothing for the current situation other 
than additional directories and a disconnect between what's listed in 
the .vmx file and the additional work a user would have to remove the 
disk reference and re-map on a backup/recovery. The solution would be 
too specific as some user's may want to mount the backup datastore 
directory whereas others would want to manually copy from the recovery 
datastore but not directly register the VM(s) from backup. <br>
<br>
The more I think about this, the only decent solution is to 
automatically rename and update the backup VMDK(s) as they're being 
backed up and set them to be referenced locally within the VM's 
directory. This then allows a user to either mount the VM directly if 
he/she would need to recovery or restore from backup and have all 
VMDK(s) referenced properly. The only difference with VM(s) that were 
initially stored across multiple datastores will not be preserved (the 
ability to recovery may be more important than how the disks were 
initially stored). For further use cases, that'll be something end-users
 will need to customize for their enviornment. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10827"></a>
				<div id="comment-10827" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 20, 2009 2:58 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-05ddL1x8h3rlax7B" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10841" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-10827">
					Even if you retain the path ... what's to say a user can't bring up
 the original datastores, they're recovering to another ESX/ESXi host 
with another datastore or local. This really goes hand in hand with 
recovery which is going to be unique for each environment. This script 
will not be able to handle all those use cases, hence it's up to the end
 users to customize as needed for their enviornment. We're trying to 
generalize the process so that such customization is available if 
necessary. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10812"></a>
				<div id="comment-10812" class="jive-content-comment ">
					<span>
						<span>
							Feb 20, 2009 3:34 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-uLgfSvr39xIPQ9g4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-10812">
					How about the following as a compromise: <br>
<br>
To preserve the functionality and familiarity of the script with user's 
that have already implemented a recovery/restore solution, I will 
continue to backup all VMDK(s) that are stored locally with the VM to 
the destination folder as you're aware of. The added fix would then 
support VMDK(s) that are not stored in the same datastore as the VM but 
in backing those VMDK(s) up to take into consideration of non-unique 
VMDK names provided by VMware, I would create an additional directory 
which will be the unique UUID of the original VMDK destination and then 
it would be up to the end user's to provide a solution on 
recovery/restoration. <br>
<br>
This will preserve the original .vmx file as I have currently in the 
script and if a user chooses to restore a VM to it's initial 
configuration, the only added step would be to vmkfstools copy any 
VMDK(s) that were not stored with the VM to it's correct datastore. A 
user would also be able to directly mount the backup datastore but then 
would be required to manually update the location of the VMDK(s) that 
were not stored with the original VM ( <b>this would have to be done 
even if the current script supported VMDK(s) across multiple datastores 
as your recovery .vmx file will not contain the correct paths</b> )<br>
<br>
</p><h3>Example:</h3>
<br>
<ul>
<li>DS1/VM_TEST
<ul>
<li>DS1/VM_TEST.vmdk</li>
<li>DS1/VM_TEST_1.vmdk</li>
</ul>
</li>
<li>DS2/VM_TEST/VM_TEST.vmdk</li>
</ul>
<br>
<h4>Backup would be:</h4>
<p>
</p><ul>
<li>VM_TEST
<ul>
<li>VM_TEST.vmdk</li>
<li>VM_TEST_1.vmdk</li>
<li>DS2/VM_TEST.vmdk</li>
</ul>
</li>
</ul>
<p>
I think this makes the most sense and preserves the original script's 
behavior and I can not stress this enough, that it's the responsibility 
of the end user's to design/automate a process that fits their operating
 environment. This script is to aide in backing up your VM(s) but as you
 know there will be different sets of requirements for environment and 
the specifics will need to be customized by the end users. <br>
</p><p>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10861"></a>
				<div id="comment-10861" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 22, 2009 8:43 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-H8GmWegUvHqdLMsp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-10861">
					Script has been updated, please let me for those that have multiple
 VMDK(s) across multiple datastores if this works. Thanks<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10863"></a>
				<div id="comment-10863" class="jive-content-comment ">
					<span>
						<span>
							Feb 23, 2009 4:12 AM
						</span>
							<!--<a href="/people/santalaus" title="Click to view santalaus's profile">
<img class="jive-avatar" src="/people/santalaus/avatar/16.png?a=-1" height="16" width="16" title="Click to view santalaus's profile" alt="Click to view santalaus's profile" />
</a>--><a href="http://communities.vmware.com/people/santalaus" 
id="jive-08e2d0KSAn38XljD" class="jive-username-link" title="Click to 
view santalaus's profile">santalaus</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10861" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10863">
					It seemed to work good.<br>
Now I have an backup of the vmdk which where on the second datastore
					</p>
				</div>
				<a name="comments-10896"></a>
				<div id="comment-10896" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2009 4:09 AM
						</span>
							<!--<a href="/people/bpsmanagement" title="Click to view bpsmanagement's profile">
<img class="jive-avatar" src="/people/bpsmanagement/avatar/16.png?a=-1" height="16" width="16" title="Click to view bpsmanagement's profile" alt="Click to view bpsmanagement's profile" />
</a>--><a href="http://communities.vmware.com/people/bpsmanagement" 
id="jive-9285VLS711mrbs1x" class="jive-username-link" title="Click to 
view bpsmanagement's profile">bpsmanagement</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10861" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10896">
					First of all.. thank you William and all others who have 
contributed to this. The script is sweet. Much faster than other scripts
 that use other backup methods. I am however getting speeds that are 
unusually slow for file transfer on an internal LAN. <br>
I am running ESXi embedded on my host and I have a Allegro NFS Demo 
running on a physical server 2008 box (attempted to configure Unix on 
server 2008 using native Windows tools with no luck; authentication 
issues). The export is located on my local server 2008 storage. It's a 
1.5TB Barracuda. Both boxes have Intel Gigabit Nics and are connected 
VIA a Linksys Gigabit switch. I tested my transfer speeds using 
wireshark at 15.8MBit/sec while running this script. I tested windows 
transfer from my guest VM to my Windows 2008 server at ~320MB/s. I know 
it's not my network configuration because of the results I get with 
Windows. Is allegro just slow as mollases? Server 2008 and Allegro Hate 
eachother? I know Server 2008 hates Unix (unless it's solaris 10), but 
thats another story.. What numbers should we expect/shoot for? What are 
other seeing backing up to NFS storage?<br>
<br>
Feeling down? Need a good laugh? 100GB of data split between two VM's..<br>
<br>
 Start time: Wed Feb 25 00:16:28 UTC 2009<br>
 End   time: Wed Feb 25 11:56:51 UTC 2009<br>
 Duration  : 700.38 Minutes<br>
<br>
 Completed backing up specified Virtual Machines!
					</p>
				</div>
				<a name="comments-10876"></a>
				<div id="comment-10876" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2009 11:08 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-qcKEIinMIzLJz46P" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10896" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-10876">
					Quick question.<br>
How do I restore form the Backup?<br>
I currently store the Backup on the same Datastore.<br>
Do I just add to Inventory and run from there? or do I move the files to
 the original Folder?<br>
What happens with multiple vmdks?
					</p>
				</div>
				<a name="comments-10877"></a>
				<div id="comment-10877" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2009 11:55 AM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-1KwEstL8KW15F5cV" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10876" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10877">
					mmm<br>
I just did a backup of a server that has its OS on one DS and the data 
on a second DS.<br>
The only vmdk that was backedup was the data disk. the the actual OS 
vmdk was not.
					</p>
				</div>
				<a name="comments-10902"></a>
				<div id="comment-10902" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2009 11:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Sbf4HYOlN38Vs13N" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10877" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-10902">
					Please make sure you're using the latest version. <br>
<br>
Restore can be either direct mount from your backup datastore and just 
register or replicate from your backup datastore using vmkfstools. I 
would recommend that latter, that way you don't use your backup for use 
but replicate it to the host for recovery/restore. The 
recovery/restoration process is something that is more manual and can be
 scripted but the requirement will be based around your requirements and
 should be implemented based on that. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10903"></a>
				<div id="comment-10903" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2009 12:41 PM
						</span>
							<!--<a href="/people/bpsmanagement" title="Click to view bpsmanagement's profile">
<img class="jive-avatar" src="/people/bpsmanagement/avatar/16.png?a=-1" height="16" width="16" title="Click to view bpsmanagement's profile" alt="Click to view bpsmanagement's profile" />
</a>--><a href="http://communities.vmware.com/people/bpsmanagement" 
id="jive-KMMpIWI6ia22fdqz" class="jive-username-link" title="Click to 
view bpsmanagement's profile">bpsmanagement</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10896" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-10903">
					no comment?
					</p>
				</div>
				<a name="comments-10904"></a>
				<div id="comment-10904" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2009 12:46 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-vf09FVqEIMYH9PS0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10903" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-10904">
					not really, I'm not familiar with NFS off of Windows, there are 
many configurations that could cause the speeds you're seeing. If you 
look in the forums, you'll find various comments on good/bad speeds. If 
you're running an NFS Server on VM, you may see speed decreases than on a
 physical. Your export options can also affect the speeds (e.g. sync vs 
async). There have been many individuals getting very good speeds and 
many that get less than up to par/expected. Your best bet is to ask the 
community for their configurations but can also be due to the hardware 
you're using... unfortunately when you're discussing performance, ymmv 
depending on your setup. <br>
<br>
The script has nothing to do with your performance if that's what you're
 after. <br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10908"></a>
				<div id="comment-10908" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 27, 2009 12:23 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-Ylc491ljXEnC25T5" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10904" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10908">
					hello all<br>
I am backing up about 4 different vm-images each night with the script. 
But somethimes the snapshots are not removed after backing up and so the
 next time the backup of this vm will fail.<br>
</p><ul class="jive-dash">
<li>would it be possible to backup a vm also if a snapshot exists? 
What's the reason you check for existing snapshots?</li>
<li>How is it possible to send a mail after each backup with the content
 of the ghettovcb-script?</li>
</ul>
<br>
Thank you,<br>
<br>
ibhp
					
				</div>
				<a name="comments-10930"></a>
				<div id="comment-10930" class="jive-content-comment ">
					<span>
						<span>
							Feb 27, 2009 8:12 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-o2v73nzKEiyyV1lF" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10908" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10930">
					VM(s) w/Snapshots are not supported because snapshots in general 
should not be kept for long periods of time. They're meant to be used 
for quick testing and all changes should be merged back into the main 
VMDK as soon as possible. If you're looking to send email, a quick 
search online you'll find many solutions available including using 
default utilities like (mail or mutt) if you're on a UNIX/Linux system. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10936"></a>
				<div id="comment-10936" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2009 12:38 PM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-R6R5u26homO1gUy4" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10930" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10936">
					Thank you for your response. But somethimes the snapshots created 
by ghettovcb are not removed correctly and so the next backups are not 
performed anymore.<br>
<br>
Is there a way to remove every snapshot automatically (in the script) 
before the new backups are performed? That would ensure that the backups
 run even if there are "old" snapshots.
					</p>
				</div>
				<a name="comments-10937"></a>
				<div id="comment-10937" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2009 1:33 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-KP68cUd6vwPxwM6T" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10936" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10937">
					Interesting, I haven't heard of any issues of snapshots not being 
removed. Are there any previous snapshots on the VM when running the 
backup? If so, that may cause some issues. <br>
<br>
Currently with the method of using the <b>vimsh</b> there is not an 
option to remove all snapshots, you also don't want to automate that 
process of committing older snapshots without checking the state of 
those snapshots. Committing snapshots should be a manual process to 
ensure you don't revert or make any changes to the system that the 
Application/System owner is not aware of. Again, the script enforces the
 rule that if it finds any prior snapshots it will not continue. You 
should not be using snapshots for long durations and should commit the 
changes as soon as possible especially if you're looking to backup the 
VM(s). <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10938"></a>
				<div id="comment-10938" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2009 1:45 PM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-UQ1Bp73I4Sx2eTDh" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10937" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10938">
					I have a directory with my virtual disc and a snapshot created from
 ghettoVCB (not removed after the backup). When I try to:<br>
${VMWARE_CMD} vmsvc/snapshot.remove ${VM_ID}<br>
<br>
then I get a segmentation fault. So that seems to be the problem the 
snapshots are not correctly removed after the script terminates.<br>
<br>
Any idea what could be the reason?
					</p>
				</div>
				<a name="comments-10947"></a>
				<div id="comment-10947" class="jive-content-comment ">
					<span>
						<span>
							Mar 2, 2009 1:42 AM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-xicV1jG41Hv2x3E0" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10938" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-10947">
					Hello lamw,<br>
<br>
since your script is running now for a few weeks, I got two days ago 
this error:<br>
<br>
on esxi1:<br>
<br>
Clone: 100% done.<br>
Powering back on ps1<br>
bash: /vmfs/volumes/iscsi1backupdsa1/backups//ps1/ps1-2009-02-26: bad 
number<br>
/vmfs/volumes/iso/backup/ghettoVCB-enhance-iscsi1.sh: 
/vmfs/volumes/iso/backup/ghettoVCB-enhance-iscsi1.sh: 323: Syntax error:
 /vmfs/volumes/iscsi1backupdsa1/backups//ps1/ps1-2009-02-26+1 <br>
<br>
on esxi2:<br>
<br>
Clone: 100% done.<br>
Powering back on exchange3<br>
bash: 
/vmfs/volumes/iscsi1backupdsa1/backups//exchange3/exchange3-2009-02-26: 
bad number<br>
/vmfs/volumes/iso/backup/ghettoVCB-enhance-iscsi1.sh: 
/vmfs/volumes/iso/backup/ghettoVCB-enhance-iscsi1.sh: 323: Syntax error:
 
/vmfs/volumes/iscsi1backupdsa1/backups//exchange3/exchange3-2009-02-26+1<br>
Plink error: Remote command failed<br>
(Exit code 2)<br>
<br>
I can see that your script was not removing the backup files: Backup 
rotation is set to: 2 and there are 3 directories now in the folder.<br>
<br>
It looks like that only the last vm of my machinelist had this problem. I
 did not change anything in your script an machinelist since weeks.<br>
<br>
Hope you have a answer.
					</p>
				</div>
				<a name="comments-10943"></a>
				<div id="comment-10943" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 2, 2009 3:50 AM
						</span>
							<!--<a href="/people/hremul" title="Click to view hremul's profile">
<img class="jive-avatar" src="/people/hremul/avatar/16.png?a=-1" height="16" width="16" title="Click to view hremul's profile" alt="Click to view hremul's profile" />
</a>--><a href="http://communities.vmware.com/people/hremul" 
id="jive-MOg7baBlv39FGk1z" class="jive-username-link" title="Click to 
view hremul's profile">hremul</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10947" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-10943">
					Sorry, but where i can't find ghettoVCB-enhance.sh script?
					</p>
				</div>
				<a name="comments-10960"></a>
				<div id="comment-10960" class="jive-content-comment ">
					<span>
						<span>
							Mar 2, 2009 8:34 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-jrc3rQRux0yLjPaU" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10947" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-10960">
					Please download the current version of the script and manually try 
again and see if you run into the same issues, if not, then it could be 
some issues when remoting in with plink. <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10961"></a>
				<div id="comment-10961" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 2, 2009 8:35 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-l7QgVwNv0eXn5fur" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10943" title="Go to message">hremul</a>
							</em>
					</span>
					<p id="comment-body-10961">
					The current download is the most up to date version of the script, 
please look over the documentation if you have further questions. <br>
</p><p>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10962"></a>
				<div id="comment-10962" class="jive-content-comment ">
					<span>
						<span>
							Mar 3, 2009 12:18 PM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-05oHADO77i3JUe7x" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10960" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10962">
					Hello lamw<br>
<br>
I updated to the latest version, but I got the same problem.<br>
See:<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Starting backup for dc2 ... #####################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Failed to clone disk : The file already exists (39).<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/iscsi2dsa4/dc2/dc2.vmdk'...<br>
Powering back on dc2<br>
bash: /vmfs/volumes/iscsi1backupdsa1/backups/dc2/dc2-2009-03-02: bad 
number<br>
/vmfs/volumes/iso/backup/ghettoVCB-iscsi1.sh: 
/vmfs/volumes/iso/backup/ghettoVCB-iscsi1.sh: 337: Syntax error: 
/vmfs/volumes/iscsi1backupdsa1/backups/dc2/dc2-2009-03-02+1 <br>
<br>
I am sure that i deleted all backuped subfolders which I dont needed so 
there should be not more then two subfolders be in. Rotation is set to 2<br>
<br>
I started your script direct per putty and only the machine dc2 and I 
got the complete same error.<br>
In the backup folder there are only to subfolders dc2-2009-02-28--2 and 
dc2-2009-03-01--1<br>
<br>
Any idea what this problem could be ?
					
				</div>
				<a name="comments-10944"></a>
				<div id="comment-10944" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 3, 2009 12:35 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-K27C1W2338gc5L7k" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10962" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-10944">
					I think you might have had some bad backups that were not rotated 
out properly which is causing some issues. Can you please move any 
previous backups whether they're good/bad out of that directory or purge
 them completely. Try a fresh backup<br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10980"></a>
				<div id="comment-10980" class="jive-content-comment ">
					<span>
						<span>
							Mar 4, 2009 12:01 AM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-5JUNk583F0276xX2" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10944" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10980">
					I deleted the complete folder with the backups and tried 3 backups 
only with this problematic machnine and they were running. So I delted 
also the other folders with<br>
problematic machine. I have to wait now for a few days to see if 
everything is working again.
					</p>
				</div>
				<a name="comments-10993"></a>
				<div id="comment-10993" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 4, 2009 9:27 AM
						</span>
							<!--<a href="/people/Yulman" title="Click to view Yulman's profile">
<img class="jive-avatar" src="/people/Yulman/avatar/16.png?a=-1" height="16" width="16" title="Click to view Yulman's profile" alt="Click to view Yulman's profile" />
</a>--><a href="http://communities.vmware.com/people/Yulman" 
id="jive-Iz0AljAvR99Fw2Gs" class="jive-username-link" title="Click to 
view Yulman's profile">Yulman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10754" title="Go to message">jsmithsd</a>
							</em>
					</span>
					<p id="comment-body-10993">
					Just like you I wanted to log to a file.<br>
<br>
This is what I came up with<br>
<br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9653">http://communities.vmware.com/docs/DOC-9653</a><br>
</p><p>
I did this at my own risk...I'm not a shell programmer so this should be
 tested before used in a production environment.<br>
<br>
Hope this helps
					</p>
				</div>
				<a name="comments-10981"></a>
				<div id="comment-10981" class="jive-content-comment ">
					<span>
						<span>
							Mar 4, 2009 9:34 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4dcjX9FKb3Mg7XW3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10993" title="Go to message">Yulman</a>
							</em>
					</span>
					<p id="comment-body-10981">
					Thanks for the post, the logging feature will be available in an 
upcoming release. Stay tuned <br>
</p><p>
<br>
=========================================================================<br>
--William<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-10986"></a>
				<div id="comment-10986" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 5, 2009 8:21 PM
						</span>
							<!--<a href="/people/hremul" title="Click to view hremul's profile">
<img class="jive-avatar" src="/people/hremul/avatar/16.png?a=-1" height="16" width="16" title="Click to view hremul's profile" alt="Click to view hremul's profile" />
</a>--><a href="http://communities.vmware.com/people/hremul" 
id="jive-B8U6MqIktQE0QiIQ" class="jive-username-link" title="Click to 
view hremul's profile">hremul</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10981" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-10986">
					First of all, i wish to thank for great script.<br>
<br>
I have one suggestion. It is possible to add functionality to backup 
power off machines which have snapshots?<br>
In some kind applications (like development) night downtime does not 
matter. But snapshots does. Thank you.
					</p>
				</div>
				<a name="comments-10999"></a>
				<div id="comment-10999" class="jive-content-comment ">
					<span>
						<span>
							Mar 5, 2009 8:25 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-d3aqk7juA3mp82SK" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-10986" title="Go to message">hremul</a>
							</em>
					</span>
					<p id="comment-body-10999">
					Hi hremul,<br>
<br>
As mentioned in the previous posts, snapshots should not be kept for 
long durations. They can grow and left uncheck could cause issues on 
your datastores being filled up. If you're looking to backup VM(s) that 
have snapshots, best practice is to commit those changes and merge the 
delta files back to the VM then backup the virtual machine. There some 
complexity with the way the script handles removing snapshots if you're 
going to try to backup a VM with snapshots and partially it's a 
limitation with the <b>vimsh</b> and keeping track of the snapshots. 
It's best that you don't backup VM(s) with snapshots, but if you do, 
you'll need to make modifications to the script and that is an 
unsupported feature. <br>
</p><p>
<br>
=========================================================================<br>
--William Lam<br>
VMwae vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a>
					</p>
				</div>
				<a name="comments-11036"></a>
				<div id="comment-11036" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 10, 2009 2:42 AM
						</span>
							<!--<a href="/people/jbrandligt" title="Click to view jbrandligt's profile">
<img class="jive-avatar" src="/people/jbrandligt/avatar/16.png?a=-1" height="16" width="16" title="Click to view jbrandligt's profile" alt="Click to view jbrandligt's profile" />
</a>--><a href="http://communities.vmware.com/people/jbrandligt" 
id="jive-5op9QhRq192R9r8h" class="jive-username-link" title="Click to 
view jbrandligt's profile">jbrandligt</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11036">
					Hi lamw,<br>
<br>
Thanks for a great script! I have one question though. Is it possible to
 change the script in such way that it can copy the backups to a 
datastore on a remote esxi host using something like scp?
					</p>
				</div>
				<a name="comments-11015"></a>
				<div id="comment-11015" class="jive-content-comment ">
					<span>
						<span>
							Mar 10, 2009 10:07 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5rJRW4g8y8wxxWS2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11036" title="Go to message">jbrandligt</a>
							</em>
					</span>
					<p id="comment-body-11015">
					You could append some scp commands and using paired SSH keys to 
remotely copy the backups to external storage or another host. There 
have been some threads regarding the implementation of scp on the 
unsupported console and the performance/speed in copying large files. 
You might want to take a look at a free tool by Veeam fastscp, I have 
not used it personally but I've heard many good things about their 
product. That might be a better approach if you need to copy files 
in/out of ESXi. <br>
<br>
You also have the option to leverage <b>vifs.pl</b> from the VI Perl 
Toolkit default utilities, but again these are customizations that'll 
need to be added to your custom version of the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image">
					</p>
				</div>
				<a name="comments-11038"></a>
				<div id="comment-11038" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 11, 2009 4:24 AM
						</span>
							<!--<a href="/people/jbrandligt" title="Click to view jbrandligt's profile">
<img class="jive-avatar" src="/people/jbrandligt/avatar/16.png?a=-1" height="16" width="16" title="Click to view jbrandligt's profile" alt="Click to view jbrandligt's profile" />
</a>--><a href="http://communities.vmware.com/people/jbrandligt" 
id="jive-Ws8kXcyO2Roll65V" class="jive-username-link" title="Click to 
view jbrandligt's profile">jbrandligt</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11015" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11038">
					Thanks for your reply. Fastscp is a nice tool, but it is only a 
file copy-tool. It does not handle running vm's because it does not take
 snapshots. <br>
<br>
There is also veeam-backup 3.0 now with support for esxi. The draw back 
of this tool is that it does not backup to a target esxi host, only 
local storage or san or iscsi storage. Veeam-backup makes use of the 
console of esx to make incremental backups of vm's and esxi of course 
does not have an esx-like console, so that is why it cannot use esxi as a
 target for its backups.<br>
<br>
And then there is also an other tool, vm-explorer, which does do backups
 to other esxi hosts, but this tool does not run as a service. It is 
intended to be run as a user only.... For me that is not an option for a
 backup tool. I could run the tool with a service wrapper, to run it as a
 service, but i cannot test this scenario with the trial license because
 there is this annoying popup window, you have to click away every time 
you start the tool.<br>
<br>
So it looks like i have to customize your script. Wish me luck <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Jeroen
					</p>
				</div>
				<a name="comments-11115"></a>
				<div id="comment-11115" class="jive-content-comment ">
					<span>
						<span>
							Mar 25, 2009 8:36 AM
						</span>
							<!--<a href="/people/dotcom" title="Click to view dotcom's profile">
<img class="jive-avatar" src="/people/dotcom/avatar/16.png?a=-1" height="16" width="16" title="Click to view dotcom's profile" alt="Click to view dotcom's profile" />
</a>--><a href="http://communities.vmware.com/people/dotcom" 
id="jive-AsJz65rP4V0wv0zF" class="jive-username-link" title="Click to 
view dotcom's profile">dotcom</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10516" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11115">
					Compressing the backup is more than a good suggestion... here is 
why...<br>
<br>
The VM filesystem is stored as a sparse file.  When you copy that data 
to the network storage, you are un-sparsing it, unless you encapsulate 
the data into a compressed file, using compression that knows how to 
properly restore the sparse data.<br>
<br>
So my 20g vm, that is really only using 270m of disk space in it's 
sparsely allocated file, will grow instantly to 20g using your backup 
system.  If you restore it, or use the backup to clone in, you are no 
longer sparse...  Instead you suddenly have a big file full of zeros.  
And those zeros take up network bandwidth.<br>
<br>
The backup is not accurate if it fails to preserve the state of the 
stored data, and this includes the sparseness.<br>
<br>
Sparse files are strange beasts, and programs like cp do not handle them
 correctly most of the time, so the moment you "forget" to handle the 
file correctly, it inflates to a non-sparse state.  In a sparce file, an
 unallocated block of 0's is not stored on disk, rather the index points
 to null, which represents an unallocated data block assumed to be 
zeros.  If you cat the file, the filesystem produces those 0's, but they
 don't really exist on disk.  If you copy the file without an awareness 
of the sparse allocation, you end up with a huge file full of unneeded 
zeros... and this takes up network bandwidth as well as disk io.  When 
you unsparse a file, there is a heavy performance cost and storage cost.<br>
<br>
While some might say "use a compressed filesystem on the NFS server"... 
 That does not deal with the whole issue.  On a compressed filesystem 
you are still storing unneeded 0's, and when you move the file to a 
non-compressed filesystem, all that space is consumed, along with the 
disk io needed to write it all out.  So you go from a vm that takes 
twenty seconds to move from one server to another using vmware's tools, 
to one that takes 3 hours to move.  And if you depend on your network 
bandwidth to do work, now you have a whole lot less of it... not to 
mention the time lost.  I in a day can move hundreds of vm's that only 
take 20 seconds to transit across the network... but that number falls 
to 8 when they take 3 hours each.<br>
<br>
If you have 3 vm's to back up, it's a minor issue, especially if you do 
the backup when you sleep.  But if you store the backup with the intent 
to clone it during work hours, it's is a big hit on productivity.<br>
<br>
The backups need to preserve the sparseness, a sparse aware compression 
tool needs to be used.  There are not a lot of compression tools on your
 ESXi system, there is one.  So the suggestion that there are many 
options is wrong.  And the suggestion that this is not an issue is 
misguided.  And using a compressed filesystem to store the data on is 
also not addressing the main issue.<br>
<br>
If you don't know what a sparse file is, you can read about it at:<br>
<a class="jive-link-external" 
href="http://administratosphere.wordpress.com/2008/05/23/sparse-files-what-why-and-how/">http://administratosphere.wordpress.com/2008/05/23/sparse-files-what-why-and-how/</a><br>
<br>
This does need to be addressed for this tool to be useful the the larger
 audience.<br>
<br>
It is a great tool by the way, don't let my sparse rant take away from 
the fact that this tool is wonderful.  My point is that compression in 
the utility is not as optional as you would like to think.  Compression 
and correct sparse handling are critical.
					</p>
				</div>
				<a name="comments-11146"></a>
				<div id="comment-11146" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 1, 2009 10:47 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-E4DDav9VS4f0xeB6" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10961" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11146">
					Hi there and thank you for a wonderful script and contribution to 
the community!<br>
<br>
I have two ESXi host machines that are colocated at a data center.  
There is a 3rd Linux backup computer with NFS on it, and I want to be 
able to backup the VMs running on these hosts on a regular basis.  I 
have a 'public' WAN network (the VLAN provided by the data center that 
is public to the world) and a private LAN that is not private.  All 
machines have dual NICs - one for the public WAN and one for the private
 LAN.  <br>
<br>
I would like to have it so that my NFS server runs the backups of all 
VMs using the LAN for this.  I'm also sensitive to security concerns, 
particularly brute force attacks on SSH which are showing up routinely. 
 As a result, all public servers on the WAN have their SSH ports changed
 from default ports to non-default ports, and Fail2Ban scripts installed
 to detect brute force login attacks on these boxes.  This has been very
 successful so far.<br>
<br>
I cannot install a firewall in this environment because the cost of 
doing so is prohibitive since I have about 20 WAN IP addresses on the 
VLAN.  I may do this in the future when I work out how to set this up 
with pfSense but for now, its prohibitive as an option.  Consequently 
every server that is WAN facing has their own local IPTables firewalls 
in place.<br>
<br>
I understand from reading the posts and documentation on the ghettoVCB 
scripts that it appears to run from within a ESXi host which is made 
available through a SSH port enable on the box.  As much as I would like
 to be able to do this, its not possible due to security concerns.  I 
can't have default port 22 open like this.  So is there a way that I can
 install it on my NFS server for the LAN only, and not have any of the 
ESXi boxes set with SSH at all?<br>
<br>
Or if not, is there anyway to apply some 'best practice' security 
approach to enabling SSH on the ESXi hosts that allow for the use of 
non-default ports, and some form of script that could be run to thwart 
brute force attacks on the boxes?<br>
<br>
Thanks again for your wonderful work, and I look forward to any comments
 or suggestions.<br>
<br>
Myles
					</p>
				</div>
				<a name="comments-11155"></a>
				<div id="comment-11155" class="jive-content-comment ">
					<span>
						<span>
							Apr 3, 2009 3:43 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-cmTgfpDDkUTPCA05" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11146" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-11155">
					Hi Myles,<br>
<br>
Thanks for the comments. <br>
<br>
I wanted to get a few things cleared up and this may help you decide on 
how you go forward with implementing a backup solution. <b>ghettoVCB</b>
 can run on both ESX/ESXi as you know and specifically on ESXi, you'll 
need to enable the unsupported SSH console. This is not required for the
 backup to work but you'll need a way to execute the script from a 
remote system and currently SSH is the only method to communicate with 
the host to run the script. <br>
<br>
You should also note that the unsupported SSH Console is unsupported by 
VMware, if you have a support contract this could potentially void the 
agreement. Best practice is not to enable the console, but there are 
certain things that is limited with ESXi if you were to just rely on 
RCLI or VIMA to manage and sometimes an admin may need to login to the 
console. It's best that you secure your environment and ensure that your
 hosts are not directly accessible to the public WAN network and only 
hosts within your environment can communicate to your ESXi host(s). <br>
<br>
Hopefully this clears up a few things and good luck on your 
implementation. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image">
					</p>
				</div>
				<a name="comments-11281"></a>
				<div id="comment-11281" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 25, 2009 3:51 PM
						</span>
							<!--<a href="/people/GruberK" title="Click to view GruberK's profile">
<img class="jive-avatar" src="/people/GruberK/avatar/16.png?a=-1" height="16" width="16" title="Click to view GruberK's profile" alt="Click to view GruberK's profile" />
</a>--><a href="http://communities.vmware.com/people/GruberK" 
id="jive-jJFUKM62fJtrX6Bi" class="jive-username-link" title="Click to 
view GruberK's profile">GruberK</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11281">
					Hi,<br>
I am using ESXi 3.5 Update4 with the ghettoVCB.sh script downloaded from
 this website.<br>
I trying to backup 3 machines: Ubuntu 8.10, Windows 2003 STD, Windows 
2008 STD, on all 3 machines are the latest VMWare tools installed to a 
NFS share which is mounted.<br>
<br>
I have tried to backup all 3 machines with putty connected to the ESXi 
server.<br>
su root ./ghettoVCB.sh virtual_machine_backup_list<br>
<br>
The problem now is that I would like to backup the machines while they 
are running (Online)<br>
POWER_VM_DOWN_BEFORE_BACKUP=0<br>
ENABLE_HARD_POWER_OFF=0<br>
2 of the 3 machines are shut down immediately (not gracefully, its like 
power off) when I start the backup script.<br>
<br>
Can anyone tell me where the problem can be?<br>
Thanks in advance for any suggestions!
					</p>
				</div>
				<a name="comments-11282"></a>
				<div id="comment-11282" class="jive-content-comment ">
					<span>
						<span>
							Apr 25, 2009 3:56 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-jhBdGNn058HNHEAY" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11281" title="Go to message">GruberK</a>
							</em>
					</span>
					<p id="comment-body-11282">
					Your stated configurations and your expectations slightly 
contradict each other? Are you trying to perform the backup while the 
VM(s) are running? If so, the VM(s) should not be shutting down, unless 
there is some other issue with the VM(s) or host. If you're trying to 
backup the VM(s) and have them power down prior to backup, then you'll 
need to enable the appropriate flags. If you enable both flags to be 1 
and you do not have VMware Tools installed on the guest, then the host 
will hard power off the VM after a certain duration. <br>
<br>
Please clearly describe your scenario and setup. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11306"></a>
				<div id="comment-11306" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 25, 2009 5:38 PM
						</span>
							<!--<a href="/people/GruberK" title="Click to view GruberK's profile">
<img class="jive-avatar" src="/people/GruberK/avatar/16.png?a=-1" height="16" width="16" title="Click to view GruberK's profile" alt="Click to view GruberK's profile" />
</a>--><a href="http://communities.vmware.com/people/GruberK" 
id="jive-75V48HRKhB7YpOBf" class="jive-username-link" title="Click to 
view GruberK's profile">GruberK</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11282" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11306">
					Thanks for your quick answer, the 2 machines where the problem with
 the hard shutdown occurs have the current VMWare Tools installed, the 
two machines are also Powered On and running before starting the backu 
script.
					</p>
				</div>
				<a name="comments-11293"></a>
				<div id="comment-11293" class="jive-content-comment ">
					<span>
						<span>
							Apr 28, 2009 8:45 PM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-bM23xN341EDJooKz" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11293">
					hi:<br>
   thanks for your great script!<br>
</p><p>
   i use ghettoVCB.sh under ESX 3.5i u4 with live snapshot(no shutdown 
before snapshot).<br>
   i wonder if it is a quiesced snapshot? i can not find information 
about the command "svmvc/snapshot.create".<br>
   i hope MS-SQL server with vmwaretools would be happy with the 
snapshot.<br>
   can you give me some advice?<br>
   thanks for your help!!<br>
<br>
Regards,<br>
sky_li
					</p>
				</div>
				<a name="comments-11297"></a>
				<div id="comment-11297" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 30, 2009 8:49 AM
						</span>
							<!--<a href="/people/gbras" title="Click to view gbras's profile">
<img class="jive-avatar" src="/people/gbras/avatar/16.png?a=-1" height="16" width="16" title="Click to view gbras's profile" alt="Click to view gbras's profile" />
</a>--><a href="http://communities.vmware.com/people/gbras" 
id="jive-4wiOmPXwVPnsgCb3" class="jive-username-link" title="Click to 
view gbras's profile">gbras</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11297">
					Hi,<br>
I'm confused about the versions of this script. The version I downloaded
 today from the link in the "attachments" section of this page (or from 
"http://engineering.ucsb.edu/~duonglt/vmware/") is 11/01/2008:<br>
#!/bin/bash<br>
</p><ol>
<li>Author: william2003<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=at">at</a>gmail<a
 class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=dot">dot</a>com</li>
<li>Date: 11/01/2008</li>
</ol>
<br>
the "CHANGELOG" section lists a version of the script (11/22/2008) that 
detects existing snapshots and RDMs: where can download it?<br>
<br>
Thanks<br>
Guido
					
				</div>
				<a name="comments-11320"></a>
				<div id="comment-11320" class="jive-content-comment ">
					<span>
						<span>
							Apr 30, 2009 10:21 PM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-w9xwcI07X5JAYN5i" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11297" title="Go to message">gbras</a>
							</em>
					</span>
					<p id="comment-body-11320">
					hi:<br>
   the author didn't modify the change log. but they are the latest 
version and can detect existing snapshot. i have tried that.<br>
<br>
   the attachment and the script at author's website is different files.
 but after filtering all the white spaces, they are the same.
					</p>
				</div>
				<a name="comments-11298"></a>
				<div id="comment-11298" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 1, 2009 7:20 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ljW1Nz1mb3RYEt9z" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11293" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-11298">
					Hi sky_li,<br>
<br>
If you're running hight transactional databases, it's generally not 
recommended to use snapshots for backups due to transactions occurring 
within a DB. There is something called VSS which is available within 
VMware Tools that makes the guest aware that a snapshot is going to 
occur and it forces all data to be flushed from memory to disk, I've not
 used this personally and I believe it may only be available when VMware
 VCB is called, Duncan has an article at <a class="jive-link-external" 
href="http://www.yellow-bricks.com/2008/07/26/vss-snapshots/">http://www.yellow-bricks.com/2008/07/26/vss-snapshots/</a>
  <br>
<br>
I would probably stay away from taking VMware snapshots and rely on 
database snapshots. <br>
<br>
In terms of <b>vimsh</b> wrapper for creating snapshots, you won't find 
much information on any of the commands as these are not officially 
supported by VMware even though it provides a slew of advanced 
functionality.<br>
<br>
You can always run the following for some basic info:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya scripts]# vmware-vim-cmd vmsvc/snapshot.create
Insufficient arguments.
Usage: snapshot.create vmid [snapshotName] [snapshotDescription] [includeMemory]

Creates a snapshot for the vm.

</code></pre><br>
<br>
Where the <b>includeMemory</b> accepts a boolean<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11321"></a>
				<div id="comment-11321" class="jive-content-comment ">
					<span>
						<span>
							May 1, 2009 7:45 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-68ljTpDrr75PRyr7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11297" title="Go to message">gbras</a>
							</em>
					</span>
					<p id="comment-body-11321">
					Hi Guido,<br>
<br>
As <b>tbsky</b> stated, the latest script is currently available for 
download on this page. The date within the script may be a little 
miss-leading, it's actually the date that I started develoment of the 
script. The chanelog on the other hand is accurate in terms of the 
changes that have taken place since the release of the script and again 
the latest download will <u>always</u> be available on the VMTN document
 download page. <br>
<br>
I'll ensure that both the script on the VMTN and on our website is the 
same, sorry for any confusion<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11299"></a>
				<div id="comment-11299" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 1, 2009 7:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-bsW3FBCtOVzcfMIh" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11297" title="Go to message">gbras</a>
							</em>
					</span>
					<p id="comment-body-11299">
					Hi Guido,<br>
<br>
As <b>tbsky</b> stated, the latest script is currently available for 
download on this page. The date within the script may be a little 
miss-leading, it's actually the date that I started develoment of the 
script. The chanelog on the other hand is accurate in terms of the 
changes that have taken place since the release of the script and again 
the latest download will <u>always</u> be available on the VMTN document
 download page. <br>
<br>
I'll ensure that both the script on the VMTN and on our website is the 
same, sorry for any confusion<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11300"></a>
				<div id="comment-11300" class="jive-content-comment ">
					<span>
						<span>
							May 2, 2009 5:20 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-Se2AVVe3KM3ygRWx" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11300">
					hello lamw<br>
<br>
I ve got a server to backup which has only space for one backup at a 
time. Now your<br>
script does first the backup and then rotates/deletes the old backups. 
This means, in<br>
some time during the backup there are to backups on the disc...<br>
<br>
Would it be possible to just move the "rotate"-function to the beginning
 of your script<br>
and do the backup after rotating/deleting the old backups? Or can you 
see any problems?<br>
<br>
Thank you,<br>
<br>
ibhp
					</p>
				</div>
				<a name="comments-11312"></a>
				<div id="comment-11312" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 2, 2009 6:24 AM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-61pmuMT0owdhxmgf" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11298" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11312">
					hi lamw:<br>
<br>
   i am just curios. "quiesced windows snapshot" seems become complete 
at 3.5 update 2 with sync+vss driver. but the link you give me tell us 
stay away from exchange,ad,sql. then i don't know what this "quiesce" 
function for.<br>
<br>
   also there seems some version of snapshot command line have "quiesce"
 option, like the link mentioned: <br>
    <a class="jive-link-external" 
href="http://www.esxguide.com/esx/index.php?option=com_mambowiki&amp;page=createsnapshot&amp;page_heading=&amp;show_pageheading=&amp;allowanonymoususers=">http://www.esxguide.com/esx/index.php?option=com_mambowiki&amp;page=createsnapshot&amp;page_heading=&amp;show_pageheading=&amp;allowanonymoususers=</a><br>
<br>
    but it seems the new command line version didn't have the "quiesce" 
parameter, only "memory" option is left. i wonder if  the snapshot is 
quiesced automatically now, or the option is because "quiesced" may 
bring problems.<br>
<br>
    someone said that if you do a "quiesced snapshot", ms-sql log will 
tell you.i haven't any real ms-sql server running in the vm now. maybe i
 can check that in the future.
					</p>
				</div>
				<a name="comments-11313"></a>
				<div id="comment-11313" class="jive-content-comment ">
					<span>
						<span>
							May 2, 2009 4:29 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-C7E7X8T97AQ0q752" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11300" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-11313">
					The reason I put the rotate function after the backup is to ensure 
we have a good backup prior to rotation, especially in the case of just 
rotating once. I would say please ensure that you have sufficient space 
for <u>all</u> backups<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11314"></a>
				<div id="comment-11314" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 2, 2009 4:34 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-UB5up16OaBm4LFq3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11312" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-11314">
					Yea I'm not too familiar with the expected behavior of VSS other 
than asking the VM to flush its data from memory to disk. I just know 
from reading on the VMTN forums from other experts it's not recommended 
to using VMware snapshots on VM(s) like databases and if you do, you'll 
need to look into VSS which is only available per VMware VCB (I think). 
You may need to run a few tests to see the behavior and I would actually
 recommend posting a question regarding this on the main VMTN forum and 
I'm sure an expert familiar with the process can provide further 
insight. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11353"></a>
				<div id="comment-11353" class="jive-content-comment ">
					<span>
						<span>
							May 11, 2009 1:51 AM
						</span>
							<!--<a href="/people/pietcur" title="Click to view pietcur's profile">
<img class="jive-avatar" src="/people/pietcur/avatar/16.png?a=-1" height="16" width="16" title="Click to view pietcur's profile" alt="Click to view pietcur's profile" />
</a>--><a href="http://communities.vmware.com/people/pietcur" 
id="jive-pp42L2f8D391wcTv" class="jive-username-link" title="Click to 
view pietcur's profile">pietcur</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11353">
					Hi lamw,<br>
<br>
First of all, thx for this great script! I have a question though and 
hope that the following might also be possible with your script: can you
 specify a vmdk within a vm that you want to backup? I would like to 
backup only one vmdk of a vm that is on the same datastore. So basically
 I want to exclude all the other vmdk's that are attached to this vm and
 stored on a different datastore. Is this possible?<br>
<br>
Thank you,<br>
<br>
Pietcur
					</p>
				</div>
				<a name="comments-11337"></a>
				<div id="comment-11337" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 11, 2009 8:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-aJ5751MMmSigPPLE" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11353" title="Go to message">pietcur</a>
							</em>
					</span>
					<p id="comment-body-11337">
					Specific VMDK disk(s) backups are not supported, only full backups.
 You're more than welcome to modify the script to fit your needs. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11410"></a>
				<div id="comment-11410" class="jive-content-comment ">
					<span>
						<span>
							May 12, 2009 6:34 PM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-vdp3maB2PeVXwiv5" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11337" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11410">
					hi:<br>
   i am considering put all the windows pagefile and linux swap file to a
 separate vmdk file. so i can skip backing up them in the future. would 
you consider implement this feature?  or would you consider receive 
patch? <br>
<br>
   thanks for your help!!
					</p>
				</div>
				<a name="comments-11381"></a>
				<div id="comment-11381" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 13, 2009 2:22 PM
						</span>
							<!--<a href="/people/mhanby" title="Click to view mhanby's profile">
<img class="jive-avatar" src="/people/mhanby/avatar/16.png?a=-1" height="16" width="16" title="Click to view mhanby's profile" alt="Click to view mhanby's profile" />
</a>--><a href="http://communities.vmware.com/people/mhanby" 
id="jive-JzllTBaqsL6y8kol" class="jive-username-link" title="Click to 
view mhanby's profile">mhanby</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11381">
					Thanks for the script.<br>
<br>
Shouldn't the script bypass the creation of a snapshot if the guest is 
in a powered down state? Seems like extra work to take a snapshot and 
then merge the snapshot back into the base when the machine is already 
static.<br>
<br>
Also, I got the following error while backing up a guest that was 
powered off:<br>
<br>
/vmfs/volumes/datastore1/scripts # ./ghettoVCB.sh single_vm<br>
<br>
 ################ Taking backup snapshot for Windows XP 32bit Base ... 
################<br>
DiskLib_Check() failed for source disk Insufficient permission to access
 file (38).<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/Development/Windows XP 32bit 
Base/winxp-32bit-base.vmdk'...<br>
Clone: 16% done.<br>
<br>
The clone appears to have worked, however out of all the guests that I 
backed up, that was the only one that echoed the DiskLib_Check() 
message.
					</p>
				</div>
				<a name="comments-11382"></a>
				<div id="comment-11382" class="jive-content-comment ">
					<span>
						<span>
							May 13, 2009 2:31 PM
						</span>
							<!--<a href="/people/mhanby" title="Click to view mhanby's profile">
<img class="jive-avatar" src="/people/mhanby/avatar/16.png?a=-1" height="16" width="16" title="Click to view mhanby's profile" alt="Click to view mhanby's profile" />
</a>--><a href="http://communities.vmware.com/people/mhanby" 
id="jive-dcFw8B0t1jSYHu3H" class="jive-username-link" title="Click to 
view mhanby's profile">mhanby</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11381" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-11382">
					I notice that the script also doesn't appear to take into 
consideration whether or not a vmdk is thinly provisioned. (as 
previously mentioned by ddigioia)<br>
<br>
I could alter the command:<br>
vmkfstools -i "${SOURCE_VMDK}" "${DESTIONATION_VMDK}"<br>
to<br>
vmkfstools -i "${SOURCE_VMDK}" -d thin "${DESTIONATION_VMDK}"<br>
<br>
But:<br>
 a) is there a way for the script to identify if a vmdk is thin, and if 
so add '-d thin'<br>
 b) is there any danger in storing thin clones? maybe why the script 
doesn't already do the previous
					</p>
				</div>
				<a name="comments-11396"></a>
				<div id="comment-11396" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 13, 2009 3:36 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Y6sx2cN3HVDG39Cy" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11381" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-11396">
					You know I think this was something I had missed when dealing with 
the option of allowing a user to configure the shutdown of a guest, I 
think I might have forgotten to take into consideration the current 
state of the VM. You're right, this may be a bug. Majority of the user's
 I've spoke to that have used the script are running live backups and 
would not run into the issue, but it's a good point and I'll ensure the 
next update of the script is fixed.  <br>
<br>
Thanks for bringing it to my attention<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11412"></a>
				<div id="comment-11412" class="jive-content-comment ">
					<span>
						<span>
							May 13, 2009 3:45 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9h33P7s51Ri1iHlD" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11382" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-11412">
					At the time, we were not looking at using thin provision backups, 
it does not hurt and provides optimized storage consumption (hence 
probably why vSphere officially supports it now)<br>
<br>
Your modifications will work and thinly provision disks upon backup, 
also a note when you're backing up to NFS datastore, it'll automatically
 thin provision the disk for you AFAIK<br>
<br>
a) You can look at the descriptor file and you'll find a line that says:
 ddb.thinProvisioned = "1"<br>
b) In terms of backup, there is are no dangers, better storage 
utilization. In terms of running thin provision VM(s), you just need to 
be aware of your storage utilization and with ESX 3.5, there are not 
sufficient monitoring on the datastores to notify you as VM(s) start to 
fill up, with vSphere there are better notifications/reports. <br>
<br>
In an upcoming release of the script all 3 backup types will be 
supported zeroedthick, thin and 2gb sparse<br>
<br>
Thanks for the comments<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11397"></a>
				<div id="comment-11397" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 14, 2009 6:14 PM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-P6VL8kkH3ywC2T0h" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11412" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11397">
					hi:<br>
   please consider add "monolithic sparse" also. with that you get a 
small,single vmdk file. <br>
   backup tools like rdiff-backup can compare two versions for a file 
and only backup the difference.<br>
   with "monolithic sparse" single vmdk file, backup tools can easily 
backup many versions of vms with little harddisk space.
					</p>
				</div>
				<a name="comments-11399"></a>
				<div id="comment-11399" class="jive-content-comment ">
					<span>
						<span>
							May 18, 2009 12:16 PM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-Kbu8XkpykN2yo1XC" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11399">
					Hello community<br>
<br>
I have a win2k3 server running on a ESXi-host with 2 virtual harddrives 
attached. Now one time the backup runs correct (backing up both virtual 
harddrives) and the other time it backs-up only the first virtual 
harddrive (every second time only one virtual hdd is backed-up). This 
looks like this:<br>
<br>
Failure:<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/First_750GB_HD/Win2K3 TS/Win2K3 
TS_1.vmdk'...<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/First_750GB_HD/Win2K3 TS/Win2K3 TS.vmdk'...<br>
Clone: 100% done.<br>
*******************************<br>
<br>
Success:<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/First_750GB_HD/Win2K3 TS/Win2K3 
TS_1.vmdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/First_750GB_HD/Win2K3 TS/Win2K3 TS.vmdk'...<br>
Clone: 100% done.<br>
*******************************<br>
<br>
Any idea what this could be caused from?<br>
Thanks for any help!
					</p>
				</div>
				<a name="comments-11418"></a>
				<div id="comment-11418" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 21, 2009 7:25 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8pr4ab43zxkHNei2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-11418">
					Hi everyone,<br>
<br>
We're proud to announce the release of <b>ghettoVCBg2</b> the next gen 
of ghettoVCB. You can find more information located at: <a 
class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9843">http://communities.vmware.com/docs/DOC-9843</a><br>
<br>
Hope you guys like it!<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11407"></a>
				<div id="comment-11407" class="jive-content-comment ">
					<span>
						<span>
							May 26, 2009 5:48 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-MDFd2Km5U49wez8u" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11418" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11407">
					I've just upgraded my ESXi from 3.5 to 4.0 and the old ghetto 
script doesn't work.<br>
Infact if I connect with putty and launch the script:<br>
<br>
./ghettoVCB.sh weekly<br>
I receive<br>
-ash: ./ghettoVCB.sh: not found<br>
<br>
I can't use the new script ghetto2 because I have the free version of 
ESXi<br>
Can someone help me?
					</p>
				</div>
				<a name="comments-11421"></a>
				<div id="comment-11421" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 26, 2009 10:44 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-tMIc8beBJuiJj2hK" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11407" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11421">
					ghettoVCB has not been tested/certified for ESX(i) 4.0, we've been 
pretty busy and just have not had the time to test. This holds true for 
variety of other scripts and some will fail due to changes in vSphere 
release. In general, I think the script should work and it does not 
utilize anything that is not already available in ESXi 4.0, make sure 
the permissions on your script is set to executable. I'll try to do a 
quick run tonight and post back.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11426"></a>
				<div id="comment-11426" class="jive-content-comment ">
					<span>
						<span>
							May 26, 2009 10:56 AM
						</span>
							<!--<a href="/people/mhanby" title="Click to view mhanby's profile">
<img class="jive-avatar" src="/people/mhanby/avatar/16.png?a=-1" height="16" width="16" title="Click to view mhanby's profile" alt="Click to view mhanby's profile" />
</a>--><a href="http://communities.vmware.com/people/mhanby" 
id="jive-nMf6NSUISfAmEuTK" class="jive-username-link" title="Click to 
view mhanby's profile">mhanby</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11407" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11426">
					The error is telling you that ghettoVCB.sh doesn't exist in your 
current directory.<br>
<br>
Was your ghettoVCB.sh script on a datastore or on one of the OS file 
systems? If it wasn't on a datastore, the version 4 upgrade probably 
wiped it.<br>
<br>
Copy it back to a datastore and execute it from there and see if it will
 work with v4.
					</p>
				</div>
				<a name="comments-11409"></a>
				<div id="comment-11409" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 26, 2009 11:15 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-iAcLXk5R5SfDebmp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11407" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11409">
					Okay, just got ESXi 4.0 installed as a VM on our ESX 4 (physical) 
and I see the problem, looks like there was some change to their shell 
environment and if you didn't know the busybox console runs on <b>ash</b>
 ... kinda like <b>bash</b>. It looks like it has a problem when you try
 to do the following:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">./ghettoVCB.sh

-ash: ./ghettoVCB.sh: not found
</code></pre><br>
<br>
clearly, I can see the script is in the current directory. <br>
<br>
The workaround is the following:<br>
<br>
1) Edit the script and change the top line to:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">#!/bin/ash
</code></pre><br>
<br>
OR<br>
<br>
2) execute with the <b>ash</b> interpreter:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">ash ./ghettoVCB.sh
</code></pre><br>
<br>
Give this a go and it should work, in terms of the actual backup ... I 
have not verified, so let me know if this works. In the coming weeks, 
will be verifying some of older scripts and release updates for ESX(i) 
4.0 if necessary. <br>
<p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11424"></a>
				<div id="comment-11424" class="jive-content-comment ">
					<span>
						<span>
							May 26, 2009 11:56 PM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-8WpTw3Phd4uu8P14" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11409" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11424">
					Ok now I can launch the script but I have these errors:<br>
<br>
/vmfs/volumes/48c6a14e-37156b78-c647-001a925eca7c # ash ./ghettoVCB.sh 
weekly<br>
Error: failed to extract VM_ID for 2008Termi!<br>
Error: failed to extract VM_ID for al<br>
Assiste!<br>
Error: failed to extract VM_ID for zaVista2!<br>
<br>
Start time: Wed May 27 06:51:45 UTC 2009<br>
End   time: Wed May 27 06:51:48 UTC 2009<br>
Duration  : 3 Seconds<br>
<br>
Completed backing up specified Virtual Machines!
					</p>
				</div>
				<a name="comments-11440"></a>
				<div id="comment-11440" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 27, 2009 12:06 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ljpw12yDBbBpbYTm" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11424" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11440">
					I ran a quick test earlier and realized some of the code may need 
to be updated. I have not had a chance to dig further on what needs to 
be modified. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11431"></a>
				<div id="comment-11431" class="jive-content-comment ">
					<span>
						<span>
							May 29, 2009 2:24 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1VYBXVX1WCJSOQsQ" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11424" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11431">
					Have you had a chance to try out <b>ghettoVCB4i.sh</b> to see if 
the issues are resolved?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11457"></a>
				<div id="comment-11457" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 30, 2009 5:20 AM
						</span>
							<!--<a href="/people/atrussokc" title="Click to view atrussokc's profile">
<img class="jive-avatar" src="/people/atrussokc/avatar/16.png?a=-1" height="16" width="16" title="Click to view atrussokc's profile" alt="Click to view atrussokc's profile" />
</a>--><a href="http://communities.vmware.com/people/atrussokc" 
id="jive-15qt0s5PWTyn2CNj" class="jive-username-link" title="Click to 
view atrussokc's profile">atrussokc</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11457">
					Thanks for the great script.  I finally have an option for backing 
up my ESXi (free) 4 VMs.  I downloaded ghettoVCB4i.sh and attempted to 
use it but encountered a problem where all of my VMs with the letter 'n'
 in the name where causing an error.  This is similar to the issue 
described by freez267 above.  I don't fully understand why but 
commenting out the line<br>
<br>
IFS=$'\n'<br>
<br>
appeared to resolve the issue for me.  I am not sure what this line 
does.<br>
<br>
Thanks<br>
Tony Russell
					</p>
				</div>
				<a name="comments-11471"></a>
				<div id="comment-11471" class="jive-content-comment ">
					<span>
						<span>
							May 30, 2009 1:44 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-hxDIbh2L3bRRn0K0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11457" title="Go to message">atrussokc</a>
							</em>
					</span>
					<p id="comment-body-11471">
					That's odd... it should work, I've verified on our ESXi 4 system. <br>
<br>
</p><div class="jive-quote">
IFS=$'\n'<br>
</div> <br>
<br>
Is called the Internal Field Separator: <br>
<a class="jive-link-external" 
href="http://en.wikipedia.org/wiki/Internal_Field_Separator">http://en.wikipedia.org/wiki/Internal_Field_Separator</a><br>
<a class="jive-link-external" 
href="http://learnlinux.tsf.org.za/courses/build/shell-scripting/ch11s11.html">http://learnlinux.tsf.org.za/courses/build/shell-scripting/ch11s11.html</a><br>
<br>
Basically when I loop through the list of VM(s) after some sanity checks
 and extracting out the VmId which is used in the <b>vimsh</b> to 
uniquely identify a VM, I'm also extracting the VM(s) displayName. When 
user's use white space in their VM names, by default the IFS is looking 
for a 'space' as a delimiter to denote the next line of data so a 
workaround is to redefine the IFS to look for a newline that way you can
 capture the line of text with spaces. In either cases it will not hurt 
if you don't have spaces in your VM name, but it'll only help if you do.
 <br>
<br>
Again, I'm not exactly sure why you're having an issue since '\n' is 
representing a newline and not the 'n' char.<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11472"></a>
				<div id="comment-11472" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 31, 2009 1:28 PM
						</span>
							<!--<a href="/people/paulkc" title="Click to view paulkc's profile">
<img class="jive-avatar" src="/people/paulkc/avatar/16.png?a=-1" height="16" width="16" title="Click to view paulkc's profile" alt="Click to view paulkc's profile" />
</a>--><a href="http://communities.vmware.com/people/paulkc" 
id="jive-FOcaYO332YA42RQC" class="jive-username-link" title="Click to 
view paulkc's profile">paulkc</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11472">
					I am running this on ESXi 4.  I have tried to follow the directions
 very closely but I keep getting a Permission Denied error every time I 
try to actually run the script.  Any suggestions?
					</p>
				</div>
				<a name="comments-11458"></a>
				<div id="comment-11458" class="jive-content-comment ">
					<span>
						<span>
							May 31, 2009 1:37 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-AkWKtXPM1pMbobT1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11472" title="Go to message">paulkc</a>
							</em>
					</span>
					<p id="comment-body-11458">
					Did you change the permissions on the script to have executable 
permissions? <br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">chmod +x ghettoVCB4i.sh
</code></pre><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11433"></a>
				<div id="comment-11433" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 1, 2009 12:23 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-kYQaNu2SKRp6546y" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11472" title="Go to message">paulkc</a>
							</em>
					</span>
					<p id="comment-body-11433">
					I continue to have this error<br>
<br>
Error: failed to extract VM_ID<br>
<br>
On the VMs that have 'n' in the name. For example is impossible to 
backup the VM '2008Terminal' and 'AssistenzaXp' but no problem with 
'W7RC'
					</p>
				</div>
				<a name="comments-11434"></a>
				<div id="comment-11434" class="jive-content-comment ">
					<span>
						<span>
							Jun 1, 2009 9:10 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-2aP1KeV89K4Eb411" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11433" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11434">
					I just created some dummy VM(s) using the names you've specified 
and it looks like the environment is not treating $'\n' as a newline 
char but the literal char 'n'. This cause the loop to break off once it 
sees the first char 'n' and a VM with the name: "2008Terminal" will be 
chompped into "2008Termin" and "al" which neither of which will match, 
hence it fails. If you specify a list of VM(s) w/o 'n' then the backup 
is successful. This is pretty odd and I'll have to look into it some 
more.<br>
<br>
You said if you remove the IFS=$'\n', everything works?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11473"></a>
				<div id="comment-11473" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 1, 2009 9:16 AM
						</span>
							<!--<a href="/people/paulkc" title="Click to view paulkc's profile">
<img class="jive-avatar" src="/people/paulkc/avatar/16.png?a=-1" height="16" width="16" title="Click to view paulkc's profile" alt="Click to view paulkc's profile" />
</a>--><a href="http://communities.vmware.com/people/paulkc" 
id="jive-q5xr1A2GsIXSOKVf" class="jive-username-link" title="Click to 
view paulkc's profile">paulkc</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11434" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11473">
					That is exactly what happened in my case.  If I commented out that 
line, it worked fine.
					</p>
				</div>
				<a name="comments-11475"></a>
				<div id="comment-11475" class="jive-content-comment ">
					<span>
						<span>
							Jun 1, 2009 9:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-mROn0I7910J04mzY" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11473" title="Go to message">paulkc</a>
							</em>
					</span>
					<p id="comment-body-11475">
					Looks like the newline needs to be defined in the following manner:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">IFS='
'
</code></pre><br>
<br>
notice where the single tick starts and ends which is on the following 
line. If you make this modification, it will backup all 3 VM(s) properly
 .... I'll push an update out tonight, it looks like the new Busybox ash
 environment may have been slightly changed and does not recognize $'\n'
 as a newline. The real reason for redefining the IFS is for VM(s) names
 that may contain spaces, which I consider a bad practice...but if you 
know your naming convention will never have spaces,tabs,etc...then you 
should be fine. <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11464"></a>
				<div id="comment-11464" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 7, 2009 9:44 AM
						</span>
							<!--<a href="/people/carlotto" title="Click to view carlotto's profile">
<img class="jive-avatar" src="/people/carlotto/avatar/16.png?a=-1" height="16" width="16" title="Click to view carlotto's profile" alt="Click to view carlotto's profile" />
</a>--><a href="http://communities.vmware.com/people/carlotto" 
id="jive-HRs7YzGSpxtQN71H" class="jive-username-link" title="Click to 
view carlotto's profile">carlotto</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11464">
					Hi,<br>
Thanks for a fantastic script. Works well, but I have a problem with the
 rotation. Anyone with a clue why it won't work? See output from a sh -x
 command (last bit):<br>
<br>
Cloning disk '/vmfs/volumes/HB-ESXi2-scsi1/HB-Label/HB-Label.vmdk'...<br>
Clone: 100% done.<br>
+ IFS=<br>
<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%21+0+-eq+1+">
 ! 0 -eq 1 </a><br>
+ /bin/vim-cmd vmsvc/snapshot.remove 256<br>
+ echo Removing snapshot from HB-Label ...<br>
+ ls /vmfs/volumes/HB-ESXi2-scsi1/HB-Label<br>
+ grep -q delta<br>
+ sleep 3<br>
+ ls /vmfs/volumes/HB-ESXi2-scsi1/HB-Label<br>
+ grep -q delta<br>
+ sleep 3<br>
+ ls /vmfs/volumes/HB-ESXi2-scsi1/HB-Label<br>
+ grep -q delta<br>
+ checkVMBackupRotation /vmfs/volumes/Thecus/Backup/HB-Label 
/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-06-07<br>
+ local BACKUP_DIR_PATH=/vmfs/volumes/Thecus/Backup/HB-Label<br>
+ local 
BACKUP_VM_NAMING_CONVENTION=/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-06-07<br>
+ ls -tr /vmfs/volumes/Thecus/Backup/HB-Label<br>
+ LIST_BACKUPS=HB-Label-2009-05-31<br>
HB-Label-2009-06-05<br>
HB-Label-2009-06-07<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+-z+4+">
 -z 4 </a><br>
+ TMP_DIR=/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31<br>
+ echo /vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31<br>
+ TMP=/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31<br>
+ <strike> /vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31 = 
/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-06-07 </strike><br>
+ <strike> /vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31 -ge 4
 </strike><br>
sh: /vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31: bad number<br>
+ echo /vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31<br>
+ BASE=/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31<br>
/vmfs/volumes/Thecus/Script/HB-Label/ghettoVCB.sh: 
/vmfs/volumes/Thecus/Script/HB-Label/ghettoVCB.sh: 340: Syntax error: 
/vmfs/volumes/Thecus/Backup/HB-Label/HB-Label-2009-05-31+1<br>
/vmfs/volumes/46df116f-b561be9a/Log #<br>
</p><p>
I have a few different VM's with different rotation counts (I keep 
several copies of the script). At least one does not delete when more 
than the rotation count, I suspect the problem above. Any clue anyone? 
Why syntax error etc?
					</p>
				</div>
				<a name="comments-11466"></a>
				<div id="comment-11466" class="jive-content-comment ">
					<span>
						<span>
							Jun 8, 2009 2:20 PM
						</span>
							<!--<a href="/people/Ritchy059" title="Click to view Ritchy059's profile">
<img class="jive-avatar" src="/people/Ritchy059/avatar/16.png?a=-1" height="16" width="16" title="Click to view Ritchy059's profile" alt="Click to view Ritchy059's profile" />
</a>--><a href="http://communities.vmware.com/people/Ritchy059" 
id="jive-LfKuxawAR3Q3q84m" class="jive-username-link" title="Click to 
view Ritchy059's profile">Ritchy059</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11464" title="Go to message">carlotto</a>
							</em>
					</span>
					<p id="comment-body-11466">
					I had a similiar Problem here an a ESX Server 3.5:<br>
<br>
At first: Script works well from the Root-Shell...<br>
<br>
But, when i Plan the Script via Crontab, the Script starts, make's the 
Snapshot, Backup the *.vmdk and *.vmx File in a newly created Folder BUT
 at the End of the Backup the Script don't rename the Folder in correct 
manner.<br>
<br>
Script stopped working. I have to rename the Folders manually in correct
 Name und Numbers and have to remove the Snapshot manually from ESX 
Server's VI Client.<br>
<br>
The Script only Backups the First VM in the Backup List and after Backup
 stopped working !<br>
<br>
mfg<br>
Ritchy059
					</p>
				</div>
				<a name="comments-11545"></a>
				<div id="comment-11545" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 15, 2009 3:02 AM
						</span>
							<!--<a href="/people/adiXSG" title="Click to view adiXSG's profile">
<img class="jive-avatar" src="/people/adiXSG/avatar/16.png?a=-1" height="16" width="16" title="Click to view adiXSG's profile" alt="Click to view adiXSG's profile" />
</a>--><a href="http://communities.vmware.com/people/adiXSG" 
id="jive-BueC3T4KUOz3wxDf" class="jive-username-link" title="Click to 
view adiXSG's profile">adiXSG</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11466" title="Go to message">Ritchy059</a>
							</em>
					</span>
					<p id="comment-body-11545">
					I've running an ESXi 4.0 Server.<br>
The backup does function well. But there is one problem wich is descibed
 by other persons above. It is the empty log file. Is there a solution 
for it or not? At the moment I see through all folders if the backup 
success. But that can't be the final solution.<br>
Further the current version of ghettoVCB4i.sh runs great if there are no
 whitespaces in the vm name. Otherwise the rename after backup fails and
 because of that the backup rotation fails too. So I've removed all 
whitespaces in VM names like lamw describes as best practice <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
Thanks lamw for his great work... really really usefull script!!
					</p>
				</div>
				<a name="comments-11537"></a>
				<div id="comment-11537" class="jive-content-comment ">
					<span>
						<span>
							Jun 18, 2009 5:40 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-GmJ5H0PNs7SC0Y31" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11537">
					For those interested in logging, maybe this helps you:<br>
<br>
Run the script like this<br>
<br>
    sh ghettoVCB.sh vmlist.txt 2&gt;&amp;1 | busybox logger -t ghettoVCB
 -p 1<br>
<br>
and then, push ESXi logs to a remote syslog-ng server.
					</p>
				</div>
				<a name="comments-11641"></a>
				<div id="comment-11641" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 27, 2009 6:17 PM
						</span>
							<!--<a href="/people/relegated" title="Click to view relegated's profile">
<img class="jive-avatar" src="/people/relegated/avatar/16.png?a=-1" height="16" width="16" title="Click to view relegated's profile" alt="Click to view relegated's profile" />
</a>--><a href="http://communities.vmware.com/people/relegated" 
id="jive-DilonBV8Wf4Y0HAP" class="jive-username-link" title="Click to 
view relegated's profile">relegated</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11537" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-11641">
					Does this backup method copy the vmdk to the same vmfs volume and 
to get it offsite you would have to download the backup vmdk file from 
the datastore?
					</p>
				</div>
				<a name="comments-11656"></a>
				<div id="comment-11656" class="jive-content-comment ">
					<span>
						<span>
							Jun 28, 2009 10:50 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-5V8ksYFjkQ3LH7U1" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11641" title="Go to message">relegated</a>
							</em>
					</span>
					<p id="comment-body-11656">
					You could just mount a NFS volume and select that as the 
destination for the backup.  That's what we do.  Works great.
					</p>
				</div>
				<a name="comments-11657"></a>
				<div id="comment-11657" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 28, 2009 10:54 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-2o5X0Vfw40Vu5g9U" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11431" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11657">
					Quick question...  I am running ghettoVCB.sh on ESXi 3.5 and its 
working great on most of my VMs.  However I have a VM that seems to have
 a snapshot associated with it.  I checked in the datastore, and there 
was a 'delta' file there.  I powered down the VM and then deleted the 
delta file.  Powered it back on, and then attempted to run ghettoVCB.sh.
  It again wouldn't do the backup because it said that there was a 
snapshot there.  I checked it again, and the delta file had returned... 
 <br>
<br>
I know this isn't a specific question of ghettoVCB, but how do I get rid
 of these snapshots so I can do a clean backup of a live VM?
					</p>
				</div>
				<a name="comments-11642"></a>
				<div id="comment-11642" class="jive-content-comment ">
					<span>
						<span>
							Jun 28, 2009 11:42 PM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-93Dkbz70m5Czdm1i" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11657" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-11642">
					You shouldn't delete deltas by hand. Instead, remove snapshots from
 VIC.<br>
Deltas track changes to the main vmdk, but information about snapshots 
are kept in vmsd files.
					</p>
				</div>
				<a name="comments-11643"></a>
				<div id="comment-11643" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 29, 2009 12:38 PM
						</span>
							<!--<a href="/people/relegated" title="Click to view relegated's profile">
<img class="jive-avatar" src="/people/relegated/avatar/16.png?a=-1" height="16" width="16" title="Click to view relegated's profile" alt="Click to view relegated's profile" />
</a>--><a href="http://communities.vmware.com/people/relegated" 
id="jive-KSNyLLAB7LyrjMwA" class="jive-username-link" title="Click to 
view relegated's profile">relegated</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11642" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-11643">
					Unfortunately I only have my one ESXi box at home with 1 HDD in it 
and my desktop so I have no NFS volume to mount <img 
class="jive-emoticon" src="DOC-8760_files/sad.gif" alt=":(" border="0"><br>
<br>
So for me, does that mean that this script just backs up the running 
vmdk and I would need to manually download it?<br>
<br>
If that is the case the primary function of the script would be to 
reduce downtime as otherwise I would need to power down the VM and copy 
the vmdk correct?
					</p>
				</div>
				<a name="comments-11644"></a>
				<div id="comment-11644" class="jive-content-comment ">
					<span>
						<span>
							Jun 29, 2009 12:43 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-Iejhu5iY2L6UXV4d" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11643" title="Go to message">relegated</a>
							</em>
					</span>
					<p id="comment-body-11644">
					</p><div class="jive-quote">So for me, does that mean that this 
script just backs up the running vmdk and I would need to manually 
download it?</div>
<br>
What it basically does is a clone of the VM.  The location of the cloned
 VM is up to you, and set in the script preferences.  If you have NFS 
storage mounted and available to ESXi, then you can elect to use that as
 the storage location.  Otherwise you'd have to store it in a local 
datastore somewhere.  Once its done, then you can download it to offline
 storage using SCP or some other form of transport that you can support 
with ESXi.<br>
<br>
<div class="jive-quote">If that is the case the primary function of the 
script would be to reduce downtime as otherwise I would need to power 
down the VM and copy the vmdk correct?</div>
<br>
You do not need to power down the VM to do the clone.  The script will 
create a snapshot before it starts its processing and remove it when its
 completed it.  You do have the option to power down the VM in the 
script, however, but by default it is turned off.
					
				</div>
				<a name="comments-11645"></a>
				<div id="comment-11645" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 29, 2009 12:46 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-67FE0GGBh6IKkOLp" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11642" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-11645">
					</p><div class="jive-quote">You shouldn't delete deltas by hand. 
Instead, remove snapshots from VIC.</div>
Deltas track changes to the main vmdk, but information about snapshots 
are kept in vmsd files. <br>
<br>
Thanks.  I found a way to remove the snapshots using VM Explorer's free 
edition (<a class="jive-link-external" href="http://www.trilead.com/">http://www.trilead.com</a>).
  Works great.
					
				</div>
				<a name="comments-11663"></a>
				<div id="comment-11663" class="jive-content-comment ">
					<span>
						<span>
							Jul 1, 2009 4:55 AM
						</span>
							<!--<a href="/people/bjoernbergmann" title="Click to view bjoernbergmann's profile">
<img class="jive-avatar" src="/people/bjoernbergmann/avatar/16.png?a=-1" height="16" width="16" title="Click to view bjoernbergmann's profile" alt="Click to view bjoernbergmann's profile" />
</a>--><a href="http://communities.vmware.com/people/bjoernbergmann" 
id="jive-iwUgAQTXMTg21vr9" class="jive-username-link" title="Click to 
view bjoernbergmann's profile">bjoernbergmann</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11663">
					Great script! Thank you so much... We are backing up 4 ESXi 3.5 
servers successfully with about 6VMs each.<br>
<br>
There is only one problem to backup a Debian Linux 60GB virtual 
harddisk. Snapshot seems to be OK. Backing up the disk (one of two) 
failed after some time with the following error message.<br>
<br>
Taking backup snapshot for DEASX401 ... ################<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/datastore1/DEASX401/DEASX401_2.vmdk'...<br>
Clone: 79% done.Failed to clone disk : Insufficient permission to access
 file (38).<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/datastore1/DEASX401/DEASX401.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from DEASX401 ...<br>
Completed backup for DEASX401! ####################<br>
Start time: Wed Jul 1 06:45:27 UTC 2009<br>
End time: Wed Jul 1 09:21:51 UTC 2009<br>
Duration : 156.40 Minutes<br>
Completed backing up specified Virtual Machines!<br>
<br>
Might it be possible that the disk is to big? Is there any timeout?<br>
<br>
Here some more information:<br>
./ghettoVCB.sh is running with root account!<br>
backup disk mouted vie NSF from a Win2003R2 server<br>
share is an external 1GB USB disk<br>
nsf shared folder is windows compressed (can save until 75% of original 
space)<br>
<br>
Regards,<br>
<br>
Bjoern
					</p>
				</div>
				<a name="comments-11741"></a>
				<div id="comment-11741" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 8, 2009 6:46 AM
						</span>
							<!--<a href="/people/spray6969" title="Click to view spray6969's profile">
<img class="jive-avatar" src="/people/spray6969/avatar/16.png?a=-1" height="16" width="16" title="Click to view spray6969's profile" alt="Click to view spray6969's profile" />
</a>--><a href="http://communities.vmware.com/people/spray6969" 
id="jive-B51exXrLYwG8900S" class="jive-username-link" title="Click to 
view spray6969's profile">spray6969</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11475" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11741">
					Hi !<br>
<br>
Very great Job !<br>
<br>
I try to use it under ESXi 4.0 (last release) but I encountered a 
problem. I logged it :<br>
<br>
+ SOURCE_VMDK='/vmfs/volumes/Datastore 1/Fedora 
9_Nagios_Centreon//usr/lib/vmware/isoimages/linux.iso'<br>
+ DESTIONATION_VMDK='/vmfs/volumes/NFS_GED//Fedora 
9_Nagios_Centreon/Fedora 
9_Nagios_Centreon-2009-07-08//usr/lib/vmware/isoimages/linux.iso'<br>
+ ''<br>
+ vmkfstools -i '/vmfs/volumes/Datastore 1/Fedora 
9_Nagios_Centreon//usr/lib/vmware/isoimages/linux.iso' 
'/vmfs/volumes/NFS_GED//Fedora 9_Nagios_Centreon/Fedora 
9_Nagios_Centreon-2009-07-08//usr/lib/vmware/isoimages/linux.iso'<br>
DiskLib_Check() failed for source disk The system cannot find the file 
specified (25).<br>
<br>
Someone could help me ?
					</p>
				</div>
				<a name="comments-11757"></a>
				<div id="comment-11757" class="jive-content-comment ">
					<span>
						<span>
							Jul 10, 2009 6:55 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ltol5d6AURLY7rue" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-11757">
					Sorry for the delay of response but I've been extremely busy over 
the last month and I currently do not have the cycles to look into the 
current issues. I'm aware there are some interesting problems being 
faced that may all be related. I will provide some more details when I 
get a chance to take a look at the issue hopefully in a few weeks after 
my VCP4 exam. Thanks for your patience <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11758"></a>
				<div id="comment-11758" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 13, 2009 5:56 AM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-qx67whQf7E7h2wdr" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11757" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11758">
					Hello lamw,<br>
<br>
I used your script since a long time without problems (great work any 
many thanks), but yesterday we changed to esxi4.0 and I changed to your 
latest ghettovcb4.x version.<br>
Like others I get this error:<br>
+ vmkfstools -i /vmfs/volumes/5fbd225c-3cf7a7b1/xpsp2.iso 
/vmfs/volumes/iscsi2backupdsa1/backups/endiancfg/endiancfg-2009-07-13/5fbd225c-3cf7a7b1/xpsp2.iso/xpsp2.iso<br>
DiskLib_Check() failed for source disk The file specified is not a 
virtual disk (15).<br>
<br>
your script tries to backup the iso file of the cdrom. Why ? I there a 
way to disable it or is it only a bug ?<br>
Also if the cdrom is a phys. cdrom of the host I get this disklib 
errors.<br>
So my workaround now is to remove the complete cdrom from the vm 
hardware. Not nice but working.<br>
The harddiskbackup is still working<br>
<br>
Hope you will find a solution, because I check my backup logs 
automatically for the word failed and error and that<br>
CDrom problem will prevent my autolog check from correct running.
					</p>
				</div>
				<a name="comments-11773"></a>
				<div id="comment-11773" class="jive-content-comment ">
					<span>
						<span>
							Jul 13, 2009 11:44 PM
						</span>
							<!--<a href="/people/jllopezg" title="Click to view jllopezg's profile">
<img class="jive-avatar" src="/people/jllopezg/avatar/16.png?a=-1" height="16" width="16" title="Click to view jllopezg's profile" alt="Click to view jllopezg's profile" />
</a>--><a href="http://communities.vmware.com/people/jllopezg" 
id="jive-4pjOz6seG1N9hMH0" class="jive-username-link" title="Click to 
view jllopezg's profile">jllopezg</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11773">
					Hello everybody,<br>
I am trying to do the backup of a esxi with this script, it is working 
perfecty, but I need to backup the vmÂ´s with rdp too.<br>
I have tried the ghettoVCBg2.pl without success.<br>
Anybody has the code to add to the script to backup the vmÂ´s ignoring 
the rdp?<br>
<br>
Thanks a lot for yor help!<br>
Regards.<br>
Jose
					</p>
				</div>
				<a name="comments-11759"></a>
				<div id="comment-11759" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 14, 2009 12:50 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-T55JQf1w9M0k2RDs" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11758" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-11759">
					Same problems with cdroms and same solution of "shechtl".<br>
I have to delete the cdrom on some VM to complete the backup
					</p>
				</div>
				<a name="comments-11760"></a>
				<div id="comment-11760" class="jive-content-comment ">
					<span>
						<span>
							Jul 14, 2009 8:02 AM
						</span>
							<!--<a href="/people/maweko" title="Click to view maweko's profile">
<img class="jive-avatar" src="/people/maweko/avatar/16.png?a=-1" height="16" width="16" title="Click to view maweko's profile" alt="Click to view maweko's profile" />
</a>--><a href="http://communities.vmware.com/people/maweko" 
id="jive-5AdR510M3KrDSba5" class="jive-username-link" title="Click to 
view maweko's profile">maweko</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11760">
					Hello,<br>
<br>
In terms of the strange path pointing to an ISO file I had the same 
behaviour and after removing all mounted CD on all VM's it was gone.<br>
<br>
My experience about the "DiskLib_Check() failed for source disk" error 
message in a ESXi3.5 environment is that the error is caused when the 
backup loop in the script executes "vmkfstools -i "${SOURCE_VMDK}" 
"${DESTIONATION_VMDK}".<br>
During first cycle in the loop of a new VM the Source_VMDK and 
Destination_VMDK do not point to files, they point to folders and this 
is causing not supported by the vmkfstools. I am not a shell developer 
but this is how it looks to me.<br>
</p><p>
By the way somethign interesting.<br>
On a ESXi4 using the ghettoVCB4i.sh I noticed that a "DiskLib_Check() 
failed for source disk" error is only shown if the VM config file has 
been created as a version 7. All VM's version 4 can be backed up without
 the error to pop up.
					</p>
				</div>
				<a name="comments-11775"></a>
				<div id="comment-11775" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 14, 2009 12:47 PM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-o4BUTUWDUsm26d3T" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11760" title="Go to message">maweko</a>
							</em>
					</span>
					<p id="comment-body-11775">
					Hi.<br>
I just upgraded the scripts for 4.0 and get this error on one of 2 VM 
one the box.<br>
<br>
RDM was found for 14_MSCLink_TestOS_Win2k8, backup will not take place
					</p>
				</div>
				<a name="comments-11776"></a>
				<div id="comment-11776" class="jive-content-comment ">
					<span>
						<span>
							Jul 14, 2009 12:49 PM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-isBot149Fl61Fgrt" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11775" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-11776">
					ah.<br>
Found the comment at the begining of the doc.<br>
Sorry!<br>
<br>
BTW, the VM has 2 disks, one virtual and one RAW. Is there a way to 
backup the virtual one?Â¿
					</p>
				</div>
				<a name="comments-11805"></a>
				<div id="comment-11805" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 19, 2009 10:27 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9VJxcgNt2290vS54" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-11805">
					Hi everyone, I've just pushed out an update to both <b>ghettoVCB.sh</b>
 and <b>ghettoVCB4i</b> which should fix the issue with the script 
trying to backup .iso when you have a mounted CD-ROM, this should not be
 an issue anymore and supports backing up w/o having to remove the 
CD-ROM device. <br>
<br>
I've also added 2 additional VMDK output format and added a new variable
 to support the various types:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain"># Format output of VMDK backup
# 1 = zeroedthick
# 2 = 2gbsparse
# 3 = thin
# 4 = eagerzeroedthick
VMDK_OUTPUT_FORMAT=1
</code></pre><br>
<br>
Please take a look at the change log for more details (07/19/09) and if 
you're interested in any type of logging, there is a new section at the 
top for Advanced Logging.<br>
<br>
Please download the latest scripts and let me know if you're still 
running into the .iso issues. <br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11790"></a>
				<div id="comment-11790" class="jive-content-comment ">
					<span>
						<span>
							Jul 19, 2009 10:49 AM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-0nh9977sVHgMHTLX" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11805" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11790">
					I am running this script with VMWare ESXi 3.5 and it works great.  
Well almost.  One of my VMs is a Linux based file server that has a 
small vmdk for itself, and also uses NFS mounted disk storage for the 
bulk of its storage.  I only want the local vmdk to be backed up in this
 case.  Is there a way, on a per VM basis, that you can set preferences 
to only backup the local vmdk of a vm with this script if there are 
remote storage (NFS or iSCSI) for the vm that you don't want backed up?<br>
<br>
Hope that makes sense.<br>
<br>
Myles
					</p>
				</div>
				<a name="comments-11806"></a>
				<div id="comment-11806" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 19, 2009 10:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-mcEYHqo7CLFtj9OG" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11790" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-11806">
					Not a supported feature of the script, you're more than welcome to 
modify to fit your needs or create separate backup jobs. Remember, the 
script itself is providing a generic backup solution, if you need 
something more specific you'll need to make those changes. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11791"></a>
				<div id="comment-11791" class="jive-content-comment ">
					<span>
						<span>
							Jul 19, 2009 11:05 AM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-m54QBaOrI7mz703P" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11806" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11791">
					I can certainly create separate backup jobs for this particular VM,
 but if I understand the way this works, I'd have to not only create a 
separate file with the target VM to backup, but I'd also have to create a
 modified ghettoVCB.sh script to tell it to only backup the specified 
vmdk files, right?  That's ok, but it obviously requires a programming 
change in the way that the script determines what to backup by VM.  Just
 before I launch down that path (which I'm fine with doing), I just 
wanted to make sure that there wasn't a preference property already 
available in the standard ghettoVCB.sh script that would cater for 
this...<br>
<br>
Myles
					</p>
				</div>
				<a name="comments-11807"></a>
				<div id="comment-11807" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 19, 2009 11:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-okf07S91b6hPKT9g" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11791" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-11807">
					Yes, you'll need to add some type of logic to on figuring out which
 VMDKs to backup and not backup and have a way to specify that in either
 a local configuration file stored within each VM or a config file read 
into the script. There's nothing in the script today that supports the 
request you're talking about, good luck. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11792"></a>
				<div id="comment-11792" class="jive-content-comment ">
					<span>
						<span>
							Jul 20, 2009 1:22 AM
						</span>
							<!--<a href="/people/maweko" title="Click to view maweko's profile">
<img class="jive-avatar" src="/people/maweko/avatar/16.png?a=-1" height="16" width="16" title="Click to view maweko's profile" alt="Click to view maweko's profile" />
</a>--><a href="http://communities.vmware.com/people/maweko" 
id="jive-Vpfk2j1tE7gIJVqi" class="jive-username-link" title="Click to 
view maweko's profile">maweko</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11792">
					Hello,<br>
<br>
Can anyone tell me best way to determine a ghettoVCB backup is running 
on a ESXi? <br>
<br>
Beside this what is the best way to stop a backup process and how do I 
have to performe this?<br>
<br>
I do not have any problems with the scripts so far, but would like to 
know how to kill things without messing up my whole ESXi.<br>
<br>
Thanks in advance for a reply.<br>
<br>
maweko
					</p>
				</div>
				<a name="comments-11809"></a>
				<div id="comment-11809" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 20, 2009 1:37 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-7wePb6ihAR0023SV" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11792" title="Go to message">maweko</a>
							</em>
					</span>
					<p id="comment-body-11809">
					To check if the process is running, from ssh:<br>
ps|grep ghettoVCB.sh<br>
<br>
To kill the process:<br>
kill -9 id_from_above<br>
<br>
If you kill it, remember to manually remove snapshots using 
VirtualCenter or whatever you use, don't delete snapshot files by hand.
					</p>
				</div>
				<a name="comments-11793"></a>
				<div id="comment-11793" class="jive-content-comment ">
					<span>
						<span>
							Jul 20, 2009 2:03 AM
						</span>
							<!--<a href="/people/maweko" title="Click to view maweko's profile">
<img class="jive-avatar" src="/people/maweko/avatar/16.png?a=-1" height="16" width="16" title="Click to view maweko's profile" alt="Click to view maweko's profile" />
</a>--><a href="http://communities.vmware.com/people/maweko" 
id="jive-b4RVVnFwArOKyjed" class="jive-username-link" title="Click to 
view maweko's profile">maweko</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11793">
					Thank's for the info.<br>
<br>
Tested it on my ESXi 3.5 U4 and although a backup process is actually 
running the ps does not display any process with name "ghettoVCB.sh" .<br>
That's a bit confusing.<br>
<br>
I started the backup with ./ghettoVCB.sh "vmlist file"<br>
<br>
Any ideas
					</p>
				</div>
				<a name="comments-11794"></a>
				<div id="comment-11794" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 20, 2009 5:36 AM
						</span>
							<!--<a href="/people/adiXSG" title="Click to view adiXSG's profile">
<img class="jive-avatar" src="/people/adiXSG/avatar/16.png?a=-1" height="16" width="16" title="Click to view adiXSG's profile" alt="Click to view adiXSG's profile" />
</a>--><a href="http://communities.vmware.com/people/adiXSG" 
id="jive-9O42riw9HEVeglu3" class="jive-username-link" title="Click to 
view adiXSG's profile">adiXSG</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11793" title="Go to message">maweko</a>
							</em>
					</span>
					<p id="comment-body-11794">
					I've tested the new version of the script. I try to create thin 
format for the backup. But although it creates flat format vmdk's. Where
 could be problem?<br>
<br>
thanks in advance for a reply.<br>
<br>
Adrian
					</p>
				</div>
				<a name="comments-11795"></a>
				<div id="comment-11795" class="jive-content-comment ">
					<span>
						<span>
							Jul 20, 2009 6:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8oooECLfw3k9Cw9o" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11794" title="Go to message">adiXSG</a>
							</em>
					</span>
					<p id="comment-body-11795">
					I think "thin" provisioning for post vSphere ESX(i) 4.0 may not act
 in the way people expect, I certainly haven't played with thin 
provisioning too much. I need you to do the following two things:<br>
<br>
1) What is the script configured to, meaning what value did you set the 
VMDK_OUTPUT_FORMAT, default is 1 which is zeroedthick<br>
<br>
2) On the VM that was backed up thin, can you go into the folder and cat
 out the .vmdk file and NOT the *-flat.vmdk<br>
<br>
3) When running the backup, can you do it manually and see if you see a 
screen output similar to this: <br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">~ # ./ghettoVCB4i.sh vmbackuplist
################ Taking backup snapshot for ghettoVCB4i-test-vm-backup ... ################
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/datastore1/ghettoVCB4i-test-vm-backup/ghettoVCB4i-test-vm-backup.vmdk'...
Clone: 100% done.
Removing snapshot from ghettoVCB4i-test-vm-backup ...
#################### Completed backup for ghettoVCB4i-test-vm-backup! ####################
</code></pre><br>
<br>
Specifically you're looking for the key words <b>"Destination disk 
format: VMFS thin-provisioned"</b>, if so, then thin provisioning is 
occurring and this goes back to my initial thought on how thin 
provisioning may work in ESX(i) 3.5. Remember by default if you backup 
to NFS datastore, it 'should' be thin by default whether or not you 
select it from vmkfstools, least from my own experiences. <br>
<p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11797"></a>
				<div id="comment-11797" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 20, 2009 11:12 PM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-Ls7lMkB772FPYxWg" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11805" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11797">
					Hi Lamw,<br>
<br>
I changed now to your new version with the cdrom fix. It works with most
 of our machines, but there is one vm where I got problems.<br>
Its the only VM with Win98 and a ide hdd (I know Win98 but its a must)<br>
If I start the script, the scripts makes a snapshot and removes the 
snapshot after that immediately, but no disks will be copied.<br>
I think the problem is ide. With the old version backup is running but 
only without the cdrom.<br>
<br>
Here is the relevant part of the log:<br>
<br>
+ IFS=<br>
+ echo ide0:0<br>
+ SCSI_ID=ide0:0<br>
+ grep -i ide0:0.present /vmfs/volumes/iscsi2dsa1/samwin/samwin.vmx<br>
+ grep -i true<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+0+-eq+0+">
 0 -eq 0 </a><br>
+ grep -i ide0:0.deviceType /vmfs/volumes/iscsi2dsa1/samwin/samwin.vmx<br>
+ grep -i scsi-hardDisk<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+1+-eq+0+">
 1 -eq 0 </a><br>
+ IFS=<br>
<br>
+ vim-cmd vmsvc/power.getstate 224<br>
+ tail -1<br>
+ ORGINAL_VM_POWER_STATE=Powered on<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+0+-eq+1+">
 0 -eq 1 </a><br>
+ [<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%21+0+-eq+1+%5D">
 ! 0 -eq 1 ]</a><br>
+ [<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+Powered+on+%21%3D+Powered+off+%5D">
 Powered on != Powered off ]</a><br>
+ echo ################ Taking backup snapshot for samwin ... 
################<br>
+ date +%F<br>
+ vim-cmd vmsvc/snapshot.create 224 vcb_snap 
VCB_BACKUP_samwin_2009-07-21<br>
+ OLD_IFS=<br>
<br>
+ IFS=:<br>
+ IFS=<br>
<br>
+ [<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%21+0+-eq+1+%5D">
 ! 0 -eq 1 ]</a><br>
+ [<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+Powered+on+%3D%3D+Powered+on+%5D">
 Powered on == Powered on ]</a><br>
+ vim-cmd vmsvc/snapshot.remove 224<br>
+ echo Removing snapshot from samwin ...<br>
Removing snapshot from samwin ...<br>
+ ls /vmfs/volumes/iscsi2dsa1/samwin<br>
+ grep -q delta<br>
ls: /vmfs/volumes/iscsi2dsa1/samwin/samwin-000001.vmdk.lck: No such file
 or directory<br>
+ sleep 3<br>
+ ls /vmfs/volumes/iscsi2dsa1/samwin<br>
+ grep -q delta<br>
+ [<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+0+-eq+1+%5D">
 0 -eq 1 ]</a><br>
+ TMP_IFS=<br>
</p><p>
Hope you could help
					</p>
				</div>
				<a name="comments-11799"></a>
				<div id="comment-11799" class="jive-content-comment ">
					<span>
						<span>
							Jul 21, 2009 8:31 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9ahhjXF5D4X17J1b" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11797" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-11799">
					Okay, I see the issue. This should hopefully be fixed now in the 
latest version of the script. Give it a run and let me know how it goes.<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11818"></a>
				<div id="comment-11818" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 22, 2009 5:42 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-OnH6j24SvW5qRRM9" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11799" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11818">
					/vmfs/volumes/4965afe0-76fbdae2-48e3-00221952c5db # ls<br>
ANTHEAFILESThin     PieraVMThin         TimbratureVMThin<br>
ANTHEAR10TEST       R10INTERNO          ghettoVCB4i.sh<br>
AntheaDom           R9SVP               weekly<br>
IvanoVMThin         RosalbaVMVistaThin  weekly2<br>
/vmfs/volumes/4965afe0-76fbdae2-48e3-00221952c5db # sh ghettoVCB4i.sh 
weekly2<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for IvanoVMThin ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/IvanoVMThin/IvanoVMThin.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from IvanoVMThin ...<br>
sh: /vmfs/volumes/VMBACKUP/ESX22/IvanoVMThin/IvanoVMThin-2009-07-21: bad
 number<br>
ghettoVCB4i.sh: line 374: syntax error: 
/vmfs/volumes/VMBACKUP/ESX22/IvanoVMThin/IvanoVMThin-2009-07-21+1<br>
/vmfs/volumes/4965afe0-76fbdae2-48e3-00221952c5db #<br>
<br>
I receive always this error when I backup this thin VM with windows XP.<br>
Can someone help me?
					
				</div>
				<a name="comments-11831"></a>
				<div id="comment-11831" class="jive-content-comment ">
					<span>
						<span>
							Jul 22, 2009 6:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-zM60keMSFLypXEC6" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11818" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11831">
					Are you using the latest version of the script? Also if you have 
the right permissions set, you don't need to execute with "sh", you 
should do something like this:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">./ghettoVCB4i.sh weekly2
</code></pre><br>
<br>
Also there is a param in the script after the "DO NOT EDIT" portion that
 provides some debugging information called "DEVEL_MODE" can you please 
change this from 0 to 1 and re-run the script and provide the output of 
that. To ensure the forum does not mangle your screen output, please 
wrap it in {code} tags<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11811"></a>
				<div id="comment-11811" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 22, 2009 1:45 PM
						</span>
							<!--<a href="/people/clone0326" title="Click to view clone0326's profile">
<img class="jive-avatar" src="/people/clone0326/avatar/16.png?a=-1" height="16" width="16" title="Click to view clone0326's profile" alt="Click to view clone0326's profile" />
</a>--><a href="http://communities.vmware.com/people/clone0326" 
id="jive-99lJke3SogRMLIGV" class="jive-username-link" title="Click to 
view clone0326's profile">clone0326</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11794" title="Go to message">adiXSG</a>
							</em>
					</span>
					<p id="comment-body-11811">
					First of all, thanks to all who have had a part putting this script
 together.  I'm very new to VMWare and Linux, and this has all been such
 a huge help.  However, I'm having the same issue as adiXSG.  I have a 
Linux VM that I have given a thin disk, and I have uploaded the most 
recent version of the ghettoVCB4i.sh script, choosing option 3 for thin 
disk format.  However, the output is "servername-flat.vmdk" and the file
 size is 100 gigs, not the 5.2 or so gigs that it should be (the size of
 the original thin .vmdk file).<br>
<br>
I hope I'm describing this properly, does anyone know what the problem 
could be?  Thanks!
					</p>
				</div>
				<a name="comments-11812"></a>
				<div id="comment-11812" class="jive-content-comment ">
					<span>
						<span>
							Jul 22, 2009 4:23 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-44C3zoQHj03As23p" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11811" title="Go to message">clone0326</a>
							</em>
					</span>
					<p id="comment-body-11812">
					Please take a look at this response <a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-11794">http://communities.vmware.com/docs/DOC-8760#comments-11794</a>
 and provide the requested output<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11813"></a>
				<div id="comment-11813" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 22, 2009 11:21 PM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-ocHswk8R4itF8pg0" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11831" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11813">
					I'm running the latest version of the script. I tried with 
./ghetto..... but the problem remain.<br>
The file have the rights "rwxr-xr-x"<br>
<br>
If I change DEVEL_MODE I receive this information <br>
<br>
/vmfs/volumes/4965afe0-76fbdae2-48e3-00221952c5db # ./ghettoVCB4i.sh 
weekly2<br>
(vim.fault.DuplicateName) {<br>
   dynamicType = &lt;unset&gt;,<br>
   faultCause = (vmodl.MethodFault) null,<br>
   name = "VMBACKUP",<br>
   object = 'vim.Datastore:192.168.111.23:/VMBACKUP',<br>
   msg = "The name 'VMBACKUP' already exists.",<br>
}<br>
##########################################<br>
Virtual Machine: IvanoVMThin<br>
VM_ID: 448<br>
VMX_PATH: /vmfs/volumes/datastore1/IvanoVMThin/IvanoVMThin.vmx<br>
VMX_DIR: /vmfs/volumes/datastore1/IvanoVMThin<br>
VMX_CONF: IvanoVMThin/IvanoVMThin.vmx<br>
VMFS_VOLUME: datastore1<br>
##########################################<br>
<br>
##########################################<br>
Virtual Machine: PieraVMThin<br>
VM_ID: 432<br>
VMX_PATH: /vmfs/volumes/datastore1/PieraVMThin/PieraVMThin.vmx<br>
VMX_DIR: /vmfs/volumes/datastore1/PieraVMThin<br>
VMX_CONF: PieraVMThin/PieraVMThin.vmx<br>
VMFS_VOLUME: datastore1<br>
##########################################<br>
<br>
##########################################<br>
Virtual Machine: TimbratureVMThin<br>
VM_ID: 400<br>
VMX_PATH: /vmfs/volumes/datastore1/TimbratureVMThin/TimbratureVMThin.vmx<br>
VMX_DIR: /vmfs/volumes/datastore1/TimbratureVMThin<br>
VMX_CONF: TimbratureVMThin/TimbratureVMThin.vmx<br>
VMFS_VOLUME: datastore1<br>
##########################################<br>
<br>
##########################################<br>
Virtual Machine: RosalbaVMVistaThin<br>
VM_ID: 416<br>
VMX_PATH: 
/vmfs/volumes/datastore1/RosalbaVMVistaThin/RosalbaVMVistaThin.vmx<br>
VMX_DIR: /vmfs/volumes/datastore1/RosalbaVMVistaThin<br>
VMX_CONF: RosalbaVMVistaThin/RosalbaVMVistaThin.vmx<br>
VMFS_VOLUME: datastore1<br>
##########################################<br>
</p><p>
Start time: Thu Jul 23 06:16:31 UTC 2009<br>
End   time: Thu Jul 23 06:16:34 UTC 2009<br>
Duration  : 3 Seconds<br>
<br>
DEVEL MODE OUTPUT COMPLETE<br>
<br>
/vmfs/volumes/4965afe0-76fbdae2-48e3-00221952c5db #
					</p>
				</div>
				<a name="comments-11834"></a>
				<div id="comment-11834" class="jive-content-comment ">
					<span>
						<span>
							Jul 22, 2009 11:25 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1YBjX0uXAhO6n93U" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11813" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11834">
					I don't see anything wrong from the output, is this the only VM 
you're having problems with? Can you ensure there are no left over 
snapshots from the script?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11835"></a>
				<div id="comment-11835" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 23, 2009 6:29 AM
						</span>
							<!--<a href="/people/clone0326" title="Click to view clone0326's profile">
<img class="jive-avatar" src="/people/clone0326/avatar/16.png?a=-1" height="16" width="16" title="Click to view clone0326's profile" alt="Click to view clone0326's profile" />
</a>--><a href="http://communities.vmware.com/people/clone0326" 
id="jive-340tVzL6WWj8yG9Y" class="jive-username-link" title="Click to 
view clone0326's profile">clone0326</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11812" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11835">
					Ok, I hope I'm being clear, please let me know if you need 
clarification:<br>
<br>
1) For VMDK_OUTPUT_FORMAT, I set the value to 3 for thin disk<br>
<br>
2)  I'm not sure what you mean by this.  Can you provide instructions on
 how to "cat out" the .vmdk file?  I do see two vmdk files, one is the 
-flat file (100 gigs) the other is servername.vmdk but is only 1k.<br>
<br>
3)  When running the script, I do see that output and the line 
"Destination disk format: VMFS thin-provisioned"<br>
<br>
I also was able to clone the disk manually using the following command, 
which appears in the ghettoVCB4i.sh script:<br>
#vmkfstools -i /vmfs/volumes/san_vmfs/my_vm/large_disk.vmdk -d thin 
/vmfs/volumes/san_vmfs/my_vm/new_thin_disk.vmdk<br>
<br>
That command worked in converting the vmdk to a thin disk, so I'm not 
sure why the script isn't.
					</p>
				</div>
				<a name="comments-11836"></a>
				<div id="comment-11836" class="jive-content-comment ">
					<span>
						<span>
							Jul 24, 2009 12:04 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-Vr15EU7pi8Q7Lwpm" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11834" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11836">
					I'm sure no snapshot on the VM.<br>
I have the same problem on another VM with different OS.<br>
<br>
The backup process seems to work fine. Infact it arrive at 100% and the 
file created seems correct.<br>
Maybe the problem is when try to cancel the old folder backup or the 
snapshot.
					</p>
				</div>
				<a name="comments-11837"></a>
				<div id="comment-11837" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 24, 2009 3:00 PM
						</span>
							<!--<a href="/people/cookieme" title="Click to view cookieme's profile">
<img class="jive-avatar" src="/people/cookieme/avatar/16.png?a=-1" height="16" width="16" title="Click to view cookieme's profile" alt="Click to view cookieme's profile" />
</a>--><a href="http://communities.vmware.com/people/cookieme" 
id="jive-tNEXUAW2PS9g1xdM" class="jive-username-link" title="Click to 
view cookieme's profile">cookieme</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11836" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-11837">
					I've spent the past 2 hours or so reading through this thread from 
start to finish!! Incredibly valuable help from all!<br>
<br>
However, I have a few questions that I feel have not been 
asked/answered.<br>
<br>
1. I access my ESXi host remotely with HP iLO via VPN. Am I correct in 
saying that I can copy the script from my remote system to the ESXi 
system WITHOUT enabling the unsupported mode and/or SSH if I use vCLI 
with command vifs?<br>
<br>
2. Maybe I have missed something, but where do you actually store the 
ghettoVCB script? It seems that you can choose to store it on external 
or internal storage. I am interested in internal, but where is the 
appropriate location?<br>
<br>
3. I understand that most users are starting the script from another 
system via SSH. This is well explained, but I am interested in 
scheduling the script from within the ESXi host. Now there are a few 
references to crontab (new to me) and some suggestions on how to set 
this up. Some say edit rc.local and others are doing something like this
 <br>
<br>
*echo "0 2 * * 6 /vmfs/volumes/vmiscsi/tools/ghettoVCB4i.sh" &gt; 
/var/spool/cron/crontabs/root* <br>
<br>
However, the different approaches have me confused, so William could you
 please add a section at the top with the "best practice" of configuring
 a crontab to run the script or post a recommendation?<br>
<br>
Thanks for an excellent free backup solution!!
					</p>
				</div>
				<a name="comments-11838"></a>
				<div id="comment-11838" class="jive-content-comment ">
					<span>
						<span>
							Jul 24, 2009 3:05 PM
						</span>
							<!--<a href="/people/cookieme" title="Click to view cookieme's profile">
<img class="jive-avatar" src="/people/cookieme/avatar/16.png?a=-1" height="16" width="16" title="Click to view cookieme's profile" alt="Click to view cookieme's profile" />
</a>--><a href="http://communities.vmware.com/people/cookieme" 
id="jive-cfTERQb4xkzP6HIX" class="jive-username-link" title="Click to 
view cookieme's profile">cookieme</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11537" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-11838">
					voro can you please elaborate on how to push ESXi logs to a syslog 
server and what the advantages are (I'm new to this)? I found a virtual 
appliance <a class="jive-link-external" 
href="http://www.syslogappliance.de/en/">http://www.syslogappliance.de/en/</a>
 would this work if it resides on the same ESXi host?<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-11839"></a>
				<div id="comment-11839" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 25, 2009 12:32 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-89o92FoK9G8O3fbI" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11837" title="Go to message">cookieme</a>
							</em>
					</span>
					<p id="comment-body-11839">
					3) If you want to schedule it without keeping a ssh session open or
 using a remote system, you have to use ESXi's crond. Busybox's crond is
 limited and adding that line in /var/spool/cron/crontabs/root is the 
only way, but it will be lost upon rebot. That's why some suggest adding
 that echo in rc.local
					</p>
				</div>
				<a name="comments-11840"></a>
				<div id="comment-11840" class="jive-content-comment ">
					<span>
						<span>
							Jul 25, 2009 12:47 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-RkDHSrCsq429ie7O" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11838" title="Go to message">cookieme</a>
							</em>
					</span>
					<p id="comment-body-11840">
					About Remote logging<br>
<br>
</p><ul>
<li>Advantages: </li>
</ul>
Easier manageability, you don't need to keep the VIClient/VCenter open 
to read the logs, you can parse them with third party tools/custom 
scripts, you don't lose them if something goes wrong, you can setup 
alerts if certain entry is logged,etc. There are dozens of reasons, just
 google it.<br>
<br>
<ul>
<li>Howto:</li>
</ul>
Very easy. Log to local syslog running the script as I posted before<br>
        ./ghettoVCB4i.sh vmbackuplist 2&gt;&amp;1 | busybox logger -t 
ghettoVCB4i -p 1<br>
then, configure ESXi's syslog to log to a remote host<br>
        vi /etc/syslog.conf<br>
or with VIClient configuration tab (it's in advanced features), just add
 remote syslog's IP or hostname.<br>
<br>
Configuring remote daemon can be as easy as doing nothing (depends on 
your defaults) or allowing ESXi's to push their logs there, or even 
using a separate file to store those logs (easier with syslog-ng)<br>
<br>
It doesn't matter if it's another VM on the same host, a physical 
computer or even a server on a different network as long as ESXi can 
reach UDP Port 514 on the remote syslog.
					
				</div>
				<a name="comments-11841"></a>
				<div id="comment-11841" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 25, 2009 1:17 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8W00M2ol9PFD98h2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11835" title="Go to message">clone0326</a>
							</em>
					</span>
					<p id="comment-body-11841">
					When looking at the actual size of thin provisioned disk, if you do
 'ls -lha', it will not show you the actual disk consumption. So by 
running the conversion in a script or from the CLI, it should yield the 
same results. Are you sure you're using the same VM and doing one backup
 and then doing it from the CLI to ensure you're looking at the same VM?
 You'll be able to see the actual consumption if you do something like 
'du -h' since ESXi unsupported console does not have 'du' nor 'vdf'. <br>
<br>
Here is an example:<br>
<br>
I have a VM that is allocated thick with 8gb:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84/ide-vm # ls -Falh
drwxr-xr-x    1 root     root          980 Jul 25 12:06 ./
drwxr-xr-t    1 root     root         1.2k Jul 25 12:03 ../
-rw-------    1 root     root         8.0G Jul 21 19:36 ide-vm-flat.vmdk
-rw-------    1 root     root          440 Jul 21 19:36 ide-vm.vmdk
-rw-------    1 root     root            0 Jul 21 19:36 ide-vm.vmsd
-rwxr-xr-x    1 root     root         1.5k Jul 21 19:36 ide-vm.vmx*
-rw-------    1 root     root          261 Jul 21 19:36 ide-vm.vmxf
</code></pre><br>
<br>
I have a local datastore that has 5.6G free, which is where this 
specific VM is stored and where the backup will go (vmfs3 is the local 
storage):<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84/ide-vm # df -h
Filesystem                Size      Used Available Use% Mounted on
visorfs                 278.2M    243.3M     34.9M  87% /
nfs                       1.3T    789.7G    558.7G  59% /vmfs/volumes/d32c5a97-e039bdbf
vfat                      4.0G    384.0k      4.0G   0% /vmfs/volumes/4a59c381-8059e09f-33a3-005056825b84
vfat                    249.7M     76.2M    173.5M  31% /vmfs/volumes/7db9337b-a328f52c-2a05-87d4ed7807df
vfat                    249.7M      4.0k    249.7M   0% /vmfs/volumes/eb676f73-6dd0961e-3224-09791e2c7199
vfat                    285.9M    230.2M     55.7M  81% /vmfs/volumes/c2a427e4-2d317086-fef9-b5750d88536c
vmfs3                    15.0G      9.4G      5.6G  62% /vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84
</code></pre><br>
<br>
I know manually clone on the CLI:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84/ide-vm # vmkfstools -i ide-vm.vmdk -d thin ide-vm-THIN.vmdk
Destination disk format: VMFS thin-provisioned
Cloning disk 'ide-vm.vmdk'...
Clone: 100% done.
</code></pre><br>
<br>
As you can see from the above, it thinly provisioned and it was done 
VERY quickly and now lets take a look at the directory listing to see 
what 'ls' shows us:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84/ide-vm # ls -Falh
drwxr-xr-x    1 root     root         1.2k Jul 25 12:08 ./
drwxr-xr-t    1 root     root         1.2k Jul 25 12:03 ../
-rw-------    1 root     root         8.0G Jul 25 12:08 ide-vm-THIN-flat.vmdk
-rw-------    1 root     root          494 Jul 25 12:08 ide-vm-THIN.vmdk
-rw-------    1 root     root         8.0G Jul 21 19:36 ide-vm-flat.vmdk
-rw-------    1 root     root          440 Jul 21 19:36 ide-vm.vmdk
-rw-------    1 root     root            0 Jul 21 19:36 ide-vm.vmsd
-rwxr-xr-x    1 root     root         1.5k Jul 21 19:36 ide-vm.vmx*
-rw-------    1 root     root          261 Jul 21 19:36 ide-vm.vmxf
</code></pre><br>
<br>
Both the original and thin clone still shows up 8gb, but if you look at 
'df' you'll notice that available space is still 5.6gb, meaning the disk
 was thin provisioned else I would have ran out of space:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84/ide-vm # df -h
Filesystem                Size      Used Available Use% Mounted on
visorfs                 278.2M    243.3M     34.9M  87% /
nfs                       1.3T    789.7G    558.7G  59% /vmfs/volumes/d32c5a97-e039bdbf
vfat                      4.0G    384.0k      4.0G   0% /vmfs/volumes/4a59c381-8059e09f-33a3-005056825b84
vfat                    249.7M     76.2M    173.5M  31% /vmfs/volumes/7db9337b-a328f52c-2a05-87d4ed7807df
vfat                    249.7M      4.0k    249.7M   0% /vmfs/volumes/eb676f73-6dd0961e-3224-09791e2c7199
vfat                    285.9M    230.2M     55.7M  81% /vmfs/volumes/c2a427e4-2d317086-fef9-b5750d88536c
vmfs3                    15.0G      9.4G      5.6G  62% /vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84
</code></pre><br>
<br>
Just to prove that this case, I try to do a standard clone which by 
default is zeroedthick which fails:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84/ide-vm # vmkfstools -i ide-vm.vmdk ide-vm-THICK.vmdk
Destination disk format: VMFS zeroedthick
Cloning disk 'ide-vm.vmdk'...
Failed to clone disk : There is not enough space on the file system for the selected operation (13).
</code></pre><br>
<br>
So the script is indeed doing what you're setting it up to and you 
probably were looking at the wrong file when comparing the disk usage as
 there is a -flat.vmdk which is the actual vDisk and the .vmdk which is 
the descriptor file for a given VM. <br>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					
				</div>
				<a name="comments-11821"></a>
				<div id="comment-11821" class="jive-content-comment ">
					<span>
						<span>
							Jul 26, 2009 7:38 AM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-PmAo57O9cE8d48tu" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11839" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-11821">
					Question:  I know that ghettoVCB.sh will skip a backup if any 
snapshots exist.  We have a couple of ESXi servers that we never use 
snapshots on.  Is there any danger in modifying the script to forcibly 
remove any snapshots with the script if it finds any and then do the 
backups?  I know that the script can remove snapshots - I just don't 
want backups skipped if they were attempted before, and the script 
failed for some reason, leaving the VMs in a state where they can be 
never backed up afterwards unless there is some manual intervention to 
remove the snapshots.<br>
<br>
Myles
					</p>
				</div>
				<a name="comments-11842"></a>
				<div id="comment-11842" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 26, 2009 10:20 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9F1don5Nc85kb3DA" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11821" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-11842">
					The script should always remove all snapshots that 'it' creates so 
long as you don't intervene or manually tweak with a VM during the 
backup process. I'm not exactly sure what you mean your initial 
statement, of ESXi servers that never use snapshots. The backup process 
requires snapshots as you know OR you have the option of powering off 
the VM before backup. If you're worried for some reason that snapshots 
may be left behind for whatever reason, you of course could modify the 
script in such a way to loop through all VMs and removeallsnapshots, but
 you will receive no support if you do make such modifications. If you 
follow all requirements and you've verified before implementing 
ghettoVCB, you should not have any issues with VMs having snapshots in 
the first place and they should all be removed prior to moving to the 
next VM.<br>
<br>
Hopefully this cleared up your concerns, also if this was an issue, I'm 
sure I would have heard from many others about it <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Thanks again. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11814"></a>
				<div id="comment-11814" class="jive-content-comment ">
					<span>
						<span>
							Jul 26, 2009 10:34 AM
						</span>
							<!--<a href="/people/cookieme" title="Click to view cookieme's profile">
<img class="jive-avatar" src="/people/cookieme/avatar/16.png?a=-1" height="16" width="16" title="Click to view cookieme's profile" alt="Click to view cookieme's profile" />
</a>--><a href="http://communities.vmware.com/people/cookieme" 
id="jive-193sT7aF75F5qw2e" class="jive-username-link" title="Click to 
view cookieme's profile">cookieme</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11837" title="Go to message">cookieme</a>
							</em>
					</span>
					<p id="comment-body-11814">
					Hmm, are my questions too trivial that no one wants to respond? I'm
 not asking just for the sake of it. There are many repeat questions/ 
answers not just here, but on any forum. However, like I said I have 
gone through this thread diligently and I couldn't find answers to what 
may be simple questions. I'm sure others would benefit.<br>
<br>
Well, I look forward to some response, so I can better understand how to
 use this. Thanks
					</p>
				</div>
				<a name="comments-11860"></a>
				<div id="comment-11860" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 27, 2009 9:33 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-G4u51vW4EJVoup3i" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11814" title="Go to message">cookieme</a>
							</em>
					</span>
					<p id="comment-body-11860">
					</p><div class="jive-quote">
1. I access my ESXi host remotely with HP iLO via VPN. Am I correct in 
saying that I can copy the script from my remote system to the ESXi 
system WITHOUT enabling the unsupported mode and/or SSH if I use vCLI 
with command vifs?<br>
<br>
2. Maybe I have missed something, but where do you actually store the 
ghettoVCB script? It seems that you can choose to store it on external 
or internal storage. I am interested in internal, but where is the 
appropriate location?<br>
<br>
3. I understand that most users are starting the script from another 
system via SSH. This is well explained, but I am interested in 
scheduling the script from within the ESXi host. Now there are a few 
references to crontab (new to me) and some suggestions on how to set 
this up. Some say edit rc.local and others are doing something like this<br>
<br>
*echo "0 2 * * 6 /vmfs/volumes/vmiscsi/tools/ghettoVCB4i.sh" &gt; 
/var/spool/cron/crontabs/root* <br>
</div>
<br>
1) Wrong, you'll need to enable the unsupported mode to both upload and 
configure/execute the script. You technically can use <b>vifs</b> to 
upload the script if you're going to be executing on a datastore that's 
not local to the ESXi hosts such as NFS,FC/iSCSI SAN but the 
configuration/setup will require the unsupported SSH console. The 
information regarding the upload, setup and configuration is defined in 
the documentation, it may not be explicitly state that you must do this 
and this but the assumption is made that users understand they'll need 
to unlock the unsupported console when using this script. <br>
<br>
2) Again, this is a choice left up to the end users. As you can see 
there are advantages/disadvantages to storing the script on either 
internal or external storage. If you decide to store it locally and not 
have it rely on other sources, then you'll need to deal with the 
persistent configuration to ensure the script itself is persisted in a 
reboot and any type of cron jobs scheduled. There is no 'best practice' 
on where to store your script, that is for you to figure out and perhaps
 through trial/error you'll get a feel for what will work in your 
environment.<br>
<br>
3) Again, there is no best practice. You're more than welcome to 
schedule this within ESXi, have an external VM whether that be 
Windows/Linux make an SSH connection and execute the backup job and run 
it in the background to ensure that no persisted TCP connection is 
required. As you know from reading through not only this thread but many
 others in the VMTN forum regarding configuring the cron jobs, there's 
more than one way and more than one location that'll keep the 
configurations persisted through a reboot. <br>
<br>
One example can be found at this thread: <a class="jive-link-message" 
href="http://communities.vmware.com/message/1249900#1249900">Re: FTP on 
ESXi 3.5??</a> <br>
<br>
You can also find a nice detailed 3 part article by Raj on configuring 
this on a Windows system if you're more comfortable and familiar than on
 a UNIX/Linux system.<br>
<br>
So, when you say provide a best practice, there really isn't one. The 
scope of this script is to provide a general backup solution that 
enables some flexibility on end users and if you need something more 
specific such as detail logging, compression, scheduling, etc. I expect 
end users to find/research the best solution that'll work in their 
operating environment. <br>
<br>
Hopefully this clears up your question and again you can find more 
information by doing a search within the main VMTN forum as well. I'm 
sure you'll find many other threads that can help you understand some of
 what people have done, I know a very popular thread that contains 
implementation of this script can be found in ~last 10-15pages of: <a 
class="jive-link-message" 
href="http://communities.vmware.com/message/1029047#1029047">Free ESXi 
Backup Solution for Windows</a><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11849"></a>
				<div id="comment-11849" class="jive-content-comment ">
					<span>
						<span>
							Jul 29, 2009 8:04 AM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-Ff83Io3hbiigiWYA" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11799" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11849">
					Hello Lamw,<br>
<br>
thanks for your work. All backups are running ok now.
					</p>
				</div>
				<a name="comments-11879"></a>
				<div id="comment-11879" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 30, 2009 7:28 AM
						</span>
							<!--<a href="/people/vmuser23" title="Click to view vmuser23's profile">
<img class="jive-avatar" src="/people/vmuser23/avatar/16.png?a=-1" height="16" width="16" title="Click to view vmuser23's profile" alt="Click to view vmuser23's profile" />
</a>--><a href="http://communities.vmware.com/people/vmuser23" 
id="jive-QdEJfjEKOAxn7MXD" class="jive-username-link" title="Click to 
view vmuser23's profile">vmuser23</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11849" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-11879">
					The best free backup script ever written was the VISBU<br>
<br>
The main important features were<br>
1. Backup vm mentioned based on criteria powered on or off only<br>
2. compress the backup<br>
3. restore script included<br>
<br>
Important features <br>
1. Specify which vmdk's can be backed up in a vm for example we have a 
few vm's that have vmdk and an rdm so we specify the backup to only 
backup the vmdk and skip the rdm from the vm<br>
2. CIFS/NFS/LOCAL DESTINATION<br>
<br>
Unfortunately its no longer available, will this script have all the 
features and become the best free script to work on esx/esxi without any
 license needed from vmware ?
					</p>
				</div>
				<a name="comments-11853"></a>
				<div id="comment-11853" class="jive-content-comment ">
					<span>
						<span>
							Aug 3, 2009 8:45 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-eCRWIEFwn4f0b0L5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11879" title="Go to message">vmuser23</a>
							</em>
					</span>
					<p id="comment-body-11853">
					Please take a look at the documentation (this document) for the 
features provided with this script, if you can not find it, then it does
 not exists. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11892"></a>
				<div id="comment-11892" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2009 8:55 AM
						</span>
							<!--<a href="/people/tnol2" title="Click to view tnol2's profile">
<img class="jive-avatar" src="/people/tnol2/avatar/16.png?a=-1" height="16" width="16" title="Click to view tnol2's profile" alt="Click to view tnol2's profile" />
</a>--><a href="http://communities.vmware.com/people/tnol2" 
id="jive-9tQnep534yirXu48" class="jive-username-link" title="Click to 
view tnol2's profile">tnol2</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10605" title="Go to message">ollivetti</a>
							</em>
					</span>
					<p id="comment-body-11892">
					"Error: failed to extract VM_ID"<br>
<br>
The solution is:<br>
<br>
Check this fields on the VMX file:<br>
<br>
displayName = "Vmname"<br>
extendedConfigFile = "vmname.vmxf"<br>
<br>
Both need be the same, example:<br>
<br>
displayName = "vmname"<br>
extendedConfigFile = "vmname.vmxf"
					</p>
				</div>
				<a name="comments-11874"></a>
				<div id="comment-11874" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 3:50 AM
						</span>
							<!--<a href="/people/Stephan84" title="Click to view Stephan84's profile">
<img class="jive-avatar" src="/people/Stephan84/avatar/16.png?a=-1" height="16" width="16" title="Click to view Stephan84's profile" alt="Click to view Stephan84's profile" />
</a>--><a href="http://communities.vmware.com/people/Stephan84" 
id="jive-BSqJw7f6NCY4CR8u" class="jive-username-link" title="Click to 
view Stephan84's profile">Stephan84</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11874">
					Hi,<br>
<br>
i am using ghettoVCB4i.sh on ESXi 4.0.0 171294 and have some problemes 
with white spaces in VMs names.<br>
<br>
While executing the Script i get the following errors:<br>
<br>
ls: /vmfs/volumes/Storagesrv01_backups//itorga: No such file or 
directory<br>
ls: backuptrigger: No such file or directory<br>
ls: /vmfs/volumes/Storagesrv01_backups//dnie: No such file or directory<br>
ls: workstation: No such file or directory<br>
<br>
The names of the virtual machines are: "itorga backuptrigger" and "dnie 
workstation"<br>
<br>
I checked the IFS:<br>
<br>
        IFS='<br>
'<br>
<br>
I think that the error occures in Line 314:<br>
<br>
echo "Removing snapshot from ${VM_NAME} ..."<br>
while ls "${VMX_DIR}" | grep -q delta;<br>
do<br>
sleep 3<br>
done<br>
<br>
Does anybody has an idea how to fix this? I can't rename all VMs.<br>
<br>
Thanks,<br>
Stephan<br>
<br>
For those of you who are trying to run the script via chronjob:<br>
<br>
</p><ul class="jive-dash">
<li>Use a secound Linux machine</li>
<li>Use ssh/authorized_keys file</li>
<li>write/use a shell script like this:</li>
</ul>
<br>
ssh <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=ESX+Host+IP">ESX
 Host IP</a> "date &gt; <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=NFS+Path+to+Logfile">NFS
 Path to Logfile</a>.log"<br>
ssh <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=ESX+Host+IP">ESX
 Host IP</a> "./sbin/ghettoVCB4i.sh /sbin/vm_backup_list  &gt;&gt; <a 
class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=NFS+Path+to+Logfile">NFS
 Path to Logfile</a>.log"<br>
cat <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=LOCAL+NFS+Path+to+Logfile">LOCAL
 NFS Path to Logfile</a> | mail -s Backup_subjekt <a 
class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=Mail">Mail</a>@<a
 class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=Host">Host</a>
					
				</div>
				<a name="comments-11857"></a>
				<div id="comment-11857" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 5, 2009 4:46 AM
						</span>
							<!--<a href="/people/tnol2" title="Click to view tnol2's profile">
<img class="jive-avatar" src="/people/tnol2/avatar/16.png?a=-1" height="16" width="16" title="Click to view tnol2's profile" alt="Click to view tnol2's profile" />
</a>--><a href="http://communities.vmware.com/people/tnol2" 
id="jive-B2F8xWVFEk0BFuzg" class="jive-username-link" title="Click to 
view tnol2's profile">tnol2</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11874" title="Go to message">Stephan84</a>
							</em>
					</span>
					<p id="comment-body-11857">
					The problem is the empty space, on the name of virtual machines. 
Remove it.
					</p>
				</div>
				<a name="comments-11896"></a>
				<div id="comment-11896" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 5:45 AM
						</span>
							<!--<a href="/people/Stephan84" title="Click to view Stephan84's profile">
<img class="jive-avatar" src="/people/Stephan84/avatar/16.png?a=-1" height="16" width="16" title="Click to view Stephan84's profile" alt="Click to view Stephan84's profile" />
</a>--><a href="http://communities.vmware.com/people/Stephan84" 
id="jive-1SxGJKOXPh7HH8d3" class="jive-username-link" title="Click to 
view Stephan84's profile">Stephan84</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11857" title="Go to message">tnol2</a>
							</em>
					</span>
					<p id="comment-body-11896">
					Hi tnol2,<br>
<br>
as i said: i can't rename all the VMs <img class="jive-emoticon" 
src="DOC-8760_files/sad.gif" alt=":(" border="0">
					</p>
				</div>
				<a name="comments-11897"></a>
				<div id="comment-11897" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 5, 2009 5:56 AM
						</span>
							<!--<a href="/people/bjoernbergmann" title="Click to view bjoernbergmann's profile">
<img class="jive-avatar" src="/people/bjoernbergmann/avatar/16.png?a=-1" height="16" width="16" title="Click to view bjoernbergmann's profile" alt="Click to view bjoernbergmann's profile" />
</a>--><a href="http://communities.vmware.com/people/bjoernbergmann" 
id="jive-Bn7p13iVfiS8mXeB" class="jive-username-link" title="Click to 
view bjoernbergmann's profile">bjoernbergmann</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11663" title="Go to message">bjoernbergmann</a>
							</em>
					</span>
					<p id="comment-body-11897">
					Hi!<br>
<br>
Since there much more activity now here I want to ask you again if there
 is any idea about the problem posted several weeks ago.<br>
We are using the 3.5 version of ghettoVCB.sh. If you need any more 
details - just let me know....<br>
<br>
*-------<br>
We are backing up 4 ESXi 3.5 servers successfully with about 6VMs each.<br>
<br>
There is only one problem to backup a Debian Linux 60GB virtual 
harddisk. Snapshot seems to be OK. Backing up the disk (one of two) 
failed after some time with the following error message.<br>
<br>
Taking backup snapshot for DEASX401 ... ################<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/datastore1/DEASX401/DEASX401_2.vmdk'...<br>
Clone: 79% done.Failed to clone disk : Insufficient permission to access
 file (38).<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/datastore1/DEASX401/DEASX401.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from DEASX401 ...<br>
Completed backup for DEASX401! ####################<br>
Start time: Wed Jul 1 06:45:27 UTC 2009<br>
End time: Wed Jul 1 09:21:51 UTC 2009<br>
Duration : 156.40 Minutes<br>
Completed backing up specified Virtual Machines!<br>
<br>
Might it be possible that the disk is to big? Is there any timeout?<br>
<br>
Here some more information:<br>
./ghettoVCB.sh is running with root account!<br>
backup disk mouted vie NSF from a Win2003R2 server<br>
share is an external 1GB USB disk<br>
nsf shared folder is windows compressed (can save until 75% of original 
space)<br>
<br>
*------<br>
</p><p>
Regards,<br>
<br>
Bjoern
					</p>
				</div>
				<a name="comments-11858"></a>
				<div id="comment-11858" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 7:02 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7TlQnVHHBcognq1j" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11897" title="Go to message">bjoernbergmann</a>
							</em>
					</span>
					<p id="comment-body-11858">
					Again, I'll tell you the same thing I told you awhile back, there 
are no known issues of timeout or VMDK being too large so long as you're
 under the &lt; 2TB range.<br>
<br>
The error dictates this to be a permission issue and not anything with 
the script. I would highly recommend you <b>manually</b> do a backup by 
hand to ensure that you are in fact able to backup using <u>vmkfstools</u>
 and isolate the problem that may be occuring. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11859"></a>
				<div id="comment-11859" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 5, 2009 7:36 AM
						</span>
							<!--<a href="/people/bjoernbergmann" title="Click to view bjoernbergmann's profile">
<img class="jive-avatar" src="/people/bjoernbergmann/avatar/16.png?a=-1" height="16" width="16" title="Click to view bjoernbergmann's profile" alt="Click to view bjoernbergmann's profile" />
</a>--><a href="http://communities.vmware.com/people/bjoernbergmann" 
id="jive-aoCHKXMrDrz3EbPN" class="jive-username-link" title="Click to 
view bjoernbergmann's profile">bjoernbergmann</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11858" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11859">
					Thank you. It seems I was not able to read your answer before.<br>
I will try to do it manually using vmkfstools and give you feedback.
					</p>
				</div>
				<a name="comments-11906"></a>
				<div id="comment-11906" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 7:45 AM
						</span>
							<!--<a href="/people/fqu89" title="Click to view fqu89's profile">
<img class="jive-avatar" src="/people/fqu89/avatar/16.png?a=-1" height="16" width="16" title="Click to view fqu89's profile" alt="Click to view fqu89's profile" />
</a>--><a href="http://communities.vmware.com/people/fqu89" 
id="jive-2HRObToySiuUGuJs" class="jive-username-link" title="Click to 
view fqu89's profile">fqu89</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11906">
					Hi,<br>
I think you can greatly reduce the down time of a VM when you power it 
off before doing the backup by doing this:<br>
<br>
1 - take down the VM<br>
2 - create a snapshot<br>
3 - restart the VM<br>
4 - start the backup (without the snapshot files)<br>
5 - remove the snapshot while the VM is on<br>
<br>
The VM is down only the time to do the snapshot<br>
what do you think of this ?
					</p>
				</div>
				<a name="comments-11898"></a>
				<div id="comment-11898" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 5, 2009 8:25 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-KrkHGMeSl9Y5l1FM" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11906" title="Go to message">fqu89</a>
							</em>
					</span>
					<p id="comment-body-11898">
					Majority of the use cases is live backup of a running VM, I don't 
know of many environments that can actually afford to take down their 
VMs/physical systems for backups. Again this option is present in the 
script if you wish to power down your VM, in which case a snapshot is <u>NOT</u>
 required as the VMDK is not locked. A snapshot is only necessary when 
it's running and a VMFS lock is issued and a snapshot will create a 
delta in which the main VMDK will be set to read-only allowing for the 
backup. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11910"></a>
				<div id="comment-11910" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 8:37 AM
						</span>
							<!--<a href="/people/fqu89" title="Click to view fqu89's profile">
<img class="jive-avatar" src="/people/fqu89/avatar/16.png?a=-1" height="16" width="16" title="Click to view fqu89's profile" alt="Click to view fqu89's profile" />
</a>--><a href="http://communities.vmware.com/people/fqu89" 
id="jive-5J8zhCox5v5Yx48M" class="jive-username-link" title="Click to 
view fqu89's profile">fqu89</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11898" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11910">
					I do agree with you that usually, it's not possible to stop VM to 
do backups. <br>
But you're script give the option to stop VM before backing up. <br>
My post was just a little idea to try to minimize the down time of a VM 
IF you can stop it, and don't have to wait that the tons of gigs of the 
VMDK files be copied before restarting the VM.
					</p>
				</div>
				<a name="comments-11915"></a>
				<div id="comment-11915" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 5, 2009 6:55 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-dr1G7V9BlvwaTH8W" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11898" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11915">
					How does GhettoVCB handle VMs that have virtual hard disks on two 
different volumes?<br>
<br>
Thanks!
					</p>
				</div>
				<a name="comments-11922"></a>
				<div id="comment-11922" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 9:11 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-QeDSt7U0U265YOGo" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11915" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-11922">
					ghettoVCB handles it like a champ <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
If you take a look at this document, it provides a list of features, one
 of which is:<br>
<br>
</p><ul>
<li>Fully support VMDK(s) stored across multiple datastores</li>
</ul>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11899"></a>
				<div id="comment-11899" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 5, 2009 10:05 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-dyujl66hFIYU3g1F" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11922" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11899">
					Normally the vmdks are stored with the VMs.  When the backup of a 
VM with a second vmdk on a different disk, does ghetto move the 
secondary vmdk files into the same directory as the other vmdk?
					</p>
				</div>
				<a name="comments-11923"></a>
				<div id="comment-11923" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2009 10:11 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-NJLR4OJsK2O8f7d0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11899" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-11923">
					It moves the VM's VMDK(s) to the backup datastore, it does not 
matter if the VMs disk is spread across multiple datastores. The way 
it's stored in the final backup is if the original disk reside on 
multiple datastores, the backup folder will have a directory for each of
 the datastore and the disk will be backed up into that directory. <br>
<br>
I would highly recommend trying the script out on a dummy/test VM to see
 what the script is capable of. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11917"></a>
				<div id="comment-11917" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 6, 2009 6:39 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-SIH7MqI56m9r9dR0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-11917">
					I think there has been quite a bit of confusion on Thin 
Provisioning, not only with this script which has supported this feature
 for awhile but also in the general forums.<br>
<br>
Within the guestOS, it may show free/unsused space but it does not mean 
that blocks have not been allocated in the past that could have used up 
more space than it's showing. Remember, when you delete something, 
you're just not referencing it anymore, it's still there. Blocks within 
the OS needs to be zeroed out and this is explained in detail from Mr. 
007 himself Duncan Epping at: <a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/">http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/</a><br>
<br>
Thin provisioning does work using <b>vmkfstools</b> but you need to 
ensure you've zeroed out any unused blocks before actually see this when
 trying to backup or even convert a VMDK. <br>
<br>
Hopefully this clears things up<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11928"></a>
				<div id="comment-11928" class="jive-content-comment ">
					<span>
						<span>
							Aug 7, 2009 12:42 AM
						</span>
							<!--<a href="/people/Stephan84" title="Click to view Stephan84's profile">
<img class="jive-avatar" src="/people/Stephan84/avatar/16.png?a=-1" height="16" width="16" title="Click to view Stephan84's profile" alt="Click to view Stephan84's profile" />
</a>--><a href="http://communities.vmware.com/people/Stephan84" 
id="jive-6srlrIIjXJD9CJ7i" class="jive-username-link" title="Click to 
view Stephan84's profile">Stephan84</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11928">
					Hi,<br>
<br>
i am using ghettoVCB4i.sh on ESXi 4.0.0 171294 and have some problemes 
with white spaces in VMs names.<br>
<br>
While executing the Script i get the following errors:<br>
<br>
ls: /vmfs/volumes/Storagesrv01_backups//itorga: No such file or 
directory<br>
ls: backuptrigger: No such file or directory<br>
ls: /vmfs/volumes/Storagesrv01_backups//dnie: No such file or directory<br>
ls: workstation: No such file or directory<br>
<br>
Any ideas?<br>
<br>
Tanks, Stephan
					</p>
				</div>
				<a name="comments-11918"></a>
				<div id="comment-11918" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 7, 2009 8:40 AM
						</span>
							<!--<a href="/people/JamesClark@kennedys" title="Click to view JamesClark@kennedys's profile">
<img class="jive-avatar" src="/people/JamesClark@kennedys/avatar/16.png?a=-1" height="16" width="16" title="Click to view JamesClark@kennedys's profile" alt="Click to view JamesClark@kennedys's profile" />
</a>--><a 
href="http://communities.vmware.com/people/JamesClark%40kennedys" 
id="jive-4K23pLX3NWLRVmnP" class="jive-username-link" title="Click to 
view JamesClark@kennedys's profile">JamesClark@keâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11928" title="Go to message">Stephan84</a>
							</em>
					</span>
					<p id="comment-body-11918">
					Hi William,<br>
<br>
Thanks for such a great script!<br>
<br>
Were using it in an ESXi 3.5 environment. I have presented 380GB iSCSI 
storage to the host as a datastore.<br>
Ive used Starwind to create the iSCSI target. <br>
When I run the script I get:<br>
<br>
/bin # ./ghettoVCB4i.sh servers.txt<br>
Invalid desination disk format 'zeroedthick'<br>
Removing snapshot from (servername)<br>
<br>
The remove snapshot hangs.<br>
There are no lingering snapshots or backups on the server Im testing.<br>
Ive tried changing the format output but get same message with relevent 
storage type name instead of zeroedthick.<br>
Any clues as to why this is failing?<br>
<br>
Thanks,<br>
Perry.
					</p>
				</div>
				<a name="comments-11919"></a>
				<div id="comment-11919" class="jive-content-comment ">
					<span>
						<span>
							Aug 7, 2009 8:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-p44pBON4kmHeBGbS" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11918" title="Go to message">JamesClark@keâ€¦</a>
							</em>
					</span>
					<p id="comment-body-11919">
					Well one thing that should worry you is <b>Invalid desination disk 
format 'zeroedthick'</b>, it looks like you might have not setup the 
right destination format. Please take a look at the document for 
instructions on how to set the output VMDK format (note, it's configured
 as 1,2,3,4)<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11936"></a>
				<div id="comment-11936" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 7, 2009 8:58 AM
						</span>
							<!--<a href="/people/JamesClark@kennedys" title="Click to view JamesClark@kennedys's profile">
<img class="jive-avatar" src="/people/JamesClark@kennedys/avatar/16.png?a=-1" height="16" width="16" title="Click to view JamesClark@kennedys's profile" alt="Click to view JamesClark@kennedys's profile" />
</a>--><a 
href="http://communities.vmware.com/people/JamesClark%40kennedys" 
id="jive-to6K7TtbF4vEPYXt" class="jive-username-link" title="Click to 
view JamesClark@kennedys's profile">JamesClark@keâ€¦</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11936">
					Hi William,<br>
<br>
Thanks for such a great script!<br>
<br>
Were using it in an ESXi 3.5 environment. I have presented 380GB iSCSI 
storage to the host as a datastore.<br>
Ive used Starwind to create the iSCSI target. <br>
When I run the script I get:<br>
<br>
/bin # ./ghettoVCB4i.sh servers.txt<br>
Invalid desination disk format 'zeroedthick'<br>
Removing snapshot from (servername)<br>
<br>
The remove snapshot hangs.<br>
There are no lingering snapshots or backups on the server Im testing.<br>
Ive tried changing the format output but get same message with relevent 
storage type name instead of zeroedthick.<br>
Any clues as to why this is failing?<br>
<br>
Thanks,<br>
Perry.
					</p>
				</div>
				<a name="comments-11950"></a>
				<div id="comment-11950" class="jive-content-comment ">
					<span>
						<span>
							Aug 8, 2009 12:45 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-YRC698iUMee6ESv9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11928" title="Go to message">Stephan84</a>
							</em>
					</span>
					<p id="comment-body-11950">
					Spaces in a VM name is bad! <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Anyway, I think I know is wrong and I just uploaded a new revision of 
ghettoVCB4i.sh which should fix the issue.<br>
<br>
Here is a sample run in our development environment:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">/vmfs/volumes/4a59c382-f2feee8e-0280-005056825b84 # ./ghettoVCB4i.sh backuplist
################## Starting backup for ghettoVCB4i-test-vm-backup ... #####################
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/ghettoVCB4i-test-vm-backup/ghettoVCB4i-test-vm-backup.vmdk'...
Clone: 100% done.
#################### Completed backup for ghettoVCB4i-test-vm-backup! ####################

################## Starting backup for itorga backuptrigger ... #####################
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/itorga backuptrigger/itorga backuptrigger.vmdk'...
Clone: 100% done.
#################### Completed backup for itorga backuptrigger! ####################

################## Starting backup for dnie workstation ... #####################
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/dnie workstation/dnie workstation.vmdk'...
Clone: 100% done.
#################### Completed backup for dnie workstation! ####################
</code></pre><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11983"></a>
				<div id="comment-11983" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 10, 2009 2:41 AM
						</span>
							<!--<a href="/people/Stephan84" title="Click to view Stephan84's profile">
<img class="jive-avatar" src="/people/Stephan84/avatar/16.png?a=-1" height="16" width="16" title="Click to view Stephan84's profile" alt="Click to view Stephan84's profile" />
</a>--><a href="http://communities.vmware.com/people/Stephan84" 
id="jive-dx7kauQ4QjwxF25Y" class="jive-username-link" title="Click to 
view Stephan84's profile">Stephan84</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11950" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-11983">
					Thank you! There are no more error messages.
					</p>
				</div>
				<a name="comments-11967"></a>
				<div id="comment-11967" class="jive-content-comment ">
					<span>
						<span>
							Aug 10, 2009 4:52 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-QIae0mTKTtT0wsv5" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11967">
					Has anybody seen this message?<br>
<br>
ls: /vmfs/volumes/raid/bktst1/bktst1-Snapshot148.vmem.MULTILOCK: No such
 file or directory<br>
<br>
However, backup gets done (snapshots are created and deleted 
successfully and the disk image can be added to the inventory)<br>
so I guess ESXi is to blame rather than the script.
					</p>
				</div>
				<a name="comments-11992"></a>
				<div id="comment-11992" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 12, 2009 7:57 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-tpwUa3fGUeYDHwg2" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10766" title="Go to message">JoeyDE</a>
							</em>
					</span>
					<p id="comment-body-11992">
					<b>Backup log file containing no information problem</b><br>
<br>
The problem is in the Windows batch file.  Do something like this and it
 will work:<br>
<br>
"C:\Program Files\PuTTY\plink.exe" root@xxx.xxx.xxx.xxx -pw MyPassword 
"/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB4i.sh 
/vmfs/volumes/datastore1/ghettoVCB/backup_list &gt; 
/vmfs/volumes/datastore1/ghettoVCB/backuplog.txt &amp;"<br>
<br>
nohup is the problem
					</p>
				</div>
				<a name="comments-11957"></a>
				<div id="comment-11957" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 3:09 AM
						</span>
							<!--<a href="/people/dide2000" title="Click to view dide2000's profile">
<img class="jive-avatar" src="/people/dide2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view dide2000's profile" alt="Click to view dide2000's profile" />
</a>--><a href="http://communities.vmware.com/people/dide2000" 
id="jive-PFJ9XkKDwg1NX9NH" class="jive-username-link" title="Click to 
view dide2000's profile">dide2000</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11957">
					Hi,<br>
<br>
I'm trying to get the script up and runing and already took some hurdles
 but now I'm getting the following error while trying to backup first vm
 :<br>
Failed to open '/vmfs/....mydisk.vmdk' file : failed to lock the file ( 
16392 )<br>
<br>
I have ESXi 4.0. The VM I'm trying to backup is located on a separate 
NFS box ( netgear readynas pro ). The vm is not powered on.<br>
<br>
Any ideas ?<br>
<br>
thx
					</p>
				</div>
				<a name="comments-11979"></a>
				<div id="comment-11979" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 13, 2009 5:36 AM
						</span>
							<!--<a href="/people/dide2000" title="Click to view dide2000's profile">
<img class="jive-avatar" src="/people/dide2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view dide2000's profile" alt="Click to view dide2000's profile" />
</a>--><a href="http://communities.vmware.com/people/dide2000" 
id="jive-eMpyH7MV4y7LUMTG" class="jive-username-link" title="Click to 
view dide2000's profile">dide2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11957" title="Go to message">dide2000</a>
							</em>
					</span>
					<p id="comment-body-11979">
					Resolved: The VM I tried to backup as test was actually booted on 
the main ESXi host ! ( Oops..).<br>
When I use one that is not in use, the script runs correctly.<br>
<br>
Dirk
					</p>
				</div>
				<a name="comments-11960"></a>
				<div id="comment-11960" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 12:17 PM
						</span>
							<!--<a href="/people/willmarmn" title="Click to view willmarmn's profile">
<img class="jive-avatar" src="/people/willmarmn/avatar/16.png?a=-1" height="16" width="16" title="Click to view willmarmn's profile" alt="Click to view willmarmn's profile" />
</a>--><a href="http://communities.vmware.com/people/willmarmn" 
id="jive-4m4nyCU0h4FQaJEB" class="jive-username-link" title="Click to 
view willmarmn's profile">willmarmn</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-11960">
					Is anyone else getting the ^M characters on the downloaded script? 
 I downloaded it onto my NFS share and when I open it up in VI from 
ESXi, it shows all the lines have the ^M characters in them - it has 
never been opened on Windows.  It is the script straight from this 
website.  Otherwise, any ideas on removing them?<br>
<br>
Should mention it is the ghettoVCB.sh script.
					</p>
				</div>
				<a name="comments-12025"></a>
				<div id="comment-12025" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 13, 2009 12:44 PM
						</span>
							<!--<a href="/people/clone0326" title="Click to view clone0326's profile">
<img class="jive-avatar" src="/people/clone0326/avatar/16.png?a=-1" height="16" width="16" title="Click to view clone0326's profile" alt="Click to view clone0326's profile" />
</a>--><a href="http://communities.vmware.com/people/clone0326" 
id="jive-y91AU81lp9JQ9d7H" class="jive-username-link" title="Click to 
view clone0326's profile">clone0326</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12025">
					I'm using ESXi and I was using one NFS datastore for backups 
successfully. I recently switched the NFS storage to a new server, but 
I'm getting an error. I've tried doing just one server at a time, from 3
 different esxi boxes, but it always fails after a few minutes. Are 
there any logs I can check to get a better idea of what's happening, or 
whether this is a network issue? thanks. Here is what I get:<br>
<br>
/vmfs/volumes/4a6efadf-c0cc9be4-7146-000d601a03f2 # ./ghettoVCB4i.sh 
vmbackups<br>
<br>
1. Taking backup snapshot for myserver... ################<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore1/myserver/myserver.vmdk'...<br>
Clone: 66% done.Failed to clone disk : Input/output error (327689).<br>
Removing snapshot from myserver...<br>
ls: /vmfs/volumes/VM_Backups/myserver: Input/output error<br>
<br>
1. Completed backup for myserver! ####################<br>
Start time: Thu Aug 13 19:02:33 UTC 2009<br>
End time: Thu Aug 13 19:22:47 UTC 2009<br>
Duration : 20.23 Minutes<br>
<br>
Completed backing up specified Virtual Machines!
					</p>
				</div>
				<a name="comments-11961"></a>
				<div id="comment-11961" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 12:49 PM
						</span>
							<!--<a href="/people/willmarmn" title="Click to view willmarmn's profile">
<img class="jive-avatar" src="/people/willmarmn/avatar/16.png?a=-1" height="16" width="16" title="Click to view willmarmn's profile" alt="Click to view willmarmn's profile" />
</a>--><a href="http://communities.vmware.com/people/willmarmn" 
id="jive-3xPh1v1HP26tWnV6" class="jive-username-link" title="Click to 
view willmarmn's profile">willmarmn</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11960" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-11961">
					One other note:<br>
I am getting an error saying I am not running 3.5 or 4. (I am running 
3.5.0, 158869).<br>
It appears that modifying the version check in the script to use print 
$5 instead of print $4 has fixed the problem.
					</p>
				</div>
				<a name="comments-11962"></a>
				<div id="comment-11962" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 13, 2009 12:55 PM
						</span>
							<!--<a href="/people/willmarmn" title="Click to view willmarmn's profile">
<img class="jive-avatar" src="/people/willmarmn/avatar/16.png?a=-1" height="16" width="16" title="Click to view willmarmn's profile" alt="Click to view willmarmn's profile" />
</a>--><a href="http://communities.vmware.com/people/willmarmn" 
id="jive-49Qh6IuC1lUXf11K" class="jive-username-link" title="Click to 
view willmarmn's profile">willmarmn</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11960" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-11962">
					dos2unix.org works good to remove the ^M characters.
					</p>
				</div>
				<a name="comments-11963"></a>
				<div id="comment-11963" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 2:24 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Bh6OU7WNIfEU7pbj" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11960" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-11963">
					This should not be the case, I've downloaded the most recent 
version directly to the ESX(i) host several times and it's been fine. 
Are you using ESXi 3.5 or ESXi 4.0? With 4.0, it comes with 'curl' and 
you can donwload it to the host directly.<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-11964"></a>
				<div id="comment-11964" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 13, 2009 2:25 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-OEabvg3B292AMfK3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12025" title="Go to message">clone0326</a>
							</em>
					</span>
					<p id="comment-body-11964">
					This is due to a network connectivity issue, ensure you're not 
saturating your NFS link. Take a look at this VMware KB: <a 
class="jive-link-external" href="http://kb.vmware.com/kb/2116375">http://kb.vmware.com/kb/2116375</a><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12040"></a>
				<div id="comment-12040" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 2:27 PM
						</span>
							<!--<a href="/people/willmarmn" title="Click to view willmarmn's profile">
<img class="jive-avatar" src="/people/willmarmn/avatar/16.png?a=-1" height="16" width="16" title="Click to view willmarmn's profile" alt="Click to view willmarmn's profile" />
</a>--><a href="http://communities.vmware.com/people/willmarmn" 
id="jive-0AGaHU68994UftBF" class="jive-username-link" title="Click to 
view willmarmn's profile">willmarmn</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11963" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12040">
					I am using 3.5, so I am downloading it on a Windows host NFS share 
(not opening it).<br>
I had the old script working fine, but am just upgrading to support my 
future 4 upgrade.  Using that website, I did get it to work, just wanted
 to make sure the file on the server was correct.  I'll just chalk it up
 to my Windows machine somehow.
					</p>
				</div>
				<a name="comments-12041"></a>
				<div id="comment-12041" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 13, 2009 3:12 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-lb3MEtAdKBpx2AwR" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-11961" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-12041">
					Which script is giving you this issue? I think this was fixed in 
the latest ghettoVCB.sh<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12042"></a>
				<div id="comment-12042" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 3:12 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FFSdF9kc2fApNPkK" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12040" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-12042">
					It's good if you're downloading from this VMTN document.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12085"></a>
				<div id="comment-12085" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 13, 2009 11:05 PM
						</span>
							<!--<a href="/people/aj24" title="Click to view aj24's profile">
<img class="jive-avatar" src="/people/aj24/avatar/16.png?a=-1" height="16" width="16" title="Click to view aj24's profile" alt="Click to view aj24's profile" />
</a>--><a href="http://communities.vmware.com/people/aj24" 
id="jive-XL4aRWqAT1L9wz5F" class="jive-username-link" title="Click to 
view aj24's profile">aj24</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12085">
					Hi <br>
<br>
I am using your script to backup thin provisioned disks to an NFS on a 
windows machine however when they are backed to the nfs datastore they 
switch to flat full size vmdk files. I have tried the sdelete script as 
suggested to zero out all the data and also created new virtual machines
 however it still does the same. Is this set-up supported or is there 
anything I could be doing wrong.<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-12086"></a>
				<div id="comment-12086" class="jive-content-comment ">
					<span>
						<span>
							Aug 13, 2009 11:13 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7jB66pBGCIyGztJG" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12085" title="Go to message">aj24</a>
							</em>
					</span>
					<p id="comment-body-12086">
					What version of ESX(i) are you running and how big is the VMDK 
allocated and how much is actually being consumed from the guestOS 
perspective? afaik, when transferring to NFS datastore, it'll alaways be
 thin provisioned. One other thing I would double check is to check the 
NFS datastore free space before the backup and then after and see if 
it's changed, even if the VMDK shows the full size when doing 'ls -lha'<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12058"></a>
				<div id="comment-12058" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 14, 2009 4:59 AM
						</span>
							<!--<a href="/people/tranceking" title="Click to view tranceking's profile">
<img class="jive-avatar" src="/people/tranceking/avatar/16.png?a=-1" height="16" width="16" title="Click to view tranceking's profile" alt="Click to view tranceking's profile" />
</a>--><a href="http://communities.vmware.com/people/tranceking" 
id="jive-i65F2gE1e2e492X1" class="jive-username-link" title="Click to 
view tranceking's profile">tranceking</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12058">
					Is there a modification where we can backup other vmdk in a vm and 
skipping only rdm disk instead of skipping the whole vm.
					</p>
				</div>
				<a name="comments-12072"></a>
				<div id="comment-12072" class="jive-content-comment ">
					<span>
						<span>
							Aug 14, 2009 6:23 AM
						</span>
							<!--<a href="/people/willmarmn" title="Click to view willmarmn's profile">
<img class="jive-avatar" src="/people/willmarmn/avatar/16.png?a=-1" height="16" width="16" title="Click to view willmarmn's profile" alt="Click to view willmarmn's profile" />
</a>--><a href="http://communities.vmware.com/people/willmarmn" 
id="jive-5765EW8TYJaKl33G" class="jive-username-link" title="Click to 
view willmarmn's profile">willmarmn</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12041" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12072">
					It was ghettoVCB.sh downloaded from above on 8/13/09.
					</p>
				</div>
				<a name="comments-12059"></a>
				<div id="comment-12059" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 14, 2009 6:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-RlAh7m67vBfY18O9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12072" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-12059">
					You've only answered the first question .... what about the rest?<br>
<br>
</p><div class="jive-quote">
What version of ESX(i) are you running and how big is the VMDK allocated
 and how much is actually being consumed from the guestOS perspective? 
afaik, when transferring to NFS datastore, it'll alaways be thin 
provisioned. One other thing I would double check is to check the NFS 
datastore free space before the backup and then after and see if it's 
changed, even if the VMDK shows the full size when doing 'ls -lha'<br>
</div>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12075"></a>
				<div id="comment-12075" class="jive-content-comment ">
					<span>
						<span>
							Aug 15, 2009 11:04 AM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-yh2WcU30L6ckMS1M" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12059" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12075">
					I would like to propose the addition of a RUN_AFTER variable.  The 
ability to serialize operations is invaluable.<br>
<br>
Example: After the first set of backups you need another that backs up 
to a different destination and you want to append the output to the same
 log.  After the final backup, you want to sendmail the log content. 
etc.
					</p>
				</div>
				<a name="comments-12064"></a>
				<div id="comment-12064" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2009 11:32 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-c9754J7TLoAzs15l" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-12064">
					The current as of 8/16 script checks the ESXi version. It appears 
to reject ESXi 3.5 or 4. <br>
<br>
Also I have a three disk VM. The vmx file contains the path 
(/vmfs/volumes/9d044c9e-6965e94b etc) to the original third disk. The 
third disk was cloned to the 9d044c9e-6965e94b folder within the backup 
folder. I will run it again to make sure.
					</p>
				</div>
				<a name="comments-12078"></a>
				<div id="comment-12078" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2009 12:45 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1A491KA2iTgs5N4w" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12075" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-12078">
					You can easily create something similar by setting up a cronjob 
that executes a file that contains the various backups that you've 
defined, which can be in a sequential order which accomplishes what 
you're looking for. This is not a backup request but a scheduling 
request. <br>
<br>
e.g.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">cat my_backups
/root/ghettoVCB.sh /root/backuplist1
/root/ghettoVCB.sh /root/backuplist2
/root/ghettoVCB.sh /root/backuplist3
</code></pre><br>
<br>
and <b>my_backups</b> is what would be in your cronjob, this assumes you
 want the various backups to kick off one after a another. <br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12079"></a>
				<div id="comment-12079" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2009 12:46 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-HX44P8eUbM2g1ofL" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12064" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12079">
					The code check might be denying 3i, but 4i is working. I'll have a 
fix for the string later this evening.<br>
<br>
What version of ESX(i) 3.5 and 4.0 are you using?<br>
<br>
Can you please output the following for <b>ALL</b> ESX(i) host's you're 
using the script against by doing the following"<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmware -v
</code></pre><br>
<p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12065"></a>
				<div id="comment-12065" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2009 2:18 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-2cntjD66CMW3K37O" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12079" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12065">
					I noticed it on 4 with the latest patches. Sorry I can't get to the
 4 server right now.
					</p>
				</div>
				<a name="comments-12066"></a>
				<div id="comment-12066" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2009 2:37 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-9tuw2Of0SyBrj9mU" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12065" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12066">
					on the 3 server VMware ESX Server 3i 3.5.0 build-120505<br>
<br>
Not my server but I will update and re run.
					</p>
				</div>
				<a name="comments-12067"></a>
				<div id="comment-12067" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2009 3:09 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-DJD614Gt77MDS21t" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12066" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12067">
					Just updated the server. <br>
<br>
VMware ESX Server 3i 3.5.0 build-176894<br>
/vmfs/volumes/4d074c9e-6965e94b/scripts # ./ghettoVCB.sh backup.daily <br>
You're not running ESX(i) 3.5+ or 4.0+!
					</p>
				</div>
				<a name="comments-12068"></a>
				<div id="comment-12068" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2009 3:15 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-exilWOkiiz34025b" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12067" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12068">
					ESX_VERSION=$(vmware -v | awk '{print $3}') Should be print $5
					</p>
				</div>
				<a name="comments-12080"></a>
				<div id="comment-12080" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2009 6:01 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Ok7f5pyo9YJVsnO1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12068" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12080">
					Yes, I'm aware of the 3i issue and I'll have an update later this 
evening. I'll still be using $3 but doing a different check for 3i since
 with 4i, they've gone back to the version number. <br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12069"></a>
				<div id="comment-12069" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 17, 2009 12:34 AM
						</span>
							<!--<a href="/people/tranceking" title="Click to view tranceking's profile">
<img class="jive-avatar" src="/people/tranceking/avatar/16.png?a=-1" height="16" width="16" title="Click to view tranceking's profile" alt="Click to view tranceking's profile" />
</a>--><a href="http://communities.vmware.com/people/tranceking" 
id="jive-Buf34uM0H0743u52" class="jive-username-link" title="Click to 
view tranceking's profile">tranceking</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12069">
					I have a vm with 2 vmdks one of them is a raw disk , how can I only
 skip that disk instead of skipping the whole vm ?
					</p>
				</div>
				<a name="comments-12082"></a>
				<div id="comment-12082" class="jive-content-comment ">
					<span>
						<span>
							Aug 17, 2009 6:19 AM
						</span>
							<!--<a href="/people/xHaplo" title="Click to view xHaplo's profile">
<img class="jive-avatar" src="/people/xHaplo/avatar/16.png?a=-1" height="16" width="16" title="Click to view xHaplo's profile" alt="Click to view xHaplo's profile" />
</a>--><a href="http://communities.vmware.com/people/xHaplo" 
id="jive-eT1CI3nWL1eI2xCs" class="jive-username-link" title="Click to 
view xHaplo's profile">xHaplo</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12082">
					A terrific script lamw. thanks very much for posting. I am using 
the latest script and cannot get it to backup BOTH VMDKs for a VM. The 
script will always backup the 'myvmname.vmdk' but not the 
'myvmname_1.vmdk'. After injecting some echo's in the script I have 
learning the following:<br>
<br>
The VMDKS_FOUND variable returns the follwoing: scsi0:0.filename 
scsi0:1.filename ide0:0.filename<br>
</p><div class="jive-quote">obviously it is seeing both scsi stores at 
this point</div>
<br>
However the loop 'for DISK in ${VMDKS_FOUND};' only ever iterates once<br>
<br>
if I echo the DISK variable I get (on seperate lines)<br>
scsi0:0.filename <br>
scsi0:1.filename <br>
ide0:0.filename<br>
<p>
</p><div class="jive-quote">Could it be that the script is seeing DISK 
as a string rather than an array and therefore only looping once?</div>
<br>
if this is occuring the following line:<br>
SCSI_ID='echo ${DISK%%.*}'<br>
<br>
will just bite off the first 'scsi0:0' from the string which explains 
why the script works for the first VMDK<br>
<br>
Appreciate any thoughts/comments/suggestions
					
				</div>
				<a name="comments-12093"></a>
				<div id="comment-12093" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 17, 2009 6:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-A2B1t1472WdEOm4M" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-12093">
					This is a known issue, I'll be pushing a fix later this week. Sorry
 for the inconvenience. The reason this is occurring is due to a 
variable declaration that is not defined within the script and this 
definition is crucial to the looping of the VMDK(s) within the script. 
If you would like to remediate this yourselves, you can edit the script 
and add the following to line 193:<br>
<br>
original code:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">IFS='
'
</code></pre><br>
<br>
modified code:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">ORIG_IFS=${IFS}
IFS='
'
</code></pre><br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12095"></a>
				<div id="comment-12095" class="jive-content-comment ">
					<span>
						<span>
							Aug 17, 2009 3:44 PM
						</span>
							<!--<a href="/people/xHaplo" title="Click to view xHaplo's profile">
<img class="jive-avatar" src="/people/xHaplo/avatar/16.png?a=-1" height="16" width="16" title="Click to view xHaplo's profile" alt="Click to view xHaplo's profile" />
</a>--><a href="http://communities.vmware.com/people/xHaplo" 
id="jive-KwC2MmKOfd2dpA4k" class="jive-username-link" title="Click to 
view xHaplo's profile">xHaplo</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12095">
					Thanks William - this appears to work perfectly!<br>
Appreciate your time in posting
					</p>
				</div>
				<a name="comments-12116"></a>
				<div id="comment-12116" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 2:11 PM
						</span>
							<!--<a href="/people/penzipa" title="Click to view penzipa's profile">
<img class="jive-avatar" src="/people/penzipa/avatar/16.png?a=-1" height="16" width="16" title="Click to view penzipa's profile" alt="Click to view penzipa's profile" />
</a>--><a href="http://communities.vmware.com/people/penzipa" 
id="jive-22qlD2OIThN6Xq64" class="jive-username-link" title="Click to 
view penzipa's profile">penzipa</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12116">
					Anyone know why I would get a Your not running ESX(i) 3.5 or 4.0 
when running the ghetoVCB.sh script. I am running Esxi 3.5 update 
176894? This should work right?
					</p>
				</div>
				<a name="comments-12117"></a>
				<div id="comment-12117" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2009 2:22 PM
						</span>
							<!--<a href="/people/willmarmn" title="Click to view willmarmn's profile">
<img class="jive-avatar" src="/people/willmarmn/avatar/16.png?a=-1" height="16" width="16" title="Click to view willmarmn's profile" alt="Click to view willmarmn's profile" />
</a>--><a href="http://communities.vmware.com/people/willmarmn" 
id="jive-d610i6QPN61Yc9a3" class="jive-username-link" title="Click to 
view willmarmn's profile">willmarmn</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12116" title="Go to message">penzipa</a>
							</em>
					</span>
					<p id="comment-body-12117">
					Yes, see comments above:<br>
DSTAVERT  says: in response to: DSTAVERT<br>
ESX_VERSION=$(vmware -v | awk '{print $3}') Should be print $5
					</p>
				</div>
				<a name="comments-12118"></a>
				<div id="comment-12118" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 3:02 PM
						</span>
							<!--<a href="/people/penzipa" title="Click to view penzipa's profile">
<img class="jive-avatar" src="/people/penzipa/avatar/16.png?a=-1" height="16" width="16" title="Click to view penzipa's profile" alt="Click to view penzipa's profile" />
</a>--><a href="http://communities.vmware.com/people/penzipa" 
id="jive-r6u7d7I8d1hd9PMd" class="jive-username-link" title="Click to 
view penzipa's profile">penzipa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12117" title="Go to message">willmarmn</a>
							</em>
					</span>
					<p id="comment-body-12118">
					That did not work, I still get:<br>
ghettoVCB.sh: ghettoVCB.sh: 460 : 3i: not found<br>
You're not running ESX(i) 3.5+ or 4.0+<br>
</p><p>
I made the change to the script above<br>
any assistance is greatly appreciated
					</p>
				</div>
				<a name="comments-12131"></a>
				<div id="comment-12131" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2009 4:44 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-HzyckBHypIHgzIYm" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-12131">
					The logic regarding the version check is as the following:<br>
<br>
Pre-ESX(i) 4.0, the text would read something like the following when 
executing <b>vmware -v</b> "VMware ESX Server 3.5.0 build-163429", to 
get the major release you'll print out column #4<br>
<br>
Post-ESX(i) 4.0, VMware decided to rebrand their hypervisor and remove 
the word <b>Server</b> from <b>vmware -v</b> and if you run this on 4.0 
box you'll get "VMware ESX 4.0.0 build-164009" and as you can see, 
you'll need to now print out column #3<br>
<br>
This gets interesting as with 3i, the version was not <b>3.5.0</b> but 
"3i" and again with 4i, this was not the case and we're back to just 
"4.0.0".<br>
<br>
I have 4 ESX systems I use to verify/test this script agains, unless 
this oddity is occuring in another release, I've tested this against:<br>
<br>
ESX 3.5u4<br>
ESXi 3.5u4<br>
ESX 4.0<br>
ESXi 4.0 <br>
<br>
and they all sucessfully pass the check and execute backups.<br>
<br>
Let me explain the logic, so everyone can understand, since others are 
thinking we need to print out other columns which is not the case:<br>
<br>
First off, I check for 4.0.0 which uses col #3, since both ESX and ESXi 
4.0 use the same version (no 4i crap), I first see if it's 4.0. If it's 
not, then I assume it's running 3.5 which can be any of the various 
flavor/updates + ESXi, in which case, it's column #4. I redefine the <b>ESX_VERSION</b>
 variable to capture the new version and then check for either 3.5.0 
(classic ESX 3.5) or 3i (ESXi) and this <u><b>should</b></u> cover all 
the use cases.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">	ESX_VERSION=$(vmware -v | awk '{print $3}')
        if [ "${ESX_VERSION}" == "4.0.0" ]; then
	        VER=4
        else
		ESX_VERSION=$(vmware -v | awk '{print $4}')
		if [[ "${ESX_VERSION}" == "3.5.0" || "${ESX_VERSION}" == "3i" ]]; then
			VER=3
		else
			echo "You're not running ESX(i) 3.5+ or 4.0+!"
                	exit
		fi
        fi
</code></pre><br>
<br>
This has nothing to do with the brackets/etc. Generally if you're 
comparing 1 value, a single set of brackets is fine and if you're doing 
&amp;&amp; or || than you'll need a double set. <br>
<br>
If for whatever reason people are still running into this issue, can you
 please provide the actual update you're running and please please 
please, post what YOUR system shows when running <b>vmware -v</b>. I've 
noticed everyone is trying to help and provide a fix, but I need to 
understand exactly what is going on and what version YOU ARE running.<br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12132"></a>
				<div id="comment-12132" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 4:54 PM
						</span>
							<!--<a href="/people/zdali" title="Click to view zdali's profile">
<img class="jive-avatar" src="/people/zdali/avatar/16.png?a=-1" height="16" width="16" title="Click to view zdali's profile" alt="Click to view zdali's profile" />
</a>--><a href="http://communities.vmware.com/people/zdali" 
id="jive-o2cJvON1api41LDL" class="jive-username-link" title="Click to 
view zdali's profile">zdali</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12131" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12132">
					Hi William,<br>
vmware -v outputs VMware ESX Server 3i 3.5.0 build-153875<br>
<br>
Code i'm running looks like<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">
	ESX_VERSION=$(vmware -v | awk '{print $3}')
	if [; then
		VER=4
	else
		ESX_VERSION=$(vmware -v | awk '{print $4}')
		if [ || [; then
			VER=3
		else
			echo "You're not running ESX(i) 3.5+ or 4.0+!"
			exit
		fi
	fi

</code></pre><br>
Your logic is bang on here. I suspect the issue lies in the shell 
variable expansion.<br>
<br>
TIA<br>
<br>
dali<br>
<br>
<ul>
<li>Now i only need to figure out how to make the code show up 
properly...</li>
</ul>

					
				</div>
				<a name="comments-12133"></a>
				<div id="comment-12133" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2009 4:59 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1waF4A5LBl7I8NDL" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12132" title="Go to message">zdali</a>
							</em>
					</span>
					<p id="comment-body-12133">
					Can you please wrap your text output in \{code\} tags and actually 
do the following instead:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">sh -x ./ghettoVCB.sh &lt;your_input_list&gt;
</code></pre><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12134"></a>
				<div id="comment-12134" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 5:28 PM
						</span>
							<!--<a href="/people/zdali" title="Click to view zdali's profile">
<img class="jive-avatar" src="/people/zdali/avatar/16.png?a=-1" height="16" width="16" title="Click to view zdali's profile" alt="Click to view zdali's profile" />
</a>--><a href="http://communities.vmware.com/people/zdali" 
id="jive-Ff1RUbWIK91786gx" class="jive-username-link" title="Click to 
view zdali's profile">zdali</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12133" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12134">
					Unmodified script outputs following:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">/scripts # sh -x ghettoVCB1.sh backup_list
+ VM_BACKUP_VOLUME=/vmfs/volumes/backup/tempest
+ VMDK_OUTPUT_FORMAT=1
+ VM_BACKUP_ROTATION_COUNT=3
+ date +%F
+ VM_BACKUP_DIR_NAMING_CONVENTION=2009-08-19
+ POWER_VM_DOWN_BEFORE_BACKUP=0
+ ENABLE_HARD_POWER_OFF=0
+ ITER_TO_WAIT_SHUTDOWN=4
+ ENABLE_COMPRESSION=0
+ ENABLE_NON_PERSISTENT_NFS=0
+ UNMOUNT_NFS=0
+ NFS_SERVER=172.30.0.195
+ NFS_MOUNT=/nfsshare
+ NFS_LOCAL_NAME=nfs_storage_backup
+ NFS_VM_BACKUP_DIR=mybackups
+ DEVEL_MODE=1
+ IS_4I=0
+ [ ! -f /bin/bash ]
+ sanityCheck 1
+ NUM_OF_ARGS=1
+ [ ! 1 == 1 ]
+ [ -f /usr/bin/vmware-vim-cmd ]
+ [ -f /bin/vim-cmd ]
+ VMWARE_CMD=/bin/vim-cmd
+ VMKFSTOOLS_CMD=/sbin/vmkfstools
+ vmware -v
+ awk {print $3}
+ ESX_VERSION=Server
+ [ Server == 4.0.0 ]
+ vmware -v
+ awk {print $4}
+ ESX_VERSION=3i
+ [[ 3i == 3.5.0
sh: missing ]]
+ 3i == 3i ]]
ghettoVCB1.sh: ghettoVCB1.sh: 460: 3i: not found
+ echo You're not running ESX(i) 3.5+ or 4.0+!
You're not running ESX(i) 3.5+ or 4.0+!
+ exit
</code></pre>
					
				</div>
				<a name="comments-12135"></a>
				<div id="comment-12135" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2009 5:45 PM
						</span>
							<!--<a href="/people/zdali" title="Click to view zdali's profile">
<img class="jive-avatar" src="/people/zdali/avatar/16.png?a=-1" height="16" width="16" title="Click to view zdali's profile" alt="Click to view zdali's profile" />
</a>--><a href="http://communities.vmware.com/people/zdali" 
id="jive-f1S450dVI6MO75kw" class="jive-username-link" title="Click to 
view zdali's profile">zdali</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12134" title="Go to message">zdali</a>
							</em>
					</span>
					<p id="comment-body-12135">
					Sorry to double post here, but I seem to fail at editing <img 
class="jive-emoticon" src="DOC-8760_files/sad.gif" alt=":-(" border="0"><br>
<br>
Currently running code <br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">	ESX_VERSION=$(vmware -v | awk '{print $3}')
	if [ "${ESX_VERSION}" == "4.0.0" ]; then
		VER=4
	else
		ESX_VERSION=$(vmware -v | awk '{print $4}')
		if [ "${ESX_VERSION}" == "3.5.0" ] || [ "${ESX_VERSION}" == "3i" ]; then
			VER=3
		else
			echo "You're not running ESX(i) 3.5+ or 4.0+!"
			exit
		fi
	fi
</code></pre><br>
<br>
outputs:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">+ VM_BACKUP_VOLUME=/vmfs/volumes/backup/tempest
+ VMDK_OUTPUT_FORMAT=1
+ VM_BACKUP_ROTATION_COUNT=3
+ date +%F
+ VM_BACKUP_DIR_NAMING_CONVENTION=2009-08-19
+ POWER_VM_DOWN_BEFORE_BACKUP=0
+ ENABLE_HARD_POWER_OFF=0
+ ITER_TO_WAIT_SHUTDOWN=4
+ ENABLE_COMPRESSION=0
+ ENABLE_NON_PERSISTENT_NFS=0
+ UNMOUNT_NFS=0
+ NFS_SERVER=commander.swerve.co.nz
+ NFS_MOUNT=/nfsshare
+ NFS_LOCAL_NAME=nfs_storage_backup
+ NFS_VM_BACKUP_DIR=mybackups
+ DEVEL_MODE=1
+ IS_4I=0
+ [ ! -f /bin/bash ]
+ sanityCheck 1
+ NUM_OF_ARGS=1
+ [ ! 1 == 1 ]
+ [ -f /usr/bin/vmware-vim-cmd ]
+ [ -f /bin/vim-cmd ]
+ VMWARE_CMD=/bin/vim-cmd
+ VMKFSTOOLS_CMD=/sbin/vmkfstools
+ vmware -v
+ awk {print $3}
+ ESX_VERSION=Server
+ [ Server == 4.0.0 ]
+ vmware -v
+ awk {print $4}
+ ESX_VERSION=3i
+ [ 3i == 3.5.0 ]
+ [ 3i == 3i ]
+ VER=3
+ [ 0 -eq 1 ]
+ [ ! -f ]
+ whoami
+ [ ! root == root ]
+ ghettoVCB backup_list
+ VM_INPUT=backup_list
+ date
+ START_TIME=Wed Aug 19 00:38:32 UTC 2009
*snip*
Completed backing up specified Virtual Machines
</code></pre><br>
<br>
I've had less trouble fixing the problem than working out how to use the
 forums <img class="jive-emoticon" src="DOC-8760_files/happy.gif" 
alt=":-)" border="0">  Thanx again for the excellent script.<br>
<br>
dali
					
				</div>
				<a name="comments-12136"></a>
				<div id="comment-12136" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 6:22 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-oTkULxfNgo6hOwa5" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12131" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12136">
					The output for my version <br>
VMware ESX Server 3i 3.5.0 build-120505<br>
3.5 is in the fifth column not fourth. It could be that VMware is 
"messin witcha".
					</p>
				</div>
				<a name="comments-12137"></a>
				<div id="comment-12137" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2009 6:33 PM
						</span>
							<!--<a href="/people/zdali" title="Click to view zdali's profile">
<img class="jive-avatar" src="/people/zdali/avatar/16.png?a=-1" height="16" width="16" title="Click to view zdali's profile" alt="Click to view zdali's profile" />
</a>--><a href="http://communities.vmware.com/people/zdali" 
id="jive-Gb2iV197zwNsLlV5" class="jive-username-link" title="Click to 
view zdali's profile">zdali</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12136" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12137">
					That's precisely why the code checks for both "3.5.0" (4th column 
on ESX) and "3i" (4th column on ESXi) <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":-)" border="0">
					</p>
				</div>
				<a name="comments-12138"></a>
				<div id="comment-12138" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 6:59 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-C2PG0PirtkoD5cN3" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12137" title="Go to message">zdali</a>
							</em>
					</span>
					<p id="comment-body-12138">
					The code didn't check for 3i and 3.5. When I reported a problem on 
the 16th the code read<br>
      if ; then    VER=3 <br>
</p><p>
I was just going by the changelog date and assumed it hadn't changed. <br>
<br>
My apologies for thinking that William couldn't count. <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0">
					</p>
				</div>
				<a name="comments-12102"></a>
				<div id="comment-12102" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2009 7:09 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9gQ67s5ttq4RV7CM" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-12102">
					Okay, I see what's going on and I've pushed a 'fix' for the issue.<br>
<br>
Looks like I had two internal versions and the one I was working on had 
the following (which works):<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">if [ "${ESX_VERSION}" == "3.5.0" ] || [ "${ESX_VERSION}" == "3i" ];
</code></pre><br>
<br>
but the version that was released had the following:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">if [[ "${ESX_VERSION}" == "3.5.0" || "${ESX_VERSION}" == "3i" ]];
</code></pre><br>
<br>
which will not work since it's missing their brackets within each 
comparator. Sorry for the doozy, it should work without any further 
issues.<br>
<br>
Please download the latest version of <b>ghettoVCB.sh</b> and thanks for
 you guys feedback/patience. <br>
<p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12103"></a>
				<div id="comment-12103" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2009 7:11 PM
						</span>
							<!--<a href="/people/penzipa" title="Click to view penzipa's profile">
<img class="jive-avatar" src="/people/penzipa/avatar/16.png?a=-1" height="16" width="16" title="Click to view penzipa's profile" alt="Click to view penzipa's profile" />
</a>--><a href="http://communities.vmware.com/people/penzipa" 
id="jive-j80vOdb3b1pK61fW" class="jive-username-link" title="Click to 
view penzipa's profile">penzipa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12138" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12103">
					Here is my output<br>
<br>
+ VM_BACKUP_VOLUME=/vmfs/volumes/Backup/VMBack_Daily<br>
+ VMDK_OUTPUT_FORMAT=2<br>
+ VM_BACKUP_ROTATION_COUNT=1<br>
+ date +%F<br>
+ VM_BACKUP_DIR_NAMING_CONVENTION=2009-08-19<br>
+ POWER_VM_DOWN_BEFORE_BACKUP=0<br>
+ ENABLE_HARD_POWER_OFF=0<br>
+ ITER_TO_WAIT_SHUTDOWN=4<br>
+ ENABLE_COMPRESSION=1<br>
+ ENABLE_NON_PERSISTENT_NFS=0<br>
+ UNMOUNT_NFS=0<br>
+ NFS_SERVER=172.30.0.195<br>
+ NFS_MOUNT=/nfsshare<br>
+ NFS_LOCAL_NAME=nfs_storage_backup<br>
+ NFS_VM_BACKUP_DIR=mybackups<br>
+ DEVEL_MODE=1<br>
+ IS_4I=0<br>
+ <strike> ! -f /bin/bash </strike><br>
+ sanityCheck 1<br>
+ NUM_OF_ARGS=1<br>
+ <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%21+1+%3D%3D+1+">
 ! 1 == 1 </a><br>
+ <strike> -f /usr/bin/vmware-vim-cmd </strike><br>
+ <strike> -f /bin/vim-cmd </strike><br>
+ VMWARE_CMD=/bin/vim-cmd<br>
+ VMKFSTOOLS_CMD=/sbin/vmkfstools<br>
+ awk {print $5}<br>
+ vmware -v<br>
+ ESX_VERSION=3.5.0<br>
+ <a class="jive-link-external" href="http://%203.5.0%20==%204.0.0%20">http://
 3.5.0 == 4.0.0 </a><br>
+ vmware -v<br>
+ awk {print $5}<br>
+ ESX_VERSION=3.5.0<br>
+ [[ 3.5.0 == 3.5.0<br>
sh: missing ]]<br>
+ 3.5.0 == 3i ]]<br>
ghettoVCB1.sh: ghettoVCB1.sh: 460: 3.5.0: not found<br>
+ echo You're not running ESX(i) 3.5+ or 4.0+!<br>
You're not running ESX(i) 3.5+ or 4.0+!<br>
+ exit
					</p>
				</div>
				<a name="comments-12140"></a>
				<div id="comment-12140" class="jive-content-comment ">
					<span>
						<span>
							Aug 19, 2009 5:01 AM
						</span>
							<!--<a href="/people/aliog" title="Click to view aliog's profile">
<img class="jive-avatar" src="/people/aliog/avatar/16.png?a=-1" height="16" width="16" title="Click to view aliog's profile" alt="Click to view aliog's profile" />
</a>--><a href="http://communities.vmware.com/people/aliog" 
id="jive-wb05IENw0RptAajo" class="jive-username-link" title="Click to 
view aliog's profile">aliog</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12140">
					Great script. Has been really useful. I particularly like the new 
output format option.
					</p>
				</div>
				<a name="comments-12120"></a>
				<div id="comment-12120" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 19, 2009 6:45 AM
						</span>
							<!--<a href="/people/penzipa" title="Click to view penzipa's profile">
<img class="jive-avatar" src="/people/penzipa/avatar/16.png?a=-1" height="16" width="16" title="Click to view penzipa's profile" alt="Click to view penzipa's profile" />
</a>--><a href="http://communities.vmware.com/people/penzipa" 
id="jive-gVEFI83PiAx94bgc" class="jive-username-link" title="Click to 
view penzipa's profile">penzipa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12102" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12120">
					New Script works like a charm, thanks very much for the assistance
					</p>
				</div>
				<a name="comments-12121"></a>
				<div id="comment-12121" class="jive-content-comment ">
					<span>
						<span>
							Aug 19, 2009 6:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-162e5tFlPs5bINL7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12140" title="Go to message">aliog</a>
							</em>
					</span>
					<p id="comment-body-12121">
					np. Thanks for the feedback<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12122"></a>
				<div id="comment-12122" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 19, 2009 6:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-2A6DsWNGGM7r3nbu" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12120" title="Go to message">penzipa</a>
							</em>
					</span>
					<p id="comment-body-12122">
					awesome to hear! Thanks for your feedback<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12123"></a>
				<div id="comment-12123" class="jive-content-comment ">
					<span>
						<span>
							Aug 19, 2009 7:30 AM
						</span>
							<!--<a href="/people/penzipa" title="Click to view penzipa's profile">
<img class="jive-avatar" src="/people/penzipa/avatar/16.png?a=-1" height="16" width="16" title="Click to view penzipa's profile" alt="Click to view penzipa's profile" />
</a>--><a href="http://communities.vmware.com/people/penzipa" 
id="jive-qW3UdSPug78nCiG6" class="jive-username-link" title="Click to 
view penzipa's profile">penzipa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12122" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12123">
					Lamw is there a way to only backup the root disks? I have some VM's
 with disks on different datastores which I do not want to include in 
the backup, as they only contain user data and get backed up with a 
regular windows backup agent.
					</p>
				</div>
				<a name="comments-12141"></a>
				<div id="comment-12141" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 19, 2009 8:04 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-wPXDB7IJG55T0ihE" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12123" title="Go to message">penzipa</a>
							</em>
					</span>
					<p id="comment-body-12141">
					I agree that would be a helpful addition.<br>
<br>
For vmdks that are on different datastores it would be useful to run sed
 against the vmx file to remove the "/vmfs/volumes/${DS_UUID}/" so that 
the vmx file doesn't point to the original disk. <br>
<br>
Really sorry that this probably keeps you up nights. I do voluntary 
support for a small college and I know that they really appreciate your 
efforts. I do as well. <br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-12107"></a>
				<div id="comment-12107" class="jive-content-comment ">
					<span>
						<span>
							Aug 20, 2009 6:08 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-01u3DWHcMct0qGE2" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12078" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12107">
					<b>You can easily create something similar by setting up a cronjob</b><br>
<br>
When I try to do something like this work from a batch file, and 
schedule it, the second backup never executes.<br>
<br>
"C:\Program Files\PuTTY\plink.exe" root@10.17.127.132 -pw MM6ufG6eg 
"/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB4i.sh <br>
/vmfs/volumes/datastore1/ghettoVCB/backup_list &gt; 
/vmfs/volumes/nas-2/log/s2-backuplog.txt2 &amp;"<br>
"/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB4iSingle.sh" 
"/vmfs/volumes/datastore1/ghettoVCB/backupSingle_list &gt;&gt; <br>
/vmfs/volumes/nas-2/log/s2-backuplog.txt &amp;"<br>
<br>
If I do them in two separate batch files, and call plink a second time 
and guess how much time I need for the first one before calling the 
second one, these same commands work, but that's not reliable since it's
 tough to know how long the first one will take.
					</p>
				</div>
				<a name="comments-12143"></a>
				<div id="comment-12143" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 20, 2009 7:58 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Thw9a5fp6H0iQI77" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12107" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-12143">
					A) You're using an old version of the script, I would highly 
recommend using the latest as it has fixes/updates to any previous 
issues/bugs.<br>
B) If you can do this manually and it's successful, then this is an 
issue with your scheduling. <br>
C) I don't know how you're scheduling them on Windows, but to avoid 
contention, you should schedule these to be in sequential order and as 
I've suggested several times, instead of manually calling each of these 
backups, have a script that call these two backups sequentially and all 
you run is just <u>one</u> single script which contains these two within
 the file. <br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12145"></a>
				<div id="comment-12145" class="jive-content-comment ">
					<span>
						<span>
							Aug 20, 2009 8:31 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-hA5ngV47gBEXHQQQ" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12143" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12145">
					<b>&gt;You're using an old version of the script&lt;</b><br>
The script was downloaded from here on August 6.  I'll check if you have
 anything more current than that.  It's so named to match the calls in 
the batch file that was created for an earlier version of the script.  <br>
<br>
<b>&gt;one single script which contains these two within the file&lt;</b><br>
Rather than both in the same batch file script.  I could try that.<br>
<br>
Thanks!
					</p>
				</div>
				<a name="comments-12151"></a>
				<div id="comment-12151" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 21, 2009 2:05 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-0az8814rmCliGCPG" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12145" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-12151">
					T_Architect<br>
You could add some simple conditional things to the ghettoVCB script. I 
add the following to the ghettoVCB script to have a weekly copy in 
another datastore. It wouldn't be hard for you to add other 
conditionals.<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">
if [ "$(date +%A)" = "Saturday" ]; then   
VM_BACKUP_VOLUME=/vmfs/volumes/somewhere_else
else VM_BACKUP_VOLUME=/vmfs/volumes/sameplace
fi
</code></pre><br>
<br>
Problem with this bit is that you would need to add it every time the 
script changes.<br>
<br>
I run ghettoVCB from a script and that script generates the list of VMs 
to clone. I have a list of all VMs that I need to clone regardless of 
the host they are on "globaltobecloned". The script compares the list of
 VMs on the local host "currrentvms" to the globaltobecloned. If a local
 VM is on the globaltobecloned it is added to the local list to be 
cloned and that is what ghettoVCB uses. This way if I move a VM from one
 host to another I don't need to edit a list for each host.<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain"># start
rm /tmp/list
vim-cmd vmsvc/getallvms | awk -F " " '{print $2}' | sed '1,1d' &gt; /tmp/currentvms
for i in `cat /tmp/currentvms` ;do
awk -v var=$i -F, '$1==var' /vmfs/volumes/nfs-datastore/scripts/globaltobecloned &gt;&gt; /tmp/list
done
/vmfs/volumes/nfs-datastore/scripts/ghettoVCB.sh /tmp/list
</code></pre><br>
<br>
You can repeat some of the first part of the script to generate 
different types of lists and add some conditional things inside 
ghettoVCB depending on the name of the list.
					
				</div>
				<a name="comments-12152"></a>
				<div id="comment-12152" class="jive-content-comment ">
					<span>
						<span>
							Aug 21, 2009 3:29 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-P3503r7ooo7mj0N1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12151" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12152">
					This will not be supported, that is what cron and other scheduling 
tools are for. As you've said, it's trivial to add 'your' own 'personal'
 modification, but when you need to support this in the general 
community, this task becomes much larger. Your simplest example is using
 a breakdown of the week M-S. What is someone wants it by the hour, that
 is a huge amount of conditions you're adding ... then what if someone 
wants it hourly or every other day except for odd months 
out,etc,etc...this list can get infinite and adds unnecessary logic to 
the backup script, which can potentially lead to other issues/bugs. <br>
<br>
Again, I've said this several times and I'll continue saying it, the 
purpose of this script is to provide a free generic backup solution that
 individuals can utilize in their ESX(i) environment. Any other 
requirements that fall outside of the actual backup process, users are 
more than welcome to modify/customize the script to fit their 
needs/requirements in their environment. You can <u>easily</u> set this 
up using cron and executing various scheduled backups and why re-invent 
the wheel when a tools such as cron or Windows scheduler is available? <br>
<br>
Thanks for sharing your work but this feature will not be integrated 
into the script.<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12109"></a>
				<div id="comment-12109" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 22, 2009 7:31 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-JD93ao8Xg2lX13qd" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12152" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12109">
					I had no intention of suggesting that this be included at all. My 
comments were directed at IT_Architect who had posted a few steps back 
that they wanted different datastores and different outcomes. I 
appreciate the basic nature of the script and wouldn't want it to become
 otherwise. I was saddened by the need to accommodate spaces in VM names
 but such is life. <br>
<br>
Thanks.
					</p>
				</div>
				<a name="comments-12110"></a>
				<div id="comment-12110" class="jive-content-comment ">
					<span>
						<span>
							Aug 22, 2009 2:07 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-FOz5fk4IvV77NGXh" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12109" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12110">
					<b>I run ghettoVCB from a script and that script generates the list
 of VMs to clone...This way if I move a VM from one host to another I 
don't need to edit a list for each host.</b><br>
<br>
Great idea!  In my situation, I have two servers that cross-backup to 
each other, each with a Windows VM with a NAS on a second virtual disk 
for the backups.  Backing up the two Windows VMs then becomes a special 
case where I must only backup the first virtual disk to avoid storing 
backups of backups on the host they came from.  Thus, I made copy of the
 ghetto script and added a break to the virtual disk loop.  After the 
restore of a Windows VM and before starting it, one must first delete 
the second virtual disk and then re-add it.  The procedure works 
perfectly and there are no issues.<br>
<br>
Against all logic and after several attempts, I was unable to come up 
with a syntax that would enable both backups to execute when stacked in a
 batch file.  Adding an intermediate script as suggested did fix the 
problem and made the batch file syntax a lot less touchy.<br>
<br>
Thanks all!
					</p>
				</div>
				<a name="comments-12178"></a>
				<div id="comment-12178" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 24, 2009 2:20 PM
						</span>
							<!--<a href="/people/cyberfire" title="Click to view cyberfire's profile">
<img class="jive-avatar" src="/people/cyberfire/avatar/16.png?a=-1" height="16" width="16" title="Click to view cyberfire's profile" alt="Click to view cyberfire's profile" />
</a>--><a href="http://communities.vmware.com/people/cyberfire" 
id="jive-7B7vz6YL1fcs3f6C" class="jive-username-link" title="Click to 
view cyberfire's profile">cyberfire</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12178">
					Where is the  ghettoVCB4i file download?
					</p>
				</div>
				<a name="comments-12192"></a>
				<div id="comment-12192" class="jive-content-comment ">
					<span>
						<span>
							Aug 24, 2009 2:22 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Dc8yMUu3O4Ay9L42" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12178" title="Go to message">cyberfire</a>
							</em>
					</span>
					<p id="comment-body-12192">
					Please download the latest version of the script on this document 
which is just <b>ghettoVCB.sh</b>. Take a look at the change log for 
more details on the updates. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">http://twitter.com/lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12211"></a>
				<div id="comment-12211" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 26, 2009 5:57 AM
						</span>
							<!--<a href="/people/Anonymus07" title="Click to view Anonymus07's profile">
<img class="jive-avatar" src="/people/Anonymus07/avatar/16.png?a=-1" height="16" width="16" title="Click to view Anonymus07's profile" alt="Click to view Anonymus07's profile" />
</a>--><a href="http://communities.vmware.com/people/Anonymus07" 
id="jive-Ty2TTh1vuur2KOlb" class="jive-username-link" title="Click to 
view Anonymus07's profile">Anonymus07</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12211">
					Hey Lamn!<br>
Your script is really nice!! Thanks a lot for it!<br>
<br>
Now to my little problem: <br>
Situation as it is now: I'm using an ESXi 3.5 153875. I edited the 
/var/spool/cron/crontabs/root as mentioned by you (see below). And i 
asured that it would survice a reboot. <br>
If I start yout script manually it works fine. <br>
But if the crond runs your script I got the following output in 
/var/log/messages<br>
_______________________<br>
Aug 25 23:55:01 crond<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=1472">1472</a>:
 USER root pid 124920 cmd /vmfs/volumes/volume01/ghettoVCB.sh 
/vmfs/volumes/volume01/backuplist 2&gt;&amp;1 | busybox logger -t 
ghettoVCB4i -p 1<br>
Aug 25 23:55:01 crond<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=1289">1289</a>:
 USER root pid 132147 cmd /vmfs/volumes/volume01/ghettoVCB.sh 
/vmfs/volumes/volume01/backuplist 2&gt;&amp;1 | busybox logger -t 
ghettoVCB4i -p 1<br>
_______________________<br>
If I now do a 'ps|grep cron*' I get this: 1289 1289 busybox crond<br>
<br>
What is this second crond with PID 1472??? And why does it always start 
just nanoseconds after the 'real'(?!) crond with PID 1289?<br>
<br>
I observed that this second crond is also comming up with another task 
defined in the crontab.<br>
________________________<br>
Aug 26 14:40:01 crond<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=1289">1289</a>:
 USER root pid 360693 cmd /sbin/decodeSel.sh #Every 10 minutes, 
translate the latest IPMI SEL data<br>
Aug 26 14:40:01 crond<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=1472">1472</a>:
 USER root pid 360695 cmd /sbin/decodeSel.sh #Every 10 minutes, 
translate the latest IPMI SEL data<br>
________________________<br>
<br>
Here's my crontab as it is right now:<br>
________________________<br>
#syntax : minute hour day month dayofweek command<br>
01 01 * * * /sbin/tmpwatch.sh<br>
01 * * * * /sbin/auto-backup.sh #first minute of every hour (run every 
hour)<br>
00,10,20,30,40,50 * * * * /sbin/decodeSel.sh #Every 10 minutes, 
translate the latest IPMI SEL data<br>
01 * * * * /sbin/vmwarerootwatch.sh #first minute of every hour.<br>
55 23 * * * /vmfs/volumes/volume01/ghettoVCB.sh 
/vmfs/volumes/volume01/backuplist 2&gt;&amp;1 | busybox logger -t 
ghettoVCB4i -p 1<br>
________________________<br>
<br>
Do you have a clue why this second crond is running? It's causing me 
massive problems with my backups! The script runs twice but there's just
 one backup and even worse the backuprotation routine is used twice 
--&gt; so there's just one backup left instead of three.<br>
<br>
Hope you can provide me with some ideas!<br>
Best regards<br>
Grimes
					</p>
				</div>
				<a name="comments-12184"></a>
				<div id="comment-12184" class="jive-content-comment ">
					<span>
						<span>
							Aug 26, 2009 6:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-dg7XXi1ywq7dNmwD" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12211" title="Go to message">Anonymus07</a>
							</em>
					</span>
					<p id="comment-body-12184">
					I recommend you change the time of your backup so you don't run 
into these issues. The IPMI deals with health monitoring of the server 
and this is a default script from VMware and would not recommend 
modifying/changing it. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12236"></a>
				<div id="comment-12236" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 28, 2009 1:00 PM
						</span>
							<!--<a href="/people/etpelle72" title="Click to view etpelle72's profile">
<img class="jive-avatar" src="/people/etpelle72/avatar/16.png?a=-1" height="16" width="16" title="Click to view etpelle72's profile" alt="Click to view etpelle72's profile" />
</a>--><a href="http://communities.vmware.com/people/etpelle72" 
id="jive-Ula22I15lGS3qYIB" class="jive-username-link" title="Click to 
view etpelle72's profile">etpelle72</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12184" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12236">
					(ESXi)<br>
The script seems to backup okay, but it always hangs at "Removing 
snapshot".  The code loops looking for a file with the word "delta" in 
it.  This file is never created though so the loop is infinite. At least
 that is what the problem seems to be.  Am i the only one having this 
problem?
					</p>
				</div>
				<a name="comments-12251"></a>
				<div id="comment-12251" class="jive-content-comment ">
					<span>
						<span>
							Aug 28, 2009 7:10 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-2kn3AwVKq6Ib99s9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12236" title="Go to message">etpelle72</a>
							</em>
					</span>
					<p id="comment-body-12251">
					That's actually incorrect, what the script does is takes a snapshot
 in which a *-delta.vmdk should be created, upon successful backup, the 
script will remove the snapshot. You're right that there is a loop but 
it will only loop if it continues to find a file in the VM directory 
with name "delta". <br>
<br>
When you kick off the script, is the snapshot being taken? Can you 
verify that it has been removed? It could be the case that your snapshot
 is very large and it's taking some time to commmit the changes. Is this
 the only VM with issues? Can you provide some background on this 
specific VM? Size? Are the VMDK(s) all located within the same 
datastore, do you have them spanned over multiple datastores?  <br>
<br>
When commenting on an issue, please be diligent in providing additional 
information other than "its not working" so that I can further assist. 
Thanks<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12252"></a>
				<div id="comment-12252" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 29, 2009 8:22 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-moLPdw2o577D9tXf" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12251" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12252">
					I would like to propose for consideration that ghettoVCB use a 
configuration file that was fed on the command line. All editable 
variables would be contained in the config file. Multiple config files 
could be used for different destinations, different backup lists, 
different nfs stores etc. One script could satisfy any host or 
destination and no direct editing of the script.
					</p>
				</div>
				<a name="comments-12239"></a>
				<div id="comment-12239" class="jive-content-comment ">
					<span>
						<span>
							Aug 29, 2009 12:24 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-Y26alQ4batF704HU" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12252" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12239">
					One small tweak I made is to move the start time to a couple 
different places to include the time to make the snapshot.  The log 
still ends up looking the same.
					</p>
				</div>
				<a name="comments-12240"></a>
				<div id="comment-12240" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 31, 2009 9:44 AM
						</span>
							<!--<a href="/people/etpelle72" title="Click to view etpelle72's profile">
<img class="jive-avatar" src="/people/etpelle72/avatar/16.png?a=-1" height="16" width="16" title="Click to view etpelle72's profile" alt="Click to view etpelle72's profile" />
</a>--><a href="http://communities.vmware.com/people/etpelle72" 
id="jive-qSB01dBrpzeGe4m5" class="jive-username-link" title="Click to 
view etpelle72's profile">etpelle72</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12251" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12240">
					I just tried it again and it seems to be working.  I have no idea 
what I did differently, but it looks good.  The only thing is I never 
see the "-delta.vmdk" mine are named "-0001.vmdk". And the removing 
snapshot didn't take long at all, and the snapshot files were indeed 
removed.
					</p>
				</div>
				<a name="comments-12243"></a>
				<div id="comment-12243" class="jive-content-comment ">
					<span>
						<span>
							Sep 1, 2009 12:29 PM
						</span>
							<!--<a href="/people/clone0326" title="Click to view clone0326's profile">
<img class="jive-avatar" src="/people/clone0326/avatar/16.png?a=-1" height="16" width="16" title="Click to view clone0326's profile" alt="Click to view clone0326's profile" />
</a>--><a href="http://communities.vmware.com/people/clone0326" 
id="jive-8gHaAmExrnC9xn13" class="jive-username-link" title="Click to 
view clone0326's profile">clone0326</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12243">
					What is the process for deleting unwanted backups?  I've tried 
deleting them through the NFS store machine, through the ssh connection,
 and with WinSCP and no matter what it tells me access is denied or that
 the file is in use.  It doesn't matter if I've unshared the store.  Any
 ideas?
					</p>
				</div>
				<a name="comments-12280"></a>
				<div id="comment-12280" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 3, 2009 1:45 AM
						</span>
							<!--<a href="/people/jonasb" title="Click to view jonasb's profile">
<img class="jive-avatar" src="/people/jonasb/avatar/16.png?a=-1" height="16" width="16" title="Click to view jonasb's profile" alt="Click to view jonasb's profile" />
</a>--><a href="http://communities.vmware.com/people/jonasb" 
id="jive-7v96t5UXeH7d8Xlw" class="jive-username-link" title="Click to 
view jonasb's profile">jonasb</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12280">
					Since we often create new machines and move machines around between
 ESX:es we want to make sure ALL machines present on the ESX are backed 
up. Is there any way (or plan) to enable the script to backup ALL 
machines running on the ESX rather then the need to specify all VMs 
manually (like putting "ALL" or "*" in the server list file).
					</p>
				</div>
				<a name="comments-12295"></a>
				<div id="comment-12295" class="jive-content-comment ">
					<span>
						<span>
							Sep 3, 2009 8:37 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-HbQKIpnMTVv0SPzu" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12280" title="Go to message">jonasb</a>
							</em>
					</span>
					<p id="comment-body-12295">
					jonasb<br>
I have that problem as well. I now use a generic script script directory
 that all ESXi hosts have access to. I use a generic script that I add 
to the rc.local on each host. That script generates a new ghettoVCB 
launch script specific to that ESXi host. The launch script first 
generates the list of guests to backup. I have a global list of machines
 to clone and the launch script compares the global list to the local 
list. If a local machine is on the global list I add it to the daily 
backup list and then launch ghettoVCB using that daily list. <br>
<br>
Just a simple script (no error checking or provisions for spaces in 
names) that would create a local list.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/getallvms | awk -F " " '{print $2}' | sed '1,1d' &gt; /tmp/local_vms
ghettoVCB.sh /tmp/local_vms
</code></pre>
					
				</div>
				<a name="comments-12311"></a>
				<div id="comment-12311" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 7, 2009 12:41 AM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-2V7Q0BRWV1E7s82Y" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12311">
					Thanks lamw and others for ghettoVCb - after getting all the errors
 listed on this page it is now running like a dream.<br>
<br>
I have several large (500GB+) vms on ESXi and use ghettoVCB to backup to
 a 2003 NFS ds. Obviously this takes many hours so i installed rsync 
(daemon mode) and this also works well manually.<br>
<br>
Being a noob as well as being a bit thick I would ask for some 
assistance to hack rsync into ghettoVCB since the cloning only really 
needs to be done once - differences after that. I can see that i do not 
need rotation anymore but i still need snapshotting.<br>
<br>
Anyone done this?
					</p>
				</div>
				<a name="comments-12336"></a>
				<div id="comment-12336" class="jive-content-comment ">
					<span>
						<span>
							Sep 8, 2009 12:54 PM
						</span>
							<!--<a href="/people/SIFTU" title="Click to view SIFTU's profile">
<img class="jive-avatar" src="/people/SIFTU/avatar/16.png?a=-1" height="16" width="16" title="Click to view SIFTU's profile" alt="Click to view SIFTU's profile" />
</a>--><a href="http://communities.vmware.com/people/SIFTU" 
id="jive-zww9sg3kuYoe8hkP" class="jive-username-link" title="Click to 
view SIFTU's profile">SIFTU</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12336">
					I am having a problems running the script (ESX 3.5). I downloaded 
it via lwp-download, set it to execute and get the following when I try 
to run it.<br>
<br>
<strike>root@virt-07 xxx</strike># ./ghettoVCB.sh<br>
: command not founde 5:<br>
: command not founde 8:<br>
: command not founde 15:<br>
: command not founde 18:<br>
: command not founde 20:<br>
: command not founde 21:<br>
: command not founde 26:<br>
: command not founde 29:<br>
: command not founde 34:<br>
: command not founde 37:<br>
: command not founde 42:<br>
: command not founde 44:<br>
: command not founde 47:<br>
: command not founde 50:<br>
: command not founde 53:<br>
: command not founde 56:<br>
: command not founde 58:<br>
: command not founde 59:<br>
: command not founde 61:<br>
: command not founde 63:<br>
: command not founde 65:<br>
'/ghettoVCB.sh: line 66: syntax error near unexpected token `{<br>
'/ghettoVCB.sh: line 66: `printUsage() {<br>
</p><p>
Each of the lines mentioned is a blank line. Anyone got any ideas?
					</p>
				</div>
				<a name="comments-12318"></a>
				<div id="comment-12318" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 9, 2009 12:06 AM
						</span>
							<!--<a href="/people/fqu89" title="Click to view fqu89's profile">
<img class="jive-avatar" src="/people/fqu89/avatar/16.png?a=-1" height="16" width="16" title="Click to view fqu89's profile" alt="Click to view fqu89's profile" />
</a>--><a href="http://communities.vmware.com/people/fqu89" 
id="jive-Sx8QeH3sOq3149sU" class="jive-username-link" title="Click to 
view fqu89's profile">fqu89</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12336" title="Go to message">SIFTU</a>
							</em>
					</span>
					<p id="comment-body-12318">
					I think it's because the ghettoVCB.sh file is in DOS format (with 
^M characters at the end of each line)
					</p>
				</div>
				<a name="comments-12321"></a>
				<div id="comment-12321" class="jive-content-comment ">
					<span>
						<span>
							Sep 9, 2009 9:09 AM
						</span>
							<!--<a href="/people/SIFTU" title="Click to view SIFTU's profile">
<img class="jive-avatar" src="/people/SIFTU/avatar/16.png?a=-1" height="16" width="16" title="Click to view SIFTU's profile" alt="Click to view SIFTU's profile" />
</a>--><a href="http://communities.vmware.com/people/SIFTU" 
id="jive-SdG1F4KN1s1Hz4y9" class="jive-username-link" title="Click to 
view SIFTU's profile">SIFTU</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12318" title="Go to message">fqu89</a>
							</em>
					</span>
					<p id="comment-body-12321">
					yes you are correct, I ran the script through dos2unix on a linux 
machine and it now works. Isnt this script designed to be run on a linux
 system anyway? Why would it be in dos format?
					</p>
				</div>
				<a name="comments-12340"></a>
				<div id="comment-12340" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 9, 2009 6:49 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8K5cn5ja0sP11U3y" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12321" title="Go to message">SIFTU</a>
							</em>
					</span>
					<p id="comment-body-12340">
					The method in which you downloaded the script using <b>lwp-download</b>
 probably caused the ^M character to show up versus LF. The script by 
default will work off the bat if downloaded properly and edited within 
ESX(i) console. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12370"></a>
				<div id="comment-12370" class="jive-content-comment ">
					<span>
						<span>
							Sep 10, 2009 9:21 AM
						</span>
							<!--<a href="/people/Rob98" title="Click to view Rob98's profile">
<img class="jive-avatar" src="/people/Rob98/avatar/16.png?a=-1" height="16" width="16" title="Click to view Rob98's profile" alt="Click to view Rob98's profile" />
</a>--><a href="http://communities.vmware.com/people/Rob98" 
id="jive-r5Q68iaM6uXBo4cS" class="jive-username-link" title="Click to 
view Rob98's profile">Rob98</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12370">
					Great Script, thank you.  Though I am having some difficutly 
getting it to work properly while scheduled with cron.<br>
<br>
Running ESXi 4.0 - duplicated on two different machines.<br>
<br>
If I run the script manually, exaclty copying the command I have in the 
crontab, everything runs OK and completes OK.<br>
<br>
However, when the job is run from cron, it fails to remove the snapshot 
and then of course subsequent jobs will not run. Also the backup folder 
is missing the --x naming and the old backups in the rotation are not 
deleted.  The backup log for the job is question shows - "removing 
snapshot", and there is a large number of additional backup logs saying 
"snapshot found, backup will not take place".<br>
<br>
If i go into the vSphere client the snapshot is not visible to delete 
until I restart the management services.  Then the snapshot appears as 
"Consolidate Helper 0".  When I delete the snapshot, the log changes to 
"Complete backing up...." with a duration of the time between the 
scheduled start and when I deleted the snapshot.  Also the backup is 
then named with the --x and the rotation is completed.<br>
<br>
So it looks like for some reason the process is unable to delete the 
snapshot and waits until it is manually deleted before finishing, though
 I don't know why the other logs are appearing.
					</p>
				</div>
				<a name="comments-12373"></a>
				<div id="comment-12373" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 11, 2009 2:13 AM
						</span>
							<!--<a href="/people/cwkoh" title="Click to view cwkoh's profile">
<img class="jive-avatar" src="/people/cwkoh/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwkoh's profile" alt="Click to view cwkoh's profile" />
</a>--><a href="http://communities.vmware.com/people/cwkoh" 
id="jive-6bcK5t23hxj49QE7" class="jive-username-link" title="Click to 
view cwkoh's profile">cwkoh</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12373">
					I need to only backup the first harddisk which has the OS using the
 ghettoVCB script. I read earlier version can do this. Is there any way 
to do the same with the current version of the script? Anybody can help?
					</p>
				</div>
				<a name="comments-12374"></a>
				<div id="comment-12374" class="jive-content-comment ">
					<span>
						<span>
							Sep 11, 2009 3:00 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-oDRTXO970Y1AAri5" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12370" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-12374">
					Hi all,<br>
I have same problem as Rob98
					</p>
				</div>
				<a name="comments-12363"></a>
				<div id="comment-12363" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 11, 2009 8:25 AM
						</span>
							<!--<a href="/people/thinami" title="Click to view thinami's profile">
<img class="jive-avatar" src="/people/thinami/avatar/16.png?a=-1" height="16" width="16" title="Click to view thinami's profile" alt="Click to view thinami's profile" />
</a>--><a href="http://communities.vmware.com/people/thinami" 
id="jive-4q91hUIlpDXJIpBQ" class="jive-username-link" title="Click to 
view thinami's profile">thinami</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12340" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12363">
					Are the compressed backups not supposed to be overwritten after a 
certain number of days specified in the file?  I have noticed that the 
compressed files just continue on.
					</p>
				</div>
				<a name="comments-12353"></a>
				<div id="comment-12353" class="jive-content-comment ">
					<span>
						<span>
							Sep 11, 2009 8:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9EP4BnTNj4lqQG1c" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12373" title="Go to message">cwkoh</a>
							</em>
					</span>
					<p id="comment-body-12353">
					Nope, you miss-read, this is not a supported feature. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12354"></a>
				<div id="comment-12354" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 11, 2009 8:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-mTj6dPV420j13t8l" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12363" title="Go to message">thinami</a>
							</em>
					</span>
					<p id="comment-body-12354">
					It should be rotating based on your rotation settings, default 3 
backups before removing older backups. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12385"></a>
				<div id="comment-12385" class="jive-content-comment ">
					<span>
						<span>
							Sep 11, 2009 8:52 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-i35I6xoXzttySgos" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12370" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-12385">
					Are you running the latest version of the script? If it works 
manually it should work, verify that your cronjob has been setup 
correctly. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12364"></a>
				<div id="comment-12364" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 11, 2009 9:04 AM
						</span>
							<!--<a href="/people/thinami" title="Click to view thinami's profile">
<img class="jive-avatar" src="/people/thinami/avatar/16.png?a=-1" height="16" width="16" title="Click to view thinami's profile" alt="Click to view thinami's profile" />
</a>--><a href="http://communities.vmware.com/people/thinami" 
id="jive-N3O8I5fHI42xNj1N" class="jive-username-link" title="Click to 
view thinami's profile">thinami</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12354" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12364">
					It is not working for compressed files.  I have it set to 3 and I 
have 11 backups for one vm showing.
					</p>
				</div>
				<a name="comments-12375"></a>
				<div id="comment-12375" class="jive-content-comment ">
					<span>
						<span>
							Sep 11, 2009 9:33 AM
						</span>
							<!--<a href="/people/Rob98" title="Click to view Rob98's profile">
<img class="jive-avatar" src="/people/Rob98/avatar/16.png?a=-1" height="16" width="16" title="Click to view Rob98's profile" alt="Click to view Rob98's profile" />
</a>--><a href="http://communities.vmware.com/people/Rob98" 
id="jive-4ax6VsgVCUnTIS5V" class="jive-username-link" title="Click to 
view Rob98's profile">Rob98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12385" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12375">
					AFAIK it is the latest version of the script.  I downloaded it from
 the link on this page, thought the date at the top of the script is 
11/01/2008.<br>
<br>
My cronjob is as follows(minus the quotes):<br>
<br>
"* 22 * * * /vmfs/volumes/datastore1/ghettoVCB.sh 
/vmfs/volumes/datastore1/ghettobackups &gt; 
/vmfs/volumes/datastore1/ghettoVCB-bakcup-$(date +\%s).log"
					</p>
				</div>
				<a name="comments-12386"></a>
				<div id="comment-12386" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 11, 2009 10:44 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Q310D756h25p5Lcf" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12364" title="Go to message">thinami</a>
							</em>
					</span>
					<p id="comment-body-12386">
					I'm confused by your recent comment, your original post asked about
 'compressed files' and now you're saying you're not using compression? 
Are you or are you not enabling compression on the backups? If the 
answer is no, then it should rotate properly. Also a note, if you try to
 manually delete backups, you could screw up the counters. I would 
suggest trying to a new backup and perhaps move the current backups to 
another folder and change the value of rotation to see if it's working 
properly. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12376"></a>
				<div id="comment-12376" class="jive-content-comment ">
					<span>
						<span>
							Sep 11, 2009 10:46 AM
						</span>
							<!--<a href="/people/Rob98" title="Click to view Rob98's profile">
<img class="jive-avatar" src="/people/Rob98/avatar/16.png?a=-1" height="16" width="16" title="Click to view Rob98's profile" alt="Click to view Rob98's profile" />
</a>--><a href="http://communities.vmware.com/people/Rob98" 
id="jive-VVMzH3y8yfTIwB6N" class="jive-username-link" title="Click to 
view Rob98's profile">Rob98</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12376">
					I've come acrros another issue as well.  I have a newly createed 
linux VM, with a thin provisioned 40GB disk.  Currently it is using 2.7 
GB.  When I run the script, with the option set to thin provisioned and 
backing up to a SFU 3.5 NFS server, the backup still comes out to 40GB.
					</p>
				</div>
				<a name="comments-12377"></a>
				<div id="comment-12377" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 11, 2009 11:14 AM
						</span>
							<!--<a href="/people/thinami" title="Click to view thinami's profile">
<img class="jive-avatar" src="/people/thinami/avatar/16.png?a=-1" height="16" width="16" title="Click to view thinami's profile" alt="Click to view thinami's profile" />
</a>--><a href="http://communities.vmware.com/people/thinami" 
id="jive-iia4Abv8eWEcaqOG" class="jive-username-link" title="Click to 
view thinami's profile">thinami</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12386" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12377">
					Sorry.  Bad use of words.  I said it is not working FOR compressed 
files.  I am not deleting files manually but will clear out the folder 
and start out with a fresh run.
					</p>
				</div>
				<a name="comments-12387"></a>
				<div id="comment-12387" class="jive-content-comment ">
					<span>
						<span>
							Sep 11, 2009 1:59 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ob1GWywUnUAkHAKx" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12376" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-12387">
					Please re-read this document and specifically the change log on <b>Update
 (08/08/2009)</b><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12381"></a>
				<div id="comment-12381" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 13, 2009 11:21 AM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-UiPNeyXK81QCqjds" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12376" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-12381">
					It depends on where you view the files as to whether you see the 
true size.  I had the same problem, but I was looking at the files under
 the shell using ssh.  The shell displays the size that it <b>could</b> 
expand to over time.  If you browse the data store using the vSphere 
client, you will see the true size stored.
					</p>
				</div>
				<a name="comments-12382"></a>
				<div id="comment-12382" class="jive-content-comment ">
					<span>
						<span>
							Sep 13, 2009 11:47 AM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-2bz1Hj0tqAC7VXH7" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12370" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-12382">
					So, I am having the same problem where a Snapshot gets stuck in the
 system using the cron job and fails every night.  I can run the script 
manually and everything runs fine, but it only backs up once and then 
fails due to an existing snapshot.  One thing I noticed was 60 log files
 for each day the cron job tried to run.  The cron and crontab 
discussion above may be in error.  If you want it to run once a day 
during the week at a certain time the entry above says:<br>
<br>
"* 0 * * 1-5"<br>
<br>
but in reality that means to run it every minute with an hour that 
equals 0.  So it will run at 12:00, 12:01, 12:02, etc.  I'm not 
positive, but I think the problem with the extra snapshot may be due to 
multiple instances running 60 seconds apart.  Shouldn't it be:<br>
<br>
"01 0 * * 1-5" <br>
<br>
Which would run one time at 12:01 AM?  I'll let you know if it resolves 
the snapshot issue I was having similar to Rob98.
					</p>
				</div>
				<a name="comments-12366"></a>
				<div id="comment-12366" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 13, 2009 1:44 PM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-Wd5zQAq2o7HfaLAr" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12382" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12366">
					Hi winterg,<br>
yes, you're right, however I have setting the cron like this:<br>
5 4 * * 2-6<br>
and I have problem as Rob98 still.<br>
I am not sure but i think that cron job worked without any problems if 
not exist previous backup directory...
					</p>
				</div>
				<a name="comments-12393"></a>
				<div id="comment-12393" class="jive-content-comment ">
					<span>
						<span>
							Sep 13, 2009 4:18 PM
						</span>
							<!--<a href="/people/Rob98" title="Click to view Rob98's profile">
<img class="jive-avatar" src="/people/Rob98/avatar/16.png?a=-1" height="16" width="16" title="Click to view Rob98's profile" alt="Click to view Rob98's profile" />
</a>--><a href="http://communities.vmware.com/people/Rob98" 
id="jive-gA6MAqAD93j3OKw2" class="jive-username-link" title="Click to 
view Rob98's profile">Rob98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12366" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-12393">
					Yeah, I think vlho is on to something.  I tried the cron with the 
minute specifed, but that didn't sovle the problem.  Then I noticed that
 my file listing the vm's had a blank line in it.  So I recreated the 
file making sure there where no blank lines.  I thought this had fixed 
the problem as the first scheduled backup ran fine.  However, subsequent
 ones failed and I beleive I changed the output format at the same time 
as I recreated the backup list, which would have caused it to start the 
backups fresh.  So the first backup succeded, but everything since then 
has changed.  I'll try changing the backup format again on one of my 
machines and see what the result is.
					</p>
				</div>
				<a name="comments-12397"></a>
				<div id="comment-12397" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 13, 2009 8:38 PM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-2g2PKRwlcFJdNrxM" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12393" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-12397">
					So it still leaves the -delta and -00001 files behind in the 
consolidate-helper snapshot, preventing future backups.  So, a little 
more about my set-up:  <br>
<br>
</p><ul class="jive-dash">
<li>I'm running ESXi 4.0 free and backing up one Guest server running 
Windows 2000 server.</li>
</ul>
<br>
<ul class="jive-dash">
<li>I converted from a thick to a thin provisioned disk on the VM guest 
after creation.  So it is a thin provisioned disk that is backed up to a
 thin provisioned backup image stored on a locally attached datastore 
(External Sata drive).</li>
</ul>
<br>
<ul class="jive-dash">
<li>I was backing up the Guest Windows 2000 server <b>without</b> 
shutting down the server.</li>
</ul>
<br>
<ul class="jive-dash">
<li>I am not using compression, because it doesn't work for me under 
ESXi 4.0 (a separate issue).</li>
</ul>
<br>
I also have an NFS NAS and am working on setting that up now.  I'm 
testing with the guest shutting down now and suspect it will work.  I'm 
just curious why it will not work while running.<br>
<br>
My testing did confirm that the crontab entry in the text near the top 
of this page needs corrected to include a number for the minute in the 
first column of the crontab entry, otherwise it will run on every minute
 in the selected hour.
					
				</div>
				<a name="comments-12368"></a>
				<div id="comment-12368" class="jive-content-comment ">
					<span>
						<span>
							Sep 14, 2009 6:21 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-1tjl9lbhHrH76L35" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12397" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12368">
					Hi all,<br>
one relevant thing<br>
<br>
I see in my logs (/var/log/messages etc.) this records:<br>
Sep 10 04:05:01 crond<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=5319">5319</a>:
 USER root pid 3976380 cmd /vmfs/volumes/local/_prog/ghettoDS ... <br>
Sep 10 04:05:01 crond<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=5287">5287</a>:
 USER root pid 3980501 cmd /vmfs/volumes/local/_prog/ghettoDS ...<br>
<br>
I don't see why job run twice but I'd say he that this is reason for 
described problem.<br>
File /var/spool/cron/crontabs/root contains only this lines:<br>
#syntax : minute hour day month dayofweek command <br>
01 01 * * * /sbin/tmpwatch.sh<br>
01 * * * * /sbin/auto-backup.sh #first minute of every hour (run every 
hour)<br>
5 4 * * 2-6 /vmfs/volumes/local/_prog/ghettoDS ...<br>
<br>
Any idea?<br>
Thanks.
					</p>
				</div>
				<a name="comments-12416"></a>
				<div id="comment-12416" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 14, 2009 9:57 PM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-j8rqW6NYcHh7y1D4" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12368" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-12416">
					So, based on your reply, I checked the processes running via the 
ssh console using ps -c | grep crond.  The output is:<br>
<br>
5120 5120 busybox              crond<br>
5141 5141 busybox              /bin/busybox crond -b<br>
<br>
I think the rc.local entry above in the article might be in error.  I 
don't think "crond -b" is accomplishing the intended goal.  It appears 
to run a second copy of crond, which may be causing the problem.  I'm 
testing again with only one copy runnning.  I deleted the crond -b from 
the rc.local and instead did a kill -HUP (process id of crond) to 
re-read the crontab file.  I'll let you know how it turns out.<br>
<br>
Shutting down the guest O/S avoided the problems with the snapshot 
lingering, but I'd rather leave the guest running.
					</p>
				</div>
				<a name="comments-12417"></a>
				<div id="comment-12417" class="jive-content-comment ">
					<span>
						<span>
							Sep 14, 2009 11:00 PM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-SxKsT3JbJM29l7CB" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12368" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-12417">
					So, after manually killing both crond processes and starting only 
one copy seemed to work this time.  If I didn't kill off both, the old 
crond did not re-read the crontab file into memory. So, how do we modify
 the /etc/rc.local entries above to adjust for this?  One thought is to 
get rid of the crond -b in the rc.local and kill the original crond only
 to restart it immediately using the following in rc.local:<br>
<br>
kill `cat /var/run/crond.pid` ; crond<br>
<br>
I haven't tried this yet, but will add it in and see what happens 
tomorrow.
					</p>
				</div>
				<a name="comments-12431"></a>
				<div id="comment-12431" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 15, 2009 10:32 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-S4mvI0yFplWN2o2T" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12417" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12431">
					Thanks for all your investigations, been really busy these last few
 days. I think that definitely makes sense and you're right when you 
issue <b>crond -b</b> (-b runs in the background, which you probably 
want when restarting), creates another cron daemon process. Let me know 
what you end up finding out and I'll be more than happy to update the 
documentation.<br>
<br>
The line you probably want to add at the end of rc.local including the 
cron job is:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">kill $(cat /var/run/crond.pid)
crond -b
</code></pre><br>
<br>
You can also probably just search for all <b>crond</b> running and kill 
those prior to restarting using <b>ps ef</b>, but assuming you're not 
manually touching the system, what you've provided should work.<br>
<br>
Also here is a list of options to crond if you're not aware of already:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # busybox crond --help
BusyBox v1.9.1-VMware-visor-654 (2008-12-17 10:01:32 PST) multi-call binary

Usage: crond -d[#] -c crondir -f -b

        -d [#] -l [#] -S -L logfile -f -b -c dir
        -d num  Debug level
        -l num  Log level (8 - default)
        -S      Log to syslog (default)
        -L file Log to file
        -f      Run in foreground
        -b      Run in background (default)
        -c dir  Working dir
</code></pre><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12432"></a>
				<div id="comment-12432" class="jive-content-comment ">
					<span>
						<span>
							Sep 16, 2009 1:09 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-M4MvWYqTruQ6sqgq" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12417" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12432">
					Hi winterg<br>
your solution is works (only ESXi 4), thanks !<br>
<br>
For ESXi 3.5 you usage:<br>
<br>
kill `pidof crond` ; crond -b
					</p>
				</div>
				<a name="comments-12447"></a>
				<div id="comment-12447" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 16, 2009 8:09 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-DI6N4Tn08c7A92Op" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12432" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-12447">
					Hi all,<br>
next option for restart crond<br>
<br>
kill -HUP `pidof crond`<br>
   i.e. without crond -b<br>
<br>
I think that this is better and cleaner than the last...
					</p>
				</div>
				<a name="comments-12433"></a>
				<div id="comment-12433" class="jive-content-comment ">
					<span>
						<span>
							Sep 16, 2009 8:52 AM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-323FYgwoB82o8e2C" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12447" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-12433">
					Either works fine to kill the running process, I'm just glad it 
works.  It has run two nights in a row without fail.  I restart crond 
without the -b for two reasons:<br>
<br>
</p><ul class="jive-dash">
<li>The -b is already the default behavior without the switch</li>
<li>the original process that is started doesn't use it and I wanted it 
to mirror what VMware was doing at start-up. </li>
</ul>
<br>
Hopefully lamw will update the article text for the crontab time entry 
(to include the minute) and the restart of crond so that others don't 
suffer the same issues.  <br>
<br>
Now on to my next issue...  Does anyone have compression working on ESXi
 4.0 free?  It fails every time I enable compression.  I haven't looked 
into it yet as I needed to fix the bigger problems first and wondered if
 anyone else had it working.
					
				</div>
				<a name="comments-12434"></a>
				<div id="comment-12434" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 16, 2009 3:47 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-T1AJq89dTX73lyHW" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12433" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12434">
					I can confirm that compression works without problems in esxi 4.0.0
 181792 but I do not use it because of the extra time it adds to the 
backup process. You don't say what the error is?
					</p>
				</div>
				<a name="comments-12448"></a>
				<div id="comment-12448" class="jive-content-comment ">
					<span>
						<span>
							Sep 16, 2009 3:56 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-b8E6xYh4MoJs419w" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12433" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12448">
					winterg, thanks for all the feedback and work you've put in, I'll 
update the document tonight if I get some time.<br>
<br>
Regarding compression, it should work, I know few people out there that 
are using it including my colleague in UCSB <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"> What issues are you 
having? Can you elaborate? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12451"></a>
				<div id="comment-12451" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 16, 2009 9:12 PM
						</span>
							<!--<a href="/people/winterg" title="Click to view winterg's profile">
<img class="jive-avatar" src="/people/winterg/avatar/16.png?a=-1" height="16" width="16" title="Click to view winterg's profile" alt="Click to view winterg's profile" />
</a>--><a href="http://communities.vmware.com/people/winterg" 
id="jive-SUL5PvGxf78718g4" class="jive-username-link" title="Click to 
view winterg's profile">winterg</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12448" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12451">
					So every time I try to backup I get the following.  There is plenty
 of storage available according to df -k.<br>
<br>
"################ Taking backup snapshot for hostname.temp-dom.local ...
 ################"<br>
Start time: Thu Sep 17 03:36:16 UTC 2009<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk 
'/vmfs/volumes/SAS-Datastore1/hostname.temp-dom.local/hostname.temp-dom.local.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from hostname.temp-dom.local ...<br>
Compressing VM backup 
"/vmfs/volumes/External-eSata1/host-backups/hostname.temp-dom.local/hostname.temp-dom.local-2009-09-17.gz"...<br>
tar: cannot store file 
'hostname.temp-dom.local-2009-09-17/hostname.temp-dom.local-flat.vmdk' 
of size 107389255680, aborting<br>
End time: Thu Sep 17 03:49:09 UTC 2009<br>
"#################### Completed backup for hostname.temp-dom.local! 
####################"<br>
</p><p>
Start time: Thu Sep 17 03:36:13 UTC 2009<br>
End   time: Thu Sep 17 03:49:09 UTC 2009<br>
Duration  : 12.93 Minutes<br>
<br>
Completed backing up specified Virtual Machines!<br>
<br>
I cleaned out the destination directory to make sure no other backups 
where in the system.
					</p>
				</div>
				<a name="comments-12452"></a>
				<div id="comment-12452" class="jive-content-comment ">
					<span>
						<span>
							Sep 16, 2009 9:13 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-wp2fjHyBxKGjkB3U" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12451" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12452">
					I would suggest in the future if you post output to wrap it in code
 tags, makes it much more readable <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
Regarding thin provisioning, take a look at my response back on Aug 6:<br>
<br>
</p><div class="jive-quote">
I think there has been quite a bit of confusion on Thin Provisioning, 
not only with this script which has supported this feature for awhile 
but also in the general forums.<br>
<br>
Within the guestOS, it may show free/unsused space but it does not mean 
that blocks have not been allocated in the past that could have used up 
more space than it's showing. Remember, when you delete something, 
you're just not referencing it anymore, it's still there. Blocks within 
the OS needs to be zeroed out and this is explained in detail from Mr. 
007 himself Duncan Epping at: <a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/">http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/</a><br>
<br>
Thin provisioning does work using vmkfstools but you need to ensure 
you've zeroed out any unused blocks before actually see this when trying
 to backup or even convert a VMDK.<br>
<br>
Hopefully this clears things up<br>
</div>
<br>
Now onto the compression, it looks like the compression is in fact 
starting, but it fails to store the backup. If you still have the 
backup, can you see if you can manually compress it? I've not seen this 
error before but it may be complaining about the size of the file, 
perhaps a limitation in the version of tar in ESX (would not surprise 
me). Secondly, are you backing this up to a VMFS volume? What is the 
blocksize you've set, remember that blocksize on a given volume will 
dictate how a big a file can be and you want to make sure you're not 
exceeding any of those limits. <br>
<br>
I should be updating the documentation regarding the cron information 
but unfortunately our development system is down at moment for some new 
hardware upgrades and I want to confirm a few things before posting the 
changes, depending if it's up later tonight, the post may be postponed 
till tomorrow. <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12474"></a>
				<div id="comment-12474" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 19, 2009 8:48 AM
						</span>
							<!--<a href="/people/kanngoo" title="Click to view kanngoo's profile">
<img class="jive-avatar" src="/people/kanngoo/avatar/16.png?a=-1" height="16" width="16" title="Click to view kanngoo's profile" alt="Click to view kanngoo's profile" />
</a>--><a href="http://communities.vmware.com/people/kanngoo" 
id="jive-635zRsiMj4bL68A4" class="jive-username-link" title="Click to 
view kanngoo's profile">kanngoo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12417" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-12474">
					hello,<br>
<br>
i use esxi 4.0 and want to set up the cronejob correct. when i use the 
script manual it woks fine.<br>
when i make a cronjob now an then add the necessary lines in the 
/etc/rc.local is this example correct?<br>
<br>
~ # cat /etc/rc.local<br>
#! /bin/ash<br>
export PATH=/sbin:/bin<br>
<br>
log() {<br>
   echo "$1"<br>
   logger init "$1"<br>
}<br>
<br>
#execute all service retgistered in /etc/rc.local.d<br>
if <a class="jive-link-external" 
href="http://%20-d%20/etc/rc.local.d%20">http:// -d /etc/rc.local.d</a>;
 then<br>
   for filename in `find /etc/rc.local.d/ | sort`<br>
      do<br>
         if <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+-f+%24filename+">
 -f $filename </a> &amp;&amp; <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+-x+%24filename+">
 -x $filename </a>; then<br>
            log "running $filename"<br>
            $filename<br>
         fi<br>
      done<br>
fi<br>
<br>
/bin/echo "* 0 * * 1-5 
/vmfs/volumes/simplejack-local-storage/ghettoVCB.sh 
/vmfs/volumes/simplejack-local-storage/backuplist &gt; 
/vmfs/volumes/simplejack-local-storage/ghettoVCB-backup-\$(date +<br 
clear="all">%s).log" &gt;&gt; /var/spool/cron/crontabs/root<br>
/bin/busybox crond -b<br>
<br>
kill `cat /var/run/crond.pid` ; crond
					</p>
				</div>
				<a name="comments-12475"></a>
				<div id="comment-12475" class="jive-content-comment ">
					<span>
						<span>
							Sep 19, 2009 9:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-dUAuu8KLRf44SDln" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12474" title="Go to message">kanngoo</a>
							</em>
					</span>
					<p id="comment-body-12475">
					Please always use code tags to wrap your console output, makes 
reading much easier.<br>
<br>
I haven't had time to update the document with the latest changes 
mentioned in the last few replies, I'm currently out of town.<br>
<br>
Regarding the changes for cron to work, you need to first kill the cron 
daemon first ... then issue the updates and restart (without -b)<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">kill $(cat /var/run/crond.pid)
/bin/echo "* 0 * * 1-5 /vmfs/volumes/simplejack-local-storage/ghettoVCB.sh /vmfs/volumes/simplejack-local-storage/backuplist &gt; /vmfs/volumes/simplejack-local-storage/ghettoVCB-backup-\$(date +
%s).log" &gt;&gt; /var/spool/cron/crontabs/root
/bin/busybox crond 
</code></pre><br>
<br>
You may also want to specify the full path to where kill is located it 
at, I believe it might be in /bin<br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12477"></a>
				<div id="comment-12477" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 21, 2009 8:59 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-bMKKh3R1bS8IkDH6" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12477">
					I try to use this scipt to do backup with compression enabled.<br>
Howerver, I cannot uncompress "filename".gz as it show "tar: Invalid tar
 magic".<br>
<br>
Currently, I use ESX 3.5i U4 free edition and backup it to local drive 
of ESX server itself.<br>
<br>
Any thought about the issue?<br>
<br>
Thank you
					</p>
				</div>
				<a name="comments-12506"></a>
				<div id="comment-12506" class="jive-content-comment ">
					<span>
						<span>
							Sep 21, 2009 11:06 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9LQFHMiFlU83u2DV" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12477" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12506">
					Can you please provide the full command you're using to uncompress 
the backup?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12478"></a>
				<div id="comment-12478" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 21, 2009 11:26 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-83106yql5g4ARXCi" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12506" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12478">
					1.) # gunzip &lt; 
/vmfs/volumes/datastore1/backup/vm1/vm1-2009-09-22--1.gz | tar xvf - -C 
/vmfs/volumes/datastore1/restore<br>
<br>
and<br>
<br>
2.) # gunzip &lt; /vmfs/volumes/nfs/backup/vm1/vm1-2009-09-22--1.gz | 
tar xvf - -C /vmfs/volumes/datastore<br>
<br>
I try to backup and uncompress in 2 scenarios 1.) on local hard disk, 
2.) on nfsshare <br>
both give me "tar: Invalid tar magic"<br>
<br>
Thank you
					</p>
				</div>
				<a name="comments-12480"></a>
				<div id="comment-12480" class="jive-content-comment ">
					<span>
						<span>
							Sep 22, 2009 6:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-exQ3PXyK8j235kvU" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12478" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12480">
					Perhaps <b>tar</b> changed between ESXi 3.5u4 and ESXi 4.0 .... I 
would need to replicate this in our dev environment and see what I get. 
I'll get back to you on this one, need to find some free cycles to test.
 <br>
<br>
Thanks for reporting this.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12481"></a>
				<div id="comment-12481" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 22, 2009 10:16 AM
						</span>
							<!--<a href="/people/kanngoo" title="Click to view kanngoo's profile">
<img class="jive-avatar" src="/people/kanngoo/avatar/16.png?a=-1" height="16" width="16" title="Click to view kanngoo's profile" alt="Click to view kanngoo's profile" />
</a>--><a href="http://communities.vmware.com/people/kanngoo" 
id="jive-fT5G0bvzNYzs2M50" class="jive-username-link" title="Click to 
view kanngoo's profile">kanngoo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12474" title="Go to message">kanngoo</a>
							</em>
					</span>
					<p id="comment-body-12481">
					hi,<br>
<br>
backup and cronjob with esxi 4.0 works great.<br>
<br>
thanks<br>
kanngoo
					</p>
				</div>
				<a name="comments-12482"></a>
				<div id="comment-12482" class="jive-content-comment ">
					<span>
						<span>
							Sep 22, 2009 7:53 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-HuNQyjgLxr03RDgW" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12481" title="Go to message">kanngoo</a>
							</em>
					</span>
					<p id="comment-body-12482">
					Thanks for the comments and glad it's working!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12511"></a>
				<div id="comment-12511" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 22, 2009 9:48 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Ew5N1pQP6MDVXMWq" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12478" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12511">
					Interesting, it works for me on ESXi 3.5u4<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">~ # vmware -v
VMware ESX Server 3i 3.5.0 build-153875

~ # gunzip &lt; /vmfs/volumes/datastore1/WILLIAM_BACKUPS/test/test-2009-09-22--1.gz | tar xvf - -C /vmfs/volumes/datastore1/
test-2009-09-22/
test-2009-09-22/test.vmx
test-2009-09-22/test-flat.vmdk
test-2009-09-22/test.vmdk
</code></pre><br>
<br>
I executed this at the root of Busybox and it works perfectly fine for 
me.<br>
<br>
What version of gunzip and tar is displaying for your version of ESXi?<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # gunzip -v
gunzip: invalid option -- v
BusyBox v1.2.1 (2008.06.26-17:58+0000) multi-call binary

Usage: gunzip [OPTION]... FILE

Uncompress FILE (or standard input if FILE is '-').

Options:
        -c      Write output to standard output
        -f      Force read when source is a terminal
        -t      Test compressed file integrity
</code></pre><br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">~ # tar -v
BusyBox v1.2.1 (2008.06.26-17:58+0000) multi-call binary

Usage: tar -[czxtvO] [-f TARFILE] [-C DIR] [FILE(s)] ...

Create, extract, or list files from a tar file.

Options:
        c               create
        x               extract
        t               list

Archive format selection:
        z               Filter the archive through gzip

File selection:
        f               name of TARFILE or "-" for stdin
        O               extract to stdout
        C               change to directory DIR before operation
        v               verbosely list files processed
</code></pre><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12486"></a>
				<div id="comment-12486" class="jive-content-comment ">
					<span>
						<span>
							Sep 23, 2009 8:41 AM
						</span>
							<!--<a href="/people/Kabs123" title="Click to view Kabs123's profile">
<img class="jive-avatar" src="/people/Kabs123/avatar/16.png?a=-1" height="16" width="16" title="Click to view Kabs123's profile" alt="Click to view Kabs123's profile" />
</a>--><a href="http://communities.vmware.com/people/Kabs123" 
id="jive-j0lxYP2KGMz6538C" class="jive-username-link" title="Click to 
view Kabs123's profile">Kabs123</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12486">
					Hi William,<br>
<br>
thank you for the nice script. There is just something wrong with my 
settings. Can you help me please?<br>
I get the following message, what does it mean:<br>
<br>
DEVEL_MODE=0<br>
<br>
printUsage() {<br>
        SCRIPT_PATH=$(basename $0)<br>
        echo -e "\nUsage: ${SCRIPT_PATH} <a 
class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_FILE_INPUT">VM_FILE_INPUT</a>\n"<br>
/vmfs/volumes/4a3bec10-5b0ef122-e3cb-001777642eb1/backupscript # 
./ghettoVCB.sh vmbackups<br>
(vim.fault.AlreadyExists) {<br>
   dynamicType = &lt;unset&gt;,<br>
   faultCause = (vmodl.MethodFault) null,<br>
   name = "/vmfs/volumes/b22ca6b3-931cd49f",<br>
   msg = "The specified key, name, or identifier already exists.",<br>
}<br>
Snapshot found for xvm3_1, backup will not take place
					</p>
				</div>
				<a name="comments-12495"></a>
				<div id="comment-12495" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 23, 2009 1:43 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-U4HLJQYYuTjJb9yJ" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12486" title="Go to message">Kabs123</a>
							</em>
					</span>
					<p id="comment-body-12495">
					It looks like the error is:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">Snapshot found for xvm3_1, backup will not take place 
</code></pre><br>
<br>
Please take a look at FAQ #10<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12516"></a>
				<div id="comment-12516" class="jive-content-comment ">
					<span>
						<span>
							Sep 23, 2009 5:38 PM
						</span>
							<!--<a href="/people/cookieme" title="Click to view cookieme's profile">
<img class="jive-avatar" src="/people/cookieme/avatar/16.png?a=-1" height="16" width="16" title="Click to view cookieme's profile" alt="Click to view cookieme's profile" />
</a>--><a href="http://communities.vmware.com/people/cookieme" 
id="jive-PjHG8zOnM7h6IpXT" class="jive-username-link" title="Click to 
view cookieme's profile">cookieme</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10373" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12516">
					Is it possible to remotely kick-off the script from an Ubuntu VM 
with vCLI installed instead of enabling SSH through the unsupported 
mode? The reason I'm asking is that with your ghettoVCBg2 script you are
 using the vMA which has vi-fastpass for authentication and so does not 
require SSH. So without vMA and fastpass is there a command in the vCLI 
that can run the script located on the local datastore or shared storage
 although it might prompt for credentials?<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-12487"></a>
				<div id="comment-12487" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 23, 2009 7:27 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-Qyd95vcRx6LeB5Af" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12511" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12487">
					Hi,<br>
<br>
here is my VMWare Version<br>
~ # vmware -v<br>
VMware ESX Server 3i 3.5.0 build-153875<br>
</p><p>
Here is my tar and gunzip version<br>
<br>
~ # tar -v<br>
BusyBox v1.2.1 (2008.06.26-17:58+0000) multi-call binary<br>
<br>
Usage: tar -<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=czxtvO">czxtvO</a>
 <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=-f+TARFILE">-f
 TARFILE</a> <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=-C+DIR">-C
 DIR</a> <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=FILE%28s%29">FILE(s)</a>
 ...<br>
<br>
Create, extract, or list files from a tar file.<br>
<br>
Options:<br>
        c               create<br>
        x               extract<br>
        t               list<br>
<br>
Archive format selection:<br>
        z               Filter the archive through gzip<br>
<br>
File selection:<br>
        f               name of TARFILE or "-" for stdin<br>
        O               extract to stdout<br>
        C               change to directory DIR before operation<br>
        v               verbosely list files processed<br>
</p><p>
~ # gunzip -v<br>
gunzip: invalid option -- v<br>
BusyBox v1.2.1 (2008.06.26-17:58+0000) multi-call binary<br>
<br>
Usage: gunzip <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=OPTION">OPTION</a>...
 FILE<br>
<br>
Uncompress FILE (or standard input if FILE is '-').<br>
<br>
Options:<br>
        -c      Write output to standard output<br>
        -f      Force read when source is a terminal<br>
        -t      Test compressed file integrity<br>
</p><p>
This is error what I get:<br>
~ # gunzip &lt; 
/vmfs/volumes/datastore2/backup/vm01/vm01-2009-09-24--1.gz | tar xvf - 
-C /vmfs/volumes/datastore2/<br>
vm01-2009-09-24/<br>
vm01-2009-09-24/vm01.vmx<br>
vm01-2009-09-24/vm01-0-flat.vmdk<br>
tar: Invalid tar magic<br>
</p><p>
I set disk format as "VMFS Thick". Not sure whether it relates to the 
issue. <br>
<br>
Thank you very much for you time on this matter.
					</p>
				</div>
				<a name="comments-12517"></a>
				<div id="comment-12517" class="jive-content-comment ">
					<span>
						<span>
							Sep 23, 2009 7:32 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-zQrE72eXfSI8arbr" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-12517">
					Thought I share with everyone that <b>ghettoVCB</b> just hit 
100,000+ views! Thanks to everyone for their contributions, comments and
 use of the script! <br>
<br>
<img src="DOC-8760_files/ghettovcb100k.png" 
alt="http://img44.imageshack.us/img44/1553/ghettovcb100k.png" 
class="jive-image"><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "he
					</p>
				</div>
				<a name="comments-12518"></a>
				<div id="comment-12518" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 23, 2009 10:11 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1ve38HwnAq901YBJ" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12516" title="Go to message">cookieme</a>
							</em>
					</span>
					<p id="comment-body-12518">
					You're posting in the wrong forum, this is not ghettoVCBg2 forum 
and No you can not. The script is written specifically to work with vMA 
and vi-fastpass. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12520"></a>
				<div id="comment-12520" class="jive-content-comment ">
					<span>
						<span>
							Sep 23, 2009 10:23 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-XVL0tE3UWpkw1FNL" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12487" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12520">
					Nope, the VMDK format does not matter with respect to extracting 
the contents. Curious, how big is the VM that you backed up and how big 
is the file after compression?<br>
<br>
Not sure what to tell you, it works fine on our system ... the only 
thing I can think of is there might be a size limitation when trying to 
extract from within Busybox and it would not surprise me at all if this 
was a <b>tar</b> limitation within Busybox confines. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12488"></a>
				<div id="comment-12488" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 23, 2009 10:28 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-Eh2lwuK2a10QHUu1" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12520" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12488">
					tar size is 8 GB<br>
<br>
backup size after compression is around 750 MB
					</p>
				</div>
				<a name="comments-12521"></a>
				<div id="comment-12521" class="jive-content-comment ">
					<span>
						<span>
							Sep 23, 2009 10:35 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-e9cv04VOJtWkk7FE" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12488" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12521">
					Let me create a dummy VM that is 8GB using eagerzeroedthick and try
 backing it up with compression enabled and see if I run into the same 
issue. Post back shortly<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12489"></a>
				<div id="comment-12489" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 23, 2009 11:57 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-l18hx7011gWzfaX2" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12521" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12489">
					Hi,<br>
I just recreate dummy VM with 2 GB size do backup with compression. it 
is running smooth without a problem. So, I think the problem as you 
mentioned about tar file size limitation.<br>
<br>
I will try to find server to put VMWare ESX 4 and try whether will give 
me the same issue. And, will let you know the result.<br>
<br>
Thank you very much for your assistance.
					</p>
				</div>
				<a name="comments-12522"></a>
				<div id="comment-12522" class="jive-content-comment ">
					<span>
						<span>
							Sep 24, 2009 5:12 AM
						</span>
							<!--<a href="/people/Kabs123" title="Click to view Kabs123's profile">
<img class="jive-avatar" src="/people/Kabs123/avatar/16.png?a=-1" height="16" width="16" title="Click to view Kabs123's profile" alt="Click to view Kabs123's profile" />
</a>--><a href="http://communities.vmware.com/people/Kabs123" 
id="jive-k32u10xRDVh8p2K5" class="jive-username-link" title="Click to 
view Kabs123's profile">Kabs123</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12522">
					Unfortunately the backup does not work properly for me.<br>
The only file that gets copied by backup process is the *.vmx file.<br>
The second problem is, that there will no further backup take place when
 there already exists one *.vmx copy.<br>
The error message i get:<br>
<br>
Error: failed to lookup testvm!<br>
<br>
It would be great if you could help me.
					</p>
				</div>
				<a name="comments-12535"></a>
				<div id="comment-12535" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 24, 2009 6:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MVJ0H1OIl66QKgrg" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12522" title="Go to message">Kabs123</a>
							</em>
					</span>
					<p id="comment-body-12535">
					Please take a look at FAQ #9 and also edit the script and look for 
the variable <b>DEVEL_MODE</b> and change that from 0 to a 1 and provide
 the output and <u>remember</u> to wrap the output from the console 
using code tags to make it readable.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12497"></a>
				<div id="comment-12497" class="jive-content-comment ">
					<span>
						<span>
							Sep 24, 2009 8:10 AM
						</span>
							<!--<a href="/people/Kabs123" title="Click to view Kabs123's profile">
<img class="jive-avatar" src="/people/Kabs123/avatar/16.png?a=-1" height="16" width="16" title="Click to view Kabs123's profile" alt="Click to view Kabs123's profile" />
</a>--><a href="http://communities.vmware.com/people/Kabs123" 
id="jive-IKR6DK51LFbEFP6L" class="jive-username-link" title="Click to 
view Kabs123's profile">Kabs123</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12497">
					</p><div class="jive-quote">
(vim.fault.DuplicateName) {<br>
   dynamicType = &lt;unset&gt;,<br>
   faultCause = (vmodl.MethodFault) null,<br>
   name = "nfs1-vol1",<br>
   object = 'vim.Datastore:nfs1.cad:/vol/vol1/data/esx-datastore',<br>
   msg = "The name 'nfs1-vol1' already exists.",<br>
}<br>
##########################################<br>
Virtual Machine: testvm<br>
VM_ID: 80<br>
VMX_PATH: /vmfs/volumes/datastore2/testvm/testvm.vmx<br>
VMX_DIR: /vmfs/volumes/datastore2/testvm<br>
VMX_CONF: testvm/testvm.vmx<br>
VMFS_VOLUME: datastore2<br>
##########################################<br>
<p>
Start time: Thu Sep 24 16:57:42 UTC 2009<br>
End   time: Thu Sep 24 16:57:43 UTC 2009<br>
Duration  : 1 Seconds<br>
<br>
Completed backing up specified Virtual Machines!<br>
</p></div>
					
				</div>
				<a name="comments-12500"></a>
				<div id="comment-12500" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 24, 2009 2:06 PM
						</span>
							<!--<a href="/people/ralfoertner" title="Click to view ralfoertner's profile">
<img class="jive-avatar" src="/people/ralfoertner/avatar/16.png?a=-1" height="16" width="16" title="Click to view ralfoertner's profile" alt="Click to view ralfoertner's profile" />
</a>--><a href="http://communities.vmware.com/people/ralfoertner" 
id="jive-4N0iiMHTa1i1Kicl" class="jive-username-link" title="Click to 
view ralfoertner's profile">ralfoertner</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12500">
					Excuse me if that isn't the right way to ask such a simple question
 but I did not find another way.<br>
The only downloadable version of ghettovcb on this page is dated on 
11/01/2008.<br>
Is that truely the latest version esx-i 4?<br>
I've been searching high and but could not find an newer one to 
download.<br>
Once again I hope tah this was the right place to ask such a question<br>
<br>
Sincerely <br>
Ralf Oertner
					</p>
				</div>
				<a name="comments-12525"></a>
				<div id="comment-12525" class="jive-content-comment ">
					<span>
						<span>
							Sep 24, 2009 2:08 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-jPq1rwRV0moU46R0" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12500" title="Go to message">ralfoertner</a>
							</em>
					</span>
					<p id="comment-body-12525">
					The download link is for the latest version.
					</p>
				</div>
				<a name="comments-12501"></a>
				<div id="comment-12501" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 24, 2009 2:34 PM
						</span>
							<!--<a href="/people/ralfoertner" title="Click to view ralfoertner's profile">
<img class="jive-avatar" src="/people/ralfoertner/avatar/16.png?a=-1" height="16" width="16" title="Click to view ralfoertner's profile" alt="Click to view ralfoertner's profile" />
</a>--><a href="http://communities.vmware.com/people/ralfoertner" 
id="jive-L6r4j3r4mWC9J6Dx" class="jive-username-link" title="Click to 
view ralfoertner's profile">ralfoertner</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12525" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12501">
					Thank you for your quick reply.<br>
The link is located before the known issues section.<br>
Underneath the "Attachment" Section.<br>
Is that the right link?<br>
<br>
Sorry my question may sound stupid but I am truely confused about that.<br>
<br>
Ralf Oertner
					</p>
				</div>
				<a name="comments-12526"></a>
				<div id="comment-12526" class="jive-content-comment ">
					<span>
						<span>
							Sep 24, 2009 2:37 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-KAY9K73URx96CEO8" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12501" title="Go to message">ralfoertner</a>
							</em>
					</span>
					<p id="comment-body-12526">
					There is only one download link.
					</p>
				</div>
				<a name="comments-12502"></a>
				<div id="comment-12502" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 24, 2009 8:22 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-04vGE5kjda9L2A9v" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12497" title="Go to message">Kabs123</a>
							</em>
					</span>
					<p id="comment-body-12502">
					So nothing from the output is showing me there were any errors and 
if you look at the duration it was pretty quick to finish and I can see 
that all the params were validated. So, my question, is there an actual 
VMDK that is valid and attached to this VM? <br>
<br>
Also when I mentioned code tags, there were specific ones for the Jive 
forums, take a look at this page: <a class="jive-link-external" 
href="http://communities.vmware.com/markuphelpfull.jspa">http://communities.vmware.com/markuphelpfull.jspa</a><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12528"></a>
				<div id="comment-12528" class="jive-content-comment ">
					<span>
						<span>
							Sep 25, 2009 5:42 AM
						</span>
							<!--<a href="/people/Kabs123" title="Click to view Kabs123's profile">
<img class="jive-avatar" src="/people/Kabs123/avatar/16.png?a=-1" height="16" width="16" title="Click to view Kabs123's profile" alt="Click to view Kabs123's profile" />
</a>--><a href="http://communities.vmware.com/people/Kabs123" 
id="jive-g7sqN8eu77QSC4zU" class="jive-username-link" title="Click to 
view Kabs123's profile">Kabs123</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12528">
					Problem cleared, i have deleted accidently a " in the source code 
and a part of the script has been commented out.<br>
Thank you for support.
					</p>
				</div>
				<a name="comments-12555"></a>
				<div id="comment-12555" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 25, 2009 12:54 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-g0n8E3X4QMIJJhsl" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12528" title="Go to message">Kabs123</a>
							</em>
					</span>
					<p id="comment-body-12555">
					I think I have found an issue with huge notes in Annotations. I 
downloaded the ntop appliance and the output from vim-cmd 
vmsvc/getallvms generates a bunch of junk lines. I haven't been able to 
test the script and it may not affect anything. The output looks like:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">
"112";"ntop";"[storage]";"ntop/ntop.vmx"
"       VirtualAppliances.net NTOP Appliance for realtime network monitoring.";"";""
"       To monitor your network's traffic usage, simply start this appliance.";"";""
"       It will automatically begin collecting traffic statistics from your";"";""
"       network.  To view statistics, simply use your web browser to visit";"";""
"       the NTOP interface at http://ntop.local.:3000 or the IP Address given";"";""
"       on the console.  NTOP is excellent for collecting statistics for ";"";""
"       trouble shooting your network as well as longer range monitoring and";"";""
"       planning activities.  Visit http://ntop.org for more information about";"";""
"       the ntop application. Community support available at http://forums.virtualappliances.net ";"";""

</code></pre>
					
				</div>
				<a name="comments-12557"></a>
				<div id="comment-12557" class="jive-content-comment ">
					<span>
						<span>
							Sep 25, 2009 9:54 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-kblESr6KDn4qX3th" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12555" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12557">
					Yes, annotations with the VM will cause the input to be captured 
when dumping out all VM(s), it'll pretty much fail on the lines where it
 contains the annotation since each line is suppose to represent a VM 
entry. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12585"></a>
				<div id="comment-12585" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 26, 2009 8:19 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-93kD5xw4xu29Gllq" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12557" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12585">
					Did finally get to test it and at least in my test environment it 
doesn't appear to affect anything. Screen output doesn't seem to be 
affected either. Sorry to have caused unnecessary concern.
					</p>
				</div>
				<a name="comments-12530"></a>
				<div id="comment-12530" class="jive-content-comment ">
					<span>
						<span>
							Sep 27, 2009 3:11 AM
						</span>
							<!--<a href="/people/gbras" title="Click to view gbras's profile">
<img class="jive-avatar" src="/people/gbras/avatar/16.png?a=-1" height="16" width="16" title="Click to view gbras's profile" alt="Click to view gbras's profile" />
</a>--><a href="http://communities.vmware.com/people/gbras" 
id="jive-Kby4UKY2l9eInJ5S" class="jive-username-link" title="Click to 
view gbras's profile">gbras</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12530">
					Hi,<br>
I need to do a small modification to the script, to skip both virtual 
and Physical RDMs (I need the VM backed up but not the RDMs).<br>
<br>
I'm going to change this bit of code:<br>
\{code\} <br>
#support for vRDM and deny pRDM<br>
 grep "vmfsPassthroughRawDeviceMap" "${SOURCE_VMDK}" &gt; /dev/null 
2&gt;&amp;1<br>
\{code\} <br>
<br>
with this:<br>
\{code\} <br>
#support for vRDM and deny pRDM<br>
  grep "RawDeviceMap" "${SOURCE_VMDK}" &gt; /dev/null 2&gt;&amp;1<br>
\{code\} <br>
</p><p>
Is this OK?<br>
<br>
Thank you<br>
Guido
					</p>
				</div>
				<a name="comments-12545"></a>
				<div id="comment-12545" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 27, 2009 12:32 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-07I3Aik0CFy7a2Qd" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12530" title="Go to message">gbras</a>
							</em>
					</span>
					<p id="comment-body-12545">
					You can do that OR you can just deny both types of RDMs: physical 
and virtual by doing the following:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">grep -E '(vmfsPassthroughRawDeviceMap|RawDeviceMap)' "${SOURCE_VMDK}" &gt; /dev/null 2&gt;&amp;1
</code></pre><br>
<br>
This is an extended grep which allows you to use an OR type statement to
 look for multiple strings and in this case, you want to deny any disks 
that are pRDM or vRDM. <br>
<br>
When you display code on the forums, you don't need to escape the "{" 
when wrapping your output using the code tags.<br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12531"></a>
				<div id="comment-12531" class="jive-content-comment ">
					<span>
						<span>
							Sep 27, 2009 8:32 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-m7o32FMno4uSGKl2" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12489" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12531">
					run backup with this script on ESX 4.0.<br>
Have no problme so far.<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-12588"></a>
				<div id="comment-12588" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 28, 2009 1:41 PM
						</span>
							<!--<a href="/people/ralfoertner" title="Click to view ralfoertner's profile">
<img class="jive-avatar" src="/people/ralfoertner/avatar/16.png?a=-1" height="16" width="16" title="Click to view ralfoertner's profile" alt="Click to view ralfoertner's profile" />
</a>--><a href="http://communities.vmware.com/people/ralfoertner" 
id="jive-HFN88A7L8G1eMytQ" class="jive-username-link" title="Click to 
view ralfoertner's profile">ralfoertner</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12531" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-12588">
					Dear GhettoVCBackup Experts,<br>
<br>
First of all many thanks for the excellent script!<br>
I have a few questions regarding ghettoVCB on ESX-I 3.5 and ESX-I 4.0 
both used with the "free" license.<br>
I use the script with the "plink-method" but I am having trouble with 
the log file. I am using the following commnandline to start the script:<br>
c:\programme\putty\plink.exe root@192.168.110.3 -pw password "cd 
/vmfs/volumes/store-VMs/ &amp;&amp; ./ghettoVCB.sh servers &gt; 
ghettobackup-server.log &amp;"<br>
The log file is created as expected but sometimes lines are missing or 
the logging stops before the scriptrun has ended. For that reason I am 
often unsure if the script is still running or not.<br>
Is there any way to make sure the script is finished or not? How can I 
fix the "logging-problem"? Is the plink-method the best way or is it 
better to use crontab (maybe logging works better that way)? When I look
 at the backup-destination during the script is runnning the file sizes 
are not changing. They are set to the file size of the original vmdk as 
soon as the script is running. What happens if the script ist failing in
 the middle of the copy process. Do I end with a copy of a vmdk which is
 just "halffull" and the other half is filled probably with zeros.<br>
<br>
A lot of questions I hope you can help and many thanks once again!
					</p>
				</div>
				<a name="comments-12589"></a>
				<div id="comment-12589" class="jive-content-comment ">
					<span>
						<span>
							Sep 28, 2009 1:45 PM
						</span>
							<!--<a href="/people/davidpyper" title="Click to view davidpyper's profile">
<img class="jive-avatar" src="/people/davidpyper/avatar/16.png?a=-1" height="16" width="16" title="Click to view davidpyper's profile" alt="Click to view davidpyper's profile" />
</a>--><a href="http://communities.vmware.com/people/davidpyper" 
id="jive-r9BrP86h5F51w3CN" class="jive-username-link" title="Click to 
view davidpyper's profile">davidpyper</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12589">
					Hi William,<br>
<br>
My client has 3 ESXi machines hosting 19 virtual servers, all Windows XP
 or 2003 machines.  The ghettoVCB.sh script runs on the 3 ESXi machines 
and backs-up the 19 servers to one large NFS share.  <br>
<br>
The script regularly hangs while removing snapshots.  The symptom of the
 problem is that the last line of the logfile reads "Removing snapshot 
from " (vnname) followed by no further activity.  The manual workaround 
involves using vSphere to create then remove a snapshot, at which point 
the script continues working its charm.<br>
<br>
The problem apparently stems from the following codeblock from 
ghettoVCB.sh (line numbers added for clarity):<br>
<br>
385			#powered on VMs only w/snapshots<br>
386                        if [<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%21+%24%7BPOWER_VM_DOWN_BEFORE_BACKUP%7D+-eq+1+%5D">
 ! ${POWER_VM_DOWN_BEFORE_BACKUP} -eq 1 ]</a> &amp;&amp; [; then<br>
387                                ${VMWARE_CMD} vmsvc/snapshot.remove 
${VM_ID} &gt; /dev/null 2&gt;&amp;1<br>
388<br>
389                                #do not continue until all snapshots 
have been committed<br>
390                                echo "Removing snapshot from 
${VM_NAME} ..."<br>
391                                while ls "${VMX_DIR}" | grep -q 
delta;<br>
392                                do<br>
393                                        sleep 3<br>
394                                done<br>
395                        fi<br>
<br>
As long as there are delta files in the VM's directory, lines 392 to 394
 loop perpetually.  My contribution to your excellent script is to 
suggest a modification to line 387 to use vmsvc's snapshot.removeall 
command instead of snashot.remove.  Line 387 would then look like this:<br>
<br>
387                                ${VMWARE_CMD} 
vmsvc/snapshot.removeall ${VM_ID} &gt; /dev/null 2&gt;&amp;1<br>
<br>
This enhancement removes all snapshots in the form of delta files, and 
allows the script to continue its work.<br>
<br>
Cheers!<br>
<br>
Dave
					</p>
				</div>
				<a name="comments-12596"></a>
				<div id="comment-12596" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 28, 2009 10:21 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-DQ5FASgtKgaaiLjs" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12588" title="Go to message">ralfoertner</a>
							</em>
					</span>
					<p id="comment-body-12596">
					Not sure about the plink solution, I don't use that personally with
 ghettoVCB, I know it works great for others. You also have another 
logging possiblity as you've mentioned is to setup a cronjob and have it
 log locally, take a look at <b>Advanced Logging setup</b> in this 
document.<br>
<br>
Regarding your destination disk, you'll want to take a look at your 
*-flat.vmdk and not your .vmdk as that is just the descriptor and not 
the actual disk and the final output will also be determined based on 
how you're backing up your VM, whether that is thin/thick or any other 
supported format. If something were to error, you'll see something 
logged and you'll end up with a bad backup. <br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12597"></a>
				<div id="comment-12597" class="jive-content-comment ">
					<span>
						<span>
							Sep 28, 2009 10:26 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ETtom25M1JfRQIi2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12589" title="Go to message">davidpyper</a>
							</em>
					</span>
					<p id="comment-body-12597">
					Thanks for the comments, unfortunately your solution is not a valid
 work around. The script does not support any VM(s) with snapshots, but I
 also do not make the assumption that a user may or may not modify the 
script. Having said that, I <u>will</u> only remove the most recent 
snapshot <u>which</u> should have been generated by my script only and 
hence it will continue to loop to ensure that the *-delta-XXXXX.vmdk are
 gone. The other thing that I'm not 100% sure is if <b>snapshot.removeall</b>
 is a blocking function because <b>snapshot.remove</b> is not and you 
could run into a situation where you'll have multiple backups completing
 and committing multiple snapshots which could hinder performance. This 
will guarantee that each VM is back into a consistent state before 
moving onto the next VM if something were to go wrong.<br>
<br>
I've not heard others having issues with removing the snapshots.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12622"></a>
				<div id="comment-12622" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 1, 2009 6:44 AM
						</span>
							<!--<a href="/people/SirGuun" title="Click to view SirGuun's profile">
<img class="jive-avatar" src="/people/SirGuun/avatar/16.png?a=-1" height="16" width="16" title="Click to view SirGuun's profile" alt="Click to view SirGuun's profile" />
</a>--><a href="http://communities.vmware.com/people/SirGuun" 
id="jive-enniBbQl328APITd" class="jive-username-link" title="Click to 
view SirGuun's profile">SirGuun</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12622">
					Hi Everybody,<br>
<br>
Lamw, I like your script! Great work!<br>
I am backing up 5 VMs (on a ESXi 3.5u2 Free) to a Windows NFS Store. 
Works great.<br>
Now I want to use a NAS-Box (QNAP 509 pro) as a NFS Storage. Connected 
allright. First 3 Backups ok, but the time it comes to deleting files we
 have a Problem:<br>
<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for VM_MONTASWWW ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Destination disk format: VMFS thick<br>
Cloning disk 
'/vmfs/volumes/ESXi2950_DS1/VM_MONTASWWW/VM_MONTASWWW.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from VM_MONTASWWW ...<br>
rm: unable to remove 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-2<br>
009-09-22--3/VM_MONTASWWW-flat.vmdk': Input/output error<br>
rm: unable to stat 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-200<br>
9-09-22--3/VM_MONTASWWW.vmx': Input/output error<br>
rm: unable to remove 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-2<br>
009-09-22--3': Input/output error<br>
mv: unable to stat 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-200<br>
9-09-30--3': Input/output error<br>
mv: unable to stat 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-200<br>
9-09-30--2': Input/output error<br>
rm: unable to stat 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-200<br>
9-09-16--3': Input/output error<br>
mv: unable to stat 
`/vmfs/volumes/NFS_NAS02/Backup/VM_MONTASWWW/VM_MONTASWWW-200<br>
9-09-30--1': Input/output error<br>
<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Completed backup for VM_MONTASWWW! ####################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
<p>
Start time: Wed Sep 30 14:34:34 UTC 2009<br>
End   time: Wed Sep 30 15:07:57 UTC 2009<br>
Duration  : 33.38 Minutes<br>
<br>
Completed backing up specified Virtual Machines!<br>
<br>
The speed ist OK (80 GB in about 30 Minutes), but the QNAP-NAS takes 
over 40 Sek. to delete a large file and so the ESXi gets a timeout. When
 deleting a large file on the Windows NFS you get the response 
instantly.<br>
QNAP told me that they will improve the NFS Performance later this year.<br>
<br>
Is there a chance to make the script wait for the NFS-Store to send the 
OK without timeout e.g. an increased period of time?<br>
<br>
By the way:<br>
If you a starting the script with plink from windows the log-File doesnt
 show the Input/Output error, but ends with ...Removing snapshot from 
VM_MONTASWWW ...<br>
</p><p>
Hope to hear from you<br>
Gunter
					</p>
				</div>
				<a name="comments-12680"></a>
				<div id="comment-12680" class="jive-content-comment ">
					<span>
						<span>
							Oct 4, 2009 11:50 AM
						</span>
							<!--<a href="/people/ibhp" title="Click to view ibhp's profile">
<img class="jive-avatar" src="/people/ibhp/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp's profile" alt="Click to view ibhp's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp" 
id="jive-cT0gdIUxtc9ITiu4" class="jive-username-link" title="Click to 
view ibhp's profile">ibhp</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12680">
					Hello<br>
<br>
I am backing up my VM's since a few months with ghettoVCB.sh. It is 
great. Since yesterday I got a problem: The script runs without errors, 
but no VM's are backed-up anymore. I am running ESXi v3.5 build: 153840.<br>
<br>
Until yesterday my log looked like this:<br>
*****************************************<br>
VM is still on - Iteration: 0 - waiting 3secs<br>
VM is off<br>
Starting backup for khtsbs01 ... <br>
Destination disk format: VMFS thick<br>
Cloning disk 
'/vmfs/volumes/4895d67c-fc7a4da0-09b6-00215ad1fa42/khtsbs01_1/khtsbs01_1_1.vmdk'...<br>
Clone: 0% done.Clone: 1% done... Clone: 99% done.Clone: 100% done.<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/R3_KHTSBS01/khtsbs01/khtsbs01_2.vmdk'...<br>
Clone: 0% done.Clone: 1% done...Clone: 99% done.Clone: 100% done.<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/R3_KHTSBS01/khtsbs01/khtsbs01_1.vmdk'...<br>
Clone: 0% done.Clone: 1% done....Clone: 99% done.Clone: 100% done.<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/R3_KHTSBS01/khtsbs01/khtsbs01.vmdk'...<br>
Clone: 0% done.Clone: 1% done...Clone: 99% done.Clone: 100% done.<br>
Powering back on khtsbs01<br>
Completed backup for khtsbs01! <br>
*******************************<br>
<br>
And since today it is only this (VMs are not backuped):<br>
********************************<br>
VM is still on - Iteration: 0 - waiting 3secs<br>
VM is off<br>
Starting backup for khtts01 ... <br>
Destination disk format: VMFS thick<br>
Cloning disk 
'/vmfs/volumes/4895d67c-fc7a4da0-09b6-00215ad1fa42/khtts01/khtts01_1.vmdk'...<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/R2_KHTTS01/khtts01/khtts01.vmdk'...<br>
Powering back on khtts01<br>
Completed backup for khtts01! <br>
*******************************<br>
<br>
Any ideas what could cause this problem?<br>
<br>
Thank you very much,<br>
<br>
ibhp
					</p>
				</div>
				<a name="comments-12653"></a>
				<div id="comment-12653" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 4, 2009 11:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-EP1UCWWSg6ayul0T" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12622" title="Go to message">SirGuun</a>
							</em>
					</span>
					<p id="comment-body-12653">
					This sounds like an issue with your NFS server...you could add an 
additional wait by inserting a <b>sleep(XX)</b> into the script before 
it gets to the rotation code. This value may just be some arbitrary 
number since different size VM(s) will probably delete faster or slower 
based on their size.<br>
<br>
Good luck<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12654"></a>
				<div id="comment-12654" class="jive-content-comment ">
					<span>
						<span>
							Oct 4, 2009 11:55 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0nFTv2guGF15zu9K" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12680" title="Go to message">ibhp</a>
							</em>
					</span>
					<p id="comment-body-12654">
					If things have been working for a few months, then I would start 
looking at the changes that could have occurred in your environment, if 
the script has changed, then it's probably something else. Make sure no 
changes were done or if any of the virtual disks have been removed from 
the VM, etc,etc. You will need to do some troubleshooting<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12666"></a>
				<div id="comment-12666" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 5, 2009 11:25 AM
						</span>
							<!--<a href="/people/someone908" title="Click to view someone908's profile">
<img class="jive-avatar" src="/people/someone908/avatar/16.png?a=-1" height="16" width="16" title="Click to view someone908's profile" alt="Click to view someone908's profile" />
</a>--><a href="http://communities.vmware.com/people/someone908" 
id="jive-6bfCgtX9tuSwydVT" class="jive-username-link" title="Click to 
view someone908's profile">someone908</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12654" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12666">
					Hi,<br>
<br>
first thanks for this great script, seems to be the only alternative for
 using VCB on Windows.<br>
One small question / feature request:<br>
Would it not minize the downtime if the script shuts down a VM, take the
 snapshot, Power the VM back on again, clone the disk and then remove 
the snapshot ? So the downtime would be time requied for shutting down, 
take Sanpshot and start again. No matter how big the disks are.<br>
<br>
Thanks in advantage.
					</p>
				</div>
				<a name="comments-12669"></a>
				<div id="comment-12669" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2009 7:00 AM
						</span>
							<!--<a href="/people/hburroughs" title="Click to view hburroughs's profile">
<img class="jive-avatar" src="/people/hburroughs/avatar/16.png?a=-1" height="16" width="16" title="Click to view hburroughs's profile" alt="Click to view hburroughs's profile" />
</a>--><a href="http://communities.vmware.com/people/hburroughs" 
id="jive-6749wVXnY7Kmam36" class="jive-username-link" title="Click to 
view hburroughs's profile">hburroughs</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12666" title="Go to message">someone908</a>
							</em>
					</span>
					<p id="comment-body-12669">
					I second the request to shut down the VM, take a snapshot, power 
the VM back up, while cloning the disk and remove the snapshot 
afterwards.  I have modified the scripts in the past to get close to 
this functionality, but of course I have to re-edit them anytime the 
upstream GhettoVCB is modified.  I feel more confident when I can do 
pristine copies of the VMs, but it is inconvenient for the downtime 
required.  Maybe a new toggle in the script file?  The one problem with 
this behavior would be if you provided a list of VMs..... do you cycle 
each off, snapshot, power back on, backup, remove snapshot, THEN do the 
next for the next VM or do you take snapshots of ALL the VMs you listed 
first, THEN backup each one and delete the snapshot before moving to the
 next vm, backup then delete snapshot, etc.....  I understand there 
would be performance impacts due to more than one snapshot in play... 
but that would be the user's responsibility.  They still could pass a 
single VM to the script (my favorite is echo "vmname" | sh ghettoVCB.sh -
 ) which reads the VM from the command line vs a config file.
					</p>
				</div>
				<a name="comments-12715"></a>
				<div id="comment-12715" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 6, 2009 8:06 AM
						</span>
							<!--<a href="/people/hburroughs" title="Click to view hburroughs's profile">
<img class="jive-avatar" src="/people/hburroughs/avatar/16.png?a=-1" height="16" width="16" title="Click to view hburroughs's profile" alt="Click to view hburroughs's profile" />
</a>--><a href="http://communities.vmware.com/people/hburroughs" 
id="jive-T1sCa2uUoWzedv9t" class="jive-username-link" title="Click to 
view hburroughs's profile">hburroughs</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12669" title="Go to message">hburroughs</a>
							</em>
					</span>
					<p id="comment-body-12715">
					I've made the changes with about 10 lines of code. (one if 
statement needs a condition added as well)  The evolution of ghetoVCB 
has actually made it easier to implement part of this. Right now the 
behavior works best with one VM at a time.  If you are backing up 
multiple VMs, it will wait till the last backup is done, then power that
 VM off, snapshot, power back on (waiting x seconds), then backup/clone,
 then delete snapshot.  It would take a good deal of rewriting the 
ghettoVCB flow to handle snapshots first for all VMs.  I'll post my 
changes as soon as I run a few more tests.
					</p>
				</div>
				<a name="comments-12717"></a>
				<div id="comment-12717" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2009 8:48 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-7hDNO38N8gwlS6nD" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12715" title="Go to message">hburroughs</a>
							</em>
					</span>
					<p id="comment-body-12717">
					Guys â€“ got a problem with the ghetto backup script. It runs OK for a
 few backups then complains that it cannot create the directory 
/vmfs/volumes/BACKUP (see below).<br>
<br>
In the script I define:<br>
<br>
VM_BACKUP_VOLUME=/vmfs/volumes/BACKUP/ESXIDMZ01<br>
<br>
BACKUP is an NFS share mounted as a datastore on the ESXi server. This 
is actually drive F: on the backup server and on that drive I have 
pre-created the ESXIDMZ01 folder. I have tried also pre-creating the VM 
folder below that â€œOCSEDGEâ€ but it fails with or without that directory 
existing. There seems to be no consistency.<br>
<br>
I also see that â€œlsâ€ error at the end of the backing up of EXCHEDGE01 
(below)<br>
<br>
Any ideas?<br>
</p><p>
/vmfs/volumes/49303d2e-240b718c-15f5-00226409b2b0 # ./ghettoVCB.sh 
./vmbackups<br>
<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for C2C ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Start time: Tue Oct  6 14:02:20 UTC 2009<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/ESXIDMZ01_1/C2C/C2C.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from C2C ...<br>
End time: Tue Oct  6 14:17:33 UTC 2009<br>
<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Completed backup for C2C! ####################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
<br>
<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for EXCHEDGE01 ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Start time: Tue Oct  6 14:17:35 UTC 2009<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/ESXIDMZ01_1/EXCHEDGE01/EXCHEDGE01.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from EXCHEDGE01 ...<br>
ls: /vmfs/volumes/BACKUP/ESXIDMZ01/EXCHEDGE01: Input/output error<br>
End time: Tue Oct  6 14:56:00 UTC 2009<br>
<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Completed backup for EXCHEDGE01! ####################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
<br>
mkdir: Cannot create directory `/vmfs/volumes/BACKUP/': Input/output 
error<br>
Unable to create "/vmfs/volumes/BACKUP/ESXIDMZ01/OCSEDGE"! - Ensure 
VM_BACKUP_VOLUME was defined correctly
					
				</div>
				<a name="comments-12711"></a>
				<div id="comment-12711" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 6, 2009 10:09 AM
						</span>
							<!--<a href="/people/hburroughs" title="Click to view hburroughs's profile">
<img class="jive-avatar" src="/people/hburroughs/avatar/16.png?a=-1" height="16" width="16" title="Click to view hburroughs's profile" alt="Click to view hburroughs's profile" />
</a>--><a href="http://communities.vmware.com/people/hburroughs" 
id="jive-3x5v4O1Y1duG8WHw" class="jive-username-link" title="Click to 
view hburroughs's profile">hburroughs</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12715" title="Go to message">hburroughs</a>
							</em>
					</span>
					<p id="comment-body-12711">
					Follow these steps to modify the current ghettoVCB.sh to support 
what was discussed above: (I just fixed a minor issue if you run the 
script with this enabled and the VM off... it wouldn't be able to 
startup since the disk would be locked)<br>
<br>
1.  Add the following code at the top of the program before the # DO NOT
 MODIFY LINE<br>
<br>
# 1=on, 0 = off<br>
POWER_OFF_SNAPSHOT_ON=1<br>
<br>
# Time to wait after powering on the VM before starting the backup/clone
 process<br>
POWER_ON_WAIT=120<br>
<br>
2. Next, replace the if statement directly following "#section that will
 power down a VM prior to taking a snapshot and backup and power it back
 on" with this:<br>
if [[ ${POWER_VM_DOWN_BEFORE_BACKUP} -eq 1 ]] || [[ 
${POWER_OFF_SNAPSHOT_ON} -eq 1 ]]; then<br>
<br>
3. Add this code directly after the section for <br>
<br>
#If we need to power the VM back on before backup (POWER_OFF_SNAPSHOT_ON
 = 1)<br>
if [[${POWER_OFF_SNAPSHOT_ON} -eq 1 ]] &amp;&amp; [[ 
"${ORGINAL_VM_POWER_STATE}" != "Powered off" ]]; then<br>
       echo "Powering back on ${VM_NAME} before backing up (waiting 
${POWER_ON_WAIT} seconds before copying)"<br>
       ${VMWARE_CMD} vmsvc/power.on ${VM_ID} &gt; /dev/null <br>
       sleep ${POWER_ON_WAIT}<br>
fi<br>
<br>
That is it!  I've tested this on a only  a non-critical system, and 
since you are modifying your existing ghettoVCB.sh script, please be 
careful and test completely before using in production.
					</p>
				</div>
				<a name="comments-12719"></a>
				<div id="comment-12719" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2009 7:56 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-576pFcEbEqDWHs7Q" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12666" title="Go to message">someone908</a>
							</em>
					</span>
					<p id="comment-body-12719">
					I'm not sure which use case you're trying to accomplish with the 
suggested solution. <br>
<br>
I see basically 2:<br>
<br>
A) Backup while the VM is online<br>
B) Backup while the VM is offline<br>
<br>
The solutions to the following are:<br>
<br>
A) Take a snapshot while the VM is running, backup the disk and commit 
the snapshot (no downtime)<br>
B) Power down the VM, no snapshot is needed and backup the disk and 
power VM <br>
<br>
I'm assuming you're referring to case <b>B</b>, you may minimize the 
actual downtime of the VM by doing an offline snapshot but unfortunately
 you introduce a snapshot which needs to be committed which turns out to
 be a similar use case as <b>A</b>, so why not just backup the VM while 
it's running?<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12697"></a>
				<div id="comment-12697" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 7, 2009 12:36 AM
						</span>
							<!--<a href="/people/fqu89" title="Click to view fqu89's profile">
<img class="jive-avatar" src="/people/fqu89/avatar/16.png?a=-1" height="16" width="16" title="Click to view fqu89's profile" alt="Click to view fqu89's profile" />
</a>--><a href="http://communities.vmware.com/people/fqu89" 
id="jive-V1uCNiu3rX3c6MWY" class="jive-username-link" title="Click to 
view fqu89's profile">fqu89</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12719" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12697">
					I've had the same request than someone98 a few weeks ago...<br>
<br>
The reason of this request is :<br>
<br>
-It's safer to make a backup of a VM while it's off because databases 
are closed, files are closed, nothing is in the memory of the VM and in 
fact you are sure that you won't have any surprise (database 
inconsistency, files truncated, and so on) when you will use this 
backup.<br>
-In this case, if you power down a VM and wait until the backup is done 
before powering it on, it can take HOURS to complete (lots of gigs to 
transfer)<br>
-so it would be nice to have the ability to shutdown a VM, take a 
snapshot, power it on, make the backup and delete the snapshot.
					</p>
				</div>
				<a name="comments-12712"></a>
				<div id="comment-12712" class="jive-content-comment ">
					<span>
						<span>
							Oct 7, 2009 1:44 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-51zeUmjzJB1k7FBf" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12697" title="Go to message">fqu89</a>
							</em>
					</span>
					<p id="comment-body-12712">
					problem I have does not seem to be with taking the online snapshot 
etc. The problem seems to be with the target datastore where the files 
get moved to. For some reason I fails after backing up 1 or 2 VMs OK 
saying that it can't create a specific directory for the next VM. 
However, it managed to do it fine for the first 2 so why fail now?
					</p>
				</div>
				<a name="comments-12698"></a>
				<div id="comment-12698" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 7, 2009 2:47 AM
						</span>
							<!--<a href="/people/aliog" title="Click to view aliog's profile">
<img class="jive-avatar" src="/people/aliog/avatar/16.png?a=-1" height="16" width="16" title="Click to view aliog's profile" alt="Click to view aliog's profile" />
</a>--><a href="http://communities.vmware.com/people/aliog" 
id="jive-I3qa7Fe1yN7Xj15G" class="jive-username-link" title="Click to 
view aliog's profile">aliog</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12698">
					Hi, <br>
<br>
for reference when setting up a persistent cron job in ESXi 3.5 update 4
 i had to use the following commands to stop and restart crond in my 
/etc/rc.local<br>
<br>
kill $(pidof crond)<br>
crond<br>
<br>
not <br>
<br>
busybox crond <br>
<br>
as mentioned in the help. Other than that all working great.
					</p>
				</div>
				<a name="comments-12699"></a>
				<div id="comment-12699" class="jive-content-comment ">
					<span>
						<span>
							Oct 7, 2009 7:00 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-se91bAHdVlb56gaU" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12697" title="Go to message">fqu89</a>
							</em>
					</span>
					<p id="comment-body-12699">
					Definitely understandable with databases, but that's why VMware has
 the option of quiescing the filesystem to have all it's data flushed to
 disk prior to taking a snapshot. The only requirement is to have the 
latest version of VMware Tools running and when a snapshot is taken, 
there is a few options to include memory and also to quiesce the 
fileystem. <br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# vmware-vim-cmd vmsvc/snapshot.create
Insufficient arguments.
Usage: snapshot.create vmid [snapshotName] [snapshotDescription] [includeMemory] [quiesced]

Creates a snapshot for the vm.
</code></pre><br>
<br>
I do have to admit, in the current version, this is not being utilized 
and I don't have options to enable this but this is just a boolean of <b>0</b>
 or <b>1</b> which can be modified in the script. The reason we have not
 provided this additional functionality is we don't backup any databases
 for our dev environment nor any systems that are sensitive that require
 their filesystem to be flushed to disk. <br>
<br>
I don't think suggested solution really saves much more time and you do 
incur more time to power down and power on the system and you're still 
working with a snapshot. I do agree, that you do need to take into 
consideration about backing up databases and even with VMware's product 
and others, there are things like VSS and quiescing VM/etc. <br>
<br>
You can definitely test with the params and see if it helps, else the 
code that has been provided by others can be used but will not be part 
of ghettoVCB.<br>
<br>
Thanks again for your comments<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12730"></a>
				<div id="comment-12730" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 7, 2009 7:04 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-24n5uy5m969p16ex" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12712" title="Go to message">banthorpe</a>
							</em>
					</span>
					<p id="comment-body-12730">
					What are the differences between the first 2 VMs and the third? 
I've seen this issue once or twice in the forums and it all goes back to
 the NFS server as you've mentioned with the timeout. I would say that 
either the size of the VM differs significantly or the snapshot is much 
larger than the first two and hence it's failing. Also is the link to 
your NFS server being saturated, are there other data going through it? 
1gb link to NFS server vs 10gb link vs 4/8gb FC link will all act very 
different and also the storage on the backend and how many spindles/disk
 are being accessed. <br>
<br>
This is more of an environmental issue than with the script, we've 
backed up VMs in the hundreds of gig without any issue against an NFS. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12731"></a>
				<div id="comment-12731" class="jive-content-comment ">
					<span>
						<span>
							Oct 7, 2009 7:05 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-G8bDRB5cvFed53iq" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12698" title="Go to message">aliog</a>
							</em>
					</span>
					<p id="comment-body-12731">
					Thanks for the information, I'll update the document tonight with 
the correct params. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12751"></a>
				<div id="comment-12751" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 8, 2009 1:35 PM
						</span>
							<!--<a href="/people/mcunningham44" title="Click to view mcunningham44's profile">
<img class="jive-avatar" src="/people/mcunningham44/avatar/16.png?a=-1" height="16" width="16" title="Click to view mcunningham44's profile" alt="Click to view mcunningham44's profile" />
</a>--><a href="http://communities.vmware.com/people/mcunningham44" 
id="jive-4hJ9RFOCc98M84AR" class="jive-username-link" title="Click to 
view mcunningham44's profile">mcunningham44</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12751">
					Has anybody encountered the following error when running the 
script?<br>
<br>
mkdir: cannot create directory `/vmfs/volumes/nfs_storage_backup': 
Operation not permitted
					</p>
				</div>
				<a name="comments-12761"></a>
				<div id="comment-12761" class="jive-content-comment ">
					<span>
						<span>
							Oct 8, 2009 1:42 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-H137zdUw0o3nh0RP" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12751" title="Go to message">mcunningham44</a>
							</em>
					</span>
					<p id="comment-body-12761">
					what do you have for the VM_BACKUP_VOLUME= <br>
<br>
The backup volume must point to a mounted datastore (unless you are 
using non persistent storage) and the path must exist.
					</p>
				</div>
				<a name="comments-12752"></a>
				<div id="comment-12752" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 8, 2009 1:57 PM
						</span>
							<!--<a href="/people/mcunningham44" title="Click to view mcunningham44's profile">
<img class="jive-avatar" src="/people/mcunningham44/avatar/16.png?a=-1" height="16" width="16" title="Click to view mcunningham44's profile" alt="Click to view mcunningham44's profile" />
</a>--><a href="http://communities.vmware.com/people/mcunningham44" 
id="jive-BympIfolpbF1rQsp" class="jive-username-link" title="Click to 
view mcunningham44's profile">mcunningham44</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12761" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12752">
					Well, the script was working fine then I changed the NFS share 
name.  I am using non persistent storage.  This is going to a VMWare 
Cluster and I noticed that on 3 of the hosts now, it was mounting to 
nfs_storage_backup and now its going to nfs_storage_backup (1).  Because
 of the (1) the path wasn't working for the compression.  So I removed 
the nfs_storage_backup (1)...now when I go to run the script i get the 
above error.  Any suggestions?  Thanks!
					</p>
				</div>
				<a name="comments-12762"></a>
				<div id="comment-12762" class="jive-content-comment ">
					<span>
						<span>
							Oct 8, 2009 2:03 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-B3fAm4K93Qe67pQ5" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12752" title="Go to message">mcunningham44</a>
							</em>
					</span>
					<p id="comment-body-12762">
					NO spaces in the path. or special caharacters.
					</p>
				</div>
				<a name="comments-12763"></a>
				<div id="comment-12763" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 8, 2009 2:06 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-8okF2Sfv28gPUn52" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12762" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12763">
					Can you mount that datastore?
					</p>
				</div>
				<a name="comments-12753"></a>
				<div id="comment-12753" class="jive-content-comment ">
					<span>
						<span>
							Oct 8, 2009 2:06 PM
						</span>
							<!--<a href="/people/mcunningham44" title="Click to view mcunningham44's profile">
<img class="jive-avatar" src="/people/mcunningham44/avatar/16.png?a=-1" height="16" width="16" title="Click to view mcunningham44's profile" alt="Click to view mcunningham44's profile" />
</a>--><a href="http://communities.vmware.com/people/mcunningham44" 
id="jive-S7TLL9WpIEiWXHLu" class="jive-username-link" title="Click to 
view mcunningham44's profile">mcunningham44</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12762" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12753">
					The system created the nfs_storage_backup (1) on its own... i don't
 know why it used that when its defined as 
NFS_LOCAL_NAME=nfs_storage_backup in the script.
					</p>
				</div>
				<a name="comments-12764"></a>
				<div id="comment-12764" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 8, 2009 2:22 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-2OIBj5efC5mT8llh" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12753" title="Go to message">mcunningham44</a>
							</em>
					</span>
					<p id="comment-body-12764">
					Can you mount that share on your ESXi host as you have it listed in
 the script under persistent.
					</p>
				</div>
				<a name="comments-12754"></a>
				<div id="comment-12754" class="jive-content-comment ">
					<span>
						<span>
							Oct 8, 2009 2:37 PM
						</span>
							<!--<a href="/people/mcunningham44" title="Click to view mcunningham44's profile">
<img class="jive-avatar" src="/people/mcunningham44/avatar/16.png?a=-1" height="16" width="16" title="Click to view mcunningham44's profile" alt="Click to view mcunningham44's profile" />
</a>--><a href="http://communities.vmware.com/people/mcunningham44" 
id="jive-0bRFY2o48JG3u0o4" class="jive-username-link" title="Click to 
view mcunningham44's profile">mcunningham44</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12764" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12754">
					I'm not sure.  All I know was the script was working fine on each 
host in the cluster and for some reason it stopped with the Operation 
Not Permitted Error.  I would like to know what caused this error to 
occur. Is it plausible that only 1 HOST in the cluster can be mounted to
 the NFS share at a time?  Because currently there is 1 of the 4 HOSTS 
in the Cluster that work fine and mount to this location without a 
problem and STILL works fine.
					</p>
				</div>
				<a name="comments-12765"></a>
				<div id="comment-12765" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 8, 2009 3:45 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-9rhr9yDJJs0m88EY" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12754" title="Go to message">mcunningham44</a>
							</em>
					</span>
					<p id="comment-body-12765">
					As long as there are fewer than 8 NFS shares on a host (the default
 but can have been changed) an NFS share can be be add to as many ESXi 
hosts as you have. When you say that the system made the change what do 
you mean "what system?". Is the NFS share already present on the host? 
Again I ask can you mount the share as is is under the non persistent 
settings of the script. If it can't then the script won't either. You 
did say that it was working and then you changed something. Check your 
editing.
					</p>
				</div>
				<a name="comments-12767"></a>
				<div id="comment-12767" class="jive-content-comment ">
					<span>
						<span>
							Oct 8, 2009 7:49 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9O8TxCVB06sv35ET" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12752" title="Go to message">mcunningham44</a>
							</em>
					</span>
					<p id="comment-body-12767">
					I believe someone here or in the general forums ran into something 
similar when using <b>vimsh</b> to mount an NFS datastore, it seems to 
remember the original label, hence when you try to re-mount as something
 else it'll think it already exists. I think the user had to manually 
re-add with the same name, delete the NFS datastore and then manually 
re-mount using the new name. <br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/codecentral">VMware
 Code Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer/">VMware 
Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12758"></a>
				<div id="comment-12758" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 9, 2009 5:50 AM
						</span>
							<!--<a href="/people/mcunningham44" title="Click to view mcunningham44's profile">
<img class="jive-avatar" src="/people/mcunningham44/avatar/16.png?a=-1" height="16" width="16" title="Click to view mcunningham44's profile" alt="Click to view mcunningham44's profile" />
</a>--><a href="http://communities.vmware.com/people/mcunningham44" 
id="jive-4LTv1ntKcNcNsaIs" class="jive-username-link" title="Click to 
view mcunningham44's profile">mcunningham44</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12767" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12758">
					Would this also eliminate the mkdir: cannot create directory 
`/vmfs/volumes/nfs_storage_backup': Operation not permitted, that I've 
been starting to get?  I never got this error before, and for some 
reason I started getting it today and I'm not sure whats causing it?<br>
<br>
Also, <br>
<br>
When I goto mount it manually via "/usr/bin/vmware-vim-cmd 
hostsvc/datastore/nas_create nfs_storage_backup x.x.x.x /NFS_SHARE 0" I 
get a message saying this already exists below:<br>
<br>
</p><div class="jive-quote">(vim.fault.AlreadyExists) {<br>
   dynamicType = &lt;unset&gt;,<br>
   name = "",<br>
   msg = "The specified key, name, or identifier already exists."<br>
}<br>
</div>
					
				</div>
				<a name="comments-12759"></a>
				<div id="comment-12759" class="jive-content-comment ">
					<span>
						<span>
							Oct 9, 2009 11:16 AM
						</span>
							<!--<a href="/people/mpaytonnj" title="Click to view mpaytonnj's profile">
<img class="jive-avatar" src="/people/mpaytonnj/avatar/16.png?a=-1" height="16" width="16" title="Click to view mpaytonnj's profile" alt="Click to view mpaytonnj's profile" />
</a>--><a href="http://communities.vmware.com/people/mpaytonnj" 
id="jive-fB2E4wjJqkNKwPM9" class="jive-username-link" title="Click to 
view mpaytonnj's profile">mpaytonnj</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12767" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12759">
					First, thanks for this awesome script and for updating/answering 
questions.  We have Enterprise licensing, including the "official" VCB, 
but were looking for something simpler than a VCB proxy setup for our 
ESXi servers.  This fits the bill perfectly.<br>
<br>
Second, rather than using a manually maintained list of machines to 
include in a backup we do something a little different and I figured I'd
 offer to share it in case anyone finds it interesting...<br>
<br>
Due to various factors ( vmotion, VMs added/removed, VMs moved from dev 
to production, new hosts added/removed etc. ) our inventory is 
constantly changing on all hosts and manually updating a list of VMs to 
backup in multiple locations got to be a bit much.<br>
Therefore we found it easier to maintain a single file of machines to 
exclude from backup, rather than multiple files of VMs to include.  <br>
Basically, we assume the VM should be backed up unless it's specifically
 excluded.<br>
<br>
To accomplish this on ESX using vcbMounter, I get the VM names from 
/etc/vmware/hostd/vmInventory.xml ignoring any that are listed in a 
specified "exclude" file and passing the rest to vcbMounter to be backed
 up. <br>
I modified this for ESXi/ghettoVCB.sh to write the VM name(s) to the 
file used as the argument to ghettoVCB.sh.<br>
It still requires maintaining the exclude list, so it's possible to miss
 something.  But in our environment this has proven to be easier/more 
effective, and all ESX(i) machines in our environment look at the same 
exclude file.  Or if you don't want to exclude any VMs, leaving the 
exclude file blank means you no longer have to manually maintain any 
files. <br>
<br>
So, if anyone is interested, I can post what passes for my "code".<br>
<br>
Disclaimer...I am <b>not</b> a shell programmer.  I know there are 
cleaner/more graceful ways of doing this than the hack I threw together.
  real programmers will probably laugh or throw rocks at me.  But it 
works for us, it's only a few lines and it is probably easy to clean 
up/condense by someone with more experience.
					</p>
				</div>
				<a name="comments-12827"></a>
				<div id="comment-12827" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 12, 2009 11:15 AM
						</span>
							<!--<a href="/people/mcunningham44" title="Click to view mcunningham44's profile">
<img class="jive-avatar" src="/people/mcunningham44/avatar/16.png?a=-1" height="16" width="16" title="Click to view mcunningham44's profile" alt="Click to view mcunningham44's profile" />
</a>--><a href="http://communities.vmware.com/people/mcunningham44" 
id="jive-B5RSc4DG5JH4Pz5X" class="jive-username-link" title="Click to 
view mcunningham44's profile">mcunningham44</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12767" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12827">
					Thanks for your help and the script!!
					</p>
				</div>
				<a name="comments-12878"></a>
				<div id="comment-12878" class="jive-content-comment ">
					<span>
						<span>
							Oct 14, 2009 9:20 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-p25DrcqtBk84Mwoj" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-12878">
					Hi everyone,<br>
<br>
I'm currently in development (as time permits) on some new features for 
the <b>ghettoVCB</b> script and I'm looking for some individuals that 
may be interested in taking part in a BETA. The requirement is pretty 
simple, willing to help test and provide feedback on the next version of
 the script (remember to test on non-production VMs) <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
If you're interested, please PM on VTMN with your email address and the 
script you would like to take part in and I'll be selecting a group 
users and send out email notification in the coming weeks.<br>
<br>
Thanks<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/private/bitbucket/developer/codecentral"
 title="Sample code for VMware vSphere SDKs and APIs">VMware Code 
Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/private/bitbucket/developer"
 title="Resources for Administrators and Developers">VMware Developer 
Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12881"></a>
				<div id="comment-12881" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 14, 2009 11:23 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-rq9HH1zOghK5t3Qm" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12878" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12881">
					I would dearly love to participate but fundamentally refuse to use 
twitter or expose an email address to it.
					</p>
				</div>
				<a name="comments-12895"></a>
				<div id="comment-12895" class="jive-content-comment ">
					<span>
						<span>
							Oct 14, 2009 11:49 PM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-qCDo3Id7Srh9r3rv" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12878" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12895">
					I can help if you want. I have a spare R200 with latest ESXi 3.5 
and a V4 Essential license for it.<br>
Oh, I can't DM you on twitter, probably cause you're not following me <img
 class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" 
border="0">
					</p>
				</div>
				<a name="comments-12896"></a>
				<div id="comment-12896" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 15, 2009 6:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-fzN4F8qfmFf6UAPb" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12881" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12896">
					Drop me your email via PM on VMTN.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12897"></a>
				<div id="comment-12897" class="jive-content-comment ">
					<span>
						<span>
							Oct 15, 2009 6:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Aif17W85oCwXFczI" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12895" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-12897">
					Drop me your email via PM on VMTN.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12904"></a>
				<div id="comment-12904" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 16, 2009 1:54 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-t8ODa7RA4t2CGrSv" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-12904">
					This is a really great extension to ESXi.<br>
The only thing missing IMHO is the ability to exclude certain vmdks from
 backup.<br>
You very often have setups where you only want to backup the system 
volumes of machines via image and not the datavolumes which are 
sometimes 100GB+ in size. These are most often beeing backed up by 
different systems with a more granular backup technology.
					</p>
				</div>
				<a name="comments-12905"></a>
				<div id="comment-12905" class="jive-content-comment ">
					<span>
						<span>
							Oct 16, 2009 9:21 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-KjPORRivHkRh5CLr" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12904" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-12905">
					There is a BETA in the coming weeks, if you're interested drop me 
your email via VMTN PM<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12940"></a>
				<div id="comment-12940" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 18, 2009 10:28 AM
						</span>
							<!--<a href="/people/S3BASTI3N" title="Click to view S3BASTI3N's profile">
<img class="jive-avatar" src="/people/S3BASTI3N/avatar/16.png?a=-1" height="16" width="16" title="Click to view S3BASTI3N's profile" alt="Click to view S3BASTI3N's profile" />
</a>--><a href="http://communities.vmware.com/people/S3BASTI3N" 
id="jive-3Q1959QB5qNnmB2q" class="jive-username-link" title="Click to 
view S3BASTI3N's profile">S3BASTI3N</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12905" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12940">
					for pb with 100GB+ (for data volume) I use an independant disk 
(wich is not affected by snapshot) and I use a modified GhettoVCB script
 : I add a BACKUP_INDEPENDENT_DISK option and if set to 0 , I exclude 
"independent" disk when the script "browse" all vmdk <br>
It works fine until a new version of GhettoVCB comes with this option ! <img
 class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" 
border="0"><br>
<br>
lamw, i'm interested by your beta <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Sebastien
					</p>
				</div>
				<a name="comments-12926"></a>
				<div id="comment-12926" class="jive-content-comment ">
					<span>
						<span>
							Oct 18, 2009 5:50 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7wb3RSdtLxG79UP9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12940" title="Go to message">S3BASTI3N</a>
							</em>
					</span>
					<p id="comment-body-12926">
					If you're interested in the BETA, please send me a PM on VMTN with 
your email. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12966"></a>
				<div id="comment-12966" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 20, 2009 3:08 PM
						</span>
							<!--<a href="/people/BasicVirtu" title="Click to view BasicVirtu's profile">
<img class="jive-avatar" src="/people/BasicVirtu/avatar/16.png?a=-1" height="16" width="16" title="Click to view BasicVirtu's profile" alt="Click to view BasicVirtu's profile" />
</a>--><a href="http://communities.vmware.com/people/BasicVirtu" 
id="jive-1uM0C70BIUM4lMQ2" class="jive-username-link" title="Click to 
view BasicVirtu's profile">BasicVirtu</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12926" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12966">
					First off thank you, and great work on your scripts.<br>
<br>
I recently upgraded to ESX4 and ESXi4 and would like to try using one of
 the scripts either ghettoVCB or ghettoVCB2 to copy vms from our ESX4 
cluster to an ESXi server that has plenty of local storage. Would you 
recommend the newer script or the older script? I was hoping to use 
compression but did not see that feature in the new script. Also I would
 be willing to test any beta scripts since I am starting out with our 
test server. Thanks
					</p>
				</div>
				<a name="comments-12931"></a>
				<div id="comment-12931" class="jive-content-comment ">
					<span>
						<span>
							Oct 20, 2009 7:48 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-fLVFLGLCHoECO64g" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12966" title="Go to message">BasicVirtu</a>
							</em>
					</span>
					<p id="comment-body-12931">
					ESX(i) 4.0 is supported by both <a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-8760">ghettoVCB</a> and <a 
class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-9843">ghettoVCBg2</a>, 
please go over the documentation carefully and you'll see the use cases 
for each depending on the environment you're in. Compression is only 
available with ghettoVCB and it's not available for a certain reason in 
ghettoVCBg2.<br>
<br>
Regarding the BETA, if you're interested please follow the directions in
 an earlier comment that specifies on how to apply. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12951"></a>
				<div id="comment-12951" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 21, 2009 12:31 PM
						</span>
							<!--<a href="/people/jberne74" title="Click to view jberne74's profile">
<img class="jive-avatar" src="/people/jberne74/avatar/16.png?a=-1" height="16" width="16" title="Click to view jberne74's profile" alt="Click to view jberne74's profile" />
</a>--><a href="http://communities.vmware.com/people/jberne74" 
id="jive-p1r40xQ8s27O5kAB" class="jive-username-link" title="Click to 
view jberne74's profile">jberne74</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12931" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12951">
					Thanks a mill for this cost saving solution William. I have 
everything up on my ESXi host, tied my NFS datastore to it, edited the 
VM_BACKUP_VOLUME variable appropriately, created the vm list file and 
changed permissions on the ghettoVCB.sh all using Putty on my windows 
machine to ssh into the ESXi host. But when i try to run the script, i 
still get the:<br>
<br>
-ash: ./ghettoVCB.sh: not found<br>
error.Can i get any help here. Thnx so much.
					</p>
				</div>
				<a name="comments-12952"></a>
				<div id="comment-12952" class="jive-content-comment ">
					<span>
						<span>
							Oct 21, 2009 9:10 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-IMvH7aF5xseqmmHM" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12951" title="Go to message">jberne74</a>
							</em>
					</span>
					<p id="comment-body-12952">
					Make sure you're downloading the latest version which is attached 
to this VMTN document. Make sure you've edited the script directly on 
ESX(i) host (not with Windows system such as notepad). These are 
generally the issues people run into if they're hitting this error. How 
did you upload the script to your ESX(i) host?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12935"></a>
				<div id="comment-12935" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 21, 2009 9:50 PM
						</span>
							<!--<a href="/people/jberne74" title="Click to view jberne74's profile">
<img class="jive-avatar" src="/people/jberne74/avatar/16.png?a=-1" height="16" width="16" title="Click to view jberne74's profile" alt="Click to view jberne74's profile" />
</a>--><a href="http://communities.vmware.com/people/jberne74" 
id="jive-WFfn2GXaYFgGnceH" class="jive-username-link" title="Click to 
view jberne74's profile">jberne74</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12952" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12935">
					I edited the script on the ESXi host using Putty.I uploaded the 
script to the ESXi host using WinSCP transfer(in text mode).I probably 
will go ahead and download the latest version attached to this VMTN 
document, edit and make the changes in the morning.I will let you know 
how this goes.Thanks a million again.
					</p>
				</div>
				<a name="comments-12937"></a>
				<div id="comment-12937" class="jive-content-comment ">
					<span>
						<span>
							Oct 22, 2009 6:26 PM
						</span>
							<!--<a href="/people/jberne74" title="Click to view jberne74's profile">
<img class="jive-avatar" src="/people/jberne74/avatar/16.png?a=-1" height="16" width="16" title="Click to view jberne74's profile" alt="Click to view jberne74's profile" />
</a>--><a href="http://communities.vmware.com/people/jberne74" 
id="jive-9N7Rf7P2R1c5MoB8" class="jive-username-link" title="Click to 
view jberne74's profile">jberne74</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12952" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12937">
					Thanks William.Everything's on track now. Apparently the original 
download was corrupt.Thanks again.
					</p>
				</div>
				<a name="comments-13003"></a>
				<div id="comment-13003" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 22, 2009 9:26 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-VDx2Gf1IHNPp5OH2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-13003">
					BETA email invitations will be going out this weekend ... keep an 
eye out <img class="jive-emoticon" src="DOC-8760_files/happy.gif" 
alt=":)" border="0"><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-12994"></a>
				<div id="comment-12994" class="jive-content-comment ">
					<span>
						<span>
							Oct 23, 2009 3:12 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-keSx8OJSt4nIhMR9" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13003" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-12994">
					Since we are getting close to Halloween walking around with an eye 
out won't be that noticeable. Good timing. <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0">
					</p>
				</div>
				<a name="comments-12996"></a>
				<div id="comment-12996" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 23, 2009 4:45 PM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-SKqTifSPtj7Wz6Qt" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12994" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12996">
					---<br>
<br>
I found the ghettoVCB.sh to work great!<br>
<br>
But how can I automaticlly generate the vm_backup_list.. so that the 
ghettoVCB.sh through cron will backup every vmware that is running on 
the VMWare ESXI 4.0 server ?<br>
<br>
I tried using "cat /tmp/vms_list | grep <a class="jive-link-adddocument"
 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=vmware">vmware</a>
 | sed ....something "  &gt; new_file_backup_list  <br>
(but I cant get this to work..)<br>
<br>
---
					</p>
				</div>
				<a name="comments-13005"></a>
				<div id="comment-13005" class="jive-content-comment ">
					<span>
						<span>
							Oct 23, 2009 9:03 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-PoqPTkQHKv8IO459" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12996" title="Go to message">stighenning</a>
							</em>
					</span>
					<p id="comment-body-13005">
					This code will generate a list of all VMs on the host. <br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/getallvms | awk -F " " '{print $2}' | sed '1,1d' &gt; /tmp/currentvms
</code></pre><br>
<br>
You can create a script that includes that and add <br>
<pre class="jive-pre"><code class="jive-code jive-plain">ghettoVCB.sh /tmp/currentvms
</code></pre><br>
You would need to add your paths etc and add your script to cron
					
				</div>
				<a name="comments-12938"></a>
				<div id="comment-12938" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 24, 2009 7:39 AM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-fvpDH42YL1E3EFko" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13005" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-12938">
					Hi,<br>
Your command works perfect with the images-names that do not have <u>spaces</u>
 in the name.<br>
But the images with spaces, i.e.   "WIN 2K3 PRODUCTION" will not be in 
the list properly..<br>
<br>
Is there a command that could cut out the "WIN 2K3 PRODUCTION" line in 
this /tmp/vms_list :<br>
<br>
"";"";""<br>
"Windows user/pass: administrator/&lt;Blank&gt;";"  ";""<br>
"576";"WIN 2K3 PRODUCTION";"<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=vmware">vmware</a>";"WIN
 2K3 PRODUCTION/Win2k3 32 bit.vmx"<br>
"";"";""
					</p>
				</div>
				<a name="comments-12939"></a>
				<div id="comment-12939" class="jive-content-comment ">
					<span>
						<span>
							Oct 24, 2009 7:47 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-RNm1eu62A2yqAr2D" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12938" title="Go to message">stighenning</a>
							</em>
					</span>
					<p id="comment-body-12939">
					The command provided by @DSTAVERT is not correct ... it's way more 
complicated than that when you have spaces/etc. that needs to be taken 
into consideration. The actual command is actually within the <b>ghettoVCB</b>
 script if anyone has taken a look at the source.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/getallvms | sed 's/[[:blank:]]\{3,\}/   /g' | awk -F'   ' '{print "\""$1"\";\""$2"\";\""$3"\""}' |  sed 's/\] /\]\";\"/g' | sed '1,1d'
</code></pre><br>
<br>
This will handle VM names that have spaces in their display name (a big 
no no in my books!)<br>
<br>
Just substitute wither <b>vmware-vim-cmd</b> for classic ESX or <b>vim-cmd</b>
 for ESXi<br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13006"></a>
				<div id="comment-13006" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 24, 2009 7:54 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-LsL1tmnIpgKhnnV8" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-12939" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13006">
					stighenning <br>
I am sorry. <img class="jive-emoticon" src="DOC-8760_files/sad.gif" 
alt=":(" border="0"> I keep forgetting that people do use spaces in 
names.
					</p>
				</div>
				<a name="comments-13015"></a>
				<div id="comment-13015" class="jive-content-comment ">
					<span>
						<span>
							Oct 24, 2009 11:58 AM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-0J12fekyQ7H2ew4D" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12939" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13015">
					This command feeds the /tmp/vms_list with data.<br>
But this list is filled with lines like:<br>
<br>
"16";"Windows XP";"<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=vmware">vmware</a>";"Windows
 XP/WindowsXP.vmx"<br>
<br>
..so a command that pulls out the word(s) before ";"<a 
class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=vmware">vmware</a>
    and put this into a new file.
					</p>
				</div>
				<a name="comments-13007"></a>
				<div id="comment-13007" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 24, 2009 12:27 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-OgQxU3dV5779bBN0" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13015" title="Go to message">stighenning</a>
							</em>
					</span>
					<p id="comment-body-13007">
					replace the <br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">{print "\""$1"\";\""$2"\";\""$3"\""} 
</code></pre><br>
 with  <br>
<pre class="jive-pre"><code class="jive-code jive-plain">{print $2) 
</code></pre>
					
				</div>
				<a name="comments-13016"></a>
				<div id="comment-13016" class="jive-content-comment ">
					<span>
						<span>
							Oct 24, 2009 1:13 PM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-vR9AT4zKs8JpDvt8" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13007" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-13016">
					Aha.. made it <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
1. touch /tmp/vm_backup_list (so the file actually exists!)<br>
2. edit the ghettoVCB.sh and add this to the script:<br>
<br>
</p><ol>
<li>Author: william2003<a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=at">at</a>gmail<a
 class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=dot">dot</a>com</li>
<li>Date: 11/01/2008</li>
</ol>
#<br>
<ol>
<li>This script is cron'd everyday to run backups on certain set of VMs 
and will overwite the previous backup if exists</li>
</ol>
<br>
<ol>
<li>ADD THESE LINES UNDER HERE:</li>
<li>sed '1d' - removes the first line (which says Name, and we only want
 to list VMwares)</li>
<li>sed '/^ *$/d' - removes empty lines and lines with only spaces</li>
<li>awk... - gives us the vmwares that are inside the vSphere inventory</li>
</ol>
#<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/getallvms | sed 's/[[:blank:]]\{3,\}/   /g' | awk -F'   ' '{print $2}' | sed '/^ *$/d' | sed '1d' &gt; /tmp/vm_backup_list
</code></pre><br>
<br>
It will now backup all the vmwares I can see in the vSphere Client. (I 
have about 20 vmwares in the inventory list with and wihtout spaces in 
names)<br>
<br>
..last part it to setup this with cron <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Thanx you for fast feedback to help me solve this issue!
					
				</div>
				<a name="comments-13017"></a>
				<div id="comment-13017" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 24, 2009 1:17 PM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-xtniy8rvhoD7TPT6" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13007" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-13017">
					??<br>
<br>
How can I paste "code" so that it does not edit the code ? (so you can 
read the code wihtout icon and blue letters)<br>
<br>
??
					</p>
				</div>
				<a name="comments-13008"></a>
				<div id="comment-13008" class="jive-content-comment ">
					<span>
						<span>
							Oct 24, 2009 1:29 PM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-HAp621NcdBR96O0p" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13017" title="Go to message">stighenning</a>
							</em>
					</span>
					<p id="comment-body-13008">
					use  {code} before and after your code.<br>
<br>
not like html no / in the code tag
					</p>
				</div>
				<a name="comments-13009"></a>
				<div id="comment-13009" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 25, 2009 1:43 AM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-huGMzJO8Xwl4Q606" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13008" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-13009">
					..<br>
..script been running good, backing up alot of my vmware that are <u>stopped</u>..
 but when it came to an image that was running, it fails:<br>
<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for Wiki_ATG ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Start time: Sun Oct 25 03:55:16 UTC 2009<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/vmware/Wiki_ATG/Wiki_ATG.vmdk'...<br>
Clone: 100% done.<br>
Removing snapshot from Wiki_ATG ...<br>
sh: /vmfs/volumes/nfs_storage_backup///Wiki_ATG/Wiki_ATG.vmsd: bad 
number<br>
./ghettoVCB.sh: line 473: syntax error: 
/vmfs/volumes/nfs_storage_backup///Wiki_ATG/Wiki_ATG.vmsd+1
					
				</div>
				<a name="comments-13045"></a>
				<div id="comment-13045" class="jive-content-comment ">
					<span>
						<span>
							Oct 25, 2009 1:38 PM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-4M3BDu5SoTv5Ug9F" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13009" title="Go to message">stighenning</a>
							</em>
					</span>
					<p id="comment-body-13045">
					I found there where an old folder with the same name in the 
"target". <br>
I deleted this folder on the target system, and ran the ghettoVCB.sh 
vm_backup_list again.. and this time it worked. <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" border="0">
					</p>
				</div>
				<a name="comments-13081"></a>
				<div id="comment-13081" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 28, 2009 8:50 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-T3i000GQu9hnKn09" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13081">
					I just downloaded the script to test it and cannot run. I get this 
message<br>
<br>
root@esx01 ghettovcb# ./ghettoVCB.sh backuplist<br>
-bash: ./ghettoVCB.sh: /bin/bash^M: bad interpreter: No such file or 
directory<br>
<br>
I am running VMware ESX 4.0.0 build-164009
					</p>
				</div>
				<a name="comments-13106"></a>
				<div id="comment-13106" class="jive-content-comment ">
					<span>
						<span>
							Oct 28, 2009 11:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-u08bhBNAmob8kj9T" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13081" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-13106">
					Did you edit the script in any way/shape or form on a Windows 
system? That is why you're seeing the ^M character when using something 
like a notepad program. Re-download and upload the script directly to 
the ESX(i) host and make your edits using VI<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13084"></a>
				<div id="comment-13084" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 28, 2009 12:21 PM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-IDfTyI1lMF4efFI2" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13106" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13084">
					I downloaded it to a windows PC. I then used vSphere client to 
upload it to a datastore.<br>
I ssh to the esx server and edited the file via VI. <br>
I did open it using notepad to see the text but did not save anything I 
simply closed it.<br>
<br>
I will try again. Thanks
					</p>
				</div>
				<a name="comments-13093"></a>
				<div id="comment-13093" class="jive-content-comment ">
					<span>
						<span>
							Oct 28, 2009 12:42 PM
						</span>
							<!--<a href="/people/jberne74" title="Click to view jberne74's profile">
<img class="jive-avatar" src="/people/jberne74/avatar/16.png?a=-1" height="16" width="16" title="Click to view jberne74's profile" alt="Click to view jberne74's profile" />
</a>--><a href="http://communities.vmware.com/people/jberne74" 
id="jive-2gI7OUKjAKHAaWE9" class="jive-username-link" title="Click to 
view jberne74's profile">jberne74</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13084" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-13093">
					I suggest uploading the file with WinSCP as text and editing in 
using the vi editor in Putty.
					</p>
				</div>
				<a name="comments-13094"></a>
				<div id="comment-13094" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 29, 2009 2:34 AM
						</span>
							<!--<a href="/people/stighenning" title="Click to view stighenning's profile">
<img class="jive-avatar" src="/people/stighenning/avatar/16.png?a=-1" height="16" width="16" title="Click to view stighenning's profile" alt="Click to view stighenning's profile" />
</a>--><a href="http://communities.vmware.com/people/stighenning" 
id="jive-8O2e83bh9fSTqvsI" class="jive-username-link" title="Click to 
view stighenning's profile">stighenning</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13081" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-13094">
					To remove the ^M from the file, do this;<br>
<br>
sed 's/.$//' ghettoVBC.sh &gt; NewghettoVCB.sh<br>
<br>
..it will work <img class="jive-emoticon" src="DOC-8760_files/happy.gif"
 alt=":)" border="0">
					</p>
				</div>
				<a name="comments-13095"></a>
				<div id="comment-13095" class="jive-content-comment ">
					<span>
						<span>
							Oct 29, 2009 5:40 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-pbEx4b4bPHW9aCjD" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13094" title="Go to message">stighenning</a>
							</em>
					</span>
					<p id="comment-body-13095">
					Thank you guys for your suggestions, they were very helpful.<br>
The script now runs and works great however I get this message below. Is
 this something that I can fix?<br>
<br>
DiskLib_Check() failed for source disk The system cannot find the file 
specified (25).
					</p>
				</div>
				<a name="comments-13098"></a>
				<div id="comment-13098" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 29, 2009 7:31 PM
						</span>
							<!--<a href="/people/cwkoh" title="Click to view cwkoh's profile">
<img class="jive-avatar" src="/people/cwkoh/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwkoh's profile" alt="Click to view cwkoh's profile" />
</a>--><a href="http://communities.vmware.com/people/cwkoh" 
id="jive-Bd25Slg1bmJ58b9V" class="jive-username-link" title="Click to 
view cwkoh's profile">cwkoh</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12940" title="Go to message">S3BASTI3N</a>
							</em>
					</span>
					<p id="comment-body-13098">
					Hi S3BAST13N. I am also looking to exclude backup od "independent" 
disk. Can you share with us how to modify the script to do so. Thanks.
					</p>
				</div>
				<a name="comments-13110"></a>
				<div id="comment-13110" class="jive-content-comment ">
					<span>
						<span>
							Oct 29, 2009 7:51 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5kAS6ot3Rn8rTyXy" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13098" title="Go to message">cwkoh</a>
							</em>
					</span>
					<p id="comment-body-13110">
					FYI - Independent disk logic will be added to the next release of 
ghettoVCB <img class="jive-emoticon" src="DOC-8760_files/happy.gif" 
alt=":)" border="0"><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13099"></a>
				<div id="comment-13099" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 29, 2009 8:08 PM
						</span>
							<!--<a href="/people/cwkoh" title="Click to view cwkoh's profile">
<img class="jive-avatar" src="/people/cwkoh/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwkoh's profile" alt="Click to view cwkoh's profile" />
</a>--><a href="http://communities.vmware.com/people/cwkoh" 
id="jive-zs6TUJGnmtlHh1vD" class="jive-username-link" title="Click to 
view cwkoh's profile">cwkoh</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13110" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13099">
					Great. Is this also in the beta. Can I have a copy to test. Thx.
					</p>
				</div>
				<a name="comments-13111"></a>
				<div id="comment-13111" class="jive-content-comment ">
					<span>
						<span>
							Oct 29, 2009 8:10 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-md8KVQVCQKpUcoqf" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13099" title="Go to message">cwkoh</a>
							</em>
					</span>
					<p id="comment-body-13111">
					Yea that'll be in the next release and sorry the BETA is closed. I 
should have a new release of the script soon enough <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13100"></a>
				<div id="comment-13100" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 29, 2009 8:39 PM
						</span>
							<!--<a href="/people/cwkoh" title="Click to view cwkoh's profile">
<img class="jive-avatar" src="/people/cwkoh/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwkoh's profile" alt="Click to view cwkoh's profile" />
</a>--><a href="http://communities.vmware.com/people/cwkoh" 
id="jive-fvelxjvTWiT8tEFD" class="jive-username-link" title="Click to 
view cwkoh's profile">cwkoh</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13111" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13100">
					OK I'll wait for the release then
					</p>
				</div>
				<a name="comments-13101"></a>
				<div id="comment-13101" class="jive-content-comment ">
					<span>
						<span>
							Oct 30, 2009 4:54 AM
						</span>
							<!--<a href="/people/lukechip" title="Click to view lukechip's profile">
<img class="jive-avatar" src="/people/lukechip/avatar/16.png?a=-1" height="16" width="16" title="Click to view lukechip's profile" alt="Click to view lukechip's profile" />
</a>--><a href="http://communities.vmware.com/people/lukechip" 
id="jive-6N4vFIiAxvgN3pPQ" class="jive-username-link" title="Click to 
view lukechip's profile">lukechip</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13101">
					Hi,<br>
<br>
How is ghettoVCB supposed to handle VMs that are in a suspended state ? 
 I'm just starting to play around with ghettoVCB now, and I'm finding 
that when ghettoVCB hits a machine which:<br>
<br>
1/ is suspended, and<br>
2/ has no snapshots<br>
<br>
It takes snapshot, backs it up, but DOES NOT delete the snapshot it took
 as part of the backup.<br>
<br>
Consequently, next time I try to backup the machine, when it is in a 
powered on state, the backup fails since there is a pre-existing 
snapshot (called vcb_snap).<br>
<br>
Am I missing something ?
					</p>
				</div>
				<a name="comments-13102"></a>
				<div id="comment-13102" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 30, 2009 6:48 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-w9N3226wC8tkMzrg" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13101" title="Go to message">lukechip</a>
							</em>
					</span>
					<p id="comment-body-13102">
					Yep, the logic when taking the snapshot is correct, but upon 
removal it only checks for "Powered On" VMs only, this has been fixed 
and will be ported to the next release of the script. In the meantime, 
if you would like to update the script just search for the section where
 the snapshot is removed and add and "OR" statement that says:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain"> \[\[ "${ORGINAL_VM_POWER_STATE}" == "Suspended" \]\]
</code></pre><br>
<br>
This will solve the problem.<br>
<br>
Thanks for the comments <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/private/bitbucket/developer/codecentral"
 title="Sample code for VMware vSphere SDKs and APIs">VMware Code 
Central - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/private/bitbucket/developer"
 title="Resources for Administrators and Developers">VMware Developer 
Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13103"></a>
				<div id="comment-13103" class="jive-content-comment ">
					<span>
						<span>
							Oct 30, 2009 7:26 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-2SOzUuvR7m9Ug2Ro" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13102" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13103">
					I have been testing the script for a couple days, and it seems to 
work fine. I have a couple questions:<br>
<br>
1) Should the nvram and log files be also backed up? I only see the .vmx
 and .vmdk files<br>
2) In some VMs I get this message but the backup still works<br>
DiskLib_Check() failed for source disk The system cannot find the file 
specified (25). <br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-13112"></a>
				<div id="comment-13112" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 30, 2009 10:00 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-873ROiOEapeHU9n2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13103" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-13112">
					1) No, these files are not explicitly required (nvram will be 
generated upon boot up if not there) The logs may or may not be useful, 
depends on what you'll use them for and you could have quit a few logs. 
This can easily be added as a additional files but won't be part of this
 script<br>
<br>
2) Can you provide more information about the environment, the VMDK(s) 
you're trying to backup? There's probably something going on with the 
disk it's trying to clone either at the source or destination. Would be 
helpful to provide some output from your run, as your error is vague in 
general. Remember to wrap all output in {code} tags<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13135"></a>
				<div id="comment-13135" class="jive-content-comment ">
					<span>
						<span>
							Oct 31, 2009 3:45 AM
						</span>
							<!--<a href="/people/lukechip" title="Click to view lukechip's profile">
<img class="jive-avatar" src="/people/lukechip/avatar/16.png?a=-1" height="16" width="16" title="Click to view lukechip's profile" alt="Click to view lukechip's profile" />
</a>--><a href="http://communities.vmware.com/people/lukechip" 
id="jive-P88z0U4jC6kbmjPa" class="jive-username-link" title="Click to 
view lukechip's profile">lukechip</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13135">
					My backups only contain the .vmdk and .vmx files.  Consequently, 
when I restore the machine using vmkfstools, the resultant machine is in
 a powered off state.  This took me a little by surprise, since the 
machine was powered on when the backup was taken, and I'd expected it to
 be restored in exactly the same state.<br>
<br>
As a result, my questions are:<br>
<br>
1/ is this the intended behaviour<br>
2/ is there any risk of memory resident or cached data that has not been
 written to the VMs disk being lost ?  For example, an unsaved file that
 is open when the backup is taken, or data that has been saved but is in
 the VMs operating system cache, and not actually written to the VMs 
disk ?<br>
<br>
Thanks.
					</p>
				</div>
				<a name="comments-13150"></a>
				<div id="comment-13150" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 31, 2009 11:37 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-A2EndY0f29wpQvD9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13135" title="Go to message">lukechip</a>
							</em>
					</span>
					<p id="comment-body-13150">
					1) Yes that is the intended behavior as stated in the previous 
reply<br>
2) Using the <b>quiesce</b> option would solve this problem, take a look
 here for more details: <a class="jive-link-external" 
href="http://virtualizationreview.com/Blogs/Everyday-Virtualization/2009/08/Quiesced-Snapshots.aspx">http://virtualizationreview.com/Blogs/Everyday-Virtualization/2009/08/Quiesced-Snapshots.aspx</a><br>
<br>
As of today, this is disabled by default but in the next release of the 
script, a user can configure both the quiesce and memory option of a VM 
when specifying a backup snapshot prior to backup. You can manually 
change the value in the script but it'll be a manual process.   <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13136"></a>
				<div id="comment-13136" class="jive-content-comment ">
					<span>
						<span>
							Oct 31, 2009 7:43 PM
						</span>
							<!--<a href="/people/lukechip" title="Click to view lukechip's profile">
<img class="jive-avatar" src="/people/lukechip/avatar/16.png?a=-1" height="16" width="16" title="Click to view lukechip's profile" alt="Click to view lukechip's profile" />
</a>--><a href="http://communities.vmware.com/people/lukechip" 
id="jive-WlI83mYRnI7OlzDQ" class="jive-username-link" title="Click to 
view lukechip's profile">lukechip</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13150" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13136">
					Regarding "If you find this information useful, please award points
 for "correct" or "helpful"."...<br>
<br>
How do I do this ?<br>
<br>
I'd like to, but can't see where to do it !
					</p>
				</div>
				<a name="comments-13151"></a>
				<div id="comment-13151" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 2, 2009 7:54 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-q5Rsbt9O1BoBJxFQ" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13112" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13151">
					Will,<br>
1) Thanks for your responses. Agreed. nvram and log files may not be 
useful. If I wanted to copy the log files and nvram I could only add 2 
lines in your script after line 266 correct?<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain"> cp "${VMX_PATH}" "${VM_BACKUP_DIR}" 
</code></pre> <br>
to something like <br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">cp ${VMX_DIR}/*.log ${VM_BACKUP_DIR}
</code></pre><br>
<pre class="jive-pre"><code class="jive-code jive-plain">cp ${VMX_DIR}/*.nvram ${VM_BACKUP_DIR}
</code></pre><br>
<br>
2) I could not replicate the error "DiskLib_Check() failed for source 
disk The system cannot find the file specified (25)" anymore, I do not 
know what I did different with the test VM I have. I will post what I 
can if it happens again.<br>
<br>
3) I noted that in your script, line 227 you have a check for existing 
snapshots and if found the backup is not performed. Do you do that for a
 special reason? wouldn't the script take a new snapshot (vcb_snap) 
below the other ones and remove it at the end? is this supported?
					
				</div>
				<a name="comments-13124"></a>
				<div id="comment-13124" class="jive-content-comment ">
					<span>
						<span>
							Nov 2, 2009 9:41 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6Lme1K5jJYBU5ld9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13151" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-13124">
					1) That <u>should</u> work, you'll want to test and verify.<br>
<br>
3) Snapshots are not meant to be kept for long durations of time, there 
is a miss-conceptions on what snapashots are used for. They should be 
short lived and hence I will ignore any VMs with prior snapshots, you're
 more than welcome to modify the script to support this, but I will 
provide 0 support on this type of configuration. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13165"></a>
				<div id="comment-13165" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 3, 2009 10:21 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-j4RTRFaQuD6NC6ru" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13124" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13165">
					1) After line 266 <br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">cp "${VMX_PATH}" "${VM_BACKUP_DIR}"
</code></pre><br>
<br>
I added these 2 lines to also copy the nvram and log files<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">cp ${VMX_DIR}/*.log ${VM_BACKUP_DIR}
</code></pre><br>
<pre class="jive-pre"><code class="jive-code jive-plain">cp ${VMX_DIR}/*.nvram ${VM_BACKUP_DIR}
</code></pre><br>
<br>
3) Agreed. VMware snapshots should be short lived, however on 
testing/prestaging VMs sometimes you need to keep a snapshot for 24 
hours or so.<br>
<br>
I tested the script with more than 1 snapshot and I think I understand 
why it won't support more than 1 snapshot because it will only remove 1 
snapshot, the vcb_snap snapshot taken for the backup. If Iâ€™m not wrong 
this is in line 384<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">${VMWARE_CMD} vmsvc/snapshot.remove ${VM_ID} &gt; /dev/null 2&gt;&amp;1
</code></pre><br>
<br>
It's very tricky trying to remove a specific snapshot due to the levels 
and indexes for snapshots. If VMware could have a way to delete a 
snapshot based on the name of the snapshot that would eliminate many 
caveats. <br>
<br>
I'm adapting the script to our environment. So I am doing these other 
changes/additions:<br>
<br>
a) Allow the backup to proceed if snapshots are found and remove all 
snapshots (I chose I prefer a backup over a previous snapshot). So I 
commented out the snapshot check and modified the script in line 384 to 
this: <br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">${VMWARE_CMD} vmsvc/snapshot.removeall ${VM_ID} &gt; /dev/null 2&gt;&amp;1
</code></pre><br>
<br>
b) A boolean (true/false) variable/parameter to also snap the memory 
when creating the snapshot. Example below<br>
<pre class="jive-pre"><code class="jive-code jive-plain">${VMWARE_CMD} vmsvc/snapshot.create ${VM_ID} vcb_snap VCB_BACKUP_${VM_NAME}_`date +%F` ${SNAP_MEMORY} &gt; /dev/null 2&gt;&amp;1
</code></pre><br>
<br>
c) I added a line at the end of the script to add permissions at my 
backup dir specified (openfiler SMB/NFS share)in the VM_BACKUP_VOLUME 
parameter. <br>
<pre class="jive-pre"><code class="jive-code jive-plain">chmod -R +rw ${VM_BACKUP_VOLUME}
</code></pre><br>
I noticed that the files/folder created by the script had root 
permissions only so when the backup software tried to access the files 
to back them up it failed. <br>
<br>
d) I also added a notification procedure at the end of the script to 
email the log created<br>
<br>
I tested the script with my modifications/additions and works fine in 
our environment<br>
<br>
Thanks Will for providing this script as it's a great contribution and 
useful tool and other people can also contribute to your work. <br>
Can't wait to see the next release that will contain the independent 
disk logic and quiesce memory option of a VM (and more perharps?)
					
				</div>
				<a name="comments-13149"></a>
				<div id="comment-13149" class="jive-content-comment ">
					<span>
						<span>
							Nov 3, 2009 8:20 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-kpbYYxj5C8T84wbH" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13165" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-13149">
					There are actually 2 reasons why I don't support backup of VMs 
w/snapshots<br>
1) Reason from previous reply<br>
2) It's not easy using <b>vimsh</b> ... having said that, it's stupid 
simple using the official VI/vSphere API's which allows you to remove a 
snapshot based on a name. This can be seen with <a 
class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-9843">ghettoVCBg2 - Free 
alternative for backing up VMs in ESX(i) 3.5 and 4.x (no SSH console 
required!)</a> if you take a look at the code, but again even with this 
version I do not support backups of a VMs with snapshots (going back to 
reason #1) <br>
<br>
Having said all that, it's definitely possible with <b>vimsh</b> but you
 just have to figure out the index/child values which I thought I had 
figured out but it's really not worth it and again goes back to my 
reason #1<br>
<br>
Glad the script is working out for you and the customization you're 
implementing for your specific environment.<br>
<br>
Definitely keep an eye out in next few weeks for the next release, it'll
 be introducing some nice features <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
--William<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13168"></a>
				<div id="comment-13168" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 5, 2009 3:20 AM
						</span>
							<!--<a href="/people/kerozen" title="Click to view kerozen's profile">
<img class="jive-avatar" src="/people/kerozen/avatar/16.png?a=-1" height="16" width="16" title="Click to view kerozen's profile" alt="Click to view kerozen's profile" />
</a>--><a href="http://communities.vmware.com/people/kerozen" 
id="jive-IpvN4s5IAO7ti00w" class="jive-username-link" title="Click to 
view kerozen's profile">kerozen</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13168">
					Hi,<br>
<br>
thanks a lot for this script.<br>
It's working fine in our environnment but it take so long to backup.<br>
<br>
In fact, i backup vms to an nfs share on a little nas (iomega storcenter
 pro ix4-100) which is very slow for read and write (even in ftp or smb 
mode).<br>
<br>
so i realize that ghettoVCB.sh does the backup directly to this share 
and then compress the vm on the share (when i enable compress of 
course).<br>
<br>
Is it possible to do the snapshot locally, compress the backup and then 
send it to share (then delete the local compressed backup). In this 
order, i will gain some time to backup vms.<br>
The only thing i need is enough space for locally backing up the biggest
 vm.<br>
<br>
thanks by advance.<br>
<br>
ben
					</p>
				</div>
				<a name="comments-13195"></a>
				<div id="comment-13195" class="jive-content-comment ">
					<span>
						<span>
							Nov 5, 2009 3:35 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-0S387s781CPJOuA6" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13168" title="Go to message">kerozen</a>
							</em>
					</span>
					<p id="comment-body-13195">
					I've used a Iom200rl in the past and their NFS performance is not 
great. You should check how fast it transfers from the esx console 
(without using the script). Also you can tweak nas' exports config 
(async, no_wdelay, etc, but be careful with this, use at you own risk!) 
or try using jumbo frames, if your hardware supports it. I've 
experienced a huge increase of transfer rate with these.
					</p>
				</div>
				<a name="comments-13169"></a>
				<div id="comment-13169" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 5, 2009 3:41 AM
						</span>
							<!--<a href="/people/kerozen" title="Click to view kerozen's profile">
<img class="jive-avatar" src="/people/kerozen/avatar/16.png?a=-1" height="16" width="16" title="Click to view kerozen's profile" alt="Click to view kerozen's profile" />
</a>--><a href="http://communities.vmware.com/people/kerozen" 
id="jive-d472qfS0Oaiuwss6" class="jive-username-link" title="Click to 
view kerozen's profile">kerozen</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13195" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-13169">
					Hi,<br>
<br>
the transfer rate is not really a problem. The real problem of the 
iomega is the I/O of the disks.<br>
<br>
The best solution will be to compress before send the backup to the nas.
 (if space is available of course)<br>
<br>
with this, less data to send to the nas, less time to send it.<br>
<br>
i will look for jumbo frame too (the esxi nic, the switch and the nas 
have to support it)
					</p>
				</div>
				<a name="comments-13196"></a>
				<div id="comment-13196" class="jive-content-comment ">
					<span>
						<span>
							Nov 5, 2009 4:47 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-baQc0V046jPA90ki" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13169" title="Go to message">kerozen</a>
							</em>
					</span>
					<p id="comment-body-13196">
					When I said transfer rate I didn't mean "network bandwidth". Jumbo 
frames can improve the situation if its related to network. Poor NFS 
performance can be related to network and to storage I/O; async and 
no_wdelay can improve the NFS performance when saving data.<br>
To see which one you have to tweak you could do some testing with cat or
 dd with /dev/zero and /dev/null with ssh without compression and nfs. 
If it's fast (well, fast enough for a storcenter) then the bottleneck 
it's the NFS saving data and then those params I said above can make 
things a little better.<br>
<br>
I think your proposal would require a major overhaul of the script. 
Meanwhile, if you have enough local space, you can set a local dir as 
VM_BACKUP_VOLUME, and after the script has ended, move the backups to 
the storcenter with a different script (quite easy to code because you 
can copy the rotation procedure from the original script).
					</p>
				</div>
				<a name="comments-13198"></a>
				<div id="comment-13198" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 5, 2009 7:12 AM
						</span>
							<!--<a href="/people/kerozen" title="Click to view kerozen's profile">
<img class="jive-avatar" src="/people/kerozen/avatar/16.png?a=-1" height="16" width="16" title="Click to view kerozen's profile" alt="Click to view kerozen's profile" />
</a>--><a href="http://communities.vmware.com/people/kerozen" 
id="jive-F7uLIGPBxv6zxXvk" class="jive-username-link" title="Click to 
view kerozen's profile">kerozen</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13196" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-13198">
					thanks.<br>
<br>
i will look deep in this jumbo frame. easy on the iomega (just one click
 to activate jumbo frame support), i've read that i need to create a new
 virtual switch on esxi and define the mtu size for frame. sounds a bit 
more complex.<br>
<br>
i've just ended trying to backup four vms to the little nas, compressing
 each one.<br>
<br>
i got a big vmdk that was not stored in the gzipped file, the script 
return this error: tar: cannot store file 'XXXXXXX/xxxx-flat.vmdk' of 
size 107374182400, aborting.<br>
<br>
so i ended with a gzipped file of 104 Bytes.<br>
<br>
i will look into the script to see how i can do a local save then copy 
over the nfs share, as you suggest.
					</p>
				</div>
				<a name="comments-13260"></a>
				<div id="comment-13260" class="jive-content-comment ">
					<span>
						<span>
							Nov 10, 2009 2:11 AM
						</span>
							<!--<a href="/people/CBrienen" title="Click to view CBrienen's profile">
<img class="jive-avatar" src="/people/CBrienen/avatar/16.png?a=-1" height="16" width="16" title="Click to view CBrienen's profile" alt="Click to view CBrienen's profile" />
</a>--><a href="http://communities.vmware.com/people/CBrienen" 
id="jive-2NDiYm1zBSa4dqLr" class="jive-username-link" title="Click to 
view CBrienen's profile">CBrienen</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12597" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13260">
					Hi William,<br>
<br>
I have the exact same problem as Davidpyper described in his post from 
28 Sep 2009. I have been using your script for a while now and never had
 any problems. Since a couple of weeks the script sometimes "hangs" 
while removing a snapshot. If I look in VC I see a snapshot in the 
snapshot manager of that particulary date. If I remove the snapshot the 
script continues and starts snapshotting the upcoming VM's. Before the 
script starts there are NO snapshot present in VC. It is not consistent 
so I don't know where to look. Any idea where to look?<br>
<br>
Thanks for the script.<br>
<br>
Christian
					</p>
				</div>
				<a name="comments-13267"></a>
				<div id="comment-13267" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 11, 2009 9:19 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-z2rshjE1lTFb2WKu" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13260" title="Go to message">CBrienen</a>
							</em>
					</span>
					<p id="comment-body-13267">
					I've not seen this issue from others and haven't been able to 
reproduce. Are there anything specific with this VM in particular or set
 of VMs? Have you tried to backup other VMs except for this one to see 
if it's only this VM? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13336"></a>
				<div id="comment-13336" class="jive-content-comment ">
					<span>
						<span>
							Nov 12, 2009 11:15 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-tKiSwjQ2cp62WnBU" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12730" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13336">
					Hmm - OK looking into this again. It always fails on the 3rd VM 
regardless of size of that VM or the preceeding VM.
					</p>
				</div>
				<a name="comments-13346"></a>
				<div id="comment-13346" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 16, 2009 7:45 PM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-Y0ABjs4L95IYDm7v" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13346">
					I'm trying to backup one VM with two vmdk files. I've installed the
 latest GhettoVCB, but when I try to run "./GhettoVCB.sh serverlist" I 
get the following error:<br>
<br>
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 # ./ghettoVCB.sh 
serverlist<br>
Skipping invalid VM '368'<br>
Skipping invalid VM '384'<br>
Skipping invalid VM '400'<br>
Segmentation fault<br>
</p><ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for Sharepoint2008x64 ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Start time: Tue Nov 17 03:38:42 UTC 2009<br>
Destination disk format: VMFS thick<br>
Failed to open 
'/vmfs/volumes/BackupsStore/Sharepoint2008x64/Sharepoint2008x64_1.vmdk':
 Device or resource busy (1048585).<br>
Destination disk format: VMFS thick<br>
Failed to open 
'/vmfs/volumes/BackupsStore/Sharepoint2008x64/Sharepoint2008x64.vmdk': 
Device or resource busy (1048585).<br>
Compressing VM backup 
"/vmfs/volumes/NFS/Sharepoint2008x64/Sharepoint2008x64-2009-11-17.gz"...<br>
ash: /vmfs/volumes/NFS/Sharepoint2008x64/Sharepoint2008x64-2009-11-16: 
bad number<br>
./ghettoVCB.sh: ./ghettoVCB.sh: 462: Syntax error: 
/vmfs/volumes/NFS/Sharepoint2008x64/Sharepoint2008x64-2009-11-16+1<br>
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 #
					
				</div>
				<a name="comments-13360"></a>
				<div id="comment-13360" class="jive-content-comment ">
					<span>
						<span>
							Nov 16, 2009 7:51 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8kdkiyEy5kE67Le2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13346" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-13360">
					1) Please wrap any output you have in code tags, makes it much more
 readable on the forums. Please refer to this document if you have any 
questions: <a class="jive-link-external" 
href="http://communities.vmware.com/markuphelpfull.jspa">http://communities.vmware.com/markuphelpfull.jspa</a><br>
<br>
2) How many VMs do you have on this host?<br>
<br>
3) Is this ESX(i) and what build/version?<br>
<br>
4) Can you please run the following command and paste the results:<br>
<br>
ESX<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/getallvms
</code></pre><br>
<br>
ESXi<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/getallvms
</code></pre><br>
<br>
It looks like when it's querying for certain VMs, they're considered 
'invalid' for some reason and probably why you're getting the initial 
dump. <br>
<p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13376"></a>
				<div id="comment-13376" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 17, 2009 6:25 AM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-7WcrDSC4zXQL09Bg" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13360" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13376">
					Hopefully this paste works better:<br>
</p><div class="jive-quote">
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 # ./ghettoVCB.sh 
serverlist<br>
Skipping invalid VM '368'<br>
Skipping invalid VM '384'<br>
Skipping invalid VM '400'<br>
Segmentation fault<br>
<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Taking backup snapshot for Sharepoint2008x64 ... ################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
Start time: Tue Nov 17 13:41:20 UTC 2009<br>
Destination disk format: VMFS thick<br>
Failed to open 
'/vmfs/volumes/BackupsStore/Sharepoint2008x64/Sharepoint2008x64_1.vmdk':
 Device or resource busy (1048585).<br>
Destination disk format: VMFS thick<br>
Failed to open 
'/vmfs/volumes/BackupsStore/Sharepoint2008x64/Sharepoint2008x64.vmdk': 
Device or resource busy (1048585).<br>
Compressing VM backup 
"/vmfs/volumes/NFS/Sharepoint2008x64/Sharepoint2008x64-2009-11-17.gz"...<br>
End time: Tue Nov 17 13:41:20 UTC 2009<br>
<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>

<ol>
<li>Completed backup for Sharepoint2008x64! ####################</li>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
</ol>
<p>
Start time: Tue Nov 17 13:41:10 UTC 2009<br>
End   time: Tue Nov 17 13:41:20 UTC 2009<br>
Duration  : 10 Seconds<br>
<br>
Completed backing up specified Virtual Machines!<br>
<br>
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 #<br>
</p></div>
<br>
I have six guests installed, ESXi version is 3.5.0<br>
<br>
<div class="jive-quote">
~ # vim-cmd vmsvc/getallvms<br>
Vmid          Name                                    File              
                     Guest OS          Version   Annotation<br>
112    vmXP                 <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=BackupsStore">BackupsStore</a>
 vmXP/vmXP.vmx                               winXPProGuest           
vmx-04<br>
208    FreeBSD71            <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=BackupsStore">BackupsStore</a>
 vmFreeBSDx64/vmFreeBSDx64.vmx               otherLinuxGuest         
vmx-04<br>
416    ArchiveManager2003   <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=BackupsStore">BackupsStore</a>
 ArchiveManager2003/ArchiveManager2003.vmx   winNetEnterpriseGuest   
vmx-04<br>
432    Sharepoint2008x64    <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=BackupsStore">BackupsStore</a>
 Sharepoint2008x64/Sharepoint2008x64.vmx     winLonghorn64Guest      
vmx-04<br>
448    LegalFiles           <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=BackupsStore">BackupsStore</a>
 LegalFiles/LegalFiles.vmx                   winLonghorn64Guest      
vmx-04<br>
96     vmBackup2003x64      <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=datastore2">datastore2</a>
 vmBackup2003x64/vmBackup2003x64.vmx           winNetStandard64Guest   
vmx-04<br>
~ #<br>
</div>
<br>
I'm only trying to backup one of the VM's (Sharepoint2008x64). It runs 
with errors if I shutdown the VM.
					
				</div>
				<a name="comments-13361"></a>
				<div id="comment-13361" class="jive-content-comment ">
					<span>
						<span>
							Nov 17, 2009 7:38 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-IH7aAVV33oB0tvch" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13361">
					Great that policy based backup has been added.<br>
<br>
The only thing still missing IMHO is the possibility to take a snapshort
 in powerdown state before backup. Depending on guest OS and running 
apps this is the only way to get a reliable backup. How about an 
additional setting TAKE_SNAPSHOT_ON_POWER_DOWN=1. Then the sequence 
would be as follows:<br>
<br>
Power machine down,<br>
Take snapshot,<br>
Power up,<br>
Take backup,<br>
Remove snapshot<br>
<br>
Taking a backup only with the setting POWER_VM_DOWN_BEFORE_BACKUP=1 can 
be quite time consuming and is not always an option.<br>
<br>
IIRC this feature has been requested by two others. So how about?<br>
<br>
Thanks again for that great software.
					</p>
				</div>
				<a name="comments-13362"></a>
				<div id="comment-13362" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 17, 2009 9:43 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-cXHeso955x49tD19" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13376" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-13362">
					I've just released a new version of the script, please download 
this version and go over the documentation as there have been some 
changes on using the script. There were some issues that may have been 
fixed which might help resolve the issue you're running. <br>
<br>
If you're still seeing the issue, please provide an execution run on the
 <u>vm</u> that is failing with both <b>dryrun</b> and <b>debug</b> 
mode.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13364"></a>
				<div id="comment-13364" class="jive-content-comment ">
					<span>
						<span>
							Nov 17, 2009 9:48 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7o9b73Nk0DUkBGIT" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13361" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-13364">
					Sorry this feature will not be supported as mentioned in the past, 
there are no significant advantages to this and I'm not exactly sure 
what you're deeming <b>"reliable backup"</b>. You're more than welcome 
to look at other Enterprise ready solutions if you need something more <u>reliable</u>
 ... and of course you're more than welcome to edit the script to fit 
your environment. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13347"></a>
				<div id="comment-13347" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 17, 2009 10:53 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-Mg0c7Fwg6nWfExHM" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13364" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13347">
					I did not realize that it was mentioned in the past that it will 
not be supported, so I'm sorry for missing that. With "reliable backup" I
 don't want to say that ghettoVCB is not reliable, so don't feel 
offended. However depending on the apps and the os you are running you 
cannot always be sure that you have a consitent state on disk when 
taking a snapshot while the machine is running.<br>
<br>
This is a similar thing like with VSS on MS Windows. Without apropriate 
VSS writer for certain apps you are running you cannot be sure that a 
consitent state is written on disk when you take a snapshot. As this 
mechanism (IPC between app, os and vmware) is missing on VMware (or at 
least I'm not aware of it) with certain apps (e.g. dbms) a snapshot will
 have a good chance to be corrupt on application level (on filesystem 
level it will be intact of course).<br>
<br>
If I'm missing anything obvious please let me know.<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-13366"></a>
				<div id="comment-13366" class="jive-content-comment ">
					<span>
						<span>
							Nov 17, 2009 12:03 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-r5v1n8HvRUPpdI9s" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13347" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-13366">
					I agree, but that's where enabling the quiesce of the snapshot 
comes into play and of course this is also OS dependent and if you have 
VMware Tools installed. You'll either use the default filesystem sync 
driver or VSS if you're on a Windows OS. Even with using other solutions
 like Veeam or vDR, you're still using a snapshot like solution and they
 also rely on quiescing the filesystem to ensure that you have a 
consistent backup.<br>
<br>
Hope this helps<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13348"></a>
				<div id="comment-13348" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 17, 2009 12:44 PM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-020UbVSNSIOOX9I4" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13366" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13348">
					Ok not sure how exactly quiesce works with VMware. From what I 
found so far it seems that it triggers all VSS writers and so tries to 
ensure all data is written to disk before taking the snapshot. So if you
 have a system with VSS writers for all apps properly set up this should
 work. I will make some tests with that option to see if it works 
reliable. However I thik I will modify the scripts to support taking 
snapshots on power down state just to be on the safe side. Seems to be 
possible without big changes. IMHO this is still a good option as it 
ensures integrity and dramatically reduces downtime compared to taking a
 backup in power down state.<br>
<br>
Thanks again for developing ghettoVCB and sharing it with the community.<br>
<br>
Regards,<br>
goppi.
					</p>
				</div>
				<a name="comments-13351"></a>
				<div id="comment-13351" class="jive-content-comment ">
					<span>
						<span>
							Nov 18, 2009 6:59 AM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-Yj09047tLoV4eS8r" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13362" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13351">
					That did it. I'm backing it up now. Thanks for your help on this 
and the new features.<br>
I haven't tried the snapshot quiesce or snapshot memory, but if I'm 
running MS-SQL on this server is there a reason why I wouldn't use it? (
 I already have VSS turned on)<br>
<br>
Oh, one minor typo I found in the ghettVCB.sh file. You have  
"VMDK_FILES_TO_BACKUP=" inside the area that says not to edit below this
 line. No big deal, just thought you might want to know.<br>
<br>
I work for a non-profit so we have little funds for IT. Your script has 
allowed us to evaluate Vmware and virtualization options. Thanks again.
					</p>
				</div>
				<a name="comments-13352"></a>
				<div id="comment-13352" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 18, 2009 7:05 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-L54tbSVgiG0S8qwe" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13351" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-13352">
					Glad to hear the new release fixed the issues. <br>
<br>
I would definitely do some research on backing up any database systems, 
but there shouldn't be any reason why it won't work and I'm sure others 
have done it. If you already have VMware Tools installed and have VSS 
enabled, then yes you should be using snapshot quiesce option, the 
memory really is more for testing purposes and since the .vmsd and .vmss
 is not backed up as it only pertains to the snaspshot created.<br>
<br>
For a deep dive on how VMware snapshots works, take a look at this 
VMware KB: <a class="jive-link-external" 
href="http://kb.vmware.com/kb/1015180">http://kb.vmware.com/kb/1015180</a><br>
<br>
Regarding the variable, I meant to put it there <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
The reason is by default if you don't use individual VM backup policy, 
it'll backup all <b>"valid"</b> VMDK(s) ... there is no concept of an 
exclusion/inclusion list as that is only supported with backup policy 
for each VM.<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13369"></a>
				<div id="comment-13369" class="jive-content-comment ">
					<span>
						<span>
							Nov 18, 2009 1:17 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-g756M8xqjQxGP76B" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13352" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13369">
					The new script is very slick - thanks very much.<br>
<br>
Just curious about these two lines from std out:<br>
<br>
sleep: Interrupted system call<br>
wc: standard input: Interrupted system call<br>
<br>
Edit: I also note that the cron faq has not been updated to the new 
syntax e.g. "ghettoVCB.sh -f vmlist"
					</p>
				</div>
				<a name="comments-13391"></a>
				<div id="comment-13391" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 18, 2009 7:43 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-a6Vi3clGdu2V2Nrp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13369" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-13391">
					Glad to hear you're enjoying the new features of the script!<br>
<br>
Regarding the output, I'm not sure where thats coming from ... sounds 
like something might have interrupted the syscall and hence the output. 
Could you provide more details about your environment, ESX(i) host, 
version, etc...? Are you able to consistently reproduce, without 
reproducibility, it'll be very hard for me to help troubleshoot. <br>
<br>
Thanks for the doc info, I'll get that updated as soon as I get a 
chance. <br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13393"></a>
				<div id="comment-13393" class="jive-content-comment ">
					<span>
						<span>
							Nov 18, 2009 10:16 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-z0SVYf8hG2CHzTS2" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13391" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13393">
					I can reproduce my stupidity at will <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
As you can see below setting quiesce for a vm that is not enabled will 
give that type of output.<br>
<br>
Not sure why it is a bit different to the original post.<br>
<br>
Perhaps the script could read:<br>
<br>
</p><ol>
<li>Quiesce VM when taking snapshot (requires VMware Tools <b>and VSS</b>
 to be installed)?</li>
</ol>
<br>
/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/tools # ./ghettoVCB.sh
 -f vms                                                  2009-11-19 
05:38:51 -- info: ============================== ghettoVCB LOG START    
                                              
==============================<br>
<br>
2009-11-19 05:38:51 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/msc009ds<br>
2009-11-19 05:38:51 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2009-11-19 05:38:51 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2009-11-19 05:38:51 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2009-11-19 05:38:51 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-11-19 05:38:51 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-11-19 05:38:51 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-11-19 05:38:51 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-11-19 05:38:51 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-11-19 05:38:51 -- info: CONFIG - LOG_LEVEL = info<br>
2009-11-19 05:38:51 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2009-11-19 05:38:51 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1<br>
2009-11-19 05:38:51 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2009-11-19 05:38:51 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-11-19 05:38:54 -- info: Initiate backup for PMOSTEST<br>
2009-11-19 05:38:54 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2009-11-19" f                                       
          or PMOSTEST<br>
sleep: Interrupted system call<br>
sleep: Interrupted system call<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/mnc053datastore/PMOSTEST/PMOS.vmdk'...<br>
Clone: 100% done.<br>
2009-11-19 05:47:28 -- info: Removing snapshot from PMOSTEST ...<br>
2009-11-19 05:47:31 -- info: Backup Duration: 8.62 Minutes<br>
2009-11-19 05:47:32 -- info: Successfully completed backup for PMOSTEST!<br>
<br>
2009-11-19 05:47:32 -- info: ============================== ghettoVCB 
LOG END ================================<br>
<br>
/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/tools # ./ghettoVCB.sh
 -f vms<br>
2009-11-19 05:49:11 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-11-19 05:49:11 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/msc009ds<br>
2009-11-19 05:49:11 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2009-11-19 05:49:11 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2009-11-19 05:49:11 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2009-11-19 05:49:11 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-11-19 05:49:11 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-11-19 05:49:11 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-11-19 05:49:11 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-11-19 05:49:11 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-11-19 05:49:11 -- info: CONFIG - LOG_LEVEL = info<br>
2009-11-19 05:49:11 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2009-11-19 05:49:11 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1<br>
2009-11-19 05:49:11 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2009-11-19 05:49:11 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-11-19 05:49:14 -- info: Initiate backup for PMOSTEST<br>
2009-11-19 05:49:14 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2009-11-19" for PMOSTEST<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/mnc053datastore/PMOSTEST/PMOS.vmdk'...<br>
Clone: 100% done.<br>
2009-11-19 05:58:39 -- info: Removing snapshot from PMOSTEST ...<br>
2009-11-19 05:58:42 -- info: Backup Duration: 9.47 Minutes<br>
2009-11-19 05:58:42 -- info: Successfully completed backup for PMOSTEST!<br>
<br>
2009-11-19 05:58:42 -- info: ============================== ghettoVCB 
LOG END ================================<br>

					
				</div>
				<a name="comments-13394"></a>
				<div id="comment-13394" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 18, 2009 11:05 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-As0jgQc05jQYF9Is" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13393" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-13394">
					Quiesce snapshot option and the method in which the flushing occurs
 is dependent on OS and whether or not you have VMware Tools installed. 
There's actually 3 methods and VSS is Windows only, for a deep dive on 
how VMware snapshots works, take a look at this VMware KB: <a 
class="jive-link-external" href="http://kb.vmware.com/kb/1015180">http://kb.vmware.com/kb/1015180</a><br>
<br>
The interrupt you're seeing is within the busybox console (unspported 
shell). Have you tried disable VM_SNAPSHOT_MEMORY and just enabling 
VM_SNAPSHOT_QUIESCE?<br>
<br>
<b>Note:</b> VM_SNAPSHOT_MEMORY will dump the VMs state at the time of 
the snapshot but is not used for the backup, this is primarily for 
testing purposes and with this option enabled your snapshot takes longer
 to create + additional room for the memory state file. Generally you'll
 just enable VM_SNAPSHOT_QUIESCE<br>
<br>
Is this occurring with only this VM or others? How large is the VM and 
what is it's OS?<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13406"></a>
				<div id="comment-13406" class="jive-content-comment ">
					<span>
						<span>
							Nov 19, 2009 3:33 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-uBTVRq0XzKRaqVls" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13394" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13406">
					Here is the test run as you suggested - memory snap=off and quiesce
 =on<br>
<br>
This is a centos 5.3 x86_64 approx 10GB - Vmware tools installed but not
 sync driver (i have to find out what that is <img class="jive-emoticon"
 src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
As you said it is quite a bit quicker with memory_snap off<br>
<br>
esxi logs show:<br>
<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.497 116C0B90 info 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Trying quiesced snapshot via SYNC driver...<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.498 116C0B90 info 
'DictionaryOptionsProvider(Config.GlobalSettings.)'</strike> Set called 
with key 'Config.GlobalSettings.guest.commands.sharedPolicyRefCount' 
value '1'<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.514 116C0B90 verbose 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Logging into guest.<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.516 11701B90 verbose 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Dummy foundry callback #0<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.516 116C0B90 verbose 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 About to run script: /usr/sbin/pre-freeze-script all<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.520 2D3C2B90 verbose 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Dummy foundry callback #1<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.520 116C0B90 info 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Script /usr/sbin/pre-freeze-script not found in VM.<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.530 11701B90 verbose 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Dummy foundry callback #2<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.530 116C0B90 info 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 About to engage SYNC driver, freeze Timeout 15 sec.<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.540 11701B90 verbose 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Dummy foundry callback #3<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.540 116C0B90 info 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Sync driver not installed or not supported in guest.<br>
Nov 19 21:50:15 Hostd: <strike>2009-11-19 21:50:15.541 116C0B90 info 
'vm:/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/PMOSTEST/PMOS.vmx'</strike>
 Starting to snapshot VM.<br>
</p><p>
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br>
<br>
/vmfs/volumes/4a7bc59f-d1dd8294-90ca-0019d1010534/tools # ./ghettoVCB.sh
 -f vms<br>
2009-11-19 21:50:10 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-11-19 21:50:10 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/msc009ds<br>
2009-11-19 21:50:10 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2009-11-19 21:50:10 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2009-11-19 21:50:10 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2009-11-19 21:50:10 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-11-19 21:50:10 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-11-19 21:50:10 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-11-19 21:50:10 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-11-19 21:50:10 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-11-19 21:50:10 -- info: CONFIG - LOG_LEVEL = info<br>
2009-11-19 21:50:10 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2009-11-19 21:50:10 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-11-19 21:50:10 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2009-11-19 21:50:10 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-11-19 21:50:14 -- info: Initiate backup for PMOSTEST<br>
2009-11-19 21:50:14 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2009-11-19" for PMOSTEST<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/mnc053datastore/PMOSTEST/PMOS.vmdk'...<br>
Clone: 100% done.<br>
2009-11-19 21:56:33 -- info: Removing snapshot from PMOSTEST ...<br>
2009-11-19 21:56:37 -- info: Backup Duration: 6.38 Minutes<br>
2009-11-19 21:56:37 -- info: Successfully completed backup for PMOSTEST!<br>
<br>
2009-11-19 21:56:37 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
				<a name="comments-13407"></a>
				<div id="comment-13407" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 19, 2009 4:51 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-DUmNJnAJ7P1rB33d" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13406" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-13407">
					Yea when using the quiesce, it'll definitely be OS dependent. Look 
like in this case it was not able to use any of the drivers ... <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13575"></a>
				<div id="comment-13575" class="jive-content-comment ">
					<span>
						<span>
							Nov 22, 2009 10:18 PM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-4joo17uOEkh7W7TC" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13575">
					Hi William,<br>
<br>
I started using your backup/restore script some days ago. I'm using 
thick disks, backup up to thin disks. I've noticed that shrinking in the
 VMWare Tools decreases backupsize alot:<br>
<br>
9,0G    ./Test-1/Test-1-2009-11-22--1<br>
12G     ./Test-1/Test-1-2009-11-22--2<br>
<br>
Where --2 is before shrinking in vmware tools and --1 after. Is there a 
chance to get the shrink process in your Backup script? I searched your 
script repository but didn't find a script to run before the backup.<br>
<br>
Greets<br>
Peter
					</p>
				</div>
				<a name="comments-13552"></a>
				<div id="comment-13552" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 2:59 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-IFsWCoxyX9xEnt53" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13336" title="Go to message">banthorpe</a>
							</em>
					</span>
					<p id="comment-body-13552">
					any update on this? I still can't back up more than 2 VMs at a 
time.
					</p>
				</div>
				<a name="comments-13418"></a>
				<div id="comment-13418" class="jive-content-comment ">
					<span>
						<span>
							Nov 23, 2009 3:16 AM
						</span>
							<!--<a href="/people/MKguy" title="Click to view MKguy's profile">
<img class="jive-avatar" src="/people/MKguy/avatar/16.png?a=-1" height="16" width="16" title="Click to view MKguy's profile" alt="Click to view MKguy's profile" />
</a>--><a href="http://communities.vmware.com/people/MKguy" 
id="jive-CjjBrf34k7V7hrP9" class="jive-username-link" title="Click to 
view MKguy's profile">MKguy</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13418">
					Last week the Backup didn't complete, probably because I did not 
have sufficient disk space on the backup destination. I had to kill the 
ghettoVCB process. According to the Log it was stuck with removing the 
snapshot, but the VM still is snapshotted and I can't remove the 
snapshot with the VI client. How can I remove the snapshot manually?<br>
<br>
Ok, just created a new snapshot manually and deleted all after it.
					</p>
				</div>
				<a name="comments-13419"></a>
				<div id="comment-13419" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 7:05 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-x620OHse8l4L7Ukn" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13575" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-13419">
					Can you define what you mean by shrinking of VMware Tools? Are you 
using all default backup options<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13585"></a>
				<div id="comment-13585" class="jive-content-comment ">
					<span>
						<span>
							Nov 23, 2009 7:07 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-jNAwBWE66eb934c6" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13552" title="Go to message">banthorpe</a>
							</em>
					</span>
					<p id="comment-body-13585">
					VMs will <b>always</b> be backed up one at a time, since the backup
 is occurring on the Service Console or busybox console, resources are 
being taken up and you don't want to impact the performance of your 
hypervisor across other VMs during backups. There was never any plans to
 do simultaneous VM backups<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13586"></a>
				<div id="comment-13586" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 7:10 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-RNkwqwscW80Hd22W" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13585" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13586">
					right - I understand that. and the script is doing these 
sequentially so there should never be an issue - this is why I don't 
understand why it fails on VM #3.
					</p>
				</div>
				<a name="comments-13587"></a>
				<div id="comment-13587" class="jive-content-comment ">
					<span>
						<span>
							Nov 23, 2009 7:16 AM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-HwxfOv065cnQT5G0" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13419" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13587">
					Hi William,<br>
<br>
Is in the vmware tools: <a class="jive-link-external" 
href="http://www.vmware.com/support/ws5/doc/img/w_tools_shrink_supportedand.png">http://www.vmware.com/support/ws5/doc/img/w_tools_shrink_supportedand.png</a><br>
(Not my pic, googled it)<br>
<br>
Using the "prepare to shrink" the Backup shrinks as seen above.<br>
<br>
I found this thread - but I'm not sure how to wrap this up in a 
script...<br>
<br>
<a class="jive-link-external" 
href="http://communities.vmware.com/thread/230108">http://communities.vmware.com/thread/230108</a><br>
<br>
Greets<br>
Peter<br>
<br>
Edit:<br>
And yes, i'm using all default - except for the location <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";-)" border="0">
					</p>
				</div>
				<a name="comments-13588"></a>
				<div id="comment-13588" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 8:13 AM
						</span>
							<!--<a href="/people/S3BASTI3N" title="Click to view S3BASTI3N's profile">
<img class="jive-avatar" src="/people/S3BASTI3N/avatar/16.png?a=-1" height="16" width="16" title="Click to view S3BASTI3N's profile" alt="Click to view S3BASTI3N's profile" />
</a>--><a href="http://communities.vmware.com/people/S3BASTI3N" 
id="jive-7sVUq1XJRK3EvOhD" class="jive-username-link" title="Click to 
view S3BASTI3N's profile">S3BASTI3N</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13587" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-13588">
					Hi pebr,<br>
<br>
A Workaround to "shrink"  disks is to use "2gbsparse" as disk format for
 backup. <br>
<br>
Yes, you will have many files but you will not have "empty space" <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Seb = = = o&gt;Â°o
					</p>
				</div>
				<a name="comments-13589"></a>
				<div id="comment-13589" class="jive-content-comment ">
					<span>
						<span>
							Nov 23, 2009 8:17 AM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-Ymhxi7hf8ECYA5l8" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13588" title="Go to message">S3BASTI3N</a>
							</em>
					</span>
					<p id="comment-body-13589">
					Hi Sebastian,<br>
<br>
I use thin as a target-disk - this should "shrink" to the same size as 
"2gbsparse" - unless the shrink-method is called before backup. Ether by
 hand or by script<br>
<br>
Or should 2gbsparse be really "thiner" than thin?<br>
<br>
Greets<br>
Peter
					</p>
				</div>
				<a name="comments-13590"></a>
				<div id="comment-13590" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 8:29 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-55690W7r4a4skFHm" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13589" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-13590">
					This depends on the target. From my experience you will not see 
reduced size with thin when using Win2k3 NFS services as target. With 
2gbsparse in contrast you do.<br>
<br>
Regards<br>
goppi
					</p>
				</div>
				<a name="comments-13591"></a>
				<div id="comment-13591" class="jive-content-comment ">
					<span>
						<span>
							Nov 23, 2009 8:36 AM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-lVpHSeeRzlw6nA9F" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13590" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-13591">
					I'm using Linux as Target.<br>
<br>
I see reduced size! Even with Thin:<br>
<br>
Disk: 40GB<br>
Backup before "Shrink" in VMWare Tools: 12GB<br>
Backup after "Shrink" in VMWare Tools: 9GB<br>
Source: Thick<br>
Destination: Thin (both times)<br>
<br>
Nobody but me was using the virtual machine at this time, no files 
deleted, backup started directly before and after "Shrink" - so the 
reduced size must be from this.<br>
<br>
Greets<br>
Peter
					</p>
				</div>
				<a name="comments-13554"></a>
				<div id="comment-13554" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 9:07 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-gW3eO2Ve99rAeI9u" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13587" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-13554">
					From the link you reference, it sounds like this is something thats
 available via the APIs ... but probably not directly available on the 
Service Console or busybox console. I'll take a look as time permits<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13600"></a>
				<div id="comment-13600" class="jive-content-comment ">
					<span>
						<span>
							Nov 23, 2009 9:10 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-22eUWLNMj4oBG1Sh" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13418" title="Go to message">MKguy</a>
							</em>
					</span>
					<p id="comment-body-13600">
					You'll need to locate the vmid by running the following command:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/getallvms | grep -i &lt;vmname&gt; | awk '{print $1}'
</code></pre><br>
<br>
then you need to specify the following to remove the snapshot (this 
assumes you only have 1 snapshot created by ghettoVCB)<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/snapshot.remove &lt;vmid&gt; 
</code></pre><br>
<br>
you could also use:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/snapshot.removeall
</code></pre><br>
<br>
which will just remove all snapshots (commit all)<br>
<br>
As you know, you need to keep a close eye on your datastores from 
filling up else you'll have all sorts of fun with your VMs <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<p>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13601"></a>
				<div id="comment-13601" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2009 9:12 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0cq6sqVSXB88E3KD" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13586" title="Go to message">banthorpe</a>
							</em>
					</span>
					<p id="comment-body-13601">
					Please provide detail information about your environment and VM and
 run the backup with <b>both</b> debug and dryrun modes and remember to 
enclose the output in {code} tags. Can't help without more information 
and remember to always provide this if you run into any issues/bugs, 
"not working" is not sufficient. <br>
<br>
Also have you tried re-arranging the order of the VMs, is it always the 
3rd one? Any issues with storage connectivity? Please do some level of 
troubleshooting prior to the run to ensure this is not environment 
issues.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/vmtn/archive/beta/vibeta1/developer">VMware
 Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13605"></a>
				<div id="comment-13605" class="jive-content-comment ">
					<span>
						<span>
							Nov 24, 2009 8:30 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-OYhv8QTgzAu5lE0x" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13601" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13605">
					Please advise on enabling debug AND dryrun modes.<br>
<br>
FYI - have tested many potential issues, network etc. All looks OK. It 
is always the 3rd VM, regardless of the order of VMs and size of VMs
					</p>
				</div>
				<a name="comments-13579"></a>
				<div id="comment-13579" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 24, 2009 9:30 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-w81T415bqgk8LQ5p" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13605" title="Go to message">banthorpe</a>
							</em>
					</span>
					<p id="comment-body-13579">
					</p><div class="jive-quote">
Please advise on enabling debug AND dryrun modes.<br>
</div>
<br>
Please read the documentation for enabling debug and dryrun modes. <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13582"></a>
				<div id="comment-13582" class="jive-content-comment ">
					<span>
						<span>
							Nov 25, 2009 9:20 AM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-7l8COmfP3xz4RpmU" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13582">
					Hi,<br>
<br>
I'm having some problems with the sleep iterations - its too fast...<br>
<br>
2009-11-25 17:16:54 -- info: VM is still on - Iteration: 0 - sleeping 
for 60secs (Duration: 0 seconds)<br>
2009-11-25 17:17:25 -- info: VM is still on - Iteration: 1 - sleeping 
for 60secs (Duration: 60 seconds)<br>
</p><p>
As you can see - is just 30 seconds instead of 60. Machine is a Dual 
Xeon 5520 (HT enabled), ESXi4<br>
<br>
Greets<br>
Peter
					</p>
				</div>
				<a name="comments-13616"></a>
				<div id="comment-13616" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 25, 2009 2:41 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-e4Vt3S4eHxdscCVe" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13582" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-13616">
					Thanks for the info, I've just updated the script, it'll be sleep 
for 60seconds now per iteration. Remember this is controllable by 
modifying the variable called <b>ITER_TO_WAIT_SHUTDOWN</b>, by default 
it's set to 3 which means it'll sleep for 3 60-second iterations (3min) 
and you'll need to modify this based on your VMs/environment. If you 
need it to wait longer, go ahead and do a test manually and then 
configure it. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13608"></a>
				<div id="comment-13608" class="jive-content-comment ">
					<span>
						<span>
							Nov 26, 2009 1:44 AM
						</span>
							<!--<a href="/people/banthorpe" title="Click to view banthorpe's profile">
<img class="jive-avatar" src="/people/banthorpe/avatar/16.png?a=-1" height="16" width="16" title="Click to view banthorpe's profile" alt="Click to view banthorpe's profile" />
</a>--><a href="http://communities.vmware.com/people/banthorpe" 
id="jive-i8iHwX0Rc74s1UKP" class="jive-username-link" title="Click to 
view banthorpe's profile">banthorpe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13579" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13608">
					OK - latest update. I have pulled the very latest version of 
ghettoVCB.sh and the problem has gone away. All VMs are backing up 100% 
OK.
					</p>
				</div>
				<a name="comments-13632"></a>
				<div id="comment-13632" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 26, 2009 2:51 AM
						</span>
							<!--<a href="/people/Jorpavon" title="Click to view Jorpavon's profile">
<img class="jive-avatar" src="/people/Jorpavon/avatar/16.png?a=-1" height="16" width="16" title="Click to view Jorpavon's profile" alt="Click to view Jorpavon's profile" />
</a>--><a href="http://communities.vmware.com/people/Jorpavon" 
id="jive-DcmODn49RqAOjujA" class="jive-username-link" title="Click to 
view Jorpavon's profile">Jorpavon</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13632">
					Hi,<br>
<br>
I would like to backup a VM that has 2 vmdk on differents datastores. Is
 it possible?<br>
<br>
I made the configuration file with the option: VMDK_FILES_TO_BACKUP = 
"all" and I got the backup of the vmdk on the VMX_DIR, only.<br>
<br>
How can I do it?<br>
<br>
Congratulations for your great job!!
					</p>
				</div>
				<a name="comments-13619"></a>
				<div id="comment-13619" class="jive-content-comment ">
					<span>
						<span>
							Nov 26, 2009 8:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-PW7Ax1EJ160G30O1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13632" title="Go to message">Jorpavon</a>
							</em>
					</span>
					<p id="comment-body-13619">
					As mentioned before this is supported. The question is .. do you 
actually have the other VMDK attached to the VM? <br>
<br>
Please re-run the backup but with the dry run flag.<br>
<br>
e.g.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# ./ghettoVCB.sh -f recoveryvm -d dryrun
2009-11-26 08:51:29 -- info: ============================== ghettoVCB LOG START ==============================

2009-11-26 08:51:29 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-26 08:51:29 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-26 08:51:29 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-11-26 08:51:29 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-26 08:51:29 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-26 08:51:29 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-26 08:51:29 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-11-26 08:51:29 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-26 08:51:29 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-26 08:51:29 -- info: CONFIG - LOG_LEVEL = dryrun
2009-11-26 08:51:29 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-26 08:51:29 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-26 08:51:29 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-26 08:51:29 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-26 08:51:33 -- dryrun: ###############################################
2009-11-26 08:51:33 -- dryrun: Virtual Machine: vm-1
2009-11-26 08:51:33 -- dryrun: VM_ID: 5584
2009-11-26 08:51:33 -- dryrun: VMX_PATH: /vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/vm-1/vm-1.vmx
2009-11-26 08:51:33 -- dryrun: VMX_DIR: /vmfs/volumes/himalaya-local-SATA.RE4-GP:Storage/vm-1
2009-11-26 08:51:33 -- dryrun: VMX_CONF: vm-1/vm-1.vmx
2009-11-26 08:51:33 -- dryrun: VMFS_VOLUME: himalaya-local-SATA.RE4-GP:Storage
2009-11-26 08:51:33 -- dryrun: VMDK(s):
2009-11-26 08:51:33 -- dryrun:  /vmfs/volumes/4aa95d52-c297af51-90e2-003048d9586a/vm-1/vm-1.vmdk
2009-11-26 08:51:33 -- dryrun:  vm-1.vmdk
2009-11-26 08:51:33 -- dryrun: ###############################################

2009-11-26 08:51:33 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
You should see two VMDK(s) listed one of which will be within the .vmx 
directory and the other should be the path to the other datastore in 
which the VMDK resides. <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13635"></a>
				<div id="comment-13635" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 26, 2009 9:36 AM
						</span>
							<!--<a href="/people/Jorpavon" title="Click to view Jorpavon's profile">
<img class="jive-avatar" src="/people/Jorpavon/avatar/16.png?a=-1" height="16" width="16" title="Click to view Jorpavon's profile" alt="Click to view Jorpavon's profile" />
</a>--><a href="http://communities.vmware.com/people/Jorpavon" 
id="jive-FIL5lRoAlimI35FV" class="jive-username-link" title="Click to 
view Jorpavon's profile">Jorpavon</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13619" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13635">
					Thanks for your reply.<br>
<br>
I see only one VMDK as you can see:<br>
<br>
19 -- info: ============================== ghettoVCB LOG START 
==============================<br>
<br>
2009-11-26 18:21:21 -- info: CONFIG - USING CONFIGURATION FILE = 
backup_config/Virtual Center Server<br>
2009-11-26 18:21:21 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/Backup Storage/VMS_BACKUP<br>
2009-11-26 18:21:21 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2009-11-26 18:21:21 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2009-11-26 18:21:21 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2009-11-26 18:21:22 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-11-26 18:21:22 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-11-26 18:21:22 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4<br>
2009-11-26 18:21:22 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-11-26 18:21:22 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-11-26 18:21:22 -- info: CONFIG - LOG_LEVEL = dryrun<br>
2009-11-26 18:21:22 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/vmfs/volumes/Backup Storage/VMS_BACKUP/ghettoVCB.log<br>
2009-11-26 18:21:22 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1<br>
2009-11-26 18:21:22 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2009-11-26 18:21:22 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-11-26 18:21:22 -- dryrun: 
###############################################<br>
2009-11-26 18:21:22 -- dryrun: Virtual Machine: Virtual Center Server<br>
2009-11-26 18:21:22 -- dryrun: VM_ID: 32<br>
2009-11-26 18:21:22 -- dryrun: VMX_PATH: /vmfs/volumes/VirtualMachines 
Storage/Virtual Center Server/Virtual Center Server.vmx<br>
2009-11-26 18:21:22 -- dryrun: VMX_DIR: /vmfs/volumes/VirtualMachines 
Storage/Virtual Center Server<br>
2009-11-26 18:21:22 -- dryrun: VMX_CONF: Virtual Center Server/Virtual 
Center Server.vmx<br>
2009-11-26 18:21:22 -- dryrun: VMFS_VOLUME: VirtualMachines Storage<br>
2009-11-26 18:21:22 -- dryrun: VMDK(s): <br>
2009-11-26 18:21:23 -- dryrun: 	Virtual Center Server.vmdk<br>
2009-11-26 18:21:23 -- dryrun: 
###############################################<br>
<br>
2009-11-26 18:21:23 -- info: ============================== ghettoVCB 
LOG END ================================<br>
<br>
I don't know why the other VMDK, called "Virtual Center Server_1.vmdk", 
is not listed.<br>
The location of the other VMDK is "/vmfs/volumes/System Storage/Virtual 
Center Server/Virtual Center Server_1.vmdk"
					</p>
				</div>
				<a name="comments-13620"></a>
				<div id="comment-13620" class="jive-content-comment ">
					<span>
						<span>
							Nov 26, 2009 10:26 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6PQ6GSSBFoGg173F" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13635" title="Go to message">Jorpavon</a>
							</em>
					</span>
					<p id="comment-body-13620">
					Are you 100% sure that the VM <u>actually</u> has the 2nd VMDK 
attached? If it's been removed, but not deleted it will not be enabled 
within the .vmx and the script will not see the 2nd VMDK.<br>
<br>
I've just replicated a VM with a similar setup as yours and I'm able to 
see both VMDK(s) which is stored on two different datastores:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">[root@himalaya ~]# ./ghettoVCB.sh -f recoveryvm -d dryrun
2009-11-26 10:26:21 -- info: ============================== ghettoVCB LOG START ==============================

2009-11-26 10:26:21 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2009-11-26 10:26:21 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-11-26 10:26:21 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-11-26 10:26:21 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-11-26 10:26:21 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-11-26 10:26:21 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-11-26 10:26:21 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-11-26 10:26:21 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-11-26 10:26:21 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-11-26 10:26:21 -- info: CONFIG - LOG_LEVEL = dryrun
2009-11-26 10:26:21 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-11-26 10:26:21 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-11-26 10:26:21 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-11-26 10:26:21 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-11-26 10:26:25 -- dryrun: ###############################################
2009-11-26 10:26:25 -- dryrun: Virtual Machine: stupid vm with spaces
2009-11-26 10:26:25 -- dryrun: VM_ID: 5616
2009-11-26 10:26:25 -- dryrun: VMX_PATH: /vmfs/volumes/himalaya-local-SAS.Savvio/VirtualMachines Storage/stupid vm with spaces/stupid vm with spaces.vmx
2009-11-26 10:26:25 -- dryrun: VMX_DIR: /vmfs/volumes/himalaya-local-SAS.Savvio/VirtualMachines Storage/stupid vm with spaces
2009-11-26 10:26:25 -- dryrun: VMX_CONF: VirtualMachines Storage/stupid vm with spaces/stupid vm with spaces.vmx
2009-11-26 10:26:25 -- dryrun: VMFS_VOLUME: himalaya-local-SAS.Savvio
2009-11-26 10:26:25 -- dryrun: VMDK(s):
2009-11-26 10:26:25 -- dryrun:  /vmfs/volumes/4a48004d-f9af7fa0-5bbf-003048d9586b/System Storage/stupid vm with spaces/stupid vm with spaces_1.vmdk
2009-11-26 10:26:25 -- dryrun:  stupid vm with spaces.vmdk
2009-11-26 10:26:25 -- dryrun: ###############################################

2009-11-26 10:26:25 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13638"></a>
				<div id="comment-13638" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 27, 2009 12:59 AM
						</span>
							<!--<a href="/people/Jorpavon" title="Click to view Jorpavon's profile">
<img class="jive-avatar" src="/people/Jorpavon/avatar/16.png?a=-1" height="16" width="16" title="Click to view Jorpavon's profile" alt="Click to view Jorpavon's profile" />
</a>--><a href="http://communities.vmware.com/people/Jorpavon" 
id="jive-0cys5uGpF9CAjijj" class="jive-username-link" title="Click to 
view Jorpavon's profile">Jorpavon</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13620" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13638">
					I've got it. The disk is independent, and the ghettoVCB doesn't let
 you backup independent disks (independent VMDKs).<br>
<br>
Thank you, very much!!
					</p>
				</div>
				<a name="comments-13644"></a>
				<div id="comment-13644" class="jive-content-comment ">
					<span>
						<span>
							Nov 29, 2009 3:12 AM
						</span>
							<!--<a href="/people/Stangobien" title="Click to view Stangobien's profile">
<img class="jive-avatar" src="/people/Stangobien/avatar/16.png?a=-1" height="16" width="16" title="Click to view Stangobien's profile" alt="Click to view Stangobien's profile" />
</a>--><a href="http://communities.vmware.com/people/Stangobien" 
id="jive-65kuHcv6i4VssSE3" class="jive-username-link" title="Click to 
view Stangobien's profile">Stangobien</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13644">
					I like to e-mail the logfile to mysefl so i check up on it, instead
 of manually go looking for it.<br>
I have ESXI and i don't know wether it can e-mail by itself. But i used a
 linux VM i am running to pull the logfile and mail it to me. The linux 
VM is set up with sendmail and mailhost is configured.<br>
<br>
I have altered the GhettoVCB script to make the backups &amp; logiles 
use this date syntax date +%F. I find it easier to read for humans. 
Please adjust the youruser and yourpass to valid login credentials for 
browsing the datastore trough https. Usually the user you login with 
directly on the ESXi. Also adjust the you@domain.tld, place your e-mail 
address. Pretty simple &amp; basic but it works excellent. Last point, 
adjust the 192.168.1.253 to your ESXi's IP address.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">#grab esxi backup log file and mail it v0.1
#Note the WGET part should be 1 line, no line breaks
#- Adjust the youruser &amp; yourpass to valid credentials for logging in to ESXi (browse the datastore)
#- Adjust the IP address (192.168.1.253) to your ESXi ip address
#- In the wget line below my logs where located in a folder called backup on a datastore called 750GBdisk2
#- You could check the syntax of the link by browsing to your datastore and locate the backup log files then look at the addressbar

cd /tmp
wget "https://192.168.1.253/folder/backup/ghettoVCB-backup-$(date +\%F).log?dcPath=ha-datacenter&amp;dsName=750GBdisk2" --user youruser --password yourpass --no-check-certificate
cat /tmp/ghettoVCB* | mail -s "Backup log ESXi4" you@domain.tld
rm -rf /tmp/ghettoVCB*
</code></pre><br>
i have put this in the crontab at the linux VM like this:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">3 3 * * * /root/mailesxilog &gt; /dev/null 2&gt;&amp;1
</code></pre>
					
				</div>
				<a name="comments-13668"></a>
				<div id="comment-13668" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 1, 2009 1:08 AM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-LxC1T398yVCCzy6A" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13668">
					Hi lamw,<br>
<br>
I started using the script on a regular base now and started to use 
Stangobien's (thanks!) script to pull the logfiles. Is there a way to 
add a loglevel not writing every %-step to the logfile? I'm backing up 5
 machines - and just the %-lines are 500 lines... Getting a bit hard to 
read <img class="jive-emoticon" src="DOC-8760_files/sad.gif" alt=":(" 
border="0"><br>
<br>
Greets<br>
Peter
					</p>
				</div>
				<a name="comments-13671"></a>
				<div id="comment-13671" class="jive-content-comment ">
					<span>
						<span>
							Dec 1, 2009 4:52 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-d5Fvshb0j8pBzRL8" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13668" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-13671">
					I primarily have that information when users run into problems or 
provide a little bit more detail over the debugging mode. The default <b>info</b>
 mode is pretty quiet minus the configuration dump at the top, you can 
always parse out any lines that contains <b>CONFIG</b> which should 
reduce the number of the lines OR you can comment out the function call <b>dumpVMConfigurations()</b>
 depending if you're using individual VM backup policy or not. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13703"></a>
				<div id="comment-13703" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 1, 2009 10:38 AM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-dLWMUesGHwqNu08w" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13703">
					I'm using the latest version of ghettVCB.sh, but my script will 
only backup the first VM in the list. I've tried changing the order in 
my server list, but still will only backup first VM. I can run a dryrun 
of the script and it sees the other VMs. I created the server list in Vi
 so I don't think it's a formatting issue.<br>
<br>
I'm running ESXi 3.5<br>
</p><p>
Here is my server list file:<br>
</p><div class="jive-quote">
~ # cat /vmfs/volumes/BackupsStore/vmbackups<br>
LegalFiles<br>
Sharepoint2008x64<br>
FreeBSD71<br>
~ #<br>
</div>
<br>
Here are the results of my dryrun:<br>
<div class="jive-quote">
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 # ./ghettoVCB.sh -f 
vmbackups -d dryrun<br>
2009-12-01 18:36:07 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-12-01 18:36:07 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/NFS<br>
2009-12-01 18:36:07 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 5<br>
2009-12-01 18:36:08 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2009-12-01 18:36:08 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2009-12-01 18:36:08 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-12-01 18:36:08 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-12-01 18:36:08 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-12-01 18:36:08 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-12-01 18:36:09 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-12-01 18:36:09 -- info: CONFIG - LOG_LEVEL = dryrun<br>
2009-12-01 18:36:09 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2009-12-01 18:36:09 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-12-01 18:36:09 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2009-12-01 18:36:09 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-12-01 18:36:26 -- dryrun: 
###############################################<br>
2009-12-01 18:36:26 -- dryrun: Virtual Machine: LegalFiles<br>
2009-12-01 18:36:26 -- dryrun: VM_ID: 448<br>
2009-12-01 18:36:26 -- dryrun: VMX_PATH: 
/vmfs/volumes/BackupsStore/LegalFiles/LegalFiles.vmx<br>
2009-12-01 18:36:26 -- dryrun: VMX_DIR: 
/vmfs/volumes/BackupsStore/LegalFiles<br>
2009-12-01 18:36:26 -- dryrun: VMX_CONF: LegalFiles/LegalFiles.vmx<br>
2009-12-01 18:36:26 -- dryrun: VMFS_VOLUME: BackupsStore<br>
2009-12-01 18:36:26 -- dryrun: VMDK(s):<br>
2009-12-01 18:36:26 -- dryrun:  LegalFiles_1.vmdk<br>
2009-12-01 18:36:26 -- dryrun:  LegalFiles.vmdk<br>
2009-12-01 18:36:28 -- dryrun: 
###############################################<br>
<br>
2009-12-01 18:36:28 -- dryrun: 
###############################################<br>
2009-12-01 18:36:28 -- dryrun: Virtual Machine: Sharepoint2008x64<br>
2009-12-01 18:36:28 -- dryrun: VM_ID: 432<br>
2009-12-01 18:36:28 -- dryrun: VMX_PATH: 
/vmfs/volumes/BackupsStore/Sharepoint2008x64/Sharepoint2008x64.vmx<br>
2009-12-01 18:36:28 -- dryrun: VMX_DIR: 
/vmfs/volumes/BackupsStore/Sharepoint2008x64<br>
2009-12-01 18:36:28 -- dryrun: VMX_CONF: 
Sharepoint2008x64/Sharepoint2008x64.vmx<br>
2009-12-01 18:36:28 -- dryrun: VMFS_VOLUME: BackupsStore<br>
2009-12-01 18:36:28 -- dryrun: VMDK(s):<br>
2009-12-01 18:36:28 -- dryrun:  Sharepoint2008x64_1.vmdk<br>
2009-12-01 18:36:28 -- dryrun:  Sharepoint2008x64.vmdk<br>
2009-12-01 18:36:28 -- dryrun: 
###############################################<br>
<br>
2009-12-01 18:36:28 -- dryrun: 
###############################################<br>
2009-12-01 18:36:28 -- dryrun: Virtual Machine: FreeBSD71<br>
2009-12-01 18:36:28 -- dryrun: VM_ID: 208<br>
2009-12-01 18:36:28 -- dryrun: VMX_PATH: 
/vmfs/volumes/BackupsStore/vmFreeBSDx64/vmFreeBSDx64.vmx<br>
2009-12-01 18:36:28 -- dryrun: VMX_DIR: 
/vmfs/volumes/BackupsStore/vmFreeBSDx64<br>
2009-12-01 18:36:28 -- dryrun: VMX_CONF: vmFreeBSDx64/vmFreeBSDx64.vmx<br>
2009-12-01 18:36:28 -- dryrun: VMFS_VOLUME: BackupsStore<br>
2009-12-01 18:36:28 -- dryrun: VMDK(s):<br>
2009-12-01 18:36:28 -- dryrun:  vmFreeBSDx64-000001.vmdk<br>
2009-12-01 18:36:29 -- dryrun: 
###############################################<br>
<br>
2009-12-01 18:36:29 -- info: ============================== ghettoVCB 
LOG END ================================<br>
</div>
					
				</div>
				<a name="comments-13704"></a>
				<div id="comment-13704" class="jive-content-comment ">
					<span>
						<span>
							Dec 1, 2009 11:01 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-PlbjS821yQ26eyM6" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13703" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-13704">
					Please edit your response before I take a look, no need to paste my
 entire script. You can say specify that you're using the latest version
 which can also be confirmed by looking at the modified date when 
running the script w/o any parameters. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13720"></a>
				<div id="comment-13720" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 1, 2009 11:42 AM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-riKHGDan1bOX68gS" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13704" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13720">
					I've removed the script.
					</p>
				</div>
				<a name="comments-13714"></a>
				<div id="comment-13714" class="jive-content-comment ">
					<span>
						<span>
							Dec 2, 2009 12:40 AM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-zzkm8WC8i4zpNzyV" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13714">
					Nope - working like a dream
					</p>
				</div>
				<a name="comments-13689"></a>
				<div id="comment-13689" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 2, 2009 12:52 AM
						</span>
							<!--<a href="/people/michaelbrandi" title="Click to view michaelbrandi's profile">
<img class="jive-avatar" src="/people/michaelbrandi/avatar/16.png?a=-1" height="16" width="16" title="Click to view michaelbrandi's profile" alt="Click to view michaelbrandi's profile" />
</a>--><a href="http://communities.vmware.com/people/michaelbrandi" 
id="jive-0ksW4C52H2Q8LRmL" class="jive-username-link" title="Click to 
view michaelbrandi's profile">michaelbrandi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13714" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-13689">
					Hi, thanks for you reply, just removed my comment, it was me 
s******* up, sorry :o)
					</p>
				</div>
				<a name="comments-13734"></a>
				<div id="comment-13734" class="jive-content-comment ">
					<span>
						<span>
							Dec 2, 2009 7:05 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-cU7t69vp0AzQTWmk" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13703" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-13734">
					I'm still a little confused on why you're having this peculiar 
issue .... I'm going back through the replies and I see a message from 
you on <b>Nov 18, 2009 6:59 AM</b> stating that the new script has 
resolved the problem and you were able to take successful backups? <br>
<br>
It sounds like this is may be something new? Can you take backups of 
each individual VM? If so, please to a full run and provide the output 
with debug mode enabled, I'll need to see what errors you're seeing and 
remember to wrap you output in {code} tags<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13717"></a>
				<div id="comment-13717" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 2, 2009 9:39 AM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-UwcYI4UhB6iM0CmW" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13734" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13717">
					The problem I had 11/18 was related to multiple vmdk files not 
backing up. I didn't test the script with more than one VM until now. It
 appears that after the first VM backups up and compresses that the 
PUTTY session times out.<br>
<br>
Here is my output:<br>
</p><div class="jive-quote">
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 # ./ghettoVCB.sh -f 
vmbackups -d debug<br>
2009-12-02 15:14:50 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-12-02 15:14:50 -- debug: HOST BUILD: VMware ESX Server 3i 3.5.0 
build-110271<br>
2009-12-02 15:14:50 -- debug: HOSTNAME: esxios.advocacyinc.org<br>
<br>
2009-12-02 15:14:50 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/NFS<br>
2009-12-02 15:14:50 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 5<br>
2009-12-02 15:14:50 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2009-12-02 15:14:50 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2009-12-02 15:14:50 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-12-02 15:14:50 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-12-02 15:14:50 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-12-02 15:14:50 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-12-02 15:14:50 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-12-02 15:14:50 -- info: CONFIG - LOG_LEVEL = debug<br>
2009-12-02 15:14:50 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2009-12-02 15:14:50 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-12-02 15:14:50 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2009-12-02 15:14:50 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
mkdir: Cannot create directory `/vmfs/volumes/NFS/': Input/output error<br>
2009-12-02 15:15:16 -- info: Unable to create 
"/vmfs/volumes/NFS/LegalFiles"! - Ensure VM_BACKUP_VOLUME was defined 
correctly<br>
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 # ./ghettoVCB.sh -f 
vmbackups -d debug<br>
2009-12-02 15:19:12 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-12-02 15:19:12 -- debug: HOST BUILD: VMware ESX Server 3i 3.5.0 
build-110271<br>
2009-12-02 15:19:12 -- debug: HOSTNAME: esxios.advocacyinc.org<br>
<br>
2009-12-02 15:19:12 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/NFS<br>
2009-12-02 15:19:12 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 5<br>
2009-12-02 15:19:12 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2009-12-02 15:19:12 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2009-12-02 15:19:12 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-12-02 15:19:12 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-12-02 15:19:12 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-12-02 15:19:12 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-12-02 15:19:12 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-12-02 15:19:12 -- info: CONFIG - LOG_LEVEL = debug<br>
2009-12-02 15:19:12 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2009-12-02 15:19:12 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-12-02 15:19:12 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2009-12-02 15:19:12 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-12-02 15:19:42 -- info: Initiate backup for LegalFiles<br>
2009-12-02 15:19:42 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2009-12-02" for LegalFiles<br>
2009-12-02 15:19:59 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2009-12-02" to be created<br>
2009-12-02 15:19:59 -- debug: Snapshot timeout set to: 900 seconds<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk 
'/vmfs/volumes/BackupsStore/LegalFiles/LegalFiles_1.vmdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/BackupsStore/LegalFiles/LegalFiles.vmdk'...<br>
Clone: 100% done.<br>
2009-12-02 15:42:51 -- info: Removing snapshot from LegalFiles ...<br>
2009-12-02 15:42:51 -- info: Compressing VM backup 
"/vmfs/volumes/NFS/LegalFiles/LegalFiles-2009-12-02.gz"...<br>
</div>
					
				</div>
				<a name="comments-13740"></a>
				<div id="comment-13740" class="jive-content-comment ">
					<span>
						<span>
							Dec 2, 2009 8:58 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-L6YqV4luNmbm3G1G" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13717" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-13740">
					I already see a problem and this looks like an environment issue:<br>
<br>
</p><div class="jive-quote">
mkdir: Cannot create directory `/vmfs/volumes/NFS/': Input/output error<br>
</div>
<br>
If you do a search within all the posts, few individuals have had 
similar error messages relating to other things and this is usually an 
issue with their NFS server. Ensure you're not saturating the link and 
that your NFS server is configure optimally, for NFS setups please 
direct to the main VMTN forum. <br>
<br>
The other thing you mentioned is a putty timeout ... again this has 
nothing to do with the script, if you have timeouts setup on your 
server, then you'll need to either modify that or run the command in the
 background and check back later to see the status of the process. <br>
<br>
So far everything is pointing to the environment and not with the script
 as I had thought since the issue reporting does not make much sense if 
you can backup one VM but no other VMs afterwards. Please take a look 
over your configurations and try again and let me know if you've 
resolved any of these issues listed.<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13768"></a>
				<div id="comment-13768" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 3, 2009 12:25 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-AP0I2358dHchyr2u" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13740" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13768">
					I also encounter sporadic input/output errors and try to trackdown 
the problem.<br>
Could you try the following and report back:<br>
<br>
Do not us a persistent NFS datastore configured from within VI-Client 
but let it mount by the script using the ENABLE_NON_PERSISTENT_NFS 
variable.<br>
<br>
So far it seems that this cured the problem in our case.<br>
<br>
BTW: Has anybody successfully mounted an NFS datastore by using the 
busybox mount command. The reason is that the mount command supports 
async mode which could help increasing backup throughput.<br>
<br>
goppi.
					</p>
				</div>
				<a name="comments-13751"></a>
				<div id="comment-13751" class="jive-content-comment ">
					<span>
						<span>
							Dec 3, 2009 5:27 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-Dpl0TmBUNHR4QIAY" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13751">
					hi,<br>
<br>
first: please excuse my english, itÂ´s not very well.<br>
second: thanks for the script to backup vms on an esxi.<br>
<br>
i have a problem with the script:<br>
i loaded the script (date 11/01/2008)  and made my changes (nfs, 
rotation, compression,...). i thougt the script works fine, but after 
three days the script stopped.<br>
in log-file i found "Snapshot found for VM01, backup will not take 
place". i found an answer which describes, i have to create a snapshot 
in vSphere and than remove all snapshots.<br>
after this, the backup worked for two days and i got the same error.<br>
i never made a snapshot manually. so it looks like the snapshot which is
 created by the script will not be removed.<br>
i found a workaround from davidpyper (Sep 28, 2009) but i did not try 
this.<br>
i will not make snapshots manually in future, so i think, i can try this
 workaround, canÂ´t i?<br>
i have to add iÂ´m a unix noob.<br>
<br>
but lamw writes "...snapshot.removeall is a blocking function because 
snapshot.remove is not and you could run into a situation where you'll 
have multiple backups completing and committing multiple snapshots which
 could hinder performance." <br>
<br>
im not shure if i shoud try this...<br>
<br>
but i donÂ´t know why the snapshots created by the script will not be 
removed and i canÂ´t remove these snapshots every day manually...<br>
<br>
so, has anyone an idea what i can do?<br>
(i hope my english was good enough that anyone understand my problem)
					</p>
				</div>
				<a name="comments-13747"></a>
				<div id="comment-13747" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 3, 2009 10:43 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4T2D9i625MpYFe0A" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13751" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-13747">
					Hi,<br>
<br>
I think I understand the general issue, snapshots not being removed ... I
 ask that issues, you run the script in debugging mode and dryrun mode 
and paste the output <b>ENSURING</b> you wrap them in {code} tags for 
readability. Without any logs, I can't really help you and also make 
sure you're using the latest version of the script AND that if enable  <b>VM_SNAPSHOT_MEMORY</b>,
 both the creation/commit of the snapshot may take much longer and in 
general, this should be disabled. I only bring this up because there 
might be something funky going on when comitting the snapshot and 
perhaps it never finishes and hence the snapshot is left behind. <br>
<br>
In general, this should not be the case as in the current implementation
 of the script, it should loop in definite to try to commit the snapshot
 but if it runs out of space or something, it may not finish the commit.
 <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13753"></a>
				<div id="comment-13753" class="jive-content-comment ">
					<span>
						<span>
							Dec 3, 2009 2:19 PM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-fE7v3y8OOdi929Pb" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13768" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-13753">
					goppi - That worked! I enabled the non persistent settings for NFS.<br>
<br>
I also turned off compression so I'll turn that back on a test again to 
make sure, but it seems to be working.<br>
thanks.
					</p>
				</div>
				<a name="comments-13796"></a>
				<div id="comment-13796" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 6, 2009 11:26 AM
						</span>
							<!--<a href="/people/sc0ttjm" title="Click to view sc0ttjm's profile">
<img class="jive-avatar" src="/people/sc0ttjm/avatar/16.png?a=-1" height="16" width="16" title="Click to view sc0ttjm's profile" alt="Click to view sc0ttjm's profile" />
</a>--><a href="http://communities.vmware.com/people/sc0ttjm" 
id="jive-9desqYbF04oV07Vj" class="jive-username-link" title="Click to 
view sc0ttjm's profile">sc0ttjm</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13796">
					Thankyou, Thankyou, Thankyou!<br>
This script does exactly what I needed, I have just backed up my entire 
VM Inventory on My ESXi 4 server in less than 15 minutes and it didn't 
cost me anything!<br>
I really appreciate all your hard work on this script, your community 
salutes you!<br>
Your new biggest fan<br>
Scott
					</p>
				</div>
				<a name="comments-13810"></a>
				<div id="comment-13810" class="jive-content-comment ">
					<span>
						<span>
							Dec 6, 2009 11:36 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6TXjLDQ4Pe8VWg5K" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13796" title="Go to message">sc0ttjm</a>
							</em>
					</span>
					<p id="comment-body-13810">
					Glad to hear everything is working out<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13811"></a>
				<div id="comment-13811" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 7, 2009 1:51 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-4GkJRmUH8jxf3FJb" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13747" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13811">
					hi lamw,<br>
<br>
thanks fÃ¼r yoru response and help.<br>
<br>
i saw, i had a very old version from the script.<br>
now i downloaded the newest from here. but i get errors when i try to 
execute the script:<br>
<br>
/backup # ./ghettoVCB.sh -f vmserver.list<br>
: not found.sh: line 6:<br>
: not found.sh: line 8:<br>
: not found.sh: line 11:<br>
: not found.sh: line 18:<br>
: not found.sh: line 21:<br>
: not found.sh: line 26:<br>
: not found.sh: line 29:<br>
: not found.sh: line 34:<br>
: not found.sh: line 38:<br>
: not found.sh: line 41:<br>
: not found.sh: line 45:<br>
: not found.sh: line 48:<br>
: not found.sh: line 51:<br>
: not found.sh: line 54:<br>
: not found.sh: line 59:<br>
: not found.sh: line 61:<br>
: not found.sh: line 64:<br>
: not found.sh: line 67:<br>
: not found.sh: line 70:<br>
: not found.sh: line 73:<br>
: not found.sh: line 75:<br>
: not found.sh: line 76:<br>
: not found.sh: line 78:<br>
: not found.sh: line 83:<br>
: not found.sh: line 86:<br>
: not found.sh: line 87:<br>
###############################################################################<br>
#<br>
</p><ol>
<li>ghettoVCB for ESX/ESXi 3.5 &amp; 4.x+</li>
<li>Author: William Lam</li>
<li><a class="jive-link-external" 
href="http://www.engineering.ucsb.edu/%7Eduonglt/vmware/">http://www.engineering.ucsb.edu/~duonglt/vmware/</a></li>
<li>Created: 11/17/2008</li>
<li>Last modified: 11/14/2009</li>
</ol>
#<br>
###############################################################################<br>
: not found.sh: line 98: echo<br>
Usage: ./ghettoVCB.sh -f <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_BACKUP_UP_LIST">VM_BACKUP_UP_LIST</a>
 -c <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_CONFIG_DIR">VM_CONFIG_DIR</a>
 -l <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=LOG_FILE">LOG_FILE</a><br>
: not found.sh: line 100: echo<br>
OPTIONS:<br>
   -f     List of VMs to backup<br>
   -c     Configuration directory for VM backups<br>
   -l     File to output logging<br>
   -d     Debug level <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=debug"
 title="dryrun">info</a> (default: info)<br>
: not found.sh: line 106: echo<br>
(e.g.)<br>
<br>
Backup VMs stored in a list<br>
        ./ghettoVCB.sh -f vms_to_backup<br>
<br>
Backup VMs based on specific configuration located in directory<br>
        ./ghettoVCB.sh -f vms_to_backup -c vm_backup_configs<br>
<br>
Output will log to /tmp/ghettoVCB.log<br>
        ./ghettoVCB.sh -f vms_to_backup -l /tmp/ghettoVCB.log<br>
<br>
Dry run (no backup will take place)<br>
        ./ghettoVCB.sh -f vms_to_backup -d dryrun<br>
: not found.sh: line 116: echo<br>
./ghettoVCB.sh: exit: line 117: Illegal number: 1<br>
/backup #<br>
<br>
(i donÂ´t know how i have to use code-tags)<br>
<br>
when i edit the script with vi, i saw ^M at the end of every line. is 
this correct?<br>
<br>
///edit\\\<br>
so, i solved the problem ": not found.sh: line".<br>
now i test if snapshots will be remoove...
					
				</div>
				<a name="comments-13837"></a>
				<div id="comment-13837" class="jive-content-comment ">
					<span>
						<span>
							Dec 9, 2009 4:13 AM
						</span>
							<!--<a href="/people/Wolfsrudel" title="Click to view Wolfsrudel's profile">
<img class="jive-avatar" src="/people/Wolfsrudel/avatar/16.png?a=-1" height="16" width="16" title="Click to view Wolfsrudel's profile" alt="Click to view Wolfsrudel's profile" />
</a>--><a href="http://communities.vmware.com/people/Wolfsrudel" 
id="jive-o082tzjAelJBeols" class="jive-username-link" title="Click to 
view Wolfsrudel's profile">Wolfsrudel</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13837">
					Hello everybody!<br>
<br>
First of all: Thank you for that script.<br>
<br>
But I have a problem with it:<br>
<br>
I have a backup list with the following content:<br>
<br>
VM1<br>
VM2<br>
VM3<br>
<br>
Without compression everything works fine.<br>
But if I enabel compression, only the first vm in the list is backuped.<br>
The last entry of the logfiles shows:<br>
<br>
"Compressing..."<br>
<br>
After this there is no more entry for another vm and the script seems to
 stop.<br>
<br>
What could be the reason?<br>
<br>
Greetz,<br>
Wolfsrudel
					</p>
				</div>
				<a name="comments-13842"></a>
				<div id="comment-13842" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 9, 2009 8:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-XW2m1RK2Flg1uTB5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13837" title="Go to message">Wolfsrudel</a>
							</em>
					</span>
					<p id="comment-body-13842">
					Please post the full debug / dry run log, without additional 
information, it's hard to help. Also remember to wrap the output in 
{code} tags that is ... use "squiggly braces" <br>
<br>
How big are each of the VM backups? We've verified compression up an 
initial VM up to 100GB but nothing larger, the other thing is are you 
doing this manually or automating it through a cron or scheduled task, 
ensure you're not getting disconnected due to any type of timeouts as 
the compression does take awhile and ensure you have sufficient space on
 your destination storage<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13846"></a>
				<div id="comment-13846" class="jive-content-comment ">
					<span>
						<span>
							Dec 10, 2009 3:47 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-84nxXVwW6T1HG22A" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13842" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13846">
					I'm trying to backup a VM with Win03Server but I have some problem.<br>
It has just one thik hard disk.<br>
This is the debug log<br>
<br>
2009-12-10 11:38:55 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-12-10 11:38:55 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-181792<br>
2009-12-10 11:38:55 -- debug: HOSTNAME: DELLESX.gruppoanthea.local<br>
<br>
2009-12-10 11:38:56 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS<br>
2009-12-10 11:38:56 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2009-12-10 11:38:56 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2009-12-10 11:38:56 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2009-12-10 11:38:56 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-12-10 11:38:56 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-12-10 11:38:57 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-12-10 11:38:57 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-12-10 11:38:57 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-12-10 11:38:57 -- info: CONFIG - LOG_LEVEL = debug<br>
2009-12-10 11:38:57 -- info: CONFIG - BACKUP_LOG_OUTPUT = web01.log<br>
2009-12-10 11:38:58 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-12-10 11:38:58 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2009-12-10 11:38:58 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-12-10 11:39:01 -- info: Initiate backup for web01<br>
2009-12-10 11:39:01 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2009-12-10" for web01<br>
2009-12-10 11:39:03 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2009-12-10" to be created<br>
2009-12-10 11:39:03 -- debug: Snapshot timeout set to: 900 seconds<br>
2009-12-10 11:39:05 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 0 - sleeping for 60secs (Duration: 0 seconds)<br>
Failed to clone disk : The file already exists (39).<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/web01/web01.vmdk'...<br>
2009-12-10 11:40:11 -- info: Removing snapshot from web01 ...<br>
<br>
P.s. I backup other 10 VMs on the same ESX without problems
					</p>
				</div>
				<a name="comments-13847"></a>
				<div id="comment-13847" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 10, 2009 5:19 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-07d53MqOvytncpVW" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13846" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-13847">
					Looks like the issue is that the VM is taking way to long on 
creating the snapshot and the default timeout is set to 900secs (15min).
 How much memory does this VM have? Can you try to manually create a 
snapshot and monitor the time of the request and the time of completion.
 This is why it's failing the backup<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13848"></a>
				<div id="comment-13848" class="jive-content-comment ">
					<span>
						<span>
							Dec 10, 2009 5:35 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-78uY00COWppR37jX" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13847" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13848">
					The VM has only 512 Mb of RAM<br>
I manually created a snapshot in less than 3 minutes so no timeout 
problems
					</p>
				</div>
				<a name="comments-13849"></a>
				<div id="comment-13849" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 10, 2009 5:37 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-70318VKuE8M3W5gq" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13848" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-13849">
					Interesting, something must have caused it to fail on the snapshot 
creation. You mentioned you backed up 10 other VMs perfectly fine, when 
this issue occurred was this part of an overall backup with 10 systems 
within a list? Have you tried to isolate it down to just this VM and do a
 single backup with just this VM? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13850"></a>
				<div id="comment-13850" class="jive-content-comment ">
					<span>
						<span>
							Dec 10, 2009 6:41 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-0W67PFkBFn6Pno51" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13849" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13850">
					Yes it is a part of an overall backup with 10 VMs.<br>
I tried to isolate it but the problem still remain
					</p>
				</div>
				<a name="comments-13851"></a>
				<div id="comment-13851" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 10, 2009 6:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-X41J525m4h2ul0p3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13850" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-13851">
					Please post a an execute run with <b>only</b> this single VM with 
both debug and dryrun mode. Could you also elaborate on what this VM is 
running? OS, etc? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13886"></a>
				<div id="comment-13886" class="jive-content-comment ">
					<span>
						<span>
							Dec 14, 2009 2:43 AM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-dM6yCRp1Q6r1lOAY" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13851" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13886">
					The VM is Windows server 2003 enterprise with 512 mb ram<br>
I isolated the backup<br>
<br>
In debug the log seems ok <br>
<br>
2009-12-14 07:33:28 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-12-14 07:33:28 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-181792<br>
2009-12-14 07:33:28 -- debug: HOSTNAME: DELLESX.gruppoanthea.local<br>
<br>
2009-12-14 07:33:29 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS<br>
2009-12-14 07:33:29 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2009-12-14 07:33:29 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2009-12-14 07:33:29 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2009-12-14 07:33:29 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-12-14 07:33:29 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-12-14 07:33:30 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-12-14 07:33:30 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-12-14 07:33:31 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-12-14 07:33:31 -- info: CONFIG - LOG_LEVEL = debug<br>
2009-12-14 07:33:31 -- info: CONFIG - BACKUP_LOG_OUTPUT = web01Debug.log<br>
2009-12-14 07:33:31 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-12-14 07:33:31 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2009-12-14 07:33:32 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-12-14 07:33:35 -- info: Initiate backup for web01<br>
2009-12-14 07:33:35 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2009-12-14" for web01<br>
2009-12-14 07:33:38 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2009-12-14" to be created<br>
2009-12-14 07:33:38 -- debug: Snapshot timeout set to: 900 seconds<br>
2009-12-14 07:33:39 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 0 - sleeping for 60secs (Duration: 0 seconds)<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/web01/web01.vmdk'...<br>
<br>
Clone: 0% done.<br>
Clone: 1% done.<br>
Clone: 2% done.<br>
Clone: 3% done.<br>
Clone: 4% done.<br>
Clone: 5% done.<br>
Clone: 6% done.<br>
Clone: 7% done.<br>
Clone: 8% done.<br>
Clone: 9% done.<br>
Clone: 10% done.<br>
Clone: 11% done.<br>
Clone: 12% done.<br>
Clone: 13% done.<br>
Clone: 14% done.<br>
Clone: 15% done.<br>
Clone: 16% done.<br>
Clone: 17% done.<br>
Clone: 18% done.<br>
Clone: 19% done.<br>
Clone: 20% done.<br>
Clone: 21% done.<br>
Clone: 22% done.<br>
Clone: 23% done.<br>
Clone: 24% done.<br>
Clone: 25% done.<br>
Clone: 26% done.<br>
Clone: 27% done.<br>
Clone: 28% done.<br>
Clone: 29% done.<br>
Clone: 30% done.<br>
Clone: 31% done.<br>
Clone: 32% done.<br>
Clone: 33% done.<br>
Clone: 34% done.<br>
Clone: 35% done.<br>
Clone: 36% done.<br>
Clone: 37% done.<br>
Clone: 38% done.<br>
Clone: 39% done.<br>
Clone: 40% done.<br>
Clone: 41% done.<br>
Clone: 42% done.<br>
Clone: 43% done.<br>
Clone: 44% done.<br>
Clone: 45% done.<br>
Clone: 46% done.<br>
Clone: 47% done.<br>
Clone: 48% done.<br>
Clone: 49% done.<br>
Clone: 50% done.<br>
Clone: 51% done.<br>
Clone: 52% done.<br>
Clone: 53% done.<br>
Clone: 54% done.<br>
Clone: 55% done.<br>
Clone: 56% done.<br>
Clone: 57% done.<br>
Clone: 58% done.<br>
Clone: 59% done.<br>
Clone: 60% done.<br>
Clone: 61% done.<br>
Clone: 62% done.<br>
Clone: 63% done.<br>
Clone: 64% done.<br>
Clone: 65% done.<br>
Clone: 66% done.<br>
Clone: 67% done.<br>
Clone: 68% done.<br>
Clone: 69% done.<br>
Clone: 70% done.<br>
Clone: 71% done.<br>
Clone: 72% done.<br>
Clone: 73% done.<br>
Clone: 74% done.<br>
Clone: 75% done.<br>
Clone: 76% done.<br>
Clone: 77% done.<br>
Clone: 78% done.<br>
Clone: 79% done.<br>
Clone: 80% done.<br>
Clone: 81% done.<br>
Clone: 82% done.<br>
Clone: 83% done.<br>
Clone: 84% done.<br>
Clone: 85% done.<br>
Clone: 86% done.<br>
Clone: 87% done.<br>
Clone: 88% done.<br>
Clone: 89% done.<br>
Clone: 90% done.<br>
Clone: 91% done.<br>
Clone: 92% done.<br>
Clone: 93% done.<br>
Clone: 94% done.<br>
Clone: 95% done.<br>
Clone: 96% done.<br>
Clone: 97% done.<br>
Clone: 98% done.<br>
Clone: 99% done.<br>
Clone: 100% done.<br>
2009-12-14 09:54:26 -- info: Removing snapshot from web01 ...<br>
<br>
But in the console I can see this error<br>
<br>
./ghettoVCB.sh: line 735: syntax error: 
/vmfs/volumes/VMBACKUP/ESX15/web01/web01-2009-11-14+1<br>
<br>
This is the dryrun log<br>
<br>
2009-12-11 16:43:40 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2009-12-11 16:43:40 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS<br>
2009-12-11 16:43:41 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2009-12-11 16:43:41 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2009-12-11 16:43:41 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2009-12-11 16:43:41 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2009-12-11 16:43:42 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2009-12-11 16:43:42 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2009-12-11 16:43:43 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2009-12-11 16:43:43 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2009-12-11 16:43:44 -- info: CONFIG - LOG_LEVEL = dryrun<br>
2009-12-11 16:43:44 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
web01DryRun.log<br>
2009-12-11 16:43:44 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2009-12-11 16:43:44 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2009-12-11 16:43:44 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2009-12-11 16:43:46 -- dryrun: 
###############################################<br>
2009-12-11 16:43:47 -- dryrun: Virtual Machine: web01<br>
2009-12-11 16:43:47 -- dryrun: VM_ID: 64<br>
2009-12-11 16:43:47 -- dryrun: VMX_PATH: 
/vmfs/volumes/datastore1/web01/web01.vmx<br>
2009-12-11 16:43:48 -- dryrun: VMX_DIR: /vmfs/volumes/datastore1/web01<br>
2009-12-11 16:43:48 -- dryrun: VMX_CONF: web01/web01.vmx<br>
2009-12-11 16:43:49 -- dryrun: VMFS_VOLUME: datastore1<br>
2009-12-11 16:43:49 -- dryrun: VMDK(s): <br>
2009-12-11 16:43:49 -- dryrun: 	web01.vmdk<br>
2009-12-11 16:43:49 -- dryrun: 
###############################################<br>
<br>
2009-12-11 16:43:51 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
				<a name="comments-13888"></a>
				<div id="comment-13888" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 14, 2009 9:17 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-eQFHjLJiGnRCqA9X" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13886" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-13888">
					Yea I don't see anything wrong with the logs either, but when you 
get anything relating to "+X" where X is some number, it's probably 
around the rotation function where it's renaming and deleting older 
backups. I don't see anything odd about your VM backup, so I'll have to 
try to reproduce this if I can in my lab. <br>
<br>
I see this as your ESXi build: VMware ESXi 4.0.0 build-181792<br>
<br>
What ESXi 4 version is this? update 1? is it patched? I'll need to try 
to duplicate the exact version to see if there's been any odd changes in
 the busybox console (which I hope isn't the case).<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13919"></a>
				<div id="comment-13919" class="jive-content-comment ">
					<span>
						<span>
							Dec 14, 2009 2:09 PM
						</span>
							<!--<a href="/people/JLeyva" title="Click to view JLeyva's profile">
<img class="jive-avatar" src="/people/JLeyva/avatar/16.png?a=-1" height="16" width="16" title="Click to view JLeyva's profile" alt="Click to view JLeyva's profile" />
</a>--><a href="http://communities.vmware.com/people/JLeyva" 
id="jive-lArUdNwDeM8F7piD" class="jive-username-link" title="Click to 
view JLeyva's profile">JLeyva</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13919">
					I've tried searching through the comments for an answer.. sorry If 
this is a repeat question and thank you for this great script.<br>
<br>
I have 4 ESX 3.5 servers using this script with great success so far. My
 question is how can I generate the vm_backup_list dynamically. VMGuests
 often move around from host to host and each time I have to update the 
backup list on all 4 hosts same when I create a new VMGuest. is there a 
way to generate the backup list dynamically?<br>
<br>
thnks....
					</p>
				</div>
				<a name="comments-13889"></a>
				<div id="comment-13889" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 14, 2009 3:23 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-r7mIMhofiDadCaSC" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13919" title="Go to message">JLeyva</a>
							</em>
					</span>
					<p id="comment-body-13889">
					Majority of the users out there do not have vCenter and the script 
is executed on a per host basis w/o vMotion. Having said that, I know 
there are a few out there that run into this problem and to tell you the
 truth, this is not something I've not tested. <br>
<br>
You can dynamically generate the list, but my fear is that if could be 
the case that the VM is backed up, it migrates and then some other host 
now sees this VM and tries to back it up. Basically you would some logic
 to keep track of what VMs have been backed up, perhaps an exclusion 
list for the given day/etc. <br>
<br>
To dump out all the VMs residing on a given host is pretty trivial and 
if you're on the classic ESX, vmware-cmd -l can do it but if you just 
want the VM name which is eventually feed into the script to process, 
you can just use <b>vimsh</b> by doing something like:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/getallvms | grep -v Vmid | awk '{print $2}' | sed '/^$/d'
</code></pre><br>
<br>
and just redirect that out to a file and then have that be read into 
ghettoVCB to process<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13920"></a>
				<div id="comment-13920" class="jive-content-comment ">
					<span>
						<span>
							Dec 14, 2009 11:41 PM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-Y1g49PqNgDjLCGMi" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13888" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13920">
					That's a Vmware ESXi patched but I had this problem also with older
 release.<br>
I can try with the update 1 in the next days but I don't think that's a 
problem releated with the release of vmware.<br>
<br>
I think that the problem is when renaming and deleting. Infact it create
 the backup files that are perfect but it leave the old backup folder.
					</p>
				</div>
				<a name="comments-13909"></a>
				<div id="comment-13909" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 15, 2009 3:00 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-r2o2s70UM919c55S" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13909">
					hi,<br>
i still have the problems with the snapshots:<br>
sometimes the snapshots will be removed and sometimes not...<br>
here the logs:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">2009-12-15 10:25:01 -- info: ============================== ghettoVCB LOG START ==============================

2009-12-15 10:25:01 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294
2009-12-15 10:25:01 -- debug: HOSTNAME: ESXi01-AIC.Domain.de

2009-12-15 10:25:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/QNAP01-AIC
2009-12-15 10:25:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-12-15 10:25:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-12-15 10:25:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-12-15 10:25:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-12-15 10:25:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-12-15 10:25:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-12-15 10:25:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-12-15 10:25:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-12-15 10:25:01 -- info: CONFIG - LOG_LEVEL = debug
2009-12-15 10:25:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB2.log
2009-12-15 10:25:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-12-15 10:25:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-12-15 10:25:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-12-15 10:25:03 -- info: Initiate backup for AIC-KAV01
2009-12-15 10:25:03 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-12-15" for AIC-KAV01
2009-12-15 10:25:03 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2009-12-15" to be created
2009-12-15 10:25:03 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/AIC-KAV01/AIC-KAV01.vmdk'...
Clone: 100% done.
2009-12-15 10:38:44 -- info: Removing snapshot from AIC-KAV01 ...
2009-12-15 10:38:50 -- info: Backup Duration: 13.78 Minutes
2009-12-15 10:38:50 -- info: Successfully completed backup for AIC-KAV01!

2009-12-15 10:38:50 -- info: Snapshot found for VS01-Versand, backup will not take place

2009-12-15 10:38:50 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<pre class="jive-pre"><code class="jive-code jive-plain">2009-12-15 10:51:32 -- info: ============================== ghettoVCB LOG START ==============================

2009-12-15 10:51:32 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/QNAP01-AIC
2009-12-15 10:51:32 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-12-15 10:51:32 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-12-15 10:51:32 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-12-15 10:51:32 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-12-15 10:51:32 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-12-15 10:51:32 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-12-15 10:51:32 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-12-15 10:51:32 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-12-15 10:51:32 -- info: CONFIG - LOG_LEVEL = dryrun
2009-12-15 10:51:32 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB3.log
2009-12-15 10:51:32 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-12-15 10:51:32 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-12-15 10:51:32 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-12-15 10:51:33 -- dryrun: ###############################################
2009-12-15 10:51:33 -- dryrun: Virtual Machine: AIC-KAV01
2009-12-15 10:51:33 -- dryrun: VM_ID: 16
2009-12-15 10:51:33 -- dryrun: VMX_PATH: /vmfs/volumes/datastore1/AIC-KAV01/AIC-KAV01.vmx
2009-12-15 10:51:33 -- dryrun: VMX_DIR: /vmfs/volumes/datastore1/AIC-KAV01
2009-12-15 10:51:33 -- dryrun: VMX_CONF: AIC-KAV01/AIC-KAV01.vmx
2009-12-15 10:51:33 -- dryrun: VMFS_VOLUME: datastore1
2009-12-15 10:51:33 -- dryrun: VMDK(s):
2009-12-15 10:51:33 -- dryrun:         AIC-KAV01.vmdk
2009-12-15 10:51:33 -- dryrun: ###############################################

2009-12-15 10:51:33 -- dryrun: ###############################################
2009-12-15 10:51:33 -- dryrun: Virtual Machine: VS01-Versand
2009-12-15 10:51:33 -- dryrun: VM_ID: 48
2009-12-15 10:51:33 -- dryrun: VMX_PATH: /vmfs/volumes/datastore1/VS01-Versand/VS01-Versand.vmx
2009-12-15 10:51:33 -- dryrun: VMX_DIR: /vmfs/volumes/datastore1/VS01-Versand
2009-12-15 10:51:33 -- dryrun: VMX_CONF: VS01-Versand/VS01-Versand.vmx
2009-12-15 10:51:33 -- dryrun: VMFS_VOLUME: datastore1
2009-12-15 10:51:33 -- dryrun: VMDK(s):
2009-12-15 10:51:33 -- dryrun:         VS01-Versand-000002.vmdk
2009-12-15 10:51:33 -- dryrun: ###############################################

2009-12-15 10:51:33 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
when i delete all snapshots with vspehre and start backup again, i get 
these both errors in the console:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">rm: cannot remove '/vmfs/volumes/QNAP01-AIC/AIC-KAV01/AIC-KAV01-2009-12-14--3/AIC-KAV01-flat.vmdk': No such file or directory
</code></pre><br>
<pre class="jive-pre"><code class="jive-code jive-plain">rm: cannot remove '/vmfs/volumes/QNAP01-AIC/VS01-Versand/VS01-Versand-2009-12-15--3/VS01-Versand-flat.vmdk': Input/output error
</code></pre><br>
<br>
and here is the log from backup after deleting snapshots with vsphere:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">2009-12-15 12:07:22 -- info: ============================== ghettoVCB LOG START ==============================

2009-12-15 12:07:22 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294
2009-12-15 12:07:22 -- debug: HOSTNAME: ESXi01-AIC.Domain.de

2009-12-15 12:07:22 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/QNAP01-AIC
2009-12-15 12:07:22 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2009-12-15 12:07:22 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-12-15 12:07:22 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-12-15 12:07:22 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-12-15 12:07:22 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-12-15 12:07:22 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-12-15 12:07:22 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-12-15 12:07:22 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-12-15 12:07:22 -- info: CONFIG - LOG_LEVEL = debug
2009-12-15 12:07:22 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB.log
2009-12-15 12:07:22 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-12-15 12:07:22 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-12-15 12:07:22 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-12-15 12:07:23 -- info: Initiate backup for AIC-KAV01
2009-12-15 12:07:23 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-12-15" for AIC-KAV01
2009-12-15 12:07:24 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2009-12-15" to be created
2009-12-15 12:07:24 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/AIC-KAV01/AIC-KAV01.vmdk'...
Clone: 100% done.
2009-12-15 12:21:05 -- info: Removing snapshot from AIC-KAV01 ...
2009-12-15 12:21:38 -- info: Backup Duration: 14.25 Minutes
2009-12-15 12:21:38 -- info: Successfully completed backup for AIC-KAV01!

2009-12-15 12:21:39 -- info: Initiate backup for VS01-Versand
2009-12-15 12:21:39 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-12-15" for VS01-Versand
2009-12-15 12:21:40 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2009-12-15" to be created
2009-12-15 12:21:40 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/VS01-Versand/VS01-Versand.vmdk'...
Clone: 100% done.
2009-12-15 12:39:23 -- info: Removing snapshot from VS01-Versand ...
2009-12-15 12:40:00 -- info: Backup Duration: 18.35 Minutes
2009-12-15 12:40:00 -- info: Successfully completed backup for VS01-Versand!

2009-12-15 12:40:00 -- info: ============================== ghettoVCB LOG END ================================
</code></pre>
					
				</div>
				<a name="comments-13910"></a>
				<div id="comment-13910" class="jive-content-comment ">
					<span>
						<span>
							Dec 15, 2009 4:56 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-TGG76A9Yz2gtB1wv" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13919" title="Go to message">JLeyva</a>
							</em>
					</span>
					<p id="comment-body-13910">
					JLeyva, <br>
I personally use 1 list only shared for my ESX servers. I saved it in 
shared storage (NAS) and in that way I only update 1 list.
					</p>
				</div>
				<a name="comments-13921"></a>
				<div id="comment-13921" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 15, 2009 6:57 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-csG650F8gaW0wfg7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13909" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-13921">
					Is the destination datastore that you're backing up to an NFS 
datastore? If so, do you have sufficient space locally that we can try 
the same exact backup? I've started to notice that users that run into 
issues with either removing snapshots and deleting files sometimes run 
into issues due to their NFS setup and it sometimes produces 
input/output errors in either timeouts or errors, generally saturation 
of the link or non-optimal configuration. <br>
<br>
To ensure we're removing that out of the picture, lets try a local 
backup where it's writing to a local VMFS volume and if you're still 
having the same issues, we can diagnose further. As you've noted, this 
is probably not an issue with not being on update1 and this has worked 
for many on previous releases. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13922"></a>
				<div id="comment-13922" class="jive-content-comment ">
					<span>
						<span>
							Dec 15, 2009 6:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-b4DO5q75jOS9aua4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13920" title="Go to message">freez267</a>
							</em>
					</span>
					<p id="comment-body-13922">
					I've already mentioned this to @bonibaz:<br>
<br>
</p><div class="jive-quote">
Is the destination datastore that you're backing up to an NFS datastore?
 If so, do you have sufficient space locally that we can try the same 
exact backup? I've started to notice that users that run into issues 
with either removing snapshots and deleting files sometimes run into 
issues due to their NFS setup and it sometimes produces input/output 
errors in either timeouts or errors, generally saturation of the link or
 non-optimal configuration.<br>
<br>
To ensure we're removing that out of the picture, lets try a local 
backup where it's writing to a local VMFS volume and if you're still 
having the same issues, we can diagnose further. As you've noted, this 
is probably not an issue with not being on update1 and this has worked 
for many on previous releases. <br>
</div>
<br>
Let me know if you're in the same boat?<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13890"></a>
				<div id="comment-13890" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 15, 2009 7:57 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-9Ye5Hm8df1a3TviU" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13921" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13890">
					hi william,<br>
<br>
yes, the destination datastore is an NFS. ItÂ´s a "QNAP"-NAS with more 
then 9TB. Actually i only backup these both VMs, so ther is enough space
 unused.<br>
<br>
At the local datastore i have only 94GB, so i can create two or maximal 
three backups from both VMs.<br>
<br>
Tonight i backup to the NFS. IÂ´ll change my configuration tomorrow for 
backup to local datastore.
					</p>
				</div>
				<a name="comments-13891"></a>
				<div id="comment-13891" class="jive-content-comment ">
					<span>
						<span>
							Dec 15, 2009 8:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-KP36GlIyBcA55E58" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13890" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-13891">
					I'm not so much worried about the available space versus the setup 
of the NFS server. As mentioned to help isolate the issue, I would like 
you to run a comparison backup between the NFS datastore and local 
datastore and see if local is consistently successful without having any
 issues. If you don't have space locally to support multiple backups, 
then lets try it with one VM and set the rotate to max of 1 and check 
back and see if we see any similarities/differences. You might also want
 to look at the logs under /var/log/* and see if there are any issues 
reported during the time of the backup, that may also tell us what might
 be going on<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13912"></a>
				<div id="comment-13912" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 15, 2009 3:36 PM
						</span>
							<!--<a href="/people/Rob98" title="Click to view Rob98's profile">
<img class="jive-avatar" src="/people/Rob98/avatar/16.png?a=-1" height="16" width="16" title="Click to view Rob98's profile" alt="Click to view Rob98's profile" />
</a>--><a href="http://communities.vmware.com/people/Rob98" 
id="jive-wsY9L8QUAiWdagWQ" class="jive-username-link" title="Click to 
view Rob98's profile">Rob98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12452" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13912">
					I reported back in september that my thin provisioned VMs were 
taking up the full allocated size on the NFS where they were being 
backed up to.  I suspected this might be a problem with the NFS server I
 was using (Services for Unix on Windows Server 2003).  <br>
<br>
I can now confirm that that appears to have been the case.  With no 
other changes other that switching to a new NFS server (openfiler 2.3) 
the VMs are now being backed up to their appropriate size. (i.e. 1 that 
was taking up the full 40 GB on the Win2003 server is now only taking up
 8 GB on the openfiler NAS).
					</p>
				</div>
				<a name="comments-13892"></a>
				<div id="comment-13892" class="jive-content-comment ">
					<span>
						<span>
							Dec 15, 2009 8:18 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-S86ROBNUHEq9D62t" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13912" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-13892">
					Very glad to hear the issue has been resolved!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13913"></a>
				<div id="comment-13913" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 15, 2009 11:40 PM
						</span>
							<!--<a href="/people/freez267" title="Click to view freez267's profile">
<img class="jive-avatar" src="/people/freez267/avatar/16.png?a=-1" height="16" width="16" title="Click to view freez267's profile" alt="Click to view freez267's profile" />
</a>--><a href="http://communities.vmware.com/people/freez267" 
id="jive-Q197d549iUDV6Qw6" class="jive-username-link" title="Click to 
view freez267's profile">freez267</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13922" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13913">
					I will try a local backup
					</p>
				</div>
				<a name="comments-13914"></a>
				<div id="comment-13914" class="jive-content-comment ">
					<span>
						<span>
							Dec 16, 2009 1:50 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-ILScY92dlIQpI48r" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13912" title="Go to message">Rob98</a>
							</em>
					</span>
					<p id="comment-body-13914">
					@Rob98:<br>
<br>
This I already reported in this thread. You can work around this by 
using the '2gbsparse' format instead. This will only occupy the space 
which is used by the vmdk on Windows NFS.<br>
<br>
@All:<br>
<br>
How about your experiences with NFS datastore at all. <br>
Mine are not as good.<br>
For me this seems not to be very reliable implemented in ESXi.<br>
I tried different NFS servers (all on Windows plattforms) in completely 
different environments also with very fast Hardware, but from time to 
time I still get input/output errors in all environments (mostly on 
restore). Server which seems to work best so far is AllegroNFS
					</p>
				</div>
				<a name="comments-13894"></a>
				<div id="comment-13894" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 17, 2009 9:45 PM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-k9x6medlzBf7Bx8O" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13894">
					Hey William, nice script.<br>
<br>
I downloaded LAST_MODIFIED_DATE=11/14/2009 and I think either I am doing
 something wrong or the -f command is missing from the cron examples.<br>
<br>
Dont you need to use the -f also as part of the cron command ?<br>
<br>
Also for the log file you are using %s. I will suggest using $(date +<br
 clear="all">%F)-ghetto-backup.log instead as it will be easier to tail 
based on a date than having the ghetto part first, easier to sort, etc.<br>
<br>
Also, /bin/busybox crond does not seem to work in ESXi 4.0.0 
build-208167, if I use just crond it works.<br>
<br>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-13896"></a>
				<div id="comment-13896" class="jive-content-comment ">
					<span>
						<span>
							Dec 18, 2009 2:21 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-Xebgjo6kqPyjJOTH" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13891" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13896">
					today i changed the backuppath to the local datastore with 
"rotation: 1"<br>
i think, next week i can post more...
					</p>
				</div>
				<a name="comments-13959"></a>
				<div id="comment-13959" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 22, 2009 1:02 PM
						</span>
							<!--<a href="/people/Gzolfo" title="Click to view Gzolfo's profile">
<img class="jive-avatar" src="/people/Gzolfo/avatar/16.png?a=-1" height="16" width="16" title="Click to view Gzolfo's profile" alt="Click to view Gzolfo's profile" />
</a>--><a href="http://communities.vmware.com/people/Gzolfo" 
id="jive-nXor3iQT8xw1aSGY" class="jive-username-link" title="Click to 
view Gzolfo's profile">Gzolfo</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13959">
					Hi, when I runs the script appear:<br>
<br>
/vmfs/volumes/ee8e6fb6-4774615c/script # ./ghettoVCB.sh -f vmtobackup <br>
./ghettoVCB.sh: line 165: syntax error: "elif" unexpected (expecting 
"then")<br>
<br>
Coud you help me?<br>
<br>
Regards,
					</p>
				</div>
				<a name="comments-13981"></a>
				<div id="comment-13981" class="jive-content-comment ">
					<span>
						<span>
							Dec 22, 2009 2:06 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0JTuQ3kfapurpt0w" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13959" title="Go to message">Gzolfo</a>
							</em>
					</span>
					<p id="comment-body-13981">
					There should not be any errors when executing, usually users will 
run into this issue if they downloaded the script and somehow got 
'Windows' specific characters into the script that may cause issues 
within the execution. You'll want to only edit the script within ESX(i) 
host. How did you download,upload and edit the script?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13991"></a>
				<div id="comment-13991" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 22, 2009 2:07 PM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-uEJJXzQaEzGYnpGu" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13959" title="Go to message">Gzolfo</a>
							</em>
					</span>
					<p id="comment-body-13991">
					I will say to copy the script again and make sure you dont open it 
in windows first. That is known to mess the scripts. <br>
</p><p>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-13982"></a>
				<div id="comment-13982" class="jive-content-comment ">
					<span>
						<span>
							Dec 23, 2009 5:58 AM
						</span>
							<!--<a href="/people/Gzolfo" title="Click to view Gzolfo's profile">
<img class="jive-avatar" src="/people/Gzolfo/avatar/16.png?a=-1" height="16" width="16" title="Click to view Gzolfo's profile" alt="Click to view Gzolfo's profile" />
</a>--><a href="http://communities.vmware.com/people/Gzolfo" 
id="jive-22RVT58IHfeBQKS9" class="jive-username-link" title="Click to 
view Gzolfo's profile">Gzolfo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13981" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13982">
					Thanks William for the help.<br>
The script download to my Windows PC, without editing it upload with 
vSphere Client and modify it using "vi" in ESXi. Is it OK?<br>
<br>
Regards,<br>
<br>
Gustavo Zolfo
					</p>
				</div>
				<a name="comments-14005"></a>
				<div id="comment-14005" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 23, 2009 6:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8gajRBR3Wh0FsM6S" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13982" title="Go to message">Gzolfo</a>
							</em>
					</span>
					<p id="comment-body-14005">
					NO, that is not okay. If you use the vSphere Client to upload ... 
it does its funkyness with Windows and add ^M characters to the script 
which causes issue.<br>
<br>
Please download the script to your local system using any browser, do 
not edit the file and upload using SCP and for those that are on Windows
 system, use winscp (free utility). Then edit using VI <br>
<br>
I may need to update the documents to state this explicitly as I find 
users are either editing the script in Windows text editor OR uploading 
using vSphere Client which can mess up the contents of the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14006"></a>
				<div id="comment-14006" class="jive-content-comment ">
					<span>
						<span>
							Dec 23, 2009 10:17 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4SVtbxh96NqHh7uo" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13575" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-14006">
					This recent thread: <a class="jive-link-thread" 
href="http://communities.vmware.com/thread/249185">Pre / Post scripts 
for Snapshots</a> reminded me of your question awhile back about calling
 the <b>shrink</b> option from with a VM using VMware Tools, afaik, this
 is not possible and there's few threads on VMTN and on google how it's 
not supported.<br>
<br>
However, from this thread, it sounds like you <u>can</u> potentially 
call your own script prior to the backup and snaphot ... you might be 
able to use this open source version of <b>shrink</b> tool <b><a 
class="jive-link-external" 
href="http://chitchat.at.infoseek.co.jp/vmware/vmtools.html#vmshrink">vmshrink</a></b>
 which actually makes an RPC call to undocumented API to start the 
shrink process. You <u>should</u> be able to create two .bat scripts 
following the thread mentioned above (.bat ext. of course) and make a 
call to vmshrink tool before snapshot is taken. <br>
<br>
Would be interesting to see if this could be a potential work around and
 help shorten the duration of backup process.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-13992"></a>
				<div id="comment-13992" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 23, 2009 10:44 AM
						</span>
							<!--<a href="/people/Gzolfo" title="Click to view Gzolfo's profile">
<img class="jive-avatar" src="/people/Gzolfo/avatar/16.png?a=-1" height="16" width="16" title="Click to view Gzolfo's profile" alt="Click to view Gzolfo's profile" />
</a>--><a href="http://communities.vmware.com/people/Gzolfo" 
id="jive-20WFEM32111l3vMu" class="jive-username-link" title="Click to 
view Gzolfo's profile">Gzolfo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14005" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-13992">
					Thank you again!!<br>
ItÂ´s working....
					</p>
				</div>
				<a name="comments-14007"></a>
				<div id="comment-14007" class="jive-content-comment ">
					<span>
						<span>
							Dec 23, 2009 10:48 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-zw2ShEyaVejC9lFo" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14005" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14007">
					If you are on Windows you can edit the script from within WinSCP. 
This one takes care of converting EOL characters.<br>
Another option is to use Scite. With this editor you can change EOL 
character automatically as needed.
					</p>
				</div>
				<a name="comments-13986"></a>
				<div id="comment-13986" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 26, 2009 10:33 AM
						</span>
							<!--<a href="/people/MarkusAngerer" title="Click to view MarkusAngerer's profile">
<img class="jive-avatar" src="/people/MarkusAngerer/avatar/16.png?a=-1" height="16" width="16" title="Click to view MarkusAngerer's profile" alt="Click to view MarkusAngerer's profile" />
</a>--><a href="http://communities.vmware.com/people/MarkusAngerer" 
id="jive-Ym9bqz6Fgc5RV7Ik" class="jive-username-link" title="Click to 
view MarkusAngerer's profile">MarkusAngerer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-13986">
					Hello William, hello all!<br>
<br>
I have installed the ghettoVCB backup yesterday and need to say that I 
really love it. It does exactly what I had hoped, I only need to test 
the restore but I'm very optimistic.<br>
<br>
One minor improvement came to my mind during the setup: The backup 
parameters require the adapter type (I guess to correctly read the data 
from the disk-file) which makes it impossible to use the default 
parameters if Win2000 and Win2003+ vms are in use.<br>
I dont know much about unix shell scripts and also not about the 
internal structures of the *.vmdk files but by looking briefly over your
 scripts and my .vmdk file I thought of something like the following:<br>
</p><p>
</p><p>
this is a section out of your ghettoVCB.sh:<br>
&nbsp; ...<br>
&nbsp;   #support for vRDM and deny pRDM<br>
&nbsp;   grep "vmfsPassthroughRawDeviceMap" "${SOURCE_VMDK}" &gt; 
/dev/null 2&gt;&amp;1<br>
&nbsp;		if [ $? -eq 1 ]; then<br>
<br>
==&gt;&nbsp;&nbsp;			ADAPTER_FORMAT=$(grep -i "ddb.adapterType" 
"${SOURCE_VMDK}" | awk -F '=' '{print $2}' | sed 's/"//g' | sed -e 
's/^[[:blank:]]*//;s/[[:blank:]]*$//')<br>
<br>
&nbsp;&nbsp;&nbsp;			if [ "${DISK_BACKUP_FORMAT}" == "zeroedthick" ]; 
then<br>
&nbsp;&nbsp;&nbsp;&nbsp;				if [ "${VER}" == "4" ]; then <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                		        
${VMKFSTOOLS_CMD} -i "${SOURCE_VMDK}" -a "${ADAPTER_FORMAT}" -d 
zeroedthick "${DESTINATION_VMDK}" 2&gt;&amp;1 | tee -a -i "${REDIRECT}"<br>
&nbsp;&nbsp;&nbsp;&nbsp;				else <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;					...<br>
<br>
The line with ===&gt; is inserted by me.<br>
I copied the command from another section of your scripts because I 
think it extracts the right part of the line from a file (It is just a 
guess; to be honest, I dont understand even a part of what it really 
does ;-(<br>
<br>
Could this save me from specifying the adapter format each time and 
still get me the correct data? Do you think it works with all type of 
disks or only the *.vmdk/*-flat.vmdk combination that I looked at?<br>
<br>
Thanks for any feedback. Markus
					</p>
				</div>
				<a name="comments-14001"></a>
				<div id="comment-14001" class="jive-content-comment ">
					<span>
						<span>
							Dec 28, 2009 10:48 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-VIVuEfxvQ7wE89di" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-13986" title="Go to message">MarkusAngerer</a>
							</em>
					</span>
					<p id="comment-body-14001">
					These were all additional parameters that were presented so that 
users may choose how their backups were taken place, some had asked if 
they could change the adapter/etc. I don't have access to my test 
environment, but from the logic, it sounds reasonable to get the adapter
 information from the .vmdk descriptor file. <br>
<br>
Thanks for the feedback<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14013"></a>
				<div id="comment-14013" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Dec 28, 2009 11:37 AM
						</span>
							<!--<a href="/people/MarkusAngerer" title="Click to view MarkusAngerer's profile">
<img class="jive-avatar" src="/people/MarkusAngerer/avatar/16.png?a=-1" height="16" width="16" title="Click to view MarkusAngerer's profile" alt="Click to view MarkusAngerer's profile" />
</a>--><a href="http://communities.vmware.com/people/MarkusAngerer" 
id="jive-9WhI5T6kHmcmF5sJ" class="jive-username-link" title="Click to 
view MarkusAngerer's profile">MarkusAngerer</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14001" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14013">
					Ah, I see, the adapter type is required to write the destination 
disk file not to read the source file ? Thus it can be converted and 
backed-up at the same time.<br>
<br>
I'll give it a try and see... Thank you! Have a successful start into 
2010!
					</p>
				</div>
				<a name="comments-14087"></a>
				<div id="comment-14087" class="jive-content-comment ">
					<span>
						<span>
							Jan 11, 2010 12:34 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-41njWRG2sgy9XmyX" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14087">
					hi william,<br>
<br>
i changed the backuppath to a local datastore before christmas.<br>
but my problem is still the same. here the log:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">2009-12-23 04:30:01 -- info: ============================== ghettoVCB LOG START ==============================

2009-12-23 04:30:01 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294
2009-12-23 04:30:01 -- debug: HOSTNAME: ESXi01-AIC.XXXXXXXXXXX.de

2009-12-23 04:30:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/datastore1/testbackup
2009-12-23 04:30:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2
2009-12-23 04:30:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-12-23 04:30:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-12-23 04:30:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-12-23 04:30:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-12-23 04:30:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-12-23 04:30:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-12-23 04:30:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-12-23 04:30:01 -- info: CONFIG - LOG_LEVEL = debug
2009-12-23 04:30:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-12-23 04:30:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-12-23 04:30:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-12-23 04:30:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-12-23 04:30:03 -- info: Initiate backup for VS01-Versand
2009-12-23 04:30:03 -- info: Creating Snapshot "ghettoVCB-snapshot-2009-12-23" for VS01-Versand
2009-12-23 04:30:04 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2009-12-23" to be created
2009-12-23 04:30:04 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/VS01-Versand/VS01-Versand.vmdk'...
Clone: 100% done.
2009-12-23 04:37:55 -- info: Removing snapshot from VS01-Versand ...
2010-01-11 06:49:23 -- info: Backup Duration: 27499.33 Minutes
2010-01-11 06:49:23 -- info: Successfully completed backup for VS01-Versand!

2010-01-11 06:49:23 -- info: ============================== ghettoVCB LOG END ================================

 done.


2010-01-11 06:49:23 -- info: Backup Duration: 27499.33 Minutes
2010-01-11 06:49:23 -- info: Successfully completed backup for VS01-Versand!

2010-01-11 06:49:23 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
i removed the snapshot today by hand.<br>
<p>
</p><pre class="jive-pre"><code class="jive-code jive-plain">2009-12-24 04:30:01 -- info: ============================== ghettoVCB LOG START ==============================

2009-12-24 04:30:01 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294
2009-12-24 04:30:01 -- debug: HOSTNAME: ESXi01-AIC.XXXXXXXXXXXXX.de

2009-12-24 04:30:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/datastore1/testbackup
2009-12-24 04:30:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2
2009-12-24 04:30:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2009-12-24 04:30:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2009-12-24 04:30:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2009-12-24 04:30:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2009-12-24 04:30:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2009-12-24 04:30:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2009-12-24 04:30:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2009-12-24 04:30:01 -- info: CONFIG - LOG_LEVEL = debug
2009-12-24 04:30:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2009-12-24 04:30:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2009-12-24 04:30:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2009-12-24 04:30:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2009-12-24 04:30:02 -- info: Snapshot found for VS01-Versand, backup will not take place

2009-12-24 04:30:02 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
do you have any idea why the snapshot will not be removed?
					
				</div>
				<a name="comments-14075"></a>
				<div id="comment-14075" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 11, 2010 3:00 AM
						</span>
							<!--<a href="/people/SanderH" title="Click to view SanderH's profile">
<img class="jive-avatar" src="/people/SanderH/avatar/16.png?a=-1" height="16" width="16" title="Click to view SanderH's profile" alt="Click to view SanderH's profile" />
</a>--><a href="http://communities.vmware.com/people/SanderH" 
id="jive-5X5Q5gTphU2LMqw4" class="jive-username-link" title="Click to 
view SanderH's profile">SanderH</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14075">
					Hi,<br>
<br>
I also got some problems using the compression features of the script. I
 tested with 2 VM's, one large one with 3 disks, one of 50GB, one of 5GB
 and one of 250GB. Usage on this disks is very low, maybe 20GB in total.
 After backup I could not get the backup unzipped, on both the ESXi 
machine and another "normal" linux machine. The same goes for a VM with a
 single 40GB disk with 20GB usage. The error is: "Invalid tar magick". 
Tried backuping to both local storage and remote NFS storage.<br>
<br>
Because I needed to transfer the big VM to a remote VMWare Server 
machine I looked for another way to compress the backup. I ended up 
compressing it disk-by-disk with the gzip command, and afterwards I 
could unzip them just fine. Maybe it is an idea to rewrite the script to
 just zip the single disk files in stead of the whole VM directory?
					</p>
				</div>
				<a name="comments-14097"></a>
				<div id="comment-14097" class="jive-content-comment ">
					<span>
						<span>
							Jan 11, 2010 8:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Qi54QR5mBNRR99C0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14087" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-14097">
					Very odd situation, this is the only case I've seen with this type 
of persisted issue. The only thing I can think of off the top of my head
 is that you're potentially overloading your ESXi host? How are the 
physical resources (cpu/memory) on the ESXi host? Do you see any spikes 
in performance during the backup window that may cause the snapshots to 
fail to commit? Could you also trace the backup timestamps with ESXi 
logs (/var/log/messages,/var/log/vmware/hostd.log) and see if there are 
any errors? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14098"></a>
				<div id="comment-14098" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 11, 2010 8:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Vp1rXl7B8FOM0UW1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14075" title="Go to message">SanderH</a>
							</em>
					</span>
					<p id="comment-body-14098">
					What was the exact syntax you used to extract the compressed 
contents? I've not had the time to work on the restoration script 
supported compressed backups, there's few issues I just need to work out
 the kinks on. <br>
<br>
Regarding individual compressed VMDK, I don't think it makes sense as 
it'll be more complicated for the restoration to extract each VMDK 
versus just extracting 1 file which has the contents of the entire VM. 
In general, you'll want to recover the entire VM including it's 
configuration file and all it's disk and not individual files. <br>
<br>
I've not done extensive testing on larger VMDK files, we personally 
don't use compression when we issue our backups but there have been a 
few in the community that wanted this option. I believe the current 
method of compression is the most efficient but if you have data proving
 other wise, I would love to hear it and could potentially consider it 
in a future release of ghettoVCB<br>
<br>
Thanks for the feedback<br>
<br>
--William<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14112"></a>
				<div id="comment-14112" class="jive-content-comment ">
					<span>
						<span>
							Jan 12, 2010 2:33 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-J6ijLQp4Qex004AK" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14097" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14112">
					hi william,<br>
<br>
here is my log from tonight:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">
2010-01-12 04:30:01 -- info: ============================== ghettoVCB LOG START ==============================

2010-01-12 04:30:01 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294
2010-01-12 04:30:01 -- debug: HOSTNAME: ESXi01-AIC.XXXXXXXXXXXXX.de

2010-01-12 04:30:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/datastore1/testbackup
2010-01-12 04:30:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2
2010-01-12 04:30:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2010-01-12 04:30:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-01-12 04:30:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-01-12 04:30:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-01-12 04:30:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-01-12 04:30:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-01-12 04:30:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-01-12 04:30:01 -- info: CONFIG - LOG_LEVEL = debug
2010-01-12 04:30:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2010-01-12 04:30:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-01-12 04:30:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-01-12 04:30:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-01-12 04:30:03 -- info: Initiate backup for VS01-Versand
2010-01-12 04:30:03 -- info: Creating Snapshot "ghettoVCB-snapshot-2010-01-12" for VS01-Versand
2010-01-12 04:30:03 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2010-01-12" to be created
2010-01-12 04:30:04 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/VS01-Versand/VS01-Versand.vmdk'...
Clon2010-01-12 05:03:58 -- info: Removing snapshot from VS01-Versand ...
Clone: 100% done.           95 bytes)
2010-01-12 04:37:58 -- info: Removing snapshot from VS01-Versand ...
/tmp #
</code></pre><br>
backup faild again at "removing snapshot"<br>
<br>
here are my host-resources:<br>
Dell PowerEdge 1950<br>
CPU: Intel Xeon E5430 @2.66GHz<br>
Ram: 12GB<br>
<br>
I have two VMÂ´s on my ESX.<br>
<br>
the errors i can find in the logs ar:<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[2010-01-12 04:30:08.095 66081B90 info 'Vmsvc'] Failed to consolidate disks in Foundry: Error: (15) The file is already in use
[2010-01-12 04:30:03.826 145C8B90 error 'vm:/vmfs/volumes/4ae6e3da-baeabf38-2950-001ec9b33af1/VS01-Versand/VS01-Versand.vmx'] Invalid transition request
[2010-01-12 04:30:03.827 145C8B90 info 'TaskManager'] Task Completed : haTask-48-vim.VirtualMachine.createSnapshot-7829 Status error
[2010-01-12 04:30:03.869 1464AB90 error 'vm:/vmfs/volumes/4ae6e3da-baeabf38-2950-001ec9b33af1/VS01-Versand/VS01-Versand.vmx'] Invalid transition request
[2010-01-12 04:30:03.869 1464AB90 info 'TaskManager'] Task Completed : haTask-48-vim.VirtualMachine.createSnapshot-7831 Status error
</code></pre><br>
<br>
backup starts at 4:30am and snapshot should be removed 4:37am.<br>
<br>
if you want i can send you the logmessages from backup between start and
 end with email.
					
				</div>
				<a name="comments-14125"></a>
				<div id="comment-14125" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 12, 2010 6:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-231UXP1rLt3mzW7i" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14112" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-14125">
					</p><div class="jive-quote">
The only thing I can think of off the top of my head is that you're 
potentially overloading your ESXi host? How are the physical resources 
(cpu/memory) on the ESXi host? Do you see any spikes in performance 
during the backup window that may cause the snapshots to fail to commit?<br>
</div>
<br>
Please verify that your host is not under constraint and take a look at 
your performance charts during the period of backup<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14115"></a>
				<div id="comment-14115" class="jive-content-comment ">
					<span>
						<span>
							Jan 12, 2010 10:30 AM
						</span>
							<!--<a href="/people/bando" title="Click to view bando's profile">
<img class="jive-avatar" src="/people/bando/avatar/16.png?a=-1" height="16" width="16" title="Click to view bando's profile" alt="Click to view bando's profile" />
</a>--><a href="http://communities.vmware.com/people/bando" 
id="jive-96fM10glMgNI7dqu" class="jive-username-link" title="Click to 
view bando's profile">bando</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14125" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14115">
					I've downloaded and tested the latest version of ghettoVCB.sh 
(11/14/2009)... and it works very well as long as the NFS configuration 
is set within the program; not the configuration file. It seems that the
 NFS data (i.e.:<br>
  ENABLE_NON_PERSISTENT_NFS=1<br>
  UNMOUNT_NFS=1<br>
  NFS_SERVER=192.168.100.125<br>
  NFS_MOUNT=/a0/nsnbc/vm_backup<br>
  NFS_LOCAL_NAME=nfsbackup<br>
  NFS_VM_BACKUP_DIR=CYLI6S30<br>
  VMDK_FILES_TO_BACKUP="all"        )<br>
does not get set to overlay the defaults. Is there something I am 
missing here? I execute the script as follows:<br>
<br>
./ghettoVCB.sh -f vms_to_backup -c vm_backup_configs -d dryrun<br>
<br>
The and the default NFS configs do not get passed thru to the script, 
but other configuration does. Is there an updated version to the script 
where the NFS does update? I have started to update this current script,
 but if  <br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-14091"></a>
				<div id="comment-14091" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 12, 2010 12:30 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1sy1Fu856FKj6eL7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14115" title="Go to message">bando</a>
							</em>
					</span>
					<p id="comment-body-14091">
					That is correct, non-persistent NFS configurations is not a 
configurable item in the VM Backup Configs, as they primarily pertain to
 how the VM should be backed up. <br>
<br>
<b>VMDK_FILES_TO_BACKUP</b> should be something you can define on a per 
VM basis. Remember that each VM must have it's own config and if any of 
these values are not defined in the config, a default will be used. <br>
<br>
FYI - The latest version will always be up on the download page and if 
you want to check out the changes from release to release, that 
information is found in the change log. There's reason why I spend the 
time documenting everything, though not all users hit the documentation 
first <img class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" 
border="0"><br>
<br>
Thanks <br>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14116"></a>
				<div id="comment-14116" class="jive-content-comment ">
					<span>
						<span>
							Jan 12, 2010 4:40 PM
						</span>
							<!--<a href="/people/bando" title="Click to view bando's profile">
<img class="jive-avatar" src="/people/bando/avatar/16.png?a=-1" height="16" width="16" title="Click to view bando's profile" alt="Click to view bando's profile" />
</a>--><a href="http://communities.vmware.com/people/bando" 
id="jive-4492PcwyQwaID6c2" class="jive-username-link" title="Click to 
view bando's profile">bando</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14091" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14116">
					Thank you William. Though I may have several NFS data backup sites,
 I'll just control the NFS mounts from the programs and the VM client 
configuration from the configuration files. It works fine now.
					</p>
				</div>
				<a name="comments-14132"></a>
				<div id="comment-14132" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 12, 2010 7:29 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-o2srNr31wRb83zw7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14116" title="Go to message">bando</a>
							</em>
					</span>
					<p id="comment-body-14132">
					One option is to just mount your NFS datastores (persistent) and 
specify in the VM Configuration file to the datastore in which they 
should be backed up in.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14156"></a>
				<div id="comment-14156" class="jive-content-comment ">
					<span>
						<span>
							Jan 18, 2010 1:47 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-Fv4YwOQs515G3NRz" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14125" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14156">
					hi william,<br>
<br>
her is a screenshot from performance during backup.<br>
backup starts at 10:02am.<br>
<br>
<a target="_blank" title="ImageShack - Image And Video Hosting" 
href="http://img46.imageshack.us/i/backup1.jpg/"><img 
src="DOC-8760_files/backup1.jpg" border="0"></a><br>
<br>
her the log:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">2010-01-18 09:02:01 -- info: ============================== ghettoVCB LOG START ==============================

2010-01-18 09:02:01 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294
2010-01-18 09:02:01 -- debug: HOSTNAME: ESXi01-AIC.XXXXXXXXXXXX.de

2010-01-18 09:02:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/datastore1/testbackup
2010-01-18 09:02:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2
2010-01-18 09:02:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2010-01-18 09:02:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-01-18 09:02:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-01-18 09:02:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-01-18 09:02:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-01-18 09:02:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-01-18 09:02:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-01-18 09:02:01 -- info: CONFIG - LOG_LEVEL = debug
2010-01-18 09:02:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2010-01-18 09:02:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-01-18 09:02:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-01-18 09:02:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-01-18 09:02:03 -- info: Initiate backup for VS01-Versand
2010-01-18 09:02:03 -- info: Creating Snapshot "ghettoVCB-snapshot-2010-01-18" for VS01-Versand
2010-01-18 09:02:04 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2010-01-18" to be created
2010-01-18 09:02:04 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS zeroedthick
Cloning disk '/vmfs/volumes/datastore1/VS01-Versand/VS01-Versand.vmdk'...

Clone: 0% done.
Clone: 1% done.
Clone: 2% done.
Clon2010-01-18 09:36:02 -- info: Removing snapshot from VS01-Versand ...

Clone: 8% done.
Clone: 9% done.

Clone: 100% done.
2010-01-18 09:10:16 -- info: Removing snapshot from VS01-Versand ...
</code></pre>
					
				</div>
				<a name="comments-14157"></a>
				<div id="comment-14157" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 18, 2010 1:01 PM
						</span>
							<!--<a href="/people/sant0sk1" title="Click to view sant0sk1's profile">
<img class="jive-avatar" src="/people/sant0sk1/avatar/16.png?a=-1" height="16" width="16" title="Click to view sant0sk1's profile" alt="Click to view sant0sk1's profile" />
</a>--><a href="http://communities.vmware.com/people/sant0sk1" 
id="jive-4Jejeyp1y3amUKbQ" class="jive-username-link" title="Click to 
view sant0sk1's profile">sant0sk1</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14157">
					Very nice script, thanks!<br>
<br>
One thing I've noticed since updating to the most recent version; the 
Cronjob FAQ no longer works correctly, because the script expects 
explicit arguments with flags. I have a cronjob working that looks like 
this:<br>
<br>
&lt;code&gt;0 16 * * 6 /vmfs/volumes/main/ghettoVCB.sh -f 
/vmfs/volumes/main/backup_list -l /var/log/$(date 
+%y%m%d)-backup.log&lt;/code&gt;<br>
<br>
The script runs successfully with this cronjob defined, but the log file
 looks like every line is written twice. Maybe it is writing both stdout
 and stderr to the log file?<br>
<br>
Anyways, minor inconvenience, but overall great. Thanks again!<br>
<br>
EDIT: How do you post formatted code to these forums?
					</p>
				</div>
				<a name="comments-14141"></a>
				<div id="comment-14141" class="jive-content-comment ">
					<span>
						<span>
							Jan 18, 2010 7:42 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-RpG9wAIrtosmqTL9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14156" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-14141">
					Yea I'm not sure ... it's odd that every time the script is called 
automatically the time that it takes to create a snapshot is pretty long
 but from what I remember if you do it via manually, it's pretty quick. 
The other question would be is the application/VM doing anything during 
this period that may cause it to have these issues? I would also take a 
look at your graphs on all 4 resources during the backup window. <br>
<br>
Another thought, have you tried this during a different period of time? 
Does this always consistently happen? This might be a tough one to 
figure based on the information I'm seeing. May need to setup some type 
of troubleshooting session though I'm quite busy this week. If you 
potentially can setup a remote session (WebEx/etc) then you can drive 
and we can do further deep dive but I'm out of ideas other than 
something is going on with your VMs that's environmental versus an issue
 with the script<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14142"></a>
				<div id="comment-14142" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 18, 2010 7:47 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-154K7jR9meW56BXu" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14157" title="Go to message">sant0sk1</a>
							</em>
					</span>
					<p id="comment-body-14142">
					Thanks for the comments.<br>
<br>
The cron FAQ is actually out of date (my fault)...forgot to update this 
section when I rolled out the latest rev of the script. You're correct, 
you need to specify the correct flags as you would if you were to 
manually run it. It's been on my to-do list but been so busy with work 
both day and night <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"> .... I'll eventually 
get to it.<br>
<br>
Regarding writing the lines out twice, this should not be the case. I've
 not seen this issue before but I can look into it when I get some free 
time.<br>
<br>
To use code tags its actually using {code}<br>
<br>
Take a look at this VMTN text markup guide: <a 
class="jive-link-external" 
href="http://communities.vmware.com/markuphelpfull.jspa">http://communities.vmware.com/markuphelpfull.jspa</a><br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14158"></a>
				<div id="comment-14158" class="jive-content-comment ">
					<span>
						<span>
							Jan 19, 2010 1:34 AM
						</span>
							<!--<a href="/people/Wolfi3" title="Click to view Wolfi3's profile">
<img class="jive-avatar" src="/people/Wolfi3/avatar/16.png?a=-1" height="16" width="16" title="Click to view Wolfi3's profile" alt="Click to view Wolfi3's profile" />
</a>--><a href="http://communities.vmware.com/people/Wolfi3" 
id="jive-yTeC62dK1ECUjXwq" class="jive-username-link" title="Click to 
view Wolfi3's profile">Wolfi3</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14142" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14158">
					Hi<br>
<br>
Not sure if i am doing something wrong?<br>
<br>
Getting the following output.<br>
<br>
/vmfs/volumes/4b4f58b6-4836d164-7575-f4ce46ae9e83/Backups # 
./ghettoVCB.sh -f vmlist<br>
###############################################################################<br>
#<br>
</p><ol>
<li>ghettoVCB for ESX/ESXi 3.5 &amp; 4.x+</li>
<li>Author: William Lam</li>
<li><a class="jive-link-external" 
href="http://www.engineering.ucsb.edu/%7Eduonglt/vmware/">http://www.engineering.ucsb.edu/~duonglt/vmware/</a></li>
<li>Created: 11/17/2008</li>
<li>Last modified: 11/14/2009</li>
</ol>
#<br>
###############################################################################<br>
<br>
Usage: ./ghettoVCB.sh -f <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_BACKUP_UP_LIST">VM_BACKUP_UP_LIST</a>
 -c <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_CONFIG_DIR">VM_CONFIG_DIR</a>
 -l <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=LOG_FILE">LOG_FILE</a><br>
<br>
OPTIONS:<br>
   -f     List of VMs to backup<br>
   -c     Configuration directory for VM backups<br>
   -l     File to output logging<br>
   -d     Debug level <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=debug"
 title="dryrun">info</a> (default: info)<br>
<br>
(e.g.)<br>
<br>
Backup VMs stored in a list<br>
        ./ghettoVCB.sh -f vms_to_backup<br>
<br>
Backup VMs based on specific configuration located in directory<br>
        ./ghettoVCB.sh -f vms_to_backup -c vm_backup_configs<br>
<br>
Output will log to /tmp/ghettoVCB.log<br>
        ./ghettoVCB.sh -f vms_to_backup -l /tmp/ghettoVCB.log<br>
<br>
Dry run (no backup will take place)<br>
        ./ghettoVCB.sh -f vms_to_backup -d dryrun<br>
<br>
/vmfs/volumes/4b4f58b6-4836d164-7575-f4ce46ae9e83/Backups #<br>
<br>
Forgot to mention trying to run this manually to test.<br>
Then i will add it to the cron.<br>
Running ESXi 4.0 21xxx<br>
Licensed with essentials license.<br>
Backing up to a 2nd sata hard drive called Datastore2.<br>
vm is running on datastore1.
					
				</div>
				<a name="comments-14160"></a>
				<div id="comment-14160" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 19, 2010 2:06 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-LaFp9KI1ILAsq4IU" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14141" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14160">
					as for as i know, there is no job running on vm during backup. i 
tested backup at different times (4:00am, 10:00am, 3:00am). allways the 
same result.<br>
<br>
i will test this week with the other vm. an i will test shutdown vm 
before backup... itÂ´s no problem to shut down the second vm.<br>
<br>
i also noticed, when i creat snapshot manuall in vmsphere and delet all 
snapshots after creation, it takes 2 or 3 minutes for dleteing the 
snapshot.<br>
deleting the snapshots from second vm takes only 10 seconds...<br>
<br>
i have never setup a remote session on esx
					</p>
				</div>
				<a name="comments-14124"></a>
				<div id="comment-14124" class="jive-content-comment ">
					<span>
						<span>
							Jan 19, 2010 6:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-iQrabNQg6Up3GRT9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14160" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-14124">
					When I said remote troubleshooting session, I meant you would share
 out your desktop via WebEx/etc. and I would be able to view what you're
 seeing and walk you through some troubleshooting steps and looking at 
logs/etc. Again, this is something I would not be able to do until next 
week at the earliest. Again, I'm not sure why you're seeing this issue. I
 would have to believe it's something environmental. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14171"></a>
				<div id="comment-14171" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 19, 2010 7:00 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-oX5RS1Nx8y72f1Xw" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14158" title="Go to message">Wolfi3</a>
							</em>
					</span>
					<p id="comment-body-14171">
					You should definitely see some output, can you past the contents of
 your <b>vmlist</b> and also run it using <b>-d</b> which is debug mode.
 Please wrap all your output using {code} tags for readability <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14188"></a>
				<div id="comment-14188" class="jive-content-comment ">
					<span>
						<span>
							Jan 21, 2010 7:00 AM
						</span>
							<!--<a href="/people/Wolfi3" title="Click to view Wolfi3's profile">
<img class="jive-avatar" src="/people/Wolfi3/avatar/16.png?a=-1" height="16" width="16" title="Click to view Wolfi3's profile" alt="Click to view Wolfi3's profile" />
</a>--><a href="http://communities.vmware.com/people/Wolfi3" 
id="jive-s1Rb89qEM8sQ7Yhl" class="jive-username-link" title="Click to 
view Wolfi3's profile">Wolfi3</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14171" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14188">
					Hi<br>
<br>
vmlist just has one server in it called londsbs01.<br>
<br>
{/vmfs/volumes/4b4f58b6-4836d164-7575-f4ce46ae9e83/Backups # ls<br>
ghettoVCB.sh  vmlist<br>
/vmfs/volumes/4b4f58b6-4836d164-7575-f4ce46ae9e83/Backups # 
./ghettoVCB.sh -f vmlist -d<br>
###############################################################################<br>
#<br>
</p><ol>
<li>ghettoVCB for ESX/ESXi 3.5 &amp; 4.x+</li>
<li>Author: William Lam</li>
<li><a class="jive-link-external" 
href="http://www.engineering.ucsb.edu/%7Eduonglt/vmware/">http://www.engineering.ucsb.edu/~duonglt/vmware/</a></li>
<li>Created: 11/17/2008</li>
<li>Last modified: 11/14/2009</li>
</ol>
#<br>
###############################################################################<br>
<br>
Usage: ./ghettoVCB.sh -f <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_BACKUP_UP_LIST">VM_BACKUP_UP_LIST</a>
 -c <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_CONFIG_DIR">VM_CONFIG_DIR</a>
 -l <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=LOG_FILE">LOG_FILE</a><br>
<br>
OPTIONS:<br>
   -f     List of VMs to backup<br>
   -c     Configuration directory for VM backups<br>
   -l     File to output logging<br>
   -d     Debug level <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=debug"
 title="dryrun">info</a> (default: info)<br>
<br>
(e.g.)<br>
<br>
Backup VMs stored in a list<br>
        ./ghettoVCB.sh -f vms_to_backup<br>
<br>
Backup VMs based on specific configuration located in directory<br>
        ./ghettoVCB.sh -f vms_to_backup -c vm_backup_configs<br>
<br>
Output will log to /tmp/ghettoVCB.log<br>
        ./ghettoVCB.sh -f vms_to_backup -l /tmp/ghettoVCB.log<br>
<br>
Dry run (no backup will take place)<br>
        ./ghettoVCB.sh -f vms_to_backup -d dryrun<br>
<br>
/vmfs/volumes/4b4f58b6-4836d164-7575-f4ce46ae9e83/Backups #<br>
}
					
				</div>
				<a name="comments-14202"></a>
				<div id="comment-14202" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 22, 2010 10:02 AM
						</span>
							<!--<a href="/people/angelone" title="Click to view angelone's profile">
<img class="jive-avatar" src="/people/angelone/avatar/16.png?a=-1" height="16" width="16" title="Click to view angelone's profile" alt="Click to view angelone's profile" />
</a>--><a href="http://communities.vmware.com/people/angelone" 
id="jive-39wm99bu4EBEcITN" class="jive-username-link" title="Click to 
view angelone's profile">angelone</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14202">
					Hi willian, Hi all,<br>
I just found out, that I have the same problem as bonibaz.<br>
<br>
The backup runs fine, all vmdk are cloned and then the script stops 
after removing the snapshot.<br>
This is a big problem since that is the time when the old backup should 
be deleted.<br>
So my NAS is filling up with old backups.<br>
</p><p>
2010-01-21 06:40:23 -- info: Removing snapshot from stoaut01 ...<br>
2010-01-22 00:00:01 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-01-22 00:00:02 -- info: CONFIG - USING CONFIGURATION FILE = 
/vmfs/volumes/nas51_backup/gconf//svaut01<br>
2010-01-22 00:00:02 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/nas51_backup/sicherung<br>
2010-01-22 00:00:02 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-01-22 00:00:02 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-01-22 00:00:02 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-01-22 00:00:02 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-01-22 00:00:02 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-01-22 00:00:02 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4<br>
2010-01-22 00:00:02 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-01-22 00:00:02 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-01-22 00:00:02 -- info: CONFIG - LOG_LEVEL = info<br>
2010-01-22 00:00:02 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/tmp/ghettolog.log<br>
2010-01-22 00:00:02 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-01-22 00:00:02 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-01-22 00:00:02 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-01-22 00:00:04 -- info: Initiate backup for svaut01<br>
2010-01-22 00:00:04 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-22" for svaut01<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore1/svaut01/svaut01_1.vmdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore1/svaut01/svaut01.vmdk'...<br>
Clone: 100% done.<br>
2010-01-22 02:15:48 -- info: Removing snapshot from svaut01 ...<br>
2010-01-22 02:17:08 -- info: Backup Duration: 137.07 Minutes<br>
2010-01-22 02:17:08 -- info: Successfully completed backup for svaut01!<br>
<br>
2010-01-22 02:17:08 -- info: CONFIG - USING CONFIGURATION FILE = 
/vmfs/volumes/nas51_backup/gconf//stoaut01<br>
2010-01-22 02:17:08 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/nas51_backup/sicherung<br>
2010-01-22 02:17:08 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-01-22 02:17:08 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-01-22 02:17:08 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-01-22 02:17:09 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-01-22 02:17:09 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-01-22 02:17:09 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4<br>
2010-01-22 02:17:09 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-01-22 02:17:09 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-01-22 02:17:09 -- info: CONFIG - LOG_LEVEL = info<br>
2010-01-22 02:17:09 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/tmp/ghettolog.log<br>
2010-01-22 02:17:09 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-01-22 02:17:09 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-01-22 02:17:09 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-01-22 02:17:10 -- info: Initiate backup for stoaut01<br>
2010-01-22 02:17:10 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-22" for stoaut01<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore1/stoaut01/stoaut01_1.vmdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore1/stoaut01/stoaut01.vmdk'...<br>
Clone: 100% done.<br>
2010-01-22 05:25:46 -- info: Removing snapshot from stoaut01 ...<br>
~ #<br>
<br>
I have that problem on 2 out of 3 ESXi 4.0
					</p>
				</div>
				<a name="comments-14230"></a>
				<div id="comment-14230" class="jive-content-comment ">
					<span>
						<span>
							Jan 22, 2010 7:06 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-R6kxx2iW0LPGH1PV" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14202" title="Go to message">angelone</a>
							</em>
					</span>
					<p id="comment-body-14230">
					This is the first I've heard of another case. Please provide a 
debug one and just attached as text file to make it easier to read. Also
 can you provide the build #'s of the 3 ESXi 4.0 hosts? Is there 
something different between the 2 that have issues and the one that does
 not? Does this occur if you try to backup to a local datastore that's 
NOT NFS?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14245"></a>
				<div id="comment-14245" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 23, 2010 7:17 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-h7Xi2bAgJEGfv5zP" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14230" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14245">
					Hello<br>
<br>
I assume from my reading above this will work with a ESXI 3.5u4 host 
with a free license?  <br>
<br>
Will ghettoVCB.sh successfully back and restore my 2 VMs?  ( MS Server 
2008  with SQL 2005) and (MS Server 2003 with Altiris).  I know...small 
potatoes compared to many of you.  <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
This VM newbie would truly appreciate any advice you can throw my way.  <br>
<br>
Thanks!
					</p>
				</div>
				<a name="comments-14246"></a>
				<div id="comment-14246" class="jive-content-comment ">
					<span>
						<span>
							Jan 24, 2010 11:26 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-QHQ1eP8xT3uq3wXR" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14245" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14246">
					Yes to ESXi 3.5u4<br>
Yes to backup<br>
No to restore (there is another script you an utilize if you so choose 
in the documentation)<br>
<br>
Again, all this is documented from above, please spend some time 
thoroughly going through the documentation as it'll answer all your 
questions<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14269"></a>
				<div id="comment-14269" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 26, 2010 3:19 AM
						</span>
							<!--<a href="/people/unixhaj" title="Click to view unixhaj's profile">
<img class="jive-avatar" src="/people/unixhaj/avatar/16.png?a=-1" height="16" width="16" title="Click to view unixhaj's profile" alt="Click to view unixhaj's profile" />
</a>--><a href="http://communities.vmware.com/people/unixhaj" 
id="jive-4YEMIHh3UABq6Bg7" class="jive-username-link" title="Click to 
view unixhaj's profile">unixhaj</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14269">
					Was the Syntax Error on line 735 ever solved?
					</p>
				</div>
				<a name="comments-14250"></a>
				<div id="comment-14250" class="jive-content-comment ">
					<span>
						<span>
							Jan 26, 2010 6:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MK5HgMCSXE4a01Lu" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14269" title="Go to message">unixhaj</a>
							</em>
					</span>
					<p id="comment-body-14250">
					Could you jog my memory on what the issue was? I would say easiest 
way is to download the latest version and see if you still run into this
 "syntax error" and let me know what you see.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14235"></a>
				<div id="comment-14235" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 26, 2010 7:08 AM
						</span>
							<!--<a href="/people/unixhaj" title="Click to view unixhaj's profile">
<img class="jive-avatar" src="/people/unixhaj/avatar/16.png?a=-1" height="16" width="16" title="Click to view unixhaj's profile" alt="Click to view unixhaj's profile" />
</a>--><a href="http://communities.vmware.com/people/unixhaj" 
id="jive-NC1j1rUPFvf2xubM" class="jive-username-link" title="Click to 
view unixhaj's profile">unixhaj</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14235">
					Sure,<br>
<br>
</p><hr>
Destination disk format: sparse with 2GB maximum extent size<br>
Cloning disk '/vmfs/volumes/SATA1/server01/server01.vmdk'...<br>
Clone: 100% done.<br>
2010-01-26 12:55:42 -- info: Removing snapshot from server01 ...<br>
sh: /vmfs/volumes/backup-nfs//server01/server01-2010-01-25: bad number<br>
ghettoVCB.sh: line 735: syntax error: 
/vmfs/volumes/backup-nfs//server01/server01-2010-01-25+1<br>
<hr>
<br>
output of uname -a:<br>
VMkernel wmware02 4.0.0 #1 SMP Release build-171294 Jun 11 2009 12:44:08
 x86_64 unknown
					
				</div>
				<a name="comments-14305"></a>
				<div id="comment-14305" class="jive-content-comment ">
					<span>
						<span>
							Jan 28, 2010 12:44 PM
						</span>
							<!--<a href="/people/ScatterBrain" title="Click to view ScatterBrain's profile">
<img class="jive-avatar" src="/people/ScatterBrain/avatar/16.png?a=2167" height="16" width="16" title="Click to view ScatterBrain's profile" alt="Click to view ScatterBrain's profile" />
</a>--><a href="http://communities.vmware.com/people/ScatterBrain" 
id="jive-fxWgI0z5jKpEs5qf" class="jive-username-link" title="Click to 
view ScatterBrain's profile">ScatterBrain</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14235" title="Go to message">unixhaj</a>
							</em>
					</span>
					<p id="comment-body-14305">
					I'm having the same "Bad Number" problem.  Here's a snapshot the 
script running:<br>
<br>
</p><hr>
Logging output to "/tmp/vmback.log" ...<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Mail Server/Mail Server.vmdk'...<br>
Clone: 100% done.<br>
sh: /vmfs/volumes/Backups/Mail Server/Mail Server-2010-01-22: bad number<br>
./ghettoVCB.sh: line 735: syntax error: /vmfs/volumes/Backups/Mail 
Server/Mail Server-2010-01-22+1<br>
<br>
/vmfs/volumes/4b56de2d-e839ce49-7300-0024e86a3a66/scripts # uname -a<br>
VMkernel diamond.nei.local 4.0.0 #1 SMP Release build-208167 Nov  8 2009
 01:02:11 x86_64 unknown<br>
<hr>
<p>
<br>
Kevin L. Collins, MCSE<br>
Systems Manager<br>
Nesbitt Engineering, Inc.
					</p>
				</div>
				<a name="comments-14306"></a>
				<div id="comment-14306" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 28, 2010 6:49 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-2YmF8ShHcykSrK4W" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14305" title="Go to message">ScatterBrain</a>
							</em>
					</span>
					<p id="comment-body-14306">
					Hello<br>
<br>
Has anyone that is using these script to backup and restore applied 
Upgrade 5 to ESXI 3.5?  Or is this not an issue I need to be concerned 
about?  <br>
<br>
Thank you
					</p>
				</div>
				<a name="comments-14281"></a>
				<div id="comment-14281" class="jive-content-comment ">
					<span>
						<span>
							Jan 29, 2010 12:27 AM
						</span>
							<!--<a href="/people/angelone" title="Click to view angelone's profile">
<img class="jive-avatar" src="/people/angelone/avatar/16.png?a=-1" height="16" width="16" title="Click to view angelone's profile" alt="Click to view angelone's profile" />
</a>--><a href="http://communities.vmware.com/people/angelone" 
id="jive-J7T88qHE88ztf6Jz" class="jive-username-link" title="Click to 
view angelone's profile">angelone</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14230" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14281">
					Hi William,<br>
I finally managed to enable debugging on wednesday and got my hands on 
the logs this morning.<br>
As always, when you want to prove something, you can't replicate the 
error <img class="jive-emoticon" src="DOC-8760_files/grin.gif" alt=":D" 
border="0"><br>
My backups ran flawless over the last two days.<br>
<br>
I think the problem isn't the ESXi itself since both ESXi have different
 Patchlevels but behave the same.<br>
The problem is likely to be the NAS.<br>
I noticed timeouts when I deleted the left over backups on wednesday.<br>
Something like<br>
<br>
$ rm -f *<br>
(no response for 2min because of files being deleted)<br>
(some errormessage about input/output errors)<br>
And then the nfs connection broke and the directory wasn't mounted 
anymore.<br>
It then takes 1-2min until nfs works again.<br>
Deleting itself works until the point of the timeout, so you have to try
 5 or 6 times until all files are deleted.<br>
</p><p>
I never noticed that on Sundays when I backup to another NAS.<br>
So I compared both NAS and saw, that the faulty one had support for 
jumbo frames set on.<br>
So I disabled it.<br>
Maybe that was the problem.<br>
<br>
bonibaz: Can you test that on your NAS, too?<br>
Try deleting a big file and see if you run into timeouts, too.<br>
<br>
Btw, I use Thecus N5200 NAS systems with 5 WD disks on RAID10+spare 
each.
					</p>
				</div>
				<a name="comments-14307"></a>
				<div id="comment-14307" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 29, 2010 3:12 AM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-zxT9nBsx68HM0281" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14307">
					hi,<br>
<br>
it looks like, i have the resolution of my problem... <br>
<br>
at beginning i saved the ghettoVCB.sh-script and the vmlist at /backup. <br>
yesterday i shotdown my vmÂ´s and restarted the esxi and i noticed the 
folder /backup was deleted.<br>
is it possible i can not create folders in / ?<br>
so i saved the script and backupfile at /vmfs/volumes/datastore1<br>
i created the cronjob an till now i have no error in deleting snapshot.<br>
<br>
i will monitor the backup the next days... i hope itÂ´s now running.
					</p>
				</div>
				<a name="comments-14295"></a>
				<div id="comment-14295" class="jive-content-comment ">
					<span>
						<span>
							Jan 29, 2010 3:37 AM
						</span>
							<!--<a href="/people/Wolfi3" title="Click to view Wolfi3's profile">
<img class="jive-avatar" src="/people/Wolfi3/avatar/16.png?a=-1" height="16" width="16" title="Click to view Wolfi3's profile" alt="Click to view Wolfi3's profile" />
</a>--><a href="http://communities.vmware.com/people/Wolfi3" 
id="jive-tcX8NQLTguH6O194" class="jive-username-link" title="Click to 
view Wolfi3's profile">Wolfi3</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14250" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14295">
					Hi Could someone please spread some light?<br>
I am still trying to figure out why this is happening?<br>
<br>
{<br>
vmfs/volumes/4b50aab6-e58168b3-4d08-f4ce46ae9e83/Backups # 
./ghettoVCB.sh -f vmlist -d<br>
: not found.sh: line 6:<br>
: not found.sh: line 8:<br>
: not found.sh: line 11:<br>
: not found.sh: line 18:<br>
: not found.sh: line 21:<br>
: not found.sh: line 26:<br>
: not found.sh: line 29:<br>
: not found.sh: line 34:<br>
: not found.sh: line 38:<br>
: not found.sh: line 41:<br>
: not found.sh: line 45:<br>
: not found.sh: line 48:<br>
: not found.sh: line 51:<br>
: not found.sh: line 54:<br>
: not found.sh: line 59:<br>
: not found.sh: line 61:<br>
: not found.sh: line 64:<br>
: not found.sh: line 67:<br>
: not found.sh: line 70:<br>
: not found.sh: line 73:<br>
: not found.sh: line 75:<br>
: not found.sh: line 76:<br>
: not found.sh: line 78:<br>
: not found.sh: line 83:<br>
: not found.sh: line 86:<br>
: not found.sh: line 87:<br>
###############################################################################<br>
#<br>
</p><ol>
<li>ghettoVCB for ESX/ESXi 3.5 &amp; 4.x+</li>
<li>Author: William Lam</li>
<li><a class="jive-link-external" 
href="http://www.engineering.ucsb.edu/%7Eduonglt/vmware/">http://www.engineering.ucsb.edu/~duonglt/vmware/</a></li>
<li>Created: 11/17/2008</li>
<li>Last modified: 11/14/2009</li>
</ol>
#<br>
###############################################################################<br>
: not found.sh: line 98: echo<br>
Usage: ./ghettoVCB.sh -f <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_BACKUP_UP_LIST">VM_BACKUP_UP_LIST</a>
 -c <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_CONFIG_DIR">VM_CONFIG_DIR</a>
 -l <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=LOG_FILE">LOG_FILE</a><br>
: not found.sh: line 100: echo<br>
OPTIONS:<br>
   -f     List of VMs to backup<br>
   -c     Configuration directory for VM backups<br>
   -l     File to output logging<br>
   -d     Debug level <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=debug"
 title="dryrun">info</a> (default: info)<br>
: not found.sh: line 106: echo<br>
(e.g.)<br>
<br>
Backup VMs stored in a list<br>
        ./ghettoVCB.sh -f vms_to_backup<br>
<br>
Backup VMs based on specific configuration located in directory<br>
        ./ghettoVCB.sh -f vms_to_backup -c vm_backup_configs<br>
<br>
Output will log to /tmp/ghettoVCB.log<br>
        ./ghettoVCB.sh -f vms_to_backup -l /tmp/ghettoVCB.log<br>
<br>
Dry run (no backup will take place)<br>
        ./ghettoVCB.sh -f vms_to_backup -d dryrun<br>
: not found.sh: line 116: echo<br>
./ghettoVCB.sh: exit: line 117: Illegal number: 1<br>
/vmfs/volumes/4b50aab6-e58168b3-4d08-f4ce46ae9e83/Backups # ls<br>
ghettoVCB-vm_backup_configuration_template<br>
ghettoVCB.sh<br>
vmlist<br>
/vmfs/volumes/4b50aab6-e58168b3-4d08-f4ce46ae9e83/Backups #<br>
<br>
}
					
				</div>
				<a name="comments-14308"></a>
				<div id="comment-14308" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 29, 2010 4:39 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-1yzAHPrkCGf2vMW8" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14295" title="Go to message">Wolfi3</a>
							</em>
					</span>
					<p id="comment-body-14308">
					@wolfi.<br>
<br>
You did edit the script with a Windows tools which upset EOL characters.<br>
Only edit with Linux tools like vi or WinSCP's built in editor which 
will do the conversation.<br>
<br>
HTH<br>
grubi.
					</p>
				</div>
				<a name="comments-14309"></a>
				<div id="comment-14309" class="jive-content-comment ">
					<span>
						<span>
							Jan 29, 2010 4:48 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-tPAMF33gf8c8UikJ" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14307" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-14309">
					@bonibaz:<br>
<br>
You can create the folder at the root of course but it will dissappear 
after reboot as it is not part of the bootbank. If you want to have 
anything there persistent easiest way is to integrate it into oem.tgz.<br>
<br>
@all:<br>
<br>
I strongly encourage not to use Win2003R2 NFS server for backup. We had 
occasional i/o errors and speed was dissapointing at least. We now 
switched to AllegroNFS and i/o errors are gone, and speed increased 
about factor 8. Now we have a backup performance of 4GB/min which is ok 
for us.<br>
<br>
Regards,<br>
grubi.
					</p>
				</div>
				<a name="comments-14310"></a>
				<div id="comment-14310" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 29, 2010 6:02 AM
						</span>
							<!--<a href="/people/ScatterBrain" title="Click to view ScatterBrain's profile">
<img class="jive-avatar" src="/people/ScatterBrain/avatar/16.png?a=2167" height="16" width="16" title="Click to view ScatterBrain's profile" alt="Click to view ScatterBrain's profile" />
</a>--><a href="http://communities.vmware.com/people/ScatterBrain" 
id="jive-I0s1rL8bCwzDpJGp" class="jive-username-link" title="Click to 
view ScatterBrain's profile">ScatterBrain</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14309" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14310">
					Now I have another concern.  Yesterday I configured my ESXi box to 
run ghettoVCB in a cron job.  As far as I can tell that all worked fine.
  I have a copy of the virtual machine, I have logs that said what 
ghettoVCB did, etc.<br>
<br>
But I when I looked at the backup server's free disk space, I was amazed
 to find that the free space only dropped by 7GB instead of the 50GB 
that the virtual machine uses.  Here are a couple of commands that I ran
 on the backup machine:<br>
===========================================<br>
root@beige:~# df -h<br>
Filesystem            Size  Used Avail Use% Mounted on<br>
{SNIP}<br>
/dev/sda6             294G   33G  261G  12% /var/vm-back<br>
===========================================<br>
<br>
===========================================<br>
root@beige:/var/vm-back/Mail Server/Mail Server-2010-01-29# ls -lah<br>
total 7.0G<br>
drwxr-xr-x 2 root root   79 2010-01-28 19:01 .<br>
drwxr-xr-x 5 root root   93 2010-01-28 19:01 ..<br>
-rw------- 1 root root  50G 2010-01-28 19:04 Mail Server-flat.vmdk<br>
-rw------- 1 root root  500 2010-01-28 19:04 Mail Server.vmdk<br>
-rwxr-xr-x 1 root root 3.0K 2010-01-28 19:01 Mail Server.vmx<br>
===========================================<br>
<br>
===========================================<br>
root@beige:/var/vm-back/Mail Server/Mail Server-2010-01-29# du -h .<br>
7.0G    .<br>
===========================================<br>
<br>
The virtual machine's vitrual hard disk is 50GB - that's the size I told
 ESXi to make it.  It appears as though 'ls' shows that.  But 'du' only 
reports 7GB in actual use.  In addition 'df' is only showing 33GB in use
 instead of 76GB as it should be.<br>
<br>
I've not tried to restore this virtual machine yet, but I'm concerned 
that there may be some file truncation happening and the restore simply 
will not be successful.<br>
<br>
Has anyone else seen this type of behavior before?<br>
<br>
For what it's worth:  The backup machine is running Ubuntu 6.06 and NFS 
which is exporting the /var/vm-back directory.  I've attached this NFS 
share to the ESXi box as datastore "Backups".  According to the logs, 
the backup went through without incident and took nearly three minutes 
to complete.<br>
<br>
Here's the ghettoVCB log file:<br>
<br>
===========================================<br>
2010-01-29 00:00:01 -- info: ============================== ghettoVCB 
LOG START<br>
<br>
2010-01-29 00:00:01 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/Backups<br>
2010-01-29 00:00:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-01-29 00:00:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-01-29 00:00:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-01-29 00:00:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-01-29 00:00:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-01-29 00:00:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-01-29 00:00:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-01-29 00:00:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-01-29 00:00:01 -- info: CONFIG - LOG_LEVEL = info<br>
2010-01-29 00:00:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/tmp/vmback.log<br>
2010-01-29 00:00:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-01-29 00:00:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-01-29 00:00:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-01-29 00:00:03 -- info: Initiate backup for Mail Server<br>
2010-01-29 00:00:03 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-29" for Mail Server<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Mail Server/Mail Server.vmdk'...<br>
^MClone: 0% done.^MClone: 1% done.^MClone: 2% done.^MClone: 3% 
done.^MClone: 4% {SNIP...This goes all the way to 100%}<br>
2010-01-29 00:02:49 -- info: Removing snapshot from Mail Server ...<br>
===========================================<br>
<br>
I'm going to try to restore the virtual machine later this morning, but 
I'd really like to hear why my backup machine thinks a 50GB virtual 
machine is only occupying 7GB of space.<br>
</p><p>
Kevin L. Collins, MCSE<br>
Systems Manager<br>
Nesbitt Engineering, Inc.
					</p>
				</div>
				<a name="comments-14311"></a>
				<div id="comment-14311" class="jive-content-comment ">
					<span>
						<span>
							Jan 29, 2010 6:11 AM
						</span>
							<!--<a href="/people/Wolfi3" title="Click to view Wolfi3's profile">
<img class="jive-avatar" src="/people/Wolfi3/avatar/16.png?a=-1" height="16" width="16" title="Click to view Wolfi3's profile" alt="Click to view Wolfi3's profile" />
</a>--><a href="http://communities.vmware.com/people/Wolfi3" 
id="jive-3cW4ETvGqq0fwiXe" class="jive-username-link" title="Click to 
view Wolfi3's profile">Wolfi3</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14308" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14311">
					@goppi<br>
<br>
Thanks for the reply.<br>
I did edit the file with notepad.<br>
<br>
So i connected to another machine.<br>
Downloaded the file's to this machine (Win 2003 SP2)<br>
Then uploaded the file's without editing them.<br>
<br>
But still get the same output in my previous post.<br>
<br>
Is there another method i need to download the file?<br>
Maybe to a linux machine and not a windows one?
					</p>
				</div>
				<a name="comments-14297"></a>
				<div id="comment-14297" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 29, 2010 6:52 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-bu2V99Jt9KghJupR" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14281" title="Go to message">angelone</a>
							</em>
					</span>
					<p id="comment-body-14297">
					Thanks for your investigation and comments. In the back of my mind,
 this was what I was thinking but could not confirm. I know users with 
issues with their NFS may see a whole variety of problems pertaining to 
snapshots or rotation of the directories. If this is in fact the case, 
looks like I need to create a new FAQ<br>
<br>
Thanks and let me know you if you run into the issue again <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14283"></a>
				<div id="comment-14283" class="jive-content-comment ">
					<span>
						<span>
							Jan 29, 2010 8:06 AM
						</span>
							<!--<a href="/people/biekee" title="Click to view biekee's profile">
<img class="jive-avatar" src="/people/biekee/avatar/16.png?a=-1" height="16" width="16" title="Click to view biekee's profile" alt="Click to view biekee's profile" />
</a>--><a href="http://communities.vmware.com/people/biekee" 
id="jive-54668MhHtcoksBrl" class="jive-username-link" title="Click to 
view biekee's profile">biekee</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14297" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14283">
					Hi, I agree with Wolfi 3,<br>
<br>
I have the same errors:<br>
: command not founde 6:<br>
: command not founde 8:<br>
: command not founde 11:<br>
: command not founde 18:<br>
: command not founde 21:<br>
: command not founde 26:<br>
: command not founde 29:<br>
: command not founde 34:<br>
: command not founde 38:<br>
: command not founde 41:<br>
: command not founde 45:<br>
: command not founde 48:<br>
: command not founde 51:<br>
: command not founde 54:<br>
: command not founde 59:<br>
: command not founde 61:<br>
: command not founde 64:<br>
: command not founde 67:<br>
: command not founde 70:<br>
: command not founde 73:<br>
: command not founde 75:<br>
: command not founde 76:<br>
: command not founde 78:<br>
: command not founde 83:<br>
: command not founde 86:<br>
: command not founde 87:<br>
'/ghettoVCB.sh: line 88: syntax error near unexpected token `{<br>
'/ghettoVCB.sh: line 88: `printUsage() {<br>
<br>
I manually removed the blank lines with vi (haven't edited anything with
 Windows tools) and then I end up with only the last two errors.<br>
<br>
What seppenin'?<br>
<br>
BK
					</p>
				</div>
				<a name="comments-14337"></a>
				<div id="comment-14337" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jan 31, 2010 9:47 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-bK85FF0L8oX8q87u" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14297" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14337">
					lamw<br>
<br>
Thank you for this great backup option.  I gave it a first trial run 
this weekend and it appeared to work just as advertised.  <br>
<br>
Has this script and process been tested on ESXI 3.5 Update 5?
					</p>
				</div>
				<a name="comments-14322"></a>
				<div id="comment-14322" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 5:05 AM
						</span>
							<!--<a href="/people/unixhaj" title="Click to view unixhaj's profile">
<img class="jive-avatar" src="/people/unixhaj/avatar/16.png?a=-1" height="16" width="16" title="Click to view unixhaj's profile" alt="Click to view unixhaj's profile" />
</a>--><a href="http://communities.vmware.com/people/unixhaj" 
id="jive-v3ImR6GEu6wScr88" class="jive-username-link" title="Click to 
view unixhaj's profile">unixhaj</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14322">
					In response to FAQ 18,<br>
<br>
I place my backups on a Linux-based NFS-server, and I just tested 
deleting the oldest backup that ghettoVCB.sh can't delete from my ESXi 
4... It deletes fine with rm -rf * so I can't really se what would be 
the problem with the NFS-server..<br>
<br>
Anyone else use a Linux-based NFS-server for the backups?
					</p>
				</div>
				<a name="comments-14323"></a>
				<div id="comment-14323" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2010 7:01 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-C6FXFe27L7WkW30z" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14337" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14323">
					I've not tested this on ESXi 3.5u5, but it should work without any 
problems. Nothing has drastically changed between u4 and u5 but please 
let me know through your testing if you do run into any issues. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14324"></a>
				<div id="comment-14324" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 7:04 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-vyStyTdY1NMkL817" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14322" title="Go to message">unixhaj</a>
							</em>
					</span>
					<p id="comment-body-14324">
					Majority of the users if not all that run into this problem is with
 an NFS server, probably the easiest way if you have spare capacity 
located on <b>local</b> vmfs volumes is to do a backup with a <u>set</u>
 of VMs and see if you still run into this problem. This would hopefully
 rule out the NFS server<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14338"></a>
				<div id="comment-14338" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2010 7:45 AM
						</span>
							<!--<a href="/people/AGS Paul" title="Click to view AGS Paul's profile">
<img class="jive-avatar" src="/people/AGS Paul/avatar/16.png?a=-1" height="16" width="16" title="Click to view AGS Paul's profile" alt="Click to view AGS Paul's profile" />
</a>--><a href="http://communities.vmware.com/people/AGS%20Paul" 
id="jive-c1s7LpEl3391tt31" class="jive-username-link" title="Click to 
view AGS Paul's profile">AGS Paul</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14338">
					I have the ghettoVCB script running fine on my VM ESXi 4 servers.  
It's running the backup ans dumping the files to a NFS share on a 
windows server 2003 box.  However when the script writes the backup 
files to the NFS share the folders/files become read only.  So when the 
script runs a second time its fine but on the third time when its 
supposed to delete the snapshot and folder in the NFS share its not 
doing so because the permissions on the files are read only.  I checked 
the NFS and NTFS permisstions and they seem to be ok.<br>
<br>
Any ideas?
					</p>
				</div>
				<a name="comments-14353"></a>
				<div id="comment-14353" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 8:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-nJYbbYloBXDSFI7j" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14338" title="Go to message">AGS
 Paul</a>
							</em>
					</span>
					<p id="comment-body-14353">
					Can you check to see if the initial backup the folders are set to 
RO after the backup has completed? Is this Windows changing the 
permissions? I don't believe ESX would do so, but you can verify after 
the first run and if that is the case, you may need to ensure 
permissions is set properly ... or if Windows is automatically doing it,
 you'll need to investigate why as this will be a problem. Don't you 
just love windows <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14341"></a>
				<div id="comment-14341" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2010 10:48 AM
						</span>
							<!--<a href="/people/mhanby" title="Click to view mhanby's profile">
<img class="jive-avatar" src="/people/mhanby/avatar/16.png?a=-1" height="16" width="16" title="Click to view mhanby's profile" alt="Click to view mhanby's profile" />
</a>--><a href="http://communities.vmware.com/people/mhanby" 
id="jive-GXPTo1EDthqd6SVi" class="jive-username-link" title="Click to 
view mhanby's profile">mhanby</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14341">
					I have two ESXi 4 hosts managed by a vSphere Essentials server. 
Before adding these to vSpere, I was able to run ghettoVCB.sh, now when I
 run it the script fails immediately:<br>
<br>
</p><ol>
<li>./ghettoVCB.sh -f guests-to-backup.txt </li>
</ol>
2010-02-01 18:22:22 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-02-01 18:22:22 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/BACKUP<br>
2010-02-01 18:22:22 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-02-01 18:22:22 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-02-01 18:22:22 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-02-01 18:22:22 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-02-01 18:22:22 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-02-01 18:22:22 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-02-01 18:22:22 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-02-01 18:22:22 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-02-01 18:22:22 -- info: CONFIG - LOG_LEVEL = info<br>
2010-02-01 18:22:22 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-02-01 18:22:22 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-02-01 18:22:22 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-02-01 18:22:22 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
Failed to login: vim.fault.NoPermission<br>
2010-02-01 18:22:23 -- info: Error: failed to locate and extract VM_ID 
for server1!<br>
<br>
If I attempt to run the vim-cmd command separately, it produces this:<br>
<ol>
<li>/usr/bin/vim-cmd vmsvc/getallvms </li>
</ol>
Failed to login: vim.fault.NoPermission<br>
<br>
I believe I turned off local administration by 'root' when adding these 
to vCenter. Anyone know how to re-enable local root administration?
					
				</div>
				<a name="comments-14354"></a>
				<div id="comment-14354" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 10:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MRRXa37rAl713z1A" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14341" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-14354">
					Looks like whatever you did, it's revoking the permissions. When 
you say these hosts are being managed by vSphere Essentials? I'm 
assuming you mean they're being manged by vCenter where as before they 
were stand alone hosts? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14342"></a>
				<div id="comment-14342" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2010 11:10 AM
						</span>
							<!--<a href="/people/mhanby" title="Click to view mhanby's profile">
<img class="jive-avatar" src="/people/mhanby/avatar/16.png?a=-1" height="16" width="16" title="Click to view mhanby's profile" alt="Click to view mhanby's profile" />
</a>--><a href="http://communities.vmware.com/people/mhanby" 
id="jive-AlET83H649fxD4q0" class="jive-username-link" title="Click to 
view mhanby's profile">mhanby</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14354" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14342">
					Yes, sorry. The two ESXi servers used to be stand alone and are now
 managed by vCenter Server. I'm still digging through the documentation 
to find out if this setting can be changed, short of removing the ESXi 
host and adding it back.<br>
<br>
Edit:<br>
Ok, found it "Lockdown Mode" 'When enabled, lockdown mode prevents 
remote users from logging into this host using its administrative login 
name (e.g., "admin" or "root").<br>
<br>
This can be enabled / disabled by selecting the host -&gt; Configuration
 -&gt; Security Profile -&gt; Lockdown Mode<br>
<br>
The wording is a bit misleading if you ask me, as it appears to prevent 
any local interaction with the vim-cmd tool as well.<br>
<br>
I disabled the feature and now the command runs successfully.
					</p>
				</div>
				<a name="comments-14343"></a>
				<div id="comment-14343" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 11:29 AM
						</span>
							<!--<a href="/people/mhanby" title="Click to view mhanby's profile">
<img class="jive-avatar" src="/people/mhanby/avatar/16.png?a=-1" height="16" width="16" title="Click to view mhanby's profile" alt="Click to view mhanby's profile" />
</a>--><a href="http://communities.vmware.com/people/mhanby" 
id="jive-h0GH3JcOmJ0Y5Tj0" class="jive-username-link" title="Click to 
view mhanby's profile">mhanby</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14342" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-14343">
					a word of caution to anyone using vCenter, the vCenter server is 
not aware of the "Creating Snapshot" and "Removing Snapshot" steps (at 
least I didn't see those steps display in the vCenter "Recent Tasks" 
pane.<br>
<br>
If I log directly into the ESXi host, the "Recent Tasks" does show the 
snapshot steps.<br>
<br>
I wonder if there is any way from the ESXi host to pass the snapshot 
command to the vCenter server.
					</p>
				</div>
				<a name="comments-14355"></a>
				<div id="comment-14355" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2010 11:37 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Kru7xs1vPitAPtqP" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14342" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-14355">
					Correct, I had a feeling you were referring to vCenter and 
'lockdown' mode, but wanted to be sure. You'll definitely want that off 
if you're going to be using the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14356"></a>
				<div id="comment-14356" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 11:41 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ASJz08yvxQUF87xP" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14343" title="Go to message">mhanby</a>
							</em>
					</span>
					<p id="comment-body-14356">
					All tasks being done are not sent to vCenter, it's directed to an 
individual ESX(i) host. There is no way to get that information up to 
vCenter and it's not part of the use case for this script. <br>
<br>
If you're looking to do something with vCenter being aware of the 
backups/etc. you may want to take a look at <b>ghettoVCBg2</b> but still
 you'll need to modify the script it to go through vCenter versus going 
through each individual hosts, majority of the users don't have vCenter 
or is using the free version of ESXi, so they require going through this
 unsupported setup. <br>
<br>
Hopefully this clears up any confusion you may have<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14344"></a>
				<div id="comment-14344" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 1, 2010 2:58 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-9GqRbOjEv4qaIQwT" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14356" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14344">
					Hello<br>
<br>
I was reviewing the files from my first backup attempt.  The VM I backed
 up was a Server 2008x64 with SQL installed.  It has 3 drives configured
 on it.  <br>
1.	80 GIG Data<br>
2.	40 GIG System<br>
3.	8  GIG Swap<br>
<br>
As I said in my previous post the backup said it completed successfully.
  I stored the files locally in my datastore and the process took around
 73 minutes without compression.<br>
My view from WinSCP shows the following files :<br>
<br>
XXXXX.vmdk               Size                       436<br>
XXXXX. vmx                 Size                   2,767<br>
XXXXX-flat.vmdk        Size 85,899,345,920<br>
<br>
XXXXX_1.vmdk           Size                      436<br>
XXXXX_1-flat.vmdk    Size   8,589,934,592<br>
XXXXX_2.vmdk           Size                      436<br>
XXXXX_2-flat.vmdk    Size 42,949,672,960<br>
<br>
My view from the VMware Infrastructure Client (browsing datastore) shows
 the following :<br>
<br>
XXXXXXXX.vmx           Size                   2.70 KB<br>
XXXXXXX.vmdk          Size 19,189,760.00 KB<br>
XXXXXXX_1.vmdk     Size       237,568.00 KB<br>
XXXXXXX_2.vmdk     Size   4,936,704.00,KB<br>
<br>
Why the difference in files and sizes between the VMware Infrastructure 
Client and WinSCP views ?  Also is it normal for it to create bigger 
backups then the actual disk size ?  ( 80 GG Drive verses   
XXXXX-flat.vmdk        Size 85,899,345,920 )<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-14325"></a>
				<div id="comment-14325" class="jive-content-comment ">
					<span>
						<span>
							Feb 1, 2010 4:30 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-UGb45zq3BOo0t8G8" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14344" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14325">
					Not sure how familiar you are with the files that make up a VM, but
 for each disk in a VM there is a .vmdk (disk descriptor file) and 
-flat.vmdk (disk flat file). The descriptor file is pretty much meta 
data that describes what type VMDK each disk is and has a mappping to 
the actual disk contents which are the *-flat.vmdk files. <br>
<br>
What you see in the datastore broswer is <b>ONLY</b> the descriptor 
file, this was probably done intentionally so users don't accidently 
browse and delete the actual disk file, you can re-generated a 
descriptor file if you've accidently deleted it, it's not the same when 
you delete the actual disk file. That is why you're seeing this 
discrepancy. <br>
<br>
Regarding the size, if you do the math on the the actual 
*-flat.vmdk...you'll find out that's close to your actual disk 
allocation. Remember 1024 = 1MB <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"> and 85,899,345,920 !=
 85GB<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14326"></a>
				<div id="comment-14326" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 2, 2010 12:47 AM
						</span>
							<!--<a href="/people/ggehring" title="Click to view ggehring's profile">
<img class="jive-avatar" src="/people/ggehring/avatar/16.png?a=-1" height="16" width="16" title="Click to view ggehring's profile" alt="Click to view ggehring's profile" />
</a>--><a href="http://communities.vmware.com/people/ggehring" 
id="jive-YU6Hh94adyfMlRTC" class="jive-username-link" title="Click to 
view ggehring's profile">ggehring</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14325" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14326">
					Hi there, great script!<br>
Anyways i encountered a problem with using the script. It runs through a
 list of vm's specified in a file. However a certain VM named 
"Office-01" makes problems. I configured the script to take 3 backups of
 each VM and rotate them. If there are less than 3 backups of the VM 
"Office-01", the script works correctly. It just takes the backup, 
renames it to fit into rotation and continous with the next VM.<br>
But if there are already 3 backups, the script disbehaves somehow. It 
just stops working with the last message beeing <br>
"2010-01-23 00:59:25 -- info: Removing snapshot from Office-01 ..."<br>
There is no error message. It takes the backup of the VM but does not 
rotate anymore. The oldest backup doesnt get deleted and the new backup 
will not be renamed. This leads to my backup space filled up with 
unwanted old backups. Additionally all subsequent VMs listed in my list 
file doesnt get backuped, because the script just stops working, without
 giving some error message.<br>
Would be really nice if someone could give me a hint on how to fix the 
problem!<br>
<br>
I appended a log including configuration parameters (left out some 
"Clone: XX% done." messages). If additional information is needed, just 
let me know!<br>
<br>
2010-01-23 00:05:01 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-01-23 00:05:01 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-171294<br>
2010-01-23 00:05:01 -- debug: HOSTNAME: svr01.localhost<br>
<br>
2010-01-23 00:05:01 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/nas/backups<br>
2010-01-23 00:05:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-01-23 00:05:01 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-01-23 00:05:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-01-23 00:05:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-01-23 00:05:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-01-23 00:05:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-01-23 00:05:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-01-23 00:05:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-01-23 00:05:01 -- info: CONFIG - LOG_LEVEL = debug<br>
2010-01-23 00:05:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/vmfs/volumes/nas/backups/logs/ghettoVCB-backup-1264205101.log<br>
2010-01-23 00:05:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-01-23 00:05:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-01-23 00:05:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-01-23 00:05:06 -- info: Initiate backup for CA<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore2/CA/CA.vmdk'...<br>
<br>
Clone: 0% done.<br>
Clone: 1% done.<br>
Clone: 2% done.<br>
...<br>
Clone: 98% done.<br>
Clone: 99% done.<br>
Clone: 100% done.<br>
2010-01-23 00:11:35 -- info: Backup Duration: 6.48 Minutes<br>
2010-01-23 00:11:35 -- info: Successfully completed backup for CA!<br>
<br>
2010-01-23 00:11:37 -- info: Initiate backup for Dev-01<br>
2010-01-23 00:11:37 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-23" for Dev-01<br>
2010-01-23 00:11:38 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-01-23" to be created<br>
2010-01-23 00:11:38 -- debug: Snapshot timeout set to: 900 seconds<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Dev-01/Dev-01.vmdk'...<br>
<br>
Clone: 0% done.<br>
Clone: 1% done.<br>
Clone: 2% done.<br>
...<br>
Clone: 100% done.<br>
2010-01-23 00:19:57 -- info: Removing snapshot from Dev-01 ...<br>
2010-01-23 00:20:32 -- info: Backup Duration: 8.92 Minutes<br>
2010-01-23 00:20:32 -- info: Successfully completed backup for Dev-01!<br>
<br>
2010-01-23 00:20:33 -- info: Initiate backup for Monitoring<br>
2010-01-23 00:20:33 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-23" for Monitoring<br>
2010-01-23 00:20:34 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-01-23" to be created<br>
2010-01-23 00:20:34 -- debug: Snapshot timeout set to: 900 seconds<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore2/Monitoring/Monitoring.vmdk'...<br>
<br>
Clone: 0% done.<br>
...<br>
Clone: 100% done.<br>
2010-01-23 00:23:30 -- info: Removing snapshot from Monitoring ...<br>
2010-01-23 00:23:49 -- info: Backup Duration: 3.27 Minutes<br>
2010-01-23 00:23:49 -- info: Successfully completed backup for 
Monitoring!<br>
<br>
2010-01-23 00:23:51 -- info: Initiate backup for CRM-01<br>
2010-01-23 00:23:51 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-23" for CRM-01<br>
2010-01-23 00:23:52 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-01-23" to be created<br>
2010-01-23 00:23:52 -- debug: Snapshot timeout set to: 900 seconds<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore2/CRM-01/CRM-01.vmdk'...<br>
<br>
Clone: 0% done.<br>
Clone: 1% done.<br>
...<br>
Clone: 100% done.<br>
2010-01-23 00:28:16 -- info: Removing snapshot from CRM-01 ...<br>
2010-01-23 00:28:36 -- info: Backup Duration: 4.75 Minutes<br>
2010-01-23 00:28:36 -- info: Successfully completed backup for CRM-01!<br>
<br>
2010-01-23 00:28:37 -- info: Initiate backup for Office-01<br>
2010-01-23 00:28:37 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-01-23" for Office-01<br>
2010-01-23 00:28:38 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-01-23" to be created<br>
2010-01-23 00:28:38 -- debug: Snapshot timeout set to: 900 seconds<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Office-01/Office-01.vmdk'...<br>
<br>
Clone: 0% done.<br>
...<br>
Clone: 99% done.<br>
Clone: 100% done.<br>
2010-01-23 00:59:25 -- info: Removing snapshot from Office-01 ...
					</p>
				</div>
				<a name="comments-14327"></a>
				<div id="comment-14327" class="jive-content-comment ">
					<span>
						<span>
							Feb 2, 2010 8:56 AM
						</span>
							<!--<a href="/people/angelone" title="Click to view angelone's profile">
<img class="jive-avatar" src="/people/angelone/avatar/16.png?a=-1" height="16" width="16" title="Click to view angelone's profile" alt="Click to view angelone's profile" />
</a>--><a href="http://communities.vmware.com/people/angelone" 
id="jive-P3y8cw5Ovh8h94ok" class="jive-username-link" title="Click to 
view angelone's profile">angelone</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14326" title="Go to message">ggehring</a>
							</em>
					</span>
					<p id="comment-body-14327">
					hi ggehring,<br>
that's exactly the same problem bonibaz and i have.<br>
<br>
as i pointed out in my last post<br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-14281">http://communities.vmware.com/docs/DOC-8760#comments-14281</a><br>
i think it's related to the nas itself.<br>
<br>
do you get i/o errors when you rm -rf *  the old backups?
					</p>
				</div>
				<a name="comments-14346"></a>
				<div id="comment-14346" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 2, 2010 9:30 AM
						</span>
							<!--<a href="/people/ggehring" title="Click to view ggehring's profile">
<img class="jive-avatar" src="/people/ggehring/avatar/16.png?a=-1" height="16" width="16" title="Click to view ggehring's profile" alt="Click to view ggehring's profile" />
</a>--><a href="http://communities.vmware.com/people/ggehring" 
id="jive-237s6702CdoToHR6" class="jive-username-link" title="Click to 
view ggehring's profile">ggehring</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14327" title="Go to message">angelone</a>
							</em>
					</span>
					<p id="comment-body-14346">
					Hi angelone, thanks for your answer.<br>
<br>
Looks like i have indeed the same problem. I ran a rm -rf * and it 
nearly took 2 minutes with some Input/ouput errors, as you stated. Heres
 the console log:<br>
<br>
/vmfs/volumes/e863fe05-624ba7f8/backups/Office-01 # rm -rf *<br>
rm: cannot remove 'Office-01-2010-02-01/Office-01-flat.vmdk': 
Input/output error<br>
rm: cannot remove 'Office-01-2010-02-01': Input/output error<br>
ash: getcwd: Input/output error<br>
<br>
The content of the backup folder gets deleted, but not the folder 
itself.<br>
Im using a QNAP Turbo NAS TS-419U with 4 Drives and Raidlevel 5.<br>
I mounted the nas as type "NFS" as a datastore using the vSphere Client.<br>
<br>
What would you suggest to solve the problem? I will look if jumbo frames
 are enabled on the nas and how to deactivate them.
					</p>
				</div>
				<a name="comments-14332"></a>
				<div id="comment-14332" class="jive-content-comment ">
					<span>
						<span>
							Feb 3, 2010 7:18 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-2S59gnl1c058Qj6O" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14325" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14332">
					lamw<br>
<br>
Thank you for the guidance above (again <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"> ).  I have searched 
this thread and I apologize in advance if this has been covered but what
 is the recommended DISK_BACKUP_FORMAT ?  I see the default in the 
script is "zeroedthick"  but all the examples above show "thin"  Is 
there a best choice?<br>
<br>
Also tried to backup to my NFS share tonight and got the following 
issues.  Any ideas?  Are the results more reliable if a VM is powered 
down before starting the backup?  <br>
<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # ./ghettoVCB.sh -f 
vmbackups<br>
2010-02-04 01:50:26 -- info: ============================== ghettoVCB 
LOG START                                                
==============================<br>
<br>
2010-02-04 01:50:26 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/esxi-back                                               up<br>
2010-02-04 01:50:26 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-02-04 01:50:26 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-02-04 01:50:26 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-02-04 01:50:26 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-02-04 01:50:26 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-02-04 01:50:26 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-02-04 01:50:26 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-02-04 01:50:26 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-02-04 01:50:26 -- info: CONFIG - LOG_LEVEL = info<br>
2010-02-04 01:50:26 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-02-04 01:50:26 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-02-04 01:50:26 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-02-04 01:50:26 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-02-04 01:50:31 -- info: Initiate backup for MSServer2003X32<br>
2010-02-04 01:50:31 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-02-04" f                                       
        or MSServer2003X32<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk 
'/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27/MSServer2003X32/MSServer2003X32_2.v
                            mdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk 
'/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27/MSServer2003X32/MSServer2003X32_1.v
                            mdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk 
'/vmfs/volumes/datastore2/MSServer2003X32/MSServer2003X32.vmdk'...<br>
Clone: 61% done.Failed to clone disk : Input/output error (327689).<br>
2010-02-04 03:29:39 -- info: Removing snapshot from MSServer2003X32 ...<br>
2010-02-04 03:31:31 -- info: Backup Duration: 101.00 Minutes<br>
2010-02-04 03:31:31 -- info: Successfully completed backup for 
MSServer2003X32!<br>
<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # 2010-02-04 01:50:31 
-- info: Initiate backup for MSServer2003X32<br>
-ash: 2010-02-04: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # 2010-02-04 01:50:31 
-- info: Creating Snapshot "ghettoVCB-snapshot-2010-02-04" f            
                       or MSServer2003X32<br>
-ash: 2010-02-04: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Destination disk 
format: VMFS thin-provisioned<br>
-ash: Destination: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Cloning disk 
'/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27/MSServer2003X32/MSServer2003X32_2.v
                mdk'...<br>
-ash: Cloning: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Clone: 100% done.<br>
-ash: Clone:: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Destination disk 
format: VMFS thin-provisioned<br>
Cloning disk 
'/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27/MSServer2003X32/MSServer2003X32_1.v
                mdk'...<br>
-ash: Destination: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Cloning disk 
'/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27/MSServer2003X32/MSServer2003X32_1.v
                mdk'...<br>
-ash: Cloning: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Clone: 100% done.<br>
-ash: Clone:: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Destination disk 
format: VMFS thin-provisioned<br>
-ash: Destination: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Cloning disk 
'/vmfs/volumes/datastore2/MSServer2003X32/MSServer2003X32.vmdk'...<br>
<br>
-ash: Cloning: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # Clone: 61% 
done.Failed to clone disk : Input/output error (327689).<br>
-ash: Syntax error: "(" unexpected<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # 2010-02-04 03:29:39 
-- info: Removing snapshot from MSServer2003X32 ...<br>
-ash: 2010-02-04: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # 2010-02-04 03:31:31 
-- info: Backup Duration: 101.00 Minutes<br>
-ash: 2010-02-04: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # 2010-02-04 03:31:31 
-- info: Successfully completed backup for MSServer2003X32!<br>
-ash: 2010-02-04: not found<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 #<br>
/vmfs/volumes/4a8ea23d-22b66fc2-ab77-0025b382fb27 # 2010-02-04 03:31:31 
-- info: ============================== ghettoVCB LOG END 
================================
					</p>
				</div>
				<a name="comments-14334"></a>
				<div id="comment-14334" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 3, 2010 9:09 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-QjH860UwQb6xVSFk" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14332" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14334">
					I would say for backup purposes, thin would make the most sense 
unless you have a reason not to use it. There negligible performance 
difference and the main reason I would recommend zerothick versus thin 
is ensuring that you properly manage your storage. You may find yourself
 over allocating if you're thin provisioning all VMs and you don't keep 
an eye on it.<br>
<br>
Regarding your errors, please take a look back at the last 10 or so 
threads. This is an issue with your NFS server and specifically deleting
 large files which causes a delay or intermittent disconnect where the 
ESX(i) host is unable to communicate with the NFS datastore causing some
 issues which has been experienced by quite a few individuals. This has <u>nothing</u>
 to do with the script<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14366"></a>
				<div id="comment-14366" class="jive-content-comment ">
					<span>
						<span>
							Feb 3, 2010 11:44 PM
						</span>
							<!--<a href="/people/bonibaz" title="Click to view bonibaz's profile">
<img class="jive-avatar" src="/people/bonibaz/avatar/16.png?a=-1" height="16" width="16" title="Click to view bonibaz's profile" alt="Click to view bonibaz's profile" />
</a>--><a href="http://communities.vmware.com/people/bonibaz" 
id="jive-6kXQf0pT78c02gt7" class="jive-username-link" title="Click to 
view bonibaz's profile">bonibaz</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14366">
					i test the skrip nearly one week without problems till now.<br>
everything works fine: create snapshot, copy snapshot to nfs, remove 
snapshot, rename and remove old backup-folders.<br>
<br>
I doupt myself, but now, iÂ´m really happy!<br>
<br>
THANKS FOR HELP WILLIAM!!!
					</p>
				</div>
				<a name="comments-14369"></a>
				<div id="comment-14369" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 2:30 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-u4tW2vdfQ0DTbyYw" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14332" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14369">
					@ws2000:<br>
<br>
We use 2gbsparse as it produces the smallest backups. <br>
We found this in some cases to also consume significant less space than 
thin.<br>
Keep in mind that some NFS do not support thin (e.g. NFS on Windows) 
resulting in thick instead.<br>
So my personal favorite is still 2gbsparse.<br>
<br>
grubi.
					</p>
				</div>
				<a name="comments-14381"></a>
				<div id="comment-14381" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 7:03 AM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-TQr4EPlj40ooEfHr" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14369" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14381">
					goppi<br>
<br>
I am using Windows Services for UNIX Version 3.5 on a Windows XP Dell 
Dimension (firewall disabled).  The machine has a new SATA Western 
Digital Black drive and 2 gig of ram.  Pretty good for a simple NAS I 
thought.  <br>
<br>
I have tried the backup twice now.  Both times it succeeds on my smaller
 6 GB and 25 GB VM disks and then fails with a error (Failed to clone 
disk : Input/output ) on the 51 GB VM disk.  The first time it was at 
61% and the second time at 10 %.   I purposely attempted this after 
hours so there would be minimal network congestion.<br>
<br>
Do you think it could be format related?   2gbsparse verses thin?<br>
<br>
On a side note I tried to WinSCP some files off my ESXI host.  WinSCP 
runs for a few minutes and then fails with an error about the host not 
communicating for the last 15 seconds.  Seems to create the same sized 
file ( 488268 KB ) and stops.  There has to be some setting that is 
getting me???  I drop a 6 GB .wim image onto PCs in around 15 to 17 
minutes without ever a network issue.<br>
<br>
One other thought.... I have only added the NFS as storage on the ESXI 
host.  I have not added an additiional vmkernel based vSwitch pointing 
at this machine.  Is that recommemded?
					</p>
				</div>
				<a name="comments-14382"></a>
				<div id="comment-14382" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 7:19 AM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-viXI6c7o7Tc30yH7" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14382">
					I have a quick question.  When I run this script on one of my ESX 
servers it backs up fine for virtual machines that are on the running 
server.  I am unable to backup vm's that are not running on the same ESX
 host as the script.  Is there a way around this or do I need to turn 
DRS off and backup vm's that are running on each server?
					</p>
				</div>
				<a name="comments-14370"></a>
				<div id="comment-14370" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 7:43 AM
						</span>
							<!--<a href="/people/angelone" title="Click to view angelone's profile">
<img class="jive-avatar" src="/people/angelone/avatar/16.png?a=-1" height="16" width="16" title="Click to view angelone's profile" alt="Click to view angelone's profile" />
</a>--><a href="http://communities.vmware.com/people/angelone" 
id="jive-6X74458ynUwU2Ssh" class="jive-username-link" title="Click to 
view angelone's profile">angelone</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14382" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14370">
					Hi soleblazer,<br>
this script is just for backing up VMs on the local ESX(i).<br>
<br>
regards,<br>
 Martin
					</p>
				</div>
				<a name="comments-14385"></a>
				<div id="comment-14385" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 9:01 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4CxIT7Lq1Ad66Aiy" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14382" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14385">
					You'll need to disable DRS else the VMs will be moving around and 
the script will only work on VMs that are running local to the ESX(i) 
host during the period of the script execution. I know some individuals 
have placed the script on shared storage (recommended) approach and 
actually have a global backup list of VMs and that way they're able to 
backup all VMs and have each host execute the script in a staggered 
period.<br>
<br>
Again, this won't always guarantee that you'll backup all VMs or if you 
backup duplicates. You potentially can miss one after going from HostA 
to HostB via a vMotion. You can easily prevent duplicate backups by 
writing out to another file keeping track of the VMs that's been backed 
up during a period. This script is really meant to be used w/o vCenter 
and majority of the user case will be standalone ESX or ESXi host. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14386"></a>
				<div id="comment-14386" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 9:02 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-XBxLdMz4xEdL5Vq4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14366" title="Go to message">bonibaz</a>
							</em>
					</span>
					<p id="comment-body-14386">
					Glad to hear everything is working out. <br>
<br>
I do though would like to know what exactly is causing so many users to 
run into the issue with their NFS server? I'm not sure if the pipe 
between the two are not fast enough or if the NFS server itself is not 
sufficient in terms of cpu/memory resources to keep up with the demand. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14387"></a>
				<div id="comment-14387" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 9:08 AM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-eOlctJ0YM1QUSTT0" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14386" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14387">
					Any idea what is causing WinSCP to fail copying a .vmdk file from 
the datastore?  I have tried it 6 times now and everytime it stops at 
488268 KB with a host has not communicated for 15 seconds.... error.  I 
have plenty of disk space.  Itâ€™s only a 8 GB VM disk.  To stop at the 
same file size everytime screams of newbie user mistake <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" border="0">
  But I can't figure it out.<br>
<br>
I will try your suggestions.<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-14388"></a>
				<div id="comment-14388" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 9:22 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-n38of0OJkLjvnkOS" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14387" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14388">
					Well first off I would investigate why your NAS is having issues 
with the backup, if you take a look at the last 20 or so threads, few of
 the posts have referenced that this may be a potential issue with NFS 
server (take a look at the server logs/etc).<br>
<br>
Secondly, WinSCP was not designed to support transfer of VMs and should 
not be used any issues you may run into is probably expected. You may 
want to take a look at Veeam's FastSCP which "IS" design to transfer VMs
 off an ESX(i) host via the SCP protocol. The issue has nothing to do 
with free space but how you're communicating with the host to transport 
the files. <br>
<br>
I would say the latter would be a short term fix but you probably want 
to figure out why your NFS server is not sufficient enough in supporting
 the backup.  This just may be a known issue when using NFS from Windows
 which is probably not my first recommendation when setting up a NAS. <br>
<br>
Good Luck<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14362"></a>
				<div id="comment-14362" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 9:59 AM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-nXSpBOipUH0n1TLl" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14362">
					Another question.  I backed up my first VM, and it seems to have 
worked.  I restored the vm (and by restore I mean I just added it to the
 inventory and started it up, just as a test) and I notice one odd 
thing.  It seems the /etc/sysconfig/network-scripts/ifcfg-eth0 file has 
been modified, it was changed to use DHCP.  Its def different than the 
source vm, could this do anything like that?  I'm just curious, it could
 obviously be something else, just curious if anyone has seen that, I 
would assume it would be an exact replica, using the same IP.  
Everything else seemed the same.
					</p>
				</div>
				<a name="comments-14371"></a>
				<div id="comment-14371" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 10:03 AM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-Kk49L31euMqHe64k" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14388" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14371">
					Well Veeam's FastSCP is working WONDERFULLY!  I will continue 
hacking away with your other recommendations and post back.<br>
<br>
THANKS FOR ALL THE HELP!  Its very much appreciated.
					</p>
				</div>
				<a name="comments-14389"></a>
				<div id="comment-14389" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 10:06 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-JNRiiXOEsjOYrXK5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14362" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14389">
					The backup is preserving everything you had in the source .. may 
want to double check that you were in fact using static IP address. Also
 when you restored, was the source still running? perhaps a conflict and
 whatever OS you had backed up defaulted to DHCP?<br>
<br>
This is more of guestOS question versus a script question and would 
recommend you do some investigation on you end.<br>
<br>
Thanks<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14372"></a>
				<div id="comment-14372" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 11:35 AM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-R4Ylx8OiBD0Gk6fa" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14372">
					I agree, my 2nd attempt had the expected result.  I think I hit 
some sort of vmware tools item, this script rocks.
					</p>
				</div>
				<a name="comments-14390"></a>
				<div id="comment-14390" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 11:54 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-W46BTxbdwgUDR3xG" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14371" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14390">
					@ws2000:<br>
<br>
IMHO forget about NFS services for Windows. We also were using it and 
were not able to get a stable backup. This was surely no ressource 
probem. The ESXi was running on a DL380 2 X QC with 32 GB RAM and 6 x 
SAS RAID 10 and the NFS on a DL380 1 x QC with 4 GB RAM and 5 x SAS 
RAID5. Both servers are equipped with BBWC.<br>
We then switched the NFS software to AllegroNFS and all problems were 
gone + an increase of perfomance of about 700%<br>
<br>
Cheers<br>
grubi.
					</p>
				</div>
				<a name="comments-14391"></a>
				<div id="comment-14391" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 12:06 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-mHR9AkrEADO8N2XC" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14390" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14391">
					@goppi  Thanks for the comment/feedback. Another reason not to run 
Windows <img class="jive-emoticon" src="DOC-8760_files/wink.gif" 
alt=";)" border="0"> I would bet that if you spun up openfiler that it 
would do better than NFS services for Windows<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14392"></a>
				<div id="comment-14392" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 12:48 PM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-0CFT1or36WYmsyIP" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14392">
					All, I have some vm's that have many vmdks across 2 datastores.  
WHen I run the script with a dry run, I see the 4 vmdk's, but on the 
VMFS_VOLUME line, it only reports the first datastore, never both of 
them.  Is this normal?  I think it will do the right thing, but can 
someone verify I'm not doing anything wrong?
					</p>
				</div>
				<a name="comments-14373"></a>
				<div id="comment-14373" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 12:48 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-9tq03kuruTbKPsSX" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14391" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14373">
					I might just download Openfiler and try it.  Looks like a lot more 
fun than a Windows XP box.  <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"> <br>
<br>
lamw, would Openfiler fall under your recommended NFS solutions 
category?
					</p>
				</div>
				<a name="comments-14393"></a>
				<div id="comment-14393" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 1:05 PM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-4fINUd2y0WNdPQ3K" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14373" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14393">
					What ever happened to a regular linux box with NFS or used as an 
iSCSI target instead of OpenFiler? Both NFS and iSCSI are not that 
difficult to configure and probably easier to use than the clunky web 
interface that OF has.<br>
</p><p>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-14394"></a>
				<div id="comment-14394" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 1:32 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GVeOmTTcN0er63Ym" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14373" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14394">
					My comment on Openfiler was more of a joke, I know some users have 
used it but I have not personally used it and I can't comment nor can I 
comment on any other 'recommended' solution as they're many out there.<br>
<br>
Recommendation, lots of questions, reading over the previous comment and
 research is your best friend <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
Good Luck<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14395"></a>
				<div id="comment-14395" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 1:33 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6aU1rPPS7Ew5f80u" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14393" title="Go to message">NickelNetworks</a>
							</em>
					</span>
					<p id="comment-body-14395">
					100% agreed, that's actually what we run for our own setup. I'm not
 a fan of all the pretty GUI's as much of my work is on the CLI. NFS is 
probably one of the easiest to setup, though different users will have 
different comfort levels with UNIX/Linux and having VSA type of vApps 
isn't bad.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14396"></a>
				<div id="comment-14396" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 1:35 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Oz95pcmm4nuS1zTu" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14392" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14396">
					Actually that is expected, that line mainly represents where the 
VM's configuration files are stored at, since that is static and the 
VMDK(s) can be spread across multiple datastores and hence you see the 4
 lines specifying their full paths. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14375"></a>
				<div id="comment-14375" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 8:44 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-7Hz7ol2Ol1A2OxOJ" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14390" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14375">
					Hello<br>
Uninstalled the Windows NFS and installed the Allegro.  I got it all 
configured to the best of my knowledge <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"> .  I added it into my
 ESXI host.  I tested root rights by creating folders and deleting them 
in the new NFS datastore.  Everything looked good.<br>
<br>
My last few backup attempts I have powered down the VM hoping that would
 help.  Unfortunately I got the same (Input/output error (327689) ) 
errors as last nightâ€™s backup attempt to Windows NFS. <br>
</p><p>
<br>
Did you do anything special in your NFS / EXSI configurations?  How did 
you add the new NFS datastore share to your ESXI host?  Did you add it 
as â€œstorageâ€ and / or â€œnetworkâ€ with the VMkernal port?<br>
<br>
I was able to pull down some backup VMs I created on the ESXI hostâ€™s 
datastore with Veeam.  That was around 128 GB without an error.  There 
has to be a detail I have overlooked.
					</p>
				</div>
				<a name="comments-14398"></a>
				<div id="comment-14398" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 9:06 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-B80RfI8Bg2k9Mo4v" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14375" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14398">
					I have been running Win NFS for some time without a problem. You 
have proven by using Allegro that either the esxi or your backup machine
 itself has a problem. There is only one way to add a NFS datastore 
which you must have done to test it.
					</p>
				</div>
				<a name="comments-14376"></a>
				<div id="comment-14376" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 4, 2010 9:13 PM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-5HTvs0RpfkbJTWtQ" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14398" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-14376">
					Are you using Win NFS on Server 2XXX or just Windows XP?  Is it 
better to install a NFS on server software?  My backup machine is just 
an older Dell workstation but it should be fine for just getting data 
dumped on it????  No firewall.  No other processes using it.  What type 
of hardware are you using?
					</p>
				</div>
				<a name="comments-14399"></a>
				<div id="comment-14399" class="jive-content-comment ">
					<span>
						<span>
							Feb 4, 2010 10:18 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-AXMJbuYq4Il8Y6dS" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14376" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14399">
					It is a PowerEdge SC430 which is a bottom of the line server - cost
 about $800 dollars 3 years ago <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"> - running 2k3 SBS 
with everything stripped out or turned off. I would normally use linux 
NFS but it was lying around and it saved me an OS install <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" border="0">
 I have not run NFS on XP so i cannot say whether this is an issue or 
not.<br>
<br>
If you are up to it try linux - it does a much better job at NFS and you
 would then be certain as to whether it is a NFS or machine problem - i 
am inclined to think the latter but as i said i have no experience with 
XP/NFS
					</p>
				</div>
				<a name="comments-14377"></a>
				<div id="comment-14377" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 5, 2010 1:46 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-XLXSAJEkB2b07KuU" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14376" title="Go to message">ws2000</a>
							</em>
					</span>
					<p id="comment-body-14377">
					@win2000<br>
<br>
IMHO you should forget about XP for that.<br>
XP has a crippled TCP/IP stack which behaves strange under heavy load.<br>
<br>
AllegroNFS is less picky than Windows NFS however you need a quite 
powerful machine as ESXi impementation of NFS seems fragile when it 
comes to latency issues.<br>
<br>
Most times we could solve issues by changing from Window NFS to 
AllegroNFS but sometimes we simply had to switch hardware. Implementing 
linux NFS seems to further reduce latency. But be aware when using cheep
 NAS boxes. Some of them use weak processors which brings you back to 
the initial problem regardless what harddisks you plug in.<br>
<br>
Cheers<br>
grubi.
					</p>
				</div>
				<a name="comments-14379"></a>
				<div id="comment-14379" class="jive-content-comment ">
					<span>
						<span>
							Feb 5, 2010 5:28 AM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-8NskNJ84b6aemYEo" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14399" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-14379">
					Dump SBS! Unless you remove Exchange and ran DCPROMO to make it a 
regular Windows server it will give you tons of problems with NFS.  Do 
yourself a favor and install Linux and NFS.<br>
<br>
I am in the same boat as most probably thinking that NFS is easier to 
use than iSCSI. Going through an implementation now we have changed 
directions over to iSCSI since it seems better in performance and 
support with HP and Microsoft as we are using a StorageWorks X1400 as a 
SAN. Personally I would not recommend these units, nor any SAN running 
WSS at all, avoid them if you want your sanity, but since it is what we 
have to work with we are documenting the steps and will publish our 
guide in our web site soon for anyone to see. It will explain how to do 
the iSCSI LUN calculations and iSCSI targets based on your VM sizing so 
will touch a bit on capacity planning for storage.<br>
<br>
The basic idea is that we have an HP ML350 G6 as the ESX server with 
local storage of 1 TB and the X1400 as the iSCSI SAN with about the same
 storage, a bit more actually.  Ghetto does the backup every day from 
the SAN to the local storage in case something happens to the SAN we 
could also run it on the local storage. <br>
</p><p>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-14410"></a>
				<div id="comment-14410" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 5, 2010 5:49 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-M2DRV10jwkUTGcmv" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14398" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-14410">
					Definitely Windows NFS is a NO. performance sucks, unless you don't
 care and want it to read access only like for dumping ISO files for ESX
 servers to access them.<br>
Openfiler NFS -configured properly- works as good as NFS on any  linux 
flavor. openfiler iSCSI works good as well, but  it really depends what 
you're trying to accomplish then you need to decide NFS or iSCSI<br>
<br>
Whatever path you go, you will want to make sure it's a stable storage 
for your ESX servers otherwise they will not like it.<br>
<br>
Not sure how your environment is or how much i/O you have in your but 
NFS or software iSCSI for ESX/ESXi should be configured in vmkernel 
port. Ideally you want to assign -at least- one dedicated NIC for 
IPstorage on it's own vswitch. you may want to try using using jumbo 
frames if your physical switches support it. if you go software iSCSI 
with 2 NICs, you may want  to configure multipath (done at cli)<br>
</p><p>
<br>
<strike>If this was helpful please assign points</strike>
					</p>
				</div>
				<a name="comments-14402"></a>
				<div id="comment-14402" class="jive-content-comment ">
					<span>
						<span>
							Feb 5, 2010 7:14 AM
						</span>
							<!--<a href="/people/ws2000" title="Click to view ws2000's profile">
<img class="jive-avatar" src="/people/ws2000/avatar/16.png?a=-1" height="16" width="16" title="Click to view ws2000's profile" alt="Click to view ws2000's profile" />
</a>--><a href="http://communities.vmware.com/people/ws2000" 
id="jive-D1Hlpdenl15V0E5q" class="jive-username-link" title="Click to 
view ws2000's profile">ws2000</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14399" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-14402">
					I do not have a lot of experience with Linux but I would try it.  
My issue with Linux is I need something semi friendly for my co workers.
  Could I use something like Ubuntu and still get good better results?
					</p>
				</div>
				<a name="comments-14425"></a>
				<div id="comment-14425" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 5, 2010 8:54 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-6t4z9YY0P3FXVJ7g" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14410" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-14425">
					</p><div class="jive-quote"><div class="jive-quote">Definitely 
Windows NFS is a NO</div></div>
<br>
Sorry but to say that in such a general way is inaccurate.<br>
With powerful hardware it's ok.<br>
We are running it on a few sites with backup performance of about 4 
GB/min which is not that bad.<br>
<br>
Cheers,<br>
grubi.
					
				</div>
				<a name="comments-14428"></a>
				<div id="comment-14428" class="jive-content-comment ">
					<span>
						<span>
							Feb 5, 2010 9:27 AM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-EaUEgY3p84b25q7n" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14425" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14428">
					Grubi, I have spend over $8K in HP servers running windows and have
 found so many bugs with it that I am still waiting on hot fixes from 
Microsoft It is a personal choice of course, but for my experience I 
will never use it providing there are alternatives for it.<br>
</p><p>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-14429"></a>
				<div id="comment-14429" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 5, 2010 2:02 PM
						</span>
							<!--<a href="/people/sonicpony" title="Click to view sonicpony's profile">
<img class="jive-avatar" src="/people/sonicpony/avatar/16.png?a=-1" height="16" width="16" title="Click to view sonicpony's profile" alt="Click to view sonicpony's profile" />
</a>--><a href="http://communities.vmware.com/people/sonicpony" 
id="jive-E0O8H4q7vPTEi9Ay" class="jive-username-link" title="Click to 
view sonicpony's profile">sonicpony</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14429">
					Hello William. I seem to experience the same problem some users 
were having regarding a "bad number" error. You mentioned that it had 
something to do with the NFS environment but all the backups processes 
I've tried so far was using the local datastore on the ESXi server. 
Below are the log outputs for both powered on and powered off backup 
instances. There are only 2 vmx files specified in the "list" file I 
created, both are about 15GB each. <br>
<br>
vmware -v query produces VMware ESXi 4.0.0 build-208167.<br>
<br>
I made sure there were no data in the backup volume before executing the
 script. I've also tried zeroedthick and 2gbsparse disk backup formats -
 both produce the same result. <br>
<br>
~ # ./ghettoVCB.sh -f list<br>
2010-02-05 20:40:06 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-02-05 20:40:06 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/datastore1/BACKUPS<br>
2010-02-05 20:40:06 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-02-05 20:40:06 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-02-05 20:40:06 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-02-05 20:40:06 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-02-05 20:40:06 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-02-05 20:40:06 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-02-05 20:40:06 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-02-05 20:40:06 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-02-05 20:40:06 -- info: CONFIG - LOG_LEVEL = info<br>
2010-02-05 20:40:06 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-02-05 20:40:06 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-02-05 20:40:06 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-02-05 20:40:06 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-02-05 20:40:08 -- info: Initiate backup for CTX05/CTX05.vmx<br>
2010-02-05 20:40:08 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-02-05" for CTX05/CTX05.vmx<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/CTX05/CTX05.vmdk'...<br>
Clone: 100% done.<br>
2010-02-05 20:41:03 -- info: Removing snapshot from CTX05/CTX05.vmx ...<br>
sh: /vmfs/volumes/datastore1/BACKUPS/CTX05/CTX05.vmx/CTX05: bad number<br>
./ghettoVCB.sh: line 735: syntax error: 
/vmfs/volumes/datastore1/BACKUPS/CTX05/CTX05.vmx/CTX05+1<br>
~ #<br>
</p><p>
<br>
/vmfs/volumes/4b50c35e-4f78075c-2b86-0014222390f7 # ./ghettoVCB.sh -f 
list1<br>
2010-02-05 21:20:05 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-02-05 21:20:05 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/datastore1/BACKUPS<br>
2010-02-05 21:20:05 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-02-05 21:20:05 -- info: CONFIG - DISK_BACKUP_FORMAT = 2gbsparse<br>
2010-02-05 21:20:05 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-02-05 21:20:05 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 1<br>
2010-02-05 21:20:05 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 1<br>
2010-02-05 21:20:05 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-02-05 21:20:05 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-02-05 21:20:05 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-02-05 21:20:05 -- info: CONFIG - LOG_LEVEL = info<br>
2010-02-05 21:20:05 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-02-05 21:20:05 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-02-05 21:20:05 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-02-05 21:20:05 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-02-05 21:20:07 -- info: Powering off initiated for CTX05/CTX05.vmx,
 backup will not begin until VM is off...<br>
2010-02-05 21:20:10 -- info: VM is still on - Iteration: 0 - sleeping 
for 60secs (Duration: 0 seconds)<br>
2010-02-05 21:21:11 -- info: VM is powerdOff<br>
2010-02-05 21:21:11 -- info: Initiate backup for CTX05/CTX05.vmx<br>
Destination disk format: sparse with 2GB maximum extent size<br>
Cloning disk '/vmfs/volumes/datastore1/CTX05/CTX05.vmdk'...<br>
Clone: 100% done.<br>
2010-02-05 21:22:16 -- info: Powering back on CTX05/CTX05.vmx<br>
sh: /vmfs/volumes/datastore1/BACKUPS/CTX05/CTX05.vmx/CTX05: bad number<br>
./ghettoVCB.sh: line 735: syntax error: 
/vmfs/volumes/datastore1/BACKUPS/CTX05/CTX05.vmx/CTX05+1<br>
/vmfs/volumes/4b50c35e-4f78075c-2b86-0014222390f7 #<br>
</p><p>
Any help would be appreciated. Thank you very much.
					</p>
				</div>
				<a name="comments-14457"></a>
				<div id="comment-14457" class="jive-content-comment ">
					<span>
						<span>
							Feb 10, 2010 7:17 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-QlU78CToW4lt19Nw" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14457">
					William,<br>
<br>
I like the script a lot and I think itâ€™s much better then my plan to 
snapshot running vmâ€™s on a NSF share using LVM. Using the VMware 
snapshots is probably saver than LVM snapshots.<br>
Off course I have a few questions. I did read a lot on the VMware web 
site but that info is scattered around so forgive me if Iâ€™m asking 
already answered questions.<br>
<br>
Question 1. Does enabling quiesce have any negative effects on VMâ€™s that
 do not have the VMware tools installed?<br>
<br>
Question 2. What exactly does the ADAPTER_FORMAT setting do? Does it 
change the adaptor setting in the snapshot vmx?<br>
<br>
Question 3. I added â€œtouch /path/backupdoneâ€ to the end of your script. I
 use it to trigger a mail message on the NFS server. Could this be a 
problem?<br>
<br>
Question 4. I noticed a lot of writing on the NFS server after the 
script has finished. Can you perhaps explain that?<br>
<br>
Anyway thanks for a great script.<br>
<br>
WB
					</p>
				</div>
				<a name="comments-14443"></a>
				<div id="comment-14443" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 10, 2010 9:21 AM
						</span>
							<!--<a href="/people/lacikaaa" title="Click to view lacikaaa's profile">
<img class="jive-avatar" src="/people/lacikaaa/avatar/16.png?a=-1" height="16" width="16" title="Click to view lacikaaa's profile" alt="Click to view lacikaaa's profile" />
</a>--><a href="http://communities.vmware.com/people/lacikaaa" 
id="jive-qcQcjkRh1b6BqaAy" class="jive-username-link" title="Click to 
view lacikaaa's profile">lacikaaa</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14443">
					Hi!<br>
<br>
I have a problem with backup rotation. After the script has finished the
 latest backup it removes the other one, so I have only one backup at 
once, even if i set VM_BACKUP_ROTATION_COUNT to 3 or 2. There is no 
information in the log about it, neither in debug mode. Any idea?<br>
<br>
Thank you!<br>
lacika
					</p>
				</div>
				<a name="comments-14471"></a>
				<div id="comment-14471" class="jive-content-comment ">
					<span>
						<span>
							Feb 10, 2010 2:29 PM
						</span>
							<!--<a href="/people/Furgirl39" title="Click to view Furgirl39's profile">
<img class="jive-avatar" src="/people/Furgirl39/avatar/16.png?a=-1" height="16" width="16" title="Click to view Furgirl39's profile" alt="Click to view Furgirl39's profile" />
</a>--><a href="http://communities.vmware.com/people/Furgirl39" 
id="jive-xVApeQVdL5f79Oox" class="jive-username-link" title="Click to 
view Furgirl39's profile">Furgirl39</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14471">
					Hi All,<br>
<br>
I'm unable to run the script. I understand about the linefeeds "gifted" 
from Windows, so I used wget:<br>
<br>
/etc # wget <a class="jive-link-external" 
href="http://communities.vmware.com/servlet/JiveServlet/download/8760-48-3">http://communities.vmware.com/servlet/JiveServlet/download/8760-48-3</a><br>
Connecting to communities.vmware.com<a class="jive-link-external" 
href="http://198.189.255.90/">http://198.189.255.90</a>:80<br>
ghettoVCB.sh         100% 
|*****************************************************<br>
/etc #<br>
/etc # chmod +x ghettoVCB.sh<br>
/etc # ./ghettoVCB.sh -f vms_to_backup -d dryrun<br>
: not found.sh: ./ghettoVCB.sh: 6:<br>
: not found.sh: ./ghettoVCB.sh: 8:<br>
: not found.sh: ./ghettoVCB.sh: 11:<br>
: not found.sh: ./ghettoVCB.sh: 18:<br>
: not found.sh: ./ghettoVCB.sh: 21:<br>
: not found.sh: ./ghettoVCB.sh: 26:<br>
: not found.sh: ./ghettoVCB.sh: 29:<br>
: not found.sh: ./ghettoVCB.sh: 34:<br>
: not found.sh: ./ghettoVCB.sh: 38:<br>
: not found.sh: ./ghettoVCB.sh: 41:<br>
: not found.sh: ./ghettoVCB.sh: 45:<br>
: not found.sh: ./ghettoVCB.sh: 48:<br>
: not found.sh: ./ghettoVCB.sh: 51:<br>
: not found.sh: ./ghettoVCB.sh: 54:<br>
: not found.sh: ./ghettoVCB.sh: 59:<br>
: not found.sh: ./ghettoVCB.sh: 61:<br>
: not found.sh: ./ghettoVCB.sh: 64:<br>
: not found.sh: ./ghettoVCB.sh: 67:<br>
: not found.sh: ./ghettoVCB.sh: 70:<br>
: not found.sh: ./ghettoVCB.sh: 73:<br>
: not found.sh: ./ghettoVCB.sh: 75:<br>
: not found.sh: ./ghettoVCB.sh: 76:<br>
: not found.sh: ./ghettoVCB.sh: 78:<br>
: not found.sh: ./ghettoVCB.sh: 83:<br>
: not found.sh: ./ghettoVCB.sh: 86:<br>
: not found.sh: ./ghettoVCB.sh: 87:<br>
###############################################################################<br>
#<br>
</p><ol>
<li>ghettoVCB for ESX/ESXi 3.5 &amp; 4.x+</li>
<li>Author: William Lam</li>
<li><a class="jive-link-external" 
href="http://www.engineering.ucsb.edu/%7Eduonglt/vmware/">http://www.engineering.ucsb.edu/~duonglt/vmware/</a></li>
<li>Created: 11/17/2008</li>
<li>Last modified: 11/14/2009</li>
</ol>
#<br>
###############################################################################<br>
: not found.sh: ./ghettoVCB.sh: 98: echo<br>
Usage: ./ghettoVCB.sh -f <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_BACKUP_UP_LIST">VM_BACKUP_UP_LIST</a>
 -c <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=VM_CONFIG_DIR">VM_CONFIG_DIR</a>
 -l <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=LOG_FILE">LOG_FILE</a><br>
: not found.sh: ./ghettoVCB.sh: 100: echo<br>
OPTIONS:<br>
   -f     List of VMs to backup<br>
   -c     Configuration directory for VM backups<br>
   -l     File to output logging<br>
   -d     Debug level <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=debug"
 title="dryrun">info</a> (default: info)<br>
: not found.sh: ./ghettoVCB.sh: 106: echo<br>
(e.g.)<br>
<br>
Backup VMs stored in a list<br>
        ./ghettoVCB.sh -f vms_to_backup<br>
<br>
Backup VMs based on specific configuration located in directory<br>
        ./ghettoVCB.sh -f vms_to_backup -c vm_backup_configs<br>
<br>
Output will log to /tmp/ghettoVCB.log<br>
        ./ghettoVCB.sh -f vms_to_backup -l /tmp/ghettoVCB.log<br>
<br>
Dry run (no backup will take place)<br>
        ./ghettoVCB.sh -f vms_to_backup -d dryrun<br>
: not found.sh: ./ghettoVCB.sh: 116: echo<br>
./ghettoVCB.sh: exit: 117: Illegal number: 1<br>
<br>
Running sed doesn't help either:<br>
<br>
/etc # sed -i 's/$/\r/'  ghettoVCB.sh
					
				</div>
				<a name="comments-14472"></a>
				<div id="comment-14472" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 10, 2010 2:37 PM
						</span>
							<!--<a href="/people/lacikaaa" title="Click to view lacikaaa's profile">
<img class="jive-avatar" src="/people/lacikaaa/avatar/16.png?a=-1" height="16" width="16" title="Click to view lacikaaa's profile" alt="Click to view lacikaaa's profile" />
</a>--><a href="http://communities.vmware.com/people/lacikaaa" 
id="jive-9XgTTj39masKDOKm" class="jive-username-link" title="Click to 
view lacikaaa's profile">lacikaaa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14471" title="Go to message">Furgirl39</a>
							</em>
					</span>
					<p id="comment-body-14472">
					sed 's/.$//g' input &gt; output
					</p>
				</div>
				<a name="comments-14473"></a>
				<div id="comment-14473" class="jive-content-comment ">
					<span>
						<span>
							Feb 10, 2010 4:26 PM
						</span>
							<!--<a href="/people/sanfordnetworks" title="Click to view sanfordnetworks's profile">
<img class="jive-avatar" src="/people/sanfordnetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view sanfordnetworks's profile" alt="Click to view sanfordnetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/sanfordnetworks" 
id="jive-H7A9BFV9bz4Ytm5T" class="jive-username-link" title="Click to 
view sanfordnetworks's profile">sanfordnetworâ€¦</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14473">
					Greetings!<br>
<br>
Can someone explain this error? I have 60gb available for backup.<br>
<br>
DISKLIB-LIB   : Unable to get file system ID for filename 
"/backups/Nostalgia/Nostalgia-2010-02-10/Nostalgia.vmdk" Failed to clone
 disk : No space left on device (1835017).<br>
Destination disk format: VMFS thin-provisioned<br>
<br>
The VM is very small:<br>
<br>
-rw-------    1 root     root         8684 Feb 10 23:58 Nostalgia.nvram<br>
-rw-------    1 root     root          372 Feb 10 23:57 Nostalgia.vmdk<br>
-rw-------    1 root     root            0 Feb 10 23:57 Nostalgia.vmsd<br>
-rwxr-xr-x    1 root     root         1935 Feb 10 23:58 Nostalgia.vmx<br>
-rw-------    1 root     root          264 Feb 10 23:57 Nostalgia.vmxf<br>
<br>
TIA.
					</p>
				</div>
				<a name="comments-14446"></a>
				<div id="comment-14446" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 10, 2010 9:44 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-089G0PS9PDB3p1l6" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14429" title="Go to message">sonicpony</a>
							</em>
					</span>
					<p id="comment-body-14446">
					Do the backups actually take place? Do you see the backups being 
created with their disks/etc? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14447"></a>
				<div id="comment-14447" class="jive-content-comment ">
					<span>
						<span>
							Feb 10, 2010 9:50 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GD80g2YXm8R4k4P4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14457" title="Go to message">wobbe98</a>
							</em>
					</span>
					<p id="comment-body-14447">
					1) No, if you don't have VMware Tools installed, it'll use the 
default OS driver to quiesce the VM. There was a thread on this on the 
comments, you can find more details if you search maybe 30 or so posts 
back.<br>
<br>
2) This changes the adapter for the VMDK which is an option when using <b>vmkfstools</b>,
 by default you would generally leave this alone unless you need to 
change the adapter, else the default adapter will be used. <br>
<br>
3) Don't see any issues with this, but as a warning, any changes made to
 the default script will not be supported and you'll be on your own if 
you run into any odd issues. Though this should be a safe operation<br>
<br>
4) Not sure what you mean by "lot of writing". After the competition of 
the backups, based on the rotation count, it'll either skip OR purge any
 previous backups. Lots of users have ran into issues and from what I've
 gathered with few folks on here, it might be due to the NFS server that
 is being used either it's not beefy enough or there's something going 
on with the host that is running the server. In either case, once the 
backup has completed, the only operation left is the purging.<br>
<br>
I would recommend you go through the documentation and the FAQ which 
should answer more of your questions and some others may also be 
answered in past threads on this doc.<br>
<br>
Thanks<br>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14448"></a>
				<div id="comment-14448" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 10, 2010 9:51 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8gq5vdA79NED5dDX" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14443" title="Go to message">lacikaaa</a>
							</em>
					</span>
					<p id="comment-body-14448">
					Can you try to remove all the backups out to another directory or 
delete and try to set the counter and see if it's counting properly. 
I've not had any users report issues with the rotation count, this is 
the first I've heard of it. Remember not to manually rename files or 
move files around.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14449"></a>
				<div id="comment-14449" class="jive-content-comment ">
					<span>
						<span>
							Feb 10, 2010 9:52 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GQhCq92MBC1jmrxH" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14471" title="Go to message">Furgirl39</a>
							</em>
					</span>
					<p id="comment-body-14449">
					I should also mentioned that <b>wget</b> will also not pull down 
the script properly. Please take a look at FAQ #17<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14450"></a>
				<div id="comment-14450" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 10, 2010 9:57 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-arVW4mR5S9Tyo5B3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14473" title="Go to message">sanfordnetworâ€¦</a>
							</em>
					</span>
					<p id="comment-body-14450">
					Not sure what to say, the message output is pretty clear on what 
the error is.<br>
<br>
Can you please provide a screenshot to the datastore in which you're 
running the backup from the vSphere Client clearing displaying the 
capacity free and consumed?<br>
<br>
Can you also run "df -h" on the unsupported console of your ESXi host OR
 "vdf -h" if you're using classic ESX<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14474"></a>
				<div id="comment-14474" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2010 5:34 AM
						</span>
							<!--<a href="/people/wlevels" title="Click to view wlevels's profile">
<img class="jive-avatar" src="/people/wlevels/avatar/16.png?a=-1" height="16" width="16" title="Click to view wlevels's profile" alt="Click to view wlevels's profile" />
</a>--><a href="http://communities.vmware.com/people/wlevels" 
id="jive-rLVdURd7kw60pP2m" class="jive-username-link" title="Click to 
view wlevels's profile">wlevels</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14474">
					First of all, great script!Really like it, and it is the solution 
for my back-ups for my home ESXi whitebox <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
My apologies if this problem has been solved already, I couldn't find a 
resolution in the above HUGE list of posts.<br>
<br>
The problem with people getting the "tar: invalid tar magic" error, this
 has to do with the command your using.<br>
The ghettoVCB-script creates a tarball when using compression. If you 
then try to extract or list the contents without the extended usage of 
gzip you will get the "tar: invalid tar magic" error.<br>
<br>
Don't forget to use the "z" in your extract or list commands (meaning 
that your trying to extract or list a compressed tarball in stead of a 
normal tar archive):<br>
<br>
so the right commands to use are:<br>
<br>
"tar tzvf * " - for listing the contents of the selected tarball back-up<br>
"tar xzvf * " - for extracting the contents of the selected tarball 
back-up
					</p>
				</div>
				<a name="comments-14476"></a>
				<div id="comment-14476" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 11, 2010 6:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-xpvVxjk0OnAkRjrO" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14474" title="Go to message">wlevels</a>
							</em>
					</span>
					<p id="comment-body-14476">
					Thanks for the comments, I'm assuming you're referring to the 
restore script and not the backup script in this case? I may have missed
 <b>z</b> option and <b>v</b> is not necessary since I don't need to the
 verbosity.<br>
<br>
Have you tried modifying the script with your suggestion to see if you 
still run into the issue? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14460"></a>
				<div id="comment-14460" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2010 7:10 AM
						</span>
							<!--<a href="/people/wlevels" title="Click to view wlevels's profile">
<img class="jive-avatar" src="/people/wlevels/avatar/16.png?a=-1" height="16" width="16" title="Click to view wlevels's profile" alt="Click to view wlevels's profile" />
</a>--><a href="http://communities.vmware.com/people/wlevels" 
id="jive-6bi86jAcsaKRzDdw" class="jive-username-link" title="Click to 
view wlevels's profile">wlevels</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14476" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14460">
					No I was just referring to the 4 earlier comments in this thread 
that people were trying to uncompress the compressed back-ups created 
with the ghettoVCB script. They were using wrong commands to (manually) 
uncompress the compressed back-ups, this way they got the "tar: invalid 
tar magic" errors.<br>
<br>
As far as I know the restore script doesn't support restoring compressed
 back-ups yet, so I did not check the restore script.<br>
<br>
I found an other problem however, I will post it in a couple of minutes.
 Still doing some testing and creating debug logs
					</p>
				</div>
				<a name="comments-14477"></a>
				<div id="comment-14477" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 11, 2010 9:21 AM
						</span>
							<!--<a href="/people/sonicpony" title="Click to view sonicpony's profile">
<img class="jive-avatar" src="/people/sonicpony/avatar/16.png?a=-1" height="16" width="16" title="Click to view sonicpony's profile" alt="Click to view sonicpony's profile" />
</a>--><a href="http://communities.vmware.com/people/sonicpony" 
id="jive-0Ed5A4kwh2bG7N4t" class="jive-username-link" title="Click to 
view sonicpony's profile">sonicpony</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14446" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14477">
					yes they do, the disks actually get cloned. i think its when its 
trying to remove snapshot, or right after completing the cloning that 
the error occurs.
					</p>
				</div>
				<a name="comments-14485"></a>
				<div id="comment-14485" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2010 9:31 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-HA1XbhCAOTUyI0oO" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14460" title="Go to message">wlevels</a>
							</em>
					</span>
					<p id="comment-body-14485">
					Cool. Let me know what you find and I would be more than welcome to
 make any fixes.<br>
<br>
Regarding the restore script, I've just not had the time implement the 
restore for compressed backups. It's on my to-do list which is actually 
quite huge <img class="jive-emoticon" src="DOC-8760_files/wink.gif" 
alt=";)" border="0"><br>
<br>
If you want to take a crack at it and let me know if you find an elegant
 solution and we can definitely integrate but until then, my plate is 
pretty full. <br>
<br>
Thanks for the comments<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14486"></a>
				<div id="comment-14486" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 11, 2010 9:35 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0BJwGU6nUy674PG2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14477" title="Go to message">sonicpony</a>
							</em>
					</span>
					<p id="comment-body-14486">
					That's what I was thinking, the disks get cloned but its during the
 period of either removing the snapshot OR removing any previous backups
 that you're seeing the errors, most likely it's the removal of previous
 backups. You can get more details by changing the log level to <b>debug</b>
 and you should get more output towards the tail end of the backup 
process. This again goes back to issues with either the host side or NFS
 side where you lose connectivity in which the host can't communicate 
with the NFS server and you get some funkyness which has been reported 
by a few individuals, which has nothing to do with the script but mainly
 on the NFS side of things. I'm curious if maybe users need to set 
longer NFS timeouts/etc. values to compensate with this. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14478"></a>
				<div id="comment-14478" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2010 9:57 AM
						</span>
							<!--<a href="/people/sonicpony" title="Click to view sonicpony's profile">
<img class="jive-avatar" src="/people/sonicpony/avatar/16.png?a=-1" height="16" width="16" title="Click to view sonicpony's profile" alt="Click to view sonicpony's profile" />
</a>--><a href="http://communities.vmware.com/people/sonicpony" 
id="jive-Xw3PN4S8tqkiP2t0" class="jive-username-link" title="Click to 
view sonicpony's profile">sonicpony</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14486" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14478">
					i ran it one more time with the debug option, it cloned the disk 
just fine but ended up with the same error:<br>
<br>
/vmfs/volumes/4b50c35e-4f78075c-2b86-0014222390f7 # ./ghettoVCB.sh -f 
list1 -l ctxbackups.log -d debug<br>
Logging output to "ctxbackups.log" ...<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/CTX05/CTX05.vmdk'...<br>
Clone: 100% done.<br>
sh: /vmfs/volumes/datastore1/BACKUPS/CTX05/CTX05.vmx/CTX05: bad number<br>
./ghettoVCB.sh: line 735: syntax error: 
/vmfs/volumes/datastore1/BACKUPS/CTX05/CTX05.vmx/CTX05+1<br>
/vmfs/volumes/4b50c35e-4f78075c-2b86-0014222390f7 # ls<br>
BACKUPS                                     DOC-ESX-WINBASE             
                ghettoVCB.sh<br>
CTX05                                       ctxbackups.log              
                list1<br>
DOC-ESX-CTX05                               ghettoVCB-restore.sh        
                vms_to_restore_sample.txt<br>
DOC-ESX-CTX06                               
ghettoVCB-vm_backup_configuration_template<br>
<br>
here's the output to the log:<br>
<br>
/vmfs/volumes/4b50c35e-4f78075c-2b86-0014222390f7 # vi ctxbackups.log<br>
2010-02-11 17:43:43 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-02-11 17:43:43 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-208167<br>
2010-02-11 17:43:43 -- debug: HOSTNAME: ***-***-ESX4.********.LOCAL<br>
<br>
2010-02-11 17:43:43 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/datastore1/BACKUPS<br>
2010-02-11 17:43:43 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-02-11 17:43:43 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-02-11 17:43:43 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-02-11 17:43:43 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-02-11 17:43:43 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-02-11 17:43:43 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-02-11 17:43:43 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-02-11 17:43:43 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-02-11 17:43:43 -- info: CONFIG - LOG_LEVEL = debug<br>
2010-02-11 17:43:43 -- info: CONFIG - BACKUP_LOG_OUTPUT = ctxbackups.log<br>
2010-02-11 17:43:43 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-02-11 17:43:43 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-02-11 17:43:43 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-02-11 17:43:45 -- info: Initiate backup for CTX05/CTX05.vmx<br>
2010-02-11 17:43:45 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-02-11" for CTX05/CTX05.vmx<br>
2010-02-11 17:43:47 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-02-11" to be created<br>
2010-02-11 17:43:47 -- debug: Snapshot timeout set to: 900 seconds<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/CTX05/CTX05.vmdk'...<br>
^MClone: 0% done.^MClone: 1% done.^MClone: 2% done.^MClone: 3% 
done.^MClone: 4% done.^MClone: 5% done.^MClone: 6% done.^MClone: 7% 
done.^MClone: 8% done.^MClo.....<br>
2010-02-11 17:44:45 -- info: Removing snapshot from CTX05/CTX05.vmx ...<br>
<br>
You're probably right on the NFS timeout thing, is there a way of 
forcing a longer NFS r/w timeout through the script?
					</p>
				</div>
				<a name="comments-14487"></a>
				<div id="comment-14487" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 11, 2010 10:21 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-31rizY7E669aNH4D" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14478" title="Go to message">sonicpony</a>
							</em>
					</span>
					<p id="comment-body-14487">
					Regarding NFS settings, this is something you'll want to research 
into. This document may help some what on the various advanced NFS 
settings: <a class="jive-link-external" 
href="http://kb.vmware.com/kb/2068707495">http://kb.vmware.com/kb/2068707495</a><br>
<br>
If you do a search on the web, you'll see some vendors such as EMC and 
NetApp have best practices on setting certain values, you may want to 
explore those parameters and see if they help. As you may have seen from
 the dozen or so posts, not everyone experiences this issue, so it must 
be related to the way the NFS server is setup or the NFS software being 
used.<br>
<br>
I would also recommend users to look in their vmkernel/messages logs 
during the backup window to see if there's anything odd, you may see 
something that is clearly an error in which may help resolve the issue. I
 don't think any of the users have really dug into the logs which 
probably will be helpful. <br>
<br>
Sorry that I can't provide further details, much of this will depend on 
the environment that's setup and variety of reasons why users may be 
seeing this problem with tiemouts with their NFS server. We actually 
have an physical NFS Server that we've been using for hosting VMs and 
backups across multiple ESX hosts using my script and we've not had any 
issues. I'll get the specs published when I get a chance and maybe that 
might help guide users, but again this is our setup and is not a 
recommended nor 'ideal' setup as there can be many types of 
configuration and software that would suffice and works.<br>
<br>
Thanks<br>
</p><p>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14479"></a>
				<div id="comment-14479" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2010 11:26 AM
						</span>
							<!--<a href="/people/wlevels" title="Click to view wlevels's profile">
<img class="jive-avatar" src="/people/wlevels/avatar/16.png?a=-1" height="16" width="16" title="Click to view wlevels's profile" alt="Click to view wlevels's profile" />
</a>--><a href="http://communities.vmware.com/people/wlevels" 
id="jive-Wki2iz96i8985Yta" class="jive-username-link" title="Click to 
view wlevels's profile">wlevels</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14479">
					I am having the following problem:<br>
<br>
When I create a back-up of a server using the GhettoVCB script I notice 
the script creates an additional .vmdk for every virtual HDD the VM has.
 The additional .vmdk has a small size, something like 400 kB.<br>
<br>
When I run the GhettoVCB script with compression, the additional .vmdk 
file(s) are gone...When I extract the compressed back-up and try to add 
the VM to my inventory it tells me there's something missing.<br>
<br>
I tried creating an uncompressed back-up, and creating a tarball of the 
uncompressed back-up. I noticed the additional .vmdk that was in the 
uncompressed back-up wasn't added in the tarball. After uncompressing 
the VM and adding the VM to the inventory, the recovered VM can't boot, 
gives me the same message that there's something missing.<br>
<br>
What are the additional .vmdk files that GhettoVCB adds for every 
virtual HDD a VM has when backing up a VM?<br>
<br>
The following are two debug modes, one compressed, one uncompressed.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">2010-02-11 09:47:19 -- info: ============================== ghettoVCB LOG START ==============================

2010-02-11 09:47:19 -- debug: HOST BUILD: VMware ESX Server 3i 3.5.0 build-207095
2010-02-11 09:47:19 -- debug: HOSTNAME: ESXi-Thuis.levels.local

2010-02-11 09:47:19 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/49ba575c-cfd047a1-bf79-001b2133fd80/BACKUPS
2010-02-11 09:47:19 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2010-02-11 09:47:19 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2010-02-11 09:47:19 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-02-11 09:47:19 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 1
2010-02-11 09:47:19 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-02-11 09:47:19 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-02-11 09:47:19 -- info: CONFIG - POWER_DOWN_TIMEOUT = 15
2010-02-11 09:47:19 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-02-11 09:47:19 -- info: CONFIG - LOG_LEVEL = debug
2010-02-11 09:47:19 -- info: CONFIG - BACKUP_LOG_OUTPUT = ./testrun1.log
2010-02-11 09:47:19 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-02-11 09:47:19 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-02-11 09:47:19 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-02-11 09:47:22 -- info: Powering off initiated for DP16-NAGIOS, backup will not begin until VM is off...
2010-02-11 09:47:23 -- info: VM is still on - Iteration: 0 - sleeping for 60secs (Duration: 0 seconds)
2010-02-11 09:48:23 -- info: VM is powerdOff
2010-02-11 09:48:23 -- info: Initiate backup for DP16-NAGIOS
Destination disk format: VMFS thick
Cloning disk '/vmfs/volumes/datastore3(non-RAID)(SATA2)/DP16-NAGIOS/DP16-NAGIOS.vmdk'...
^MClone: 0% done.^MClone: 1% done.^MClone: 2% done.^MClone: 3% done.^MClone: 4% done.^MClone: 5% done.^MClone: 6% done.^MClone: 7% done.^MClone: 8% done.^MClone: 9% done.^MClone: 10% d
2010-02-11 09:51:52 -- info: Powering back on DP16-NAGIOS
2010-02-11 09:51:52 -- info: Compressing VM backup "/vmfs/volumes/49ba575c-cfd047a1-bf79-001b2133fd80/BACKUPS/DP16-NAGIOS/DP16-NAGIOS-2010-02-11.gz"...
2010-02-11 10:05:10 -- info: Backup Duration: 16.78 Minutes
2010-02-11 10:05:10 -- info: Successfully completed backup for DP16-NAGIOS!

2010-02-11 10:05:10 -- info: ============================== ghettoVCB LOG END ================================
</code></pre><br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">2010-02-11 10:32:55 -- info: ============================== ghettoVCB LOG START

2010-02-11 10:32:55 -- debug: HOST BUILD: VMware ESX Server 3i 3.5.0 build-20709
2010-02-11 10:32:55 -- debug: HOSTNAME: ESXi-Thuis.levels.local

2010-02-11 10:32:55 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/49ba575c-
2010-02-11 10:32:55 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2010-02-11 10:32:55 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2010-02-11 10:32:55 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-02-11 10:32:55 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 1
2010-02-11 10:32:55 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-02-11 10:32:55 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-02-11 10:32:55 -- info: CONFIG - POWER_DOWN_TIMEOUT = 15
2010-02-11 10:32:55 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-02-11 10:32:55 -- info: CONFIG - LOG_LEVEL = debug
2010-02-11 10:32:55 -- info: CONFIG - BACKUP_LOG_OUTPUT = ./testrun2.log
2010-02-11 10:32:55 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-02-11 10:32:55 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-02-11 10:32:55 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-02-11 10:32:57 -- info: Powering off initiated for DP16-NAGIOS, backup will
2010-02-11 10:32:58 -- info: VM is still on - Iteration: 0 - sleeping for 60secs
2010-02-11 10:33:58 -- info: VM is powerdOff
2010-02-11 10:33:58 -- info: Initiate backup for DP16-NAGIOS
Destination disk format: VMFS thick
Cloning disk '/vmfs/volumes/datastore3(non-RAID)(SATA2)/DP16-NAGIOS/DP16-NAGIOS.
^MClone: 0% done.^MClone: 1% done.^MClone: 2% done.^MClone: 3% done.^MClone: 4%
2010-02-11 10:37:27 -- info: Powering back on DP16-NAGIOS
2010-02-11 10:37:28 -- info: Backup Duration: 3.50 Minutes
2010-02-11 10:37:28 -- info: Successfully completed backup for DP16-NAGIOS!

2010-02-11 10:37:28 -- info: ============================== ghettoVCB LOG END ==
</code></pre>
					
				</div>
				<a name="comments-14488"></a>
				<div id="comment-14488" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 11, 2010 1:53 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-zpLk1gf7hj0jRXKt" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14479" title="Go to message">wlevels</a>
							</em>
					</span>
					<p id="comment-body-14488">
					Not sure I follow what you're saying. Compressed backups and 
non-compressed backups have the same amount of files, one is <b>compressed</b>
 in a tarball and the other is not, just regular folder.<br>
<br>
What you're referring to the additional "vmdk" are the delta files 
created when a VM is powered On and you're backign up the VM. This goes 
back to understanding the files that make up a VM how the backup 
actually work and how snapshots work, I would highly recommend you take a
 look at this VMware KB regarding snapshots: <a 
class="jive-link-external" href="http://kb.vmware.com/kb/1015180">http://kb.vmware.com/kb/1015180</a>
 and <a class="jive-link-external" 
href="http://virtualisedreality.wordpress.com/2009/09/16/quick-reminder-of-what-files-make-up-a-virtual-machine/">http://virtualisedreality.wordpress.com/2009/09/16/quick-reminder-of-what-files-make-up-a-virtual-machine/</a>
 for understanding the various files that make up a VM<br>
<br>
Here is a high level example that hopefully should clear up any 
confusion you may have:<br>
<br>
If you have a VM with say 2 Hard Disks that would be mapped in the 
filesystem with the following files:<br>
<br>
<b>myvm.vmx</b> - VM's configuration file (only 1 exists)<br>
<b>myvm.vmdk</b> - This is the 1st VM disk descriptor file that decribes
 the type of disk and it's meta data (generally small file)<br>
<b>myvm-flat.vmdk</b> - This is the 1st actual data disk for HD #1 <br>
<b>myvm-1.vmdk</b> This is the 2nd VM disk descriptor<br>
<b>myvm-1-flat.vmdk</b> - This is the 2nd actual data disk <br>
<br>
When you take a snapshot, each of these disks will automatically go into
 a read-only mode, and new delta files generally in the form of 
myvmname-00000#.vmdk and myvmname-00000#-flat.vmdk which is where all 
new writes will go to. This allows you to actually copy the VM's VMDK(s)
 as they're now in RO mode, once the backup has been completed using <b>vmkfstools</b>,
 then you delete the snapshot and the deltas which contain all the 
changes during the period of the backup is <u>merged</u> back into the 
base VM and the delta disks are then discarded. <br>
<br>
So these 'extra' VMDKs are due to the snapshots taking place, if you 
have a powered off machine, then this is not necessary as the disk are 
available and not locked for read access. <br>
<br>
Regarding your extract methods, please take a look at a few posts back 
referring to the method of extraction if you plan on doing it yourself. 
Note, that when you restore a VM, depending on the original location of 
the VM and it's disks, you may or may not need to do some modification 
before just "adding" it back to the inventory. Hence I suggest using the
 restore script for <b>non-compressed</b> backups as it'll make the 
appropriate changes to the .vmx file to properly re-register the VM. <br>
<br>
Hopefully this makes a little more sense and the two links above should 
further clarify. <br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14461"></a>
				<div id="comment-14461" class="jive-content-comment ">
					<span>
						<span>
							Feb 11, 2010 2:49 PM
						</span>
							<!--<a href="/people/wlevels" title="Click to view wlevels's profile">
<img class="jive-avatar" src="/people/wlevels/avatar/16.png?a=-1" height="16" width="16" title="Click to view wlevels's profile" alt="Click to view wlevels's profile" />
</a>--><a href="http://communities.vmware.com/people/wlevels" 
id="jive-OeVd34HWYCNVSeoB" class="jive-username-link" title="Click to 
view wlevels's profile">wlevels</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14488" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14461">
					Thanks for your reply. I did learn what the small files are using 
your link for understanding the different files. <br>
<br>
What I meant were the disk descriptors. When I create an uncompressed 
back-up using the script, the disk descriptors are available in the 
back-up, when I create a compressed back-up (or when i create a tarball 
of the uncompressed back-up) the disk descriptors are missing. <br>
<br>
Will check if I find the post where manual recovery is explained, 
however did some searches and couldn't find anything yet.<br>
<br>
Thanks!
					</p>
				</div>
				<a name="comments-14482"></a>
				<div id="comment-14482" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 12, 2010 7:05 AM
						</span>
							<!--<a href="/people/Vitelma" title="Click to view Vitelma's profile">
<img class="jive-avatar" src="/people/Vitelma/avatar/16.png?a=-1" height="16" width="16" title="Click to view Vitelma's profile" alt="Click to view Vitelma's profile" />
</a>--><a href="http://communities.vmware.com/people/Vitelma" 
id="jive-o4l0IY531l1rv5Gz" class="jive-username-link" title="Click to 
view Vitelma's profile">Vitelma</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-11793" title="Go to message">maweko</a>
							</em>
					</span>
					<p id="comment-body-14482">
					Hi Maweko,<br>
<br>
did you find a solution for this? i can't find the process either..<br>
how can we kill or stop the backup process (and manually delete the 
snapshot afterwards)<br>
<br>
thx
					</p>
				</div>
				<a name="comments-14493"></a>
				<div id="comment-14493" class="jive-content-comment ">
					<span>
						<span>
							Feb 13, 2010 9:08 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-lkuoDqIDy7cGwb5P" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-14493">
					Hi everyone,<br>
<br>
I've just updated the VMTN document with few new FAQ's, take a look if 
you're interested and hopefully it'll help those that are new to the 
script.<br>
<br>
I know there are a few of you still experiencing the NFS issue during 
the rotation of the previous backups. I've included a new section that 
describes the problem, but I've also included our current NFS 
configuration ( disclaimer: these are not recommendations but our 
personal setup) and few additional things you could try or troubleshoot 
when you run into this problem. <br>
<br>
One thing I would like to see from the users that are running into these
 problems is to verify what you have configured for your NFS exports, 
has anyone correlated any specific events in the ESX logs during the 
time of rotation and has anyone looked at the performance of their NFS 
server during this removal process? <br>
<br>
Thanks for everyone's support and patience. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14468"></a>
				<div id="comment-14468" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 15, 2010 10:14 PM
						</span>
							<!--<a href="/people/michaelbrandi" title="Click to view michaelbrandi's profile">
<img class="jive-avatar" src="/people/michaelbrandi/avatar/16.png?a=-1" height="16" width="16" title="Click to view michaelbrandi's profile" alt="Click to view michaelbrandi's profile" />
</a>--><a href="http://communities.vmware.com/people/michaelbrandi" 
id="jive-8ibcNTb13vNe0SWM" class="jive-username-link" title="Click to 
view michaelbrandi's profile">michaelbrandi</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14468">
					How do you safely and correctly abort a running backup?
					</p>
				</div>
				<a name="comments-14530"></a>
				<div id="comment-14530" class="jive-content-comment ">
					<span>
						<span>
							Feb 16, 2010 6:40 AM
						</span>
							<!--<a href="/people/buekkes" title="Click to view buekkes's profile">
<img class="jive-avatar" src="/people/buekkes/avatar/16.png?a=-1" height="16" width="16" title="Click to view buekkes's profile" alt="Click to view buekkes's profile" />
</a>--><a href="http://communities.vmware.com/people/buekkes" 
id="jive-c4t5boiRiDejglQp" class="jive-username-link" title="Click to 
view buekkes's profile">buekkes</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14530">
					We're going to apply this (very useful!) script to backup snapshot 
on a nfs share provided from a small linux box. However, nfs doesn't 
cover encryption and -- at least to be my best knowledge -- ESXi 4.0 
isn't able to setup an encrypted tunnel. Furthermore we'd like to avoid 
storing the snapshots on the local harddisks first and transfer their 
copies via an encrypted connection to somewhere else.<br>
<br>
Thus, we have to accept the resource usage needed to encrypt the 
snapshots before sending them over a clear connection. Before trying to 
incorporate this approach: Did I miss any other possibility to achieve 
higher security while storing/transferring the snapshots? Otherwise, I'd
 like to extend the line<br>
<br>
busybox tar -cz -C "${BACKUP_DIR}" 
"${VM_NAME}-${VM_BACKUP_DIR_NAMING_CONVENTION}" -f 
"${BACKUP_DIR}/${VM_NAME}-${VM_BACKUP_DIR_NAMING_CONVENTION}.gz"<br>
<br>
to pipe the archive through openssl, which is available at the ESXi 
console, before writing it to disk. Is there any reason not to do this?
					</p>
				</div>
				<a name="comments-14516"></a>
				<div id="comment-14516" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 16, 2010 9:21 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ILEH30yL4Gooe5Js" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14468" title="Go to message">michaelbrandi</a>
							</em>
					</span>
					<p id="comment-body-14516">
					The easy answer, ctrl+c and stop the script. If it's running as a 
background process, you'll need to search for it's PID and kill it. 
Depending on where you stop the script, it may or may not be clean but 
there are no official ways of cleanly stopping the script. I would 
ensure that you do sufficient testing prior to running this on any live 
production or important VMs to ensure you've covered all basis. <br>
<br>
Let me know if you have further questions<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14517"></a>
				<div id="comment-14517" class="jive-content-comment ">
					<span>
						<span>
							Feb 16, 2010 9:27 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8IYvARcON6zS4dOy" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14530" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14517">
					You mentioned backing up snapshots, wanted to make sure you were 
clear, that this script DOES NOT backup snapshots. It utilizes snapshots
 to allow backing up live running VMs, though the script backs up the 
entire VM and depending on the format you may be backing up all it's 
"configured" storage or just what's been used such as thin provisioned 
disks. Take a look at FAQ #23 for more detail information about 
snapshots and how they work.<br>
<br>
Now, regarding your question about encrypting the backup. I haven't dug 
around on the classic ESX Service Console or on ESXi to see if there are
 any utilities for encryption, as you mentioned, you might be able to 
utilize openssl and pipe it through before transport. You would need to 
do some investigation at this level and you may be able to integrate it 
into the script and preferably before transport. <br>
<br>
Reasons not to do this ... well first off as you mentioned, there will 
be some resource overhead when doing this but probably also a 
potentially performance hit on the host along with this overhead and a 
longer duration of backup. Again, this is something you would want to 
test with a standard backup and then one with 'encrypted' method to see 
the cost and also how it'll affect your host. The nice thing about the 
script is, the backups are done one at a time, so you should be able to 
calculate how much time/etc. <br>
<br>
Let me know your findings and perhaps this can be a potential feature in
 feature release if there is an interest in this.<br>
<br>
Thanks <br>
</p><p>
Edit: Here are a few links that may be of use<br>
<a class="jive-link-external" 
href="http://www.dslreports.com/shownews/Encrypt-files-quickly-with-OpenSSL-87586">http://www.dslreports.com/shownews/Encrypt-files-quickly-with-OpenSSL-87586</a><br>
<a class="jive-link-external" 
href="http://snippets.dzone.com/posts/show/2745">http://snippets.dzone.com/posts/show/2745</a><br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14503"></a>
				<div id="comment-14503" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 16, 2010 2:22 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-TN4Q351es4Hr1zEM" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14530" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14503">
					There are ways to get rsync running on esxi though i have not done 
it myself<br>
This will provide encrypted tunnel transfer via ssh<br>
From my experience the performance hit and extra time taken by tarring 
will find you looking for alternatives 
					</p>
				</div>
				<a name="comments-14519"></a>
				<div id="comment-14519" class="jive-content-comment ">
					<span>
						<span>
							Feb 16, 2010 2:46 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-107c70802k3zWv5C" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14503" title="Go to message">scowse</a>
							</em>
					</span>
					<p id="comment-body-14519">
					I've heard some individuals getting rsync to work as well, but I've
 not sure how well it works. I also know there was a thread awhile back 
regarding rsync and vSphere ESXi 4.0, not sure if someone has that 
working since there were some changes made to busybox console from 3.5 
to 4.0.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14533"></a>
				<div id="comment-14533" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 17, 2010 6:07 AM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-Dlot6Hu7w32m9rhY" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14533">
					Quick question.  I have gotten a couple vm's back by simply adding 
the machine to the inventory from the nfs backup location and running 
it.  Is this ok to do?  My reasoning is that it wouldn't be tons of vm's
 that I would run on the NFS and I have 20 drives behind it to service 
the IO load.  Instead of a restore could I just migrate the files to the
 SAN when it returns?
					</p>
				</div>
				<a name="comments-14523"></a>
				<div id="comment-14523" class="jive-content-comment ">
					<span>
						<span>
							Feb 17, 2010 9:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-zXw3nc67DYMCptC2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14533" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14523">
					Yes, you can do that and it would work perfectly fine. I personally
 don't recommend that, unless it's a last resort, since you're basically
 using your backups as 'live' systems. If you can, restore the backups 
to a new volume and then register those VMs, that way you still have 
pristine copies of your backups. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14535"></a>
				<div id="comment-14535" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2010 5:17 AM
						</span>
							<!--<a href="/people/devzero" title="Click to view devzero's profile">
<img class="jive-avatar" src="/people/devzero/avatar/16.png?a=-1" height="16" width="16" title="Click to view devzero's profile" alt="Click to view devzero's profile" />
</a>--><a href="http://communities.vmware.com/people/devzero" 
id="jive-7rv27b0KKXk24H7e" class="jive-username-link" title="Click to 
view devzero's profile">devzero</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12477" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-14535">
					</p><div class="jive-quote">22.09.2009 05:59 Antwort chayawatv  
sagt: <br>
I try to use this scipt to do backup with compression enabled.<br>
Howerver, I cannot uncompress "filename".gz as it show "tar: Invalid tar
 magic".<br>
<p>
Currently, I use ESX 3.5i U4 free edition and backup it to local drive 
of ESX server itself.<br>
</p><p>
Any thought about the issue?<br>
</p><p>
Thank you</p></div>
<br>
busybox v1.2.1 has a bug and this is the whole problem. so ghettovcb on 
esx3i with compression=on is BROKEN <img src="DOC-8760_files/a.htm" 
alt="!" class="jive-image"><br>
( <a class="jive-link-external" 
href="http://communities.vmware.com/message/1122064">http://communities.vmware.com/message/1122064</a>
 / <a class="jive-link-external" 
href="https://bugs.maemo.org/show_bug.cgi?id=3033">https://bugs.maemo.org/show_bug.cgi?id=3033</a>
 )<br>
<br>
solution:<br>
add busybox from esx4i to esx3i box and change ghettovcb appropriately 
to use that one for tar and gzip.<br>
alternative: don`t use compression<br>
<br>
i wonder that this thread has more than 700 comments but this is found 
that late - nobody using compression or test restore of their (probably 
corrupted) backups ?
					
				</div>
				<a name="comments-14524"></a>
				<div id="comment-14524" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2010 6:12 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-6Jed5892TCJ7DHbt" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14524">
					Hi lamw,<br>
I have problem with backup of vmdk stored across multiple datastores 
when I use individual configuration.<br>
My virtual machine akord-pro have this files:<br>
</p><ul class="jive-dash">
<li>akord-pro.vmx          on datastore raid1 (main configuration)</li>
<li>akord-pro.vmdk        on datastore raid1</li>
<li>akord-pro_1.vmdk    on datastore raid1</li>
<li>akord-pro_2.vmdk    on datastore raid5</li>
<li>akord-pro_3.vmdk    on datastore next1</li>
<li>akord-pro_4.vmdk    on datastore next1</li>
</ul>
I need backup only first three vmdk, i.e.: akord-pro, akord-pro_1 and 
akord-pro_2<br>
However script backup only vmdks from datastore raid1, no vmdk from next
 datastore (akord-pro_2)<br>
I think that it is because of script searches akord-pro_2.vmdk including
 full path but in configuration file is akord-pro_2.vmdk defined without
 full path.<br>
Am I right?<br>
<br>
Output from running ghettoVCB script:<br>
...<br>
2010-02-07 12:06:14 -- debug: HOST BUILD: VMware ESX 4.0.0 build-208167<br>
2010-02-07 12:06:14 -- debug: HOSTNAME: vma.domain.cz<br>
<br>
2010-02-07 12:06:15 -- info: CONFIG - USING CONFIGURATION FILE = 
./akord-pro<br>
2010-02-07 12:06:15 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/nfs172v1/_backup<br>
2010-02-07 12:06:15 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-02-07 12:06:15 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-02-07 12:06:15 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-02-07 12:06:15 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-02-07 12:06:15 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-02-07 12:06:15 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4<br>
2010-02-07 12:06:15 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-02-07 12:06:15 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-02-07 12:06:15 -- info: CONFIG - LOG_LEVEL = debug<br>
2010-02-07 12:06:15 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-02-07 12:06:15 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-02-07 12:06:15 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-02-07 12:06:15 -- info: CONFIG - VMDK_FILES_TO_BACKUP = 
akord-pro.vmdk,akord-pro_1.vmdk,akord-pro_2.vmdk<br>
<br>
2010-02-07 12:06:16 -- info: Initiate backup for akord-pro<br>
2010-02-07 12:06:16 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-02-07" for akord-pro<br>
2010-02-07 12:06:16 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-02-07" to be created<br>
2010-02-07 12:06:16 -- debug: Snapshot timeout set to: 900 seconds<br>
2010-02-07 12:06:17 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 0 - sleeping for 60secs (Duration: 0 seconds)<br>
2010-02-07 12:07:18 -- debug: findVMDK() - Searching for VMDK: 
"/vmfs/volumes/4a574526-5eb4fd94-375a-001517b9527d/akord-pro/akord-pro_3.vmdk"
 to backup<br>
2010-02-07 12:07:18 -- debug: findVMDK() - Searching for VMDK: 
"/vmfs/volumes/4a574526-5eb4fd94-375a-001517b9527d/akord-pro/akord-pro_4.vmdk"
 to backup<br>
2010-02-07 12:07:18 -- debug: findVMDK() - Searching for VMDK: 
"/vmfs/volumes/4a2fa88f-cc11effe-5c89-001517b9527d/akord-pro/akord-pro_2.vmdk"
 to backup<br>
2010-02-07 12:07:18 -- debug: findVMDK() - Searching for VMDK: 
"akord-pro_1.vmdk" to backup<br>
2010-02-07 12:07:18 -- debug: findVMDK() - Found VMDK! - 
"akord-pro_1.vmdk" to backup<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/raid1/akord-pro/akord-pro_1.vmdk'...<br>
Clone: 100% done.<br>
2010-02-07 12:27:03 -- debug: findVMDK() - Searching for VMDK: 
"akord-pro.vmdk" to backup<br>
2010-02-07 12:27:03 -- debug: findVMDK() - Found VMDK! - 
"akord-pro.vmdk" to backup<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/raid1/akord-pro/akord-pro.vmdk'...<br>
Clone: 100% done.<br>
2010-02-07 12:35:53 -- info: Removing snapshot from akord-pro ...<br>
2010-02-07 12:36:05 -- info: Backup Duration: 29.82 Minutes<br>
2010-02-07 12:36:05 -- info: Successfully completed backup for 
akord-pro!<br>
...<br>
<br>
Thank you for reaction or tip how to do that right.
					
				</div>
				<a name="comments-14536"></a>
				<div id="comment-14536" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2010 8:30 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-uhm06F5ORIh29X28" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14524" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-14536">
					Hi,<br>
<br>
Your assumptions are correct, the way the script figures out whether a 
VMDK is stored locally with the .vmx configuration file OR if it's 
hosted on another datastore is by looking at the path defined in the 
.vmx file. By default, if it's a relative path aka "myvmdk.vmdk", it 
means the VMDK is being stored locally in the datastore along with the 
.vmx configuration file. If it has an absolute path, then the VMDK is 
being stored in another datastore other than the default. You may want 
to double check that in fact your VM has all VMDKs currently mounted and
 that the .vmx file reflects these changes appropriately, in case you 
manually edited the file. <br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14525"></a>
				<div id="comment-14525" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2010 8:35 AM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-N8d5NVTzF8yzwD80" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14525">
					Urgent question!  I just noticed that on virtual machines that have
 more than one disk the following happens:<br>
<br>
The script correctly backs all the vmdks up.  When I register the 
machine directly from the backup folder the first disk is correctly on 
the backup device, but the second disk is being pointed to the original 
datastore and not the new location...<br>
<br>
So as an example.  I have a machine called fdn003.  After the backup, I 
go to the folder fdn003-2010-02-17--1.  In that folder I see the vmx 
file, the first vmdk file.  I then see a directory composed of 
characters, these characters seem to spell out the code for the 
datastore when I run a vdf command.  Why is it doing this, shouldnt all 
the disks be in one directory and the vmx updated?  Please help.
					</p>
				</div>
				<a name="comments-14537"></a>
				<div id="comment-14537" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2010 9:14 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9Sg8iDtIzX5ebtb7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14525" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14537">
					soleblazer,<br>
<br>
Ah, yes for the case of VMs with VMDKs that were dispersed across 
multiple datastores, due to the way VMware defaults the name, the only 
way to keep track of these was to create a directory structure that maps
 the original datastore UUID, that is the characters you're referring 
to. To accommodate this if you want to register and run the VM from the 
backup datastore, you just need to go into the VM's settings and 
basically locate the disks and re-point them to backup datastore since 
the .vmx file will contain the original configurations.<br>
<br>
If you use the restore script, this should be handled for you 
automatically, by default the recommendation is to restore the backup to
 a different datastore and the script will handle the registration of 
the disks.<br>
<br>
Hopefully this makes sense<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14509"></a>
				<div id="comment-14509" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2010 10:21 AM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-0P7JTf7WWfBdvpeT" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14537" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14509">
					William,<br>
<br>
That makes sense.  So on the vm's that have multiple drives I would need
 to do this:<br>
<br>
Add the vm to the inventory<br>
Remove the disk that is pointing to the original datastore<br>
Add a new disk using the path that your script uses<br>
<br>
Is that it?
					</p>
				</div>
				<a name="comments-14539"></a>
				<div id="comment-14539" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 18, 2010 10:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-q4iHV9l496QUG0Me" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14509" title="Go to message">soleblazer</a>
							</em>
					</span>
					<p id="comment-body-14539">
					That is correct, just do a 'remove' which is just a pointer but 
don't delete from disk, especially if you have the VM still running else
 it potentially can delete the actual disks from under the VM. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Comuunity</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14541"></a>
				<div id="comment-14541" class="jive-content-comment ">
					<span>
						<span>
							Feb 18, 2010 12:49 PM
						</span>
							<!--<a href="/people/soleblazer" title="Click to view soleblazer's profile">
<img class="jive-avatar" src="/people/soleblazer/avatar/16.png?a=-1" height="16" width="16" title="Click to view soleblazer's profile" alt="Click to view soleblazer's profile" />
</a>--><a href="http://communities.vmware.com/people/soleblazer" 
id="jive-Ml7LfHJ9S7B3m4CT" class="jive-username-link" title="Click to 
view soleblazer's profile">soleblazer</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14539" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14541">
					Thanks alot.  I tested it out and it works fine.  I am doing san 
maintenance this weekend and I'm simply trying to be able to survive if 
the SAN should somehow get erased.  I really appreciate your help and 
script!
					</p>
				</div>
				<a name="comments-14529"></a>
				<div id="comment-14529" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 19, 2010 3:17 AM
						</span>
							<!--<a href="/people/lacikaaa" title="Click to view lacikaaa's profile">
<img class="jive-avatar" src="/people/lacikaaa/avatar/16.png?a=-1" height="16" width="16" title="Click to view lacikaaa's profile" alt="Click to view lacikaaa's profile" />
</a>--><a href="http://communities.vmware.com/people/lacikaaa" 
id="jive-MPXPAK771BLa2Y6y" class="jive-username-link" title="Click to 
view lacikaaa's profile">lacikaaa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14448" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14529">
					I tried removing them. If i run manually the script from shell, 
then it works fine, but when it is started from cron with the same 
arguments, configs, everything, then only one backup left / vm, and it 
is the second after 2 running. I havent modified the script and the 
parameters are the same, this is the only difference. Any idea?<br>
In the logs it looks like everything is ok, there isnt any extra info 
compared to other logs which are from manual runnings.<br>
<br>
Thank you!
					</p>
				</div>
				<a name="comments-14576"></a>
				<div id="comment-14576" class="jive-content-comment ">
					<span>
						<span>
							Feb 22, 2010 9:12 AM
						</span>
							<!--<a href="/people/buekkes" title="Click to view buekkes's profile">
<img class="jive-avatar" src="/people/buekkes/avatar/16.png?a=-1" height="16" width="16" title="Click to view buekkes's profile" alt="Click to view buekkes's profile" />
</a>--><a href="http://communities.vmware.com/people/buekkes" 
id="jive-KKwFXqq91Hc6BkGi" class="jive-username-link" title="Click to 
view buekkes's profile">buekkes</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14519" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14576">
					Considering your remarks on encryption and (unnecessary) load, I 
tried to figure out an alternative approach, but I didn't work out 
completely, yet.<br>
<br>
On the remote box (IP replaced by 1.2.3.4) I exported<br>
<br>
/home/export/eq6/gotthard 1.2.3.4(rw,async,all_squash,sync,insecure)<br>
<br>
with "insecure" required on Debian Lenny. The ports of rpc.statd, lockd 
and rpc.mountd are statically bound to 2231, 2232 and 2233. "rpcinfo -p"
 confirms their ports and "exportfs -a" confirms the existance of the 
exported directory.<br>
<br>
On the ESXi I establish tunneling of two ports:<br>
<br>
dbclient -i .ssh/key_for_nfs -L 2049:1.2.3.4:2049 sleeper@1.2.3.4 sleep 
10m<br>
dbclient -i .ssh/key_for_nfs -L 2233:1.2.3.4:2233 sleeper@1.2.3.4 sleep 
10m<br>
<br>
My assumption was, that I should be able to mount the nfs-directory by 
means of vSphere Client now. Nonetheless, any attempt to do this (host: 
127.0.0.1 or external IP of ESXi, directory: /home/export/eq6/gotthard) 
is in vain. After refreshing the list, the gui tells me, that the NFS 
server can't be found. Unfortunately, all documentation on the way of 
ESXi's nfs-mapping doesn't tell something on the required ports. Has 
anybody an idea?
					</p>
				</div>
				<a name="comments-14554"></a>
				<div id="comment-14554" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 22, 2010 10:16 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-aV45II0F0K8aKyjO" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14576" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14554">
					Take a look at the vmkernel logs on why it's failing to mount the 
NFS server. You can also use <b>vmkping</b> to ensure you can ping your 
NFS server. The requirements for ESXi to mount an NFS datastore is 
pretty trivial, so long as you have a valid VMkernel interface that 
communicate to your NFS server, you should be able to mount it, assuming
 permissions on the NFS server is correct. <br>
<br>
Can you mount this volume using another hosts that's not ESXi?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14578"></a>
				<div id="comment-14578" class="jive-content-comment ">
					<span>
						<span>
							Feb 22, 2010 11:27 AM
						</span>
							<!--<a href="/people/buekkes" title="Click to view buekkes's profile">
<img class="jive-avatar" src="/people/buekkes/avatar/16.png?a=-1" height="16" width="16" title="Click to view buekkes's profile" alt="Click to view buekkes's profile" />
</a>--><a href="http://communities.vmware.com/people/buekkes" 
id="jive-5GL7r65h3RaE6x1e" class="jive-username-link" title="Click to 
view buekkes's profile">buekkes</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14554" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14578">
					Yes, mounting the NFS datastore directly from ESXi (without any 
tunnel) works fine.<br>
<br>
The logfiles (ESXi's IP replaced by 5.6.7.8) contain the following 
lines:<br>
<br>
Feb 22 19:19:18 vmkernel: 83:01:05:03.352 cpu5:9855)WARNING: NFS: 898: 
RPC error 13 (RPC was aborted due to timeout) trying to get port for 
Mount Program (100005) Version (3) Protocol (TCP) on Server (5.6.7.8)<br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.934 14AC4B90 error 
'FSVolumeProvider'</strike> VmkCtl mount or ProcessNas failed: NFS 
Error: Unable to Mount filesystem: Unable to connect to NFS server<br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.942 14AC4B90 info 
'App'</strike> AdapterServer caught exception: 
vim.fault.PlatformConfigFault<br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.942 14AC4B90 info 
'TaskManager'</strike> Task Completed : 
haTask-ha-host-vim.host.DatastoreSystem.createNasDatastore-11884 Status 
error<br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.942 14AC4B90 info 
'Vmomi'</strike> Activation <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=N5Vmomi10ActivationE%3A0x5a922fa8">N5Vmomi10ActivationE:0x5a922fa8</a>
 : Invoke done <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=createNasDatastore">createNasDatastore</a>
 on <strike>vim.host.DatastoreSystem:ha-datastoresystem</strike><br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.943 14AC4B90 verbose 
'Vmomi'</strike> Arg spec:<br>
Feb 22 19:19:18 Hostd: (vim.host.NasVolume.Specification) {    
dynamicType = &lt;unset&gt;,     remoteHost = "5.6.7.8",     remotePath =
 "/home/export/eq6/gotthard",     localPath = "test",     accessMode = 
"readWrite",     type = &lt;unset&gt;,     userN<br>
Feb 22 19:19:18 ame = &lt;unset&gt;,     password = &lt;unset&gt;,  }<br>
Feb 22 19:19:18 Hostd: <br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.943 14AC4B90 info 
'Vmomi'</strike> Throw vim.fault.PlatformConfigFault<br>
Feb 22 19:19:18 Hostd: <strike>2010-02-22 19:19:18.943 14AC4B90 info 
'Vmomi'</strike> Result:<br>
Feb 22 19:19:18 Hostd: (vim.fault.PlatformConfigFault) {    dynamicType =
 &lt;unset&gt;,     faultCause = (vmodl.MethodFault) null,     text = 
"NFS Error: Unable to Mount filesystem: Unable to connect to NFS 
server",     msg = "",  }<br>
<br>
Right now, I haven't found any clue on "RPC error 13 (RPC was aborted 
due to timeout) trying to get port for Mount Program (100005) Version 
(3) Protocol (TCP) on Server (5.6.7.8)"
					</p>
				</div>
				<a name="comments-14555"></a>
				<div id="comment-14555" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 22, 2010 11:36 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-hzdY1msM8197ANK2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14578" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14555">
					Yea, the tunnel probably is doing something odd to the way ESXi 
tries to mount up the NFS datastore using it's defaults. Remember, this 
is a very limited environment, you may or may not be able to get this 
working. You could try having a poke around /etc/services and perhaps 
tweak some entries on which ports NFS can be mounted on.  Try at your 
own risk and definitely on a test system.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14566"></a>
				<div id="comment-14566" class="jive-content-comment ">
					<span>
						<span>
							Feb 23, 2010 3:15 AM
						</span>
							<!--<a href="/people/buekkes" title="Click to view buekkes's profile">
<img class="jive-avatar" src="/people/buekkes/avatar/16.png?a=-1" height="16" width="16" title="Click to view buekkes's profile" alt="Click to view buekkes's profile" />
</a>--><a href="http://communities.vmware.com/people/buekkes" 
id="jive-Cdkm1Fvwq6xBDzcH" class="jive-username-link" title="Click to 
view buekkes's profile">buekkes</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14555" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14566">
					It works: Beside ports 2049 (nfs) and 2233 (mountd) also 
portmapper's 111 has to be tunneled to the ESXi. On the ESXi the host 
127.0.0.1 has to be used, while on the machine offering nfs-services its
 external IP is required (as written above).<br>
<br>
And now let's integrate the stuff into your script <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";-)" border="0">
					</p>
				</div>
				<a name="comments-14557"></a>
				<div id="comment-14557" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 23, 2010 3:57 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-xUpH6UW63Bcq5O7D" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14447" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14557">
					Iâ€™m experiencing some strange behavior running the script from cron
 on an ESXi4 U1 server backing up to an NFS store (CentOS 4.8). <br>
Iâ€™m starting the script from another script file that I have scheduled 
in crontab.<br>
This extra script does nothing special; it just starts the ghetto script
 and creates a new file at the end. This new file I use to trigger an 
email message from the CentOS NFS server.<br>
Last nightâ€™s run stopped after two VMâ€™s were backuped. On the second VM 
there was still a â€œConsolidate Helperâ€ snapshot active. This snapshot 
was not shown trough the vSphere client. To remove the residual snapshot
 I had to create a new snapshot and after that I could delete all 
snapshots again. At this point the script continued its work backing up 
the next VMâ€™s. After a while I got an email with the log file but 
looking at the log file the script had not jet finished. The last line 
on the backup log was Clone: 71% done.<br>
But somehow the script had finished because the email trigger file got 
created.<br>
A few minutes later I got another email message with another part of the
 backup log.<br>
So the script finished again! Looks like some how two instances of the 
script were running at the same time. But how can that be and how would 
that be possible? Checking with â€œps aux | grep crondâ€ I see only on cron
 deamon running. And earlier manual runs of the script finished just 
fine. <br>
Iâ€™ll will restart the server today and see how things workout tonight.
					</p>
				</div>
				<a name="comments-14559"></a>
				<div id="comment-14559" class="jive-content-comment ">
					<span>
						<span>
							Feb 23, 2010 10:40 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-56I5ncXwDqsd7m9X" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14566" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14559">
					Interesting, well if you get it all working, I wouldn't mind 
posting a set of instructions for your configuration for others that may
 be interested.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14590"></a>
				<div id="comment-14590" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 23, 2010 10:43 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-rnf8o6yP0r0y09t4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14557" title="Go to message">wobbe98</a>
							</em>
					</span>
					<p id="comment-body-14590">
					I would double check your kickoff script or your cron entry, the 
script will always have 1 instance running unless another is kicked off.
 You can probably easily view this by looking in your cron logs under 
/var/log/cron and see when <b>ghettoVCB</b> was kicked off and see if 
you some how got another instance running. <br>
<br>
I'm considering in a future release of the script to output a lock file,
 but I'm still thinking about that, since there may be users wanting to 
have more than once instance running. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14605"></a>
				<div id="comment-14605" class="jive-content-comment ">
					<span>
						<span>
							Feb 24, 2010 1:14 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-QNnY453e02RoMtF0" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14590" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14605">
					Another night another failure, this time if failed on the first VM 
and again on the second. (didn't get to restart the sever)<br>
<br>
My kick off script is no more then two line. Not much can go worng 
there. I ran it tree times yesterday without any problems. <br>
<br>
/vmfs/volumes/NLJRSR63/vcb/srv32/ghettoVCB.sh -f 
/vmfs/volumes/NLJRSR63/vcb/srv32/vmserver.list -l 
/vmfs/volumes/NLJRSR63/vcb/srv32/backup.log<br>
touch /vmfs/volumes/NLJRSR63/vcb/srv32/backupdone<br>
<br>
My crontab entry,<br>
<br>
00 23 * * 0-6 /vmfs/volumes/NLJRSR63/vcb/srv32/backup.sh<br>
<br>
btw. I don't see any cron logs under /var/log<br>
<br>
also strange: I know the script is running but cant find it with ps.
					</p>
				</div>
				<a name="comments-14620"></a>
				<div id="comment-14620" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 24, 2010 8:38 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-mPHPrAhY0DAdPB83" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14605" title="Go to message">wobbe98</a>
							</em>
					</span>
					<p id="comment-body-14620">
					Can you manually run the backup without using the cron job? Are you
 able to successfully and repeatably backup VMs through a manual 
execution? If you do run a manual or automated, can you also enable 
logging to <b>debug</b> level and save the output file to : <a 
class="jive-link-external" href="http://pastebin.com/">http://pastebin.com/</a>
 and just reply back with the link. Without any logs, I can't tell 
exactly what's happening if the backups are even attempted or if there 
is something that's causing these VMs to not backup. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14635"></a>
				<div id="comment-14635" class="jive-content-comment ">
					<span>
						<span>
							Feb 24, 2010 8:43 AM
						</span>
							<!--<a href="/people/sfang" title="Click to view sfang's profile">
<img class="jive-avatar" src="/people/sfang/avatar/16.png?a=-1" height="16" width="16" title="Click to view sfang's profile" alt="Click to view sfang's profile" />
</a>--><a href="http://communities.vmware.com/people/sfang" 
id="jive-PgD7fS40PCqa2N92" class="jive-username-link" title="Click to 
view sfang's profile">sfang</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14605" title="Go to message">wobbe98</a>
							</em>
					</span>
					<p id="comment-body-14635">
					Hi everybody,<br>
<br>
My needed : I would like to backup all the vms one time by week.<br>
<br>
Just one question about this script please. I've modified it and excute 
on my esxi 4.0 host. It working fine but it has just backup the vmx file
 (which is the configuration file). It's not complete for me to 
restaure. I have thinked that we can backup all the global vm file. It's
 possible please, may be to change some setting in the script but I have
 not found.<br>
<br>
thanks for your reply,<br>
/FrÃ©dÃ©ric
					</p>
				</div>
				<a name="comments-14621"></a>
				<div id="comment-14621" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 24, 2010 9:15 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-la9z8Gm3RXhHgiNF" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14635" title="Go to message">sfang</a>
							</em>
					</span>
					<p id="comment-body-14621">
					For setting up backup schedule, please take a look at the Cron FAQ 
section.<br>
<br>
The script by default will backup your VM configuration file (.vmx) and 
all relevant and valid VMDKs (*.vmdk and *-flat.vmdk). If it's only 
backing up the .vmx file, then there is something wrong and you need to 
take a look at the logs to see what might be going on.  I would also 
recommend enabling debug mode to get more verbosity in the logs, please 
take a look at FAQ #1 for any issues with the script.<br>
<br>
Thanks<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14637"></a>
				<div id="comment-14637" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 1:47 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-Hbsu3DbPfOpcrMrn" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14620" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14637">
					Manually the backup runs fine.<br>
But running fron cron it look like snapshot won't be removed.<br>
Today it failed again. I manually removed the snapshot and the script 
continued.<br>
But it's now haning again on the second VM.<br>
(I also noticed that the backup files of the first VM were stored under a
 previous backup folder. Is this done by design when there are more that
 one backups in a day?)<br>
<br>
<a class="jive-link-external" href="http://pastebin.com/rzMcfuNE">http://pastebin.com/rzMcfuNE</a>
					</p>
				</div>
				<a name="comments-14638"></a>
				<div id="comment-14638" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 4:08 AM
						</span>
							<!--<a href="/people/lacikaaa" title="Click to view lacikaaa's profile">
<img class="jive-avatar" src="/people/lacikaaa/avatar/16.png?a=-1" height="16" width="16" title="Click to view lacikaaa's profile" alt="Click to view lacikaaa's profile" />
</a>--><a href="http://communities.vmware.com/people/lacikaaa" 
id="jive-MHu7hIqyfoog95HG" class="jive-username-link" title="Click to 
view lacikaaa's profile">lacikaaa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14448" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14638">
					Hi!<br>
<br>
The solution was that I turned on loggin with "-l". So instead of 
running like this:<br>
0 0 * * 1-5 ghettoVCB.sh -f backuplist -c config &gt; 
ghettoVCB-backup-$(date +\%s).log<br>
i did this:<br>
0 0 * * 1-5 ghettoVCB.sh -f backuplist -c config -l  
ghettoVCB-backup-$(date +\%s).log &gt; /dev/null 2&gt;&amp;1
					</p>
				</div>
				<a name="comments-14609"></a>
				<div id="comment-14609" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 7:58 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-fU33LI24Ax53XOHd" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14638" title="Go to message">lacikaaa</a>
							</em>
					</span>
					<p id="comment-body-14609">
					Thanks for the tip. That seems to help a lot. I've just completed a
 backup run from cron without a problem.
					</p>
				</div>
				<a name="comments-14639"></a>
				<div id="comment-14639" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 7:59 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-Ly2QMgew3O4pwJJn" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14639">
					I feel almost lame staking this claim, but the attached and 
presumably authoritative version of ghettoVCB.sh apparently has DOS 
line-endings. No matter where and with what http client I download. E.g.
 using GNU wget 1.10.2 on a Linux box:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">% wget http://communities.vmware.com/servlet/JiveServlet/download/8760-49-32036/ghettoVCB.sh
--16:49:02--  http://communities.vmware.com/servlet/JiveServlet/download/8760-49-32036/ghettoVCB.sh
           =&gt; `ghettoVCB.sh'
Resolving communities.vmware.com... 195.18.221.160, 195.18.221.178
Connecting to communities.vmware.com|195.18.221.160|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 29&nbsp;511 (29K) [application/x-sh]

100%[========================================================&gt;] 29&nbsp;511      102.40K/s

16:49:03 (102.18 KB/s) - `ghettoVCB.sh' saved [29511/29511]

% file ghettoVCB.sh
ghettoVCB.sh: ASCII English text, with CRLF line terminators
</code></pre><br>
<br>
Should the attached file be "unix text"?
					
				</div>
				<a name="comments-14610"></a>
				<div id="comment-14610" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 8:35 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-6EXTv1HwJx5hOCNc" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14639" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14610">
					I guess it should be "unix text"<br>
I tried downloading with firefox and opening it with Notepad++ and it 
says it's ANSI with Windows line endings.<br>
<br>
You could convert it with that text editor or in linux with the "flip" 
tool (apt-get install flip if debian/ubuntu)
					</p>
				</div>
				<a name="comments-14627"></a>
				<div id="comment-14627" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 10:54 AM
						</span>
							<!--<a href="/people/lacikaaa" title="Click to view lacikaaa's profile">
<img class="jive-avatar" src="/people/lacikaaa/avatar/16.png?a=-1" height="16" width="16" title="Click to view lacikaaa's profile" alt="Click to view lacikaaa's profile" />
</a>--><a href="http://communities.vmware.com/people/lacikaaa" 
id="jive-1Qk4Cpvp2nHBixsL" class="jive-username-link" title="Click to 
view lacikaaa's profile">lacikaaa</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14639" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14627">
					sed 's/.$//g' input &gt; output <br>
run this, and it will remove ^M from end of line so it will work.
					</p>
				</div>
				<a name="comments-14628"></a>
				<div id="comment-14628" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 10:57 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-K86J7JVuS42eHhck" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14639" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14628">
					There's nothing wrong with the script per-se, but there is an issue
 when using <b>wget</b> and downloading from VMTN. Take a look at FAQ 
#17<br>
<br>
Basically either deal with removing the ^M characters using solutions OR
 use scp or WinSCP to transfer the script.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14629"></a>
				<div id="comment-14629" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 10:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-bJ5h65KpKG1l5smw" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14637" title="Go to message">wobbe98</a>
							</em>
					</span>
					<p id="comment-body-14629">
					Is this on NFS datastore or local VMFS volume?<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14640"></a>
				<div id="comment-14640" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 11:12 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-kN6xPKXs36Pn7la7" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14629" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14640">
					From local to NFS.
					</p>
				</div>
				<a name="comments-14630"></a>
				<div id="comment-14630" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 11:19 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-90qL5HCf05tbopqd" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14640" title="Go to message">wobbe98</a>
							</em>
					</span>
					<p id="comment-body-14630">
					Yea, I'm betting you're seeing the same NFS issue that others are 
seeing as well. If you just take a look at the last 20 or so threads, 
you'll see some of my replies. For more details, or as much as I've been
 able to gather take a look at FAQ #18 and "Our NFS Configuration" in 
the document.<br>
<br>
Unfortunately, at this point in time, we've not been able to identify 
what commonalities between all the NFS servers being used that is 
causing a small portion of users to have this 'connection' problem 
during the removal process of a large files. There is nothing wrong with
 the script, but it has something to do with either the NFS server or 
ESXi host configurations/etc. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14641"></a>
				<div id="comment-14641" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 11:57 AM
						</span>
							<!--<a href="/people/wobbe98" title="Click to view wobbe98's profile">
<img class="jive-avatar" src="/people/wobbe98/avatar/16.png?a=-1" height="16" width="16" title="Click to view wobbe98's profile" alt="Click to view wobbe98's profile" />
</a>--><a href="http://communities.vmware.com/people/wobbe98" 
id="jive-9nk0kSqJ50rmCQb0" class="jive-username-link" title="Click to 
view wobbe98's profile">wobbe98</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14630" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14641">
					Adding &gt; /dev/null 2&gt;&amp;1 to the cron job seems for have 
fixed the problem. Thanks again lacikaaa.
					</p>
				</div>
				<a name="comments-14631"></a>
				<div id="comment-14631" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 11:58 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-00TvUmcgtO1dyLh0" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14628" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14631">
					William, thanks for the reply. (And also thanks to others, I know 
how to convert "DOS format" to Unix.) <br>
<br>
I said "no matter where and with what http client" - I tried multiple 
browsers (IE, FF, Opera) on a couple of OSs and the result is the same 
no matter: I get a file with DOS line endings, and whether I scp or 
WinSCP to the ESX box I still have a file with DOS line endings. No http
 client should affect this. Therefore I can't think see any other 
explanation than that the file on the server has DOS line endings. 
Please enlighten me if I'm wrong.
					</p>
				</div>
				<a name="comments-14611"></a>
				<div id="comment-14611" class="jive-content-comment ">
					<span>
						<span>
							Feb 25, 2010 1:33 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4ptp26KLRYPMyeEa" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14631" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14611">
					Not sure why it's not working for you. I can right click on the 
script from this VMTN document, save as and then use WinSCP to copy it 
to ESXi host and ensure it has executable permission and execute a 
backup. If this was an issue with the source of the script, there would 
be many many more users with this problem. <br>
<br>
Again, if you continue to run into this problem, you can easily strip 
out the ^M characters and there's been a few different solutions on 
accomplishing this from using sed or replace in vi. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14642"></a>
				<div id="comment-14642" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 25, 2010 11:01 PM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-Nx46jc6oW3aqpK9m" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14611" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14642">
					I'm having the same issue with the ^M - regardless which client or 
OS. But I've to test it at home without using Squid Proxy (here at work)
 - maybe he's adding the ^M
					</p>
				</div>
				<a name="comments-14651"></a>
				<div id="comment-14651" class="jive-content-comment ">
					<span>
						<span>
							Feb 26, 2010 9:02 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0O4helKRHz9q0GW7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14642" title="Go to message">pebr</a>
							</em>
					</span>
					<p id="comment-body-14651">
					Odd ... again, I've done this in many many locations and never once
 had an issue. <br>
<br>
If you guys like, I can do screenshot of my exact steps and show you 
that it does in fact work and that no "hidden" ^M characters are 
embedded with the version that's hosted by VMTN documents. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14615"></a>
				<div id="comment-14615" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 26, 2010 9:20 AM
						</span>
							<!--<a href="/people/DSTAVERT" title="Click to view DSTAVERT's profile">
<img class="jive-avatar" src="/people/DSTAVERT/avatar/16.png?a=3064" height="16" width="16" title="Click to view DSTAVERT's profile" alt="Click to view DSTAVERT's profile" />
</a>--><a href="http://communities.vmware.com/people/DSTAVERT" 
id="jive-N2bq94K22u3I0u96" class="jive-username-link" title="Click to 
view DSTAVERT's profile">DSTAVERT</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-moderator.gif" title="User Moderators" 
alt="User Moderators" class="vmware-group-icon">
				<img src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14651" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14615">
					I don't  have any issues ether. Remember you can't do ANY editing 
of the script in Windows. You must do the editing on the vMA appliance 
or on the ESXi host.
					</p>
				</div>
				<a name="comments-14652"></a>
				<div id="comment-14652" class="jive-content-comment ">
					<span>
						<span>
							Feb 26, 2010 9:27 AM
						</span>
							<!--<a href="/people/Wolfi3" title="Click to view Wolfi3's profile">
<img class="jive-avatar" src="/people/Wolfi3/avatar/16.png?a=-1" height="16" width="16" title="Click to view Wolfi3's profile" alt="Click to view Wolfi3's profile" />
</a>--><a href="http://communities.vmware.com/people/Wolfi3" 
id="jive-o7155S670Q6lrH7A" class="jive-username-link" title="Click to 
view Wolfi3's profile">Wolfi3</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14651" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14652">
					Wont mind a few screen shots.<br>
Will maybe show me what i am doing wrong.
					</p>
				</div>
				<a name="comments-14644"></a>
				<div id="comment-14644" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 26, 2010 9:36 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-zOgoVzcc500Fm5zh" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14651" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14644">
					No need to go to such extremes as to document your steps in detail,
 William. At this point this is just puzzling and funny. To convert 
forth and back is no problem for me, and if this issue doesn't affect 
(m)any others, it doesn't matter. Though it seems like some people can 
reproduce it, voluntarily or not.<br>
<br>
I have tried so many browsers, and so many platforms and locations, 
passing through proxies or not passing through proxies. The result is 
consistently the same: I can e.g. right-click the attachment above in IE
 and save. The file size is always 29511 bytes, and if I immediately 
inspect it with a hex viewer, without transfering it anywhere, line 
breaks are 0d 0a ("DOS format"). No matter what OS, client/browser, 
proxy/no proxy, or ISP(!).<br>
<br>
Hell, at this point I am willing to believe that all backbone pipes into
 Norway automatically converts this script. <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":-)" border="0"> Maybe I should have
 myself filmed while doing it, and then send you the film and a zipped 
sample of the resulting script. <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";-)" border="0">
					</p>
				</div>
				<a name="comments-14653"></a>
				<div id="comment-14653" class="jive-content-comment ">
					<span>
						<span>
							Feb 26, 2010 9:55 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-965b02tHQX9x5c7q" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14644" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14653">
					Tell you guys what, I'll contact Corey from the VMTN team who 
currently manages the forum and see if he can look into this and perhaps
 he can shed some light. I'm sure there are multiple nodes serving out 
this file, perhaps certain nodes is holding a corrupted version of the 
script or some how including the ^M character. Again for me within the 
US and specifically in California, I've not had any issues and I've had 
several people I know try the download and it works perfectly fine. No 
guarantee I'll get an answer from Corey, but I'll see if I can get more 
info on this. <br>
<br>
In the meantime, I can put up the latest version on our site as an 
alternative download location and see if you guys can use wget,curl,etc 
to retrieve the file.<br>
<br>
Sorry for the inconvenience, this one is definitely a funny and odd case
 <img class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" 
border="0"><br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14617"></a>
				<div id="comment-14617" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2010 4:14 AM
						</span>
							<!--<a href="/people/conexcol" title="Click to view conexcol's profile">
<img class="jive-avatar" src="/people/conexcol/avatar/16.png?a=-1" height="16" width="16" title="Click to view conexcol's profile" alt="Click to view conexcol's profile" />
</a>--><a href="http://communities.vmware.com/people/conexcol" 
id="jive-68P77PWhUuq0E0eC" class="jive-username-link" title="Click to 
view conexcol's profile">conexcol</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12451" title="Go to message">winterg</a>
							</em>
					</span>
					<p id="comment-body-14617">
					I'm having exactly the same problem with tar (tar cannot store 
file)<br>
<br>
VMware ESXi 4.0.0 build-219382. The datastore is a clean 1TB hard drive 
with VMFS 3.33, 8MB Block Size, and 930.75GB free space. <br>
<br>
This is what happens if I do it manually:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain"> 
ls -al vm1-2010-02-28/
drwxr-xr-x    1 root     root                980 Feb 28 10:48 .
drwxr-xr-x    1 root     root                700 Feb 28 10:56 ..
-rw-------    1 root     root        21474836480 Feb 28 10:50 vm1-flat.vmdk
-rw-------    1 root     root                543 Feb 28 10:50 vm1.vmdk
-rwxr-xr-x    1 root     root               3591 Feb 28 10:40 vm1.vmx
-rw-------    1 root     root       182536110080 Feb 28 10:48 vm1_1-flat.vmdk
-rw-------    1 root     root                547 Feb 28 10:48 vm1_1.vmdk

/vmfs/volumes/backup/vm1 # tar -cvf compressed_vm1.tgz vm1-2010-02-28/ 
vm1-2010-02-28/
vm1-2010-02-28/vm1.vmx
tar: cannot store file 'vm1-2010-02-28/vm1_1-flat.vmdk' of size 182536110080, aborting
 
</code></pre><br>
<br>
Thanks
					
				</div>
				<a name="comments-14646"></a>
				<div id="comment-14646" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2010 5:21 AM
						</span>
							<!--<a href="/people/ippup" title="Click to view ippup's profile">
<img class="jive-avatar" src="/people/ippup/avatar/16.png?a=-1" height="16" width="16" title="Click to view ippup's profile" alt="Click to view ippup's profile" />
</a>--><a href="http://communities.vmware.com/people/ippup" 
id="jive-Hys307zj0Nb1fpa9" class="jive-username-link" title="Click to 
view ippup's profile">ippup</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14295" title="Go to message">Wolfi3</a>
							</em>
					</span>
					<p id="comment-body-14646">
					hi<br>
<br>
did you find any way of resolving the issue.<br>
i'm downloading the file directly from esx and i'm still getting the 
same error<br>
<br>
: not found.sh: line 6:<br>
: not found.sh: line 8:<br>
: not found.sh: line 11:<br>
: not found.sh: line 18:<br>
: not found.sh: line 21:<br>
....<br>
<br>
any pointers ?
					</p>
				</div>
				<a name="comments-14618"></a>
				<div id="comment-14618" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2010 5:56 AM
						</span>
							<!--<a href="/people/buekkes" title="Click to view buekkes's profile">
<img class="jive-avatar" src="/people/buekkes/avatar/16.png?a=-1" height="16" width="16" title="Click to view buekkes's profile" alt="Click to view buekkes's profile" />
</a>--><a href="http://communities.vmware.com/people/buekkes" 
id="jive-5c8VghQqWwjRY2MQ" class="jive-username-link" title="Click to 
view buekkes's profile">buekkes</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14646" title="Go to message">ippup</a>
							</em>
					</span>
					<p id="comment-body-14618">
					Remove the wrong line feeds, I also suffered from them, even by 
directly downloading via wget. Open vi, execute the command<br>
<br>
:%s/^V^M//g<br>
<br>
which has to be entered as <br>
<br>
:%s/]ctrlkey+v and ctrl-key+M]//g
					</p>
				</div>
				<a name="comments-14665"></a>
				<div id="comment-14665" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2010 6:01 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-CJl5eGR1PtYrG8zP" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14646" title="Go to message">ippup</a>
							</em>
					</span>
					<p id="comment-body-14665">
					See buekkes reply. And many more tips in the FAQ as well as 
previous comments. There are many ways to fix this, mentioned above. Or 
just google <a class="jive-link-external" 
href="http://lmgtfy.com/?q=convert+dos+format+to+unix">http://lmgtfy.com/?q=convert+dos+format+to+unix</a>.
 <br>
<br>
(Some of us are trying to pry into WHY this happens to some of us, but I
 sense from your post that fixing it for yourself is more within your 
reach... <img class="jive-emoticon" src="DOC-8760_files/happy.gif" 
alt=":-)" border="0">
					</p>
				</div>
				<a name="comments-14647"></a>
				<div id="comment-14647" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2010 8:18 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ngKb5KRLO99qRJQ5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14646" title="Go to message">ippup</a>
							</em>
					</span>
					<p id="comment-body-14647">
					@ippup @buekkes<br>
<br>
Folks, please take a look at the last 5-6 posts regarding this question 
and this is also documented on the FAQ, specifically #17. I do ask that 
users go through the documentation before posting as much of the 
questions have been answered.<br>
<br>
You can <b>NOT</b> download the script using wget from the ESXi host or 
using datastore browser to upload the script, these will indefinitely 
cause you to include the ^M character which will cause the script to 
have issues when you try to execute. <br>
<br>
Regarding remediation of this issue, most of the suggestions provided by
 users work in removing this <b>^M</b> character on classic ESX BUT not 
on ESXi due to the version of sed and vi. (e.g. removing ^M with 
&lt;ctr+v&gt;&lt;ctrl+m&gt; within vi will just fail) Depending on the 
OS you have available, you can use tools like dos2unix or others to 
remove any of thee ^M characters before uploading to your ESX(i) host. <br>
<br>
As mentioned in my comment on <b>Feb 26, 2010 9:55 AM</b>, I've 
contacted one of the guys who runs the VMTN community to see if he can 
shed any light on why only a small handful of users are having this 
problem, I've not been able to reproduce this problem across different 
OSes + browsers. <br>
<br>
In the meantime for ALL users having this problem, I've uploaded the 
current version of the script onto our site and you CAN use <b>wget</b> 
on ESXi 4.0 (only system I've tested) to pull down the script:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">wget http://engineering.ucsb.edu/~duonglt/vmware/ghettoVCB.sh
</code></pre><br>
<br>
Remember to set executable permission on the script. Let me know if you 
guys run into any issues<br>
<br>
Thanks for you patience <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14648"></a>
				<div id="comment-14648" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2010 8:23 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ns7zNk12p9F7rP79" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14617" title="Go to message">conexcol</a>
							</em>
					</span>
					<p id="comment-body-14648">
					Note, if you're trying to replicate the compression functionality 
from the script, you need to also specify "z" option which filters the 
archive into gzip. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14619"></a>
				<div id="comment-14619" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2010 9:20 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-5YHxyaEbe1jrTuLl" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14647" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14619">
					William,<br>
<br>
it just dawned on me: Why not place the script here under attachments, 
plain tar-gzipped? And preferably an explanation/comment close to it, 
saying that this is the version to use when downloading directly using 
wget, as well as instructing people to extract it with "tar pxvzf 
ghettoVCB.tar.gz". That ought to take care of line endings as well as 
execute bit...
					</p>
				</div>
				<a name="comments-14666"></a>
				<div id="comment-14666" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2010 9:30 AM
						</span>
							<!--<a href="/people/conexcol" title="Click to view conexcol's profile">
<img class="jive-avatar" src="/people/conexcol/avatar/16.png?a=-1" height="16" width="16" title="Click to view conexcol's profile" alt="Click to view conexcol's profile" />
</a>--><a href="http://communities.vmware.com/people/conexcol" 
id="jive-zUtD0LQy4saTFm1D" class="jive-username-link" title="Click to 
view conexcol's profile">conexcol</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14648" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14666">
					I was trying to report it as simple as possible as It doesn't 
matter if you add the -z or not. It has exactly the same behavior.<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">ls -al vm1-2010-02-28/
drwxr-xr-x    1 root     root                980 Feb 28 10:48 .
drwxr-xr-x    1 root     root                700 Feb 28 10:56 ..
-rw-------    1 root     root        21474836480 Feb 28 10:50 vm1-flat.vmdk
-rw-------    1 root     root                543 Feb 28 10:50 vm1.vmdk
-rwxr-xr-x    1 root     root               3591 Feb 28 10:40 vm1.vmx
-rw-------    1 root     root       182536110080 Feb 28 10:48 vm1_1-flat.vmdk
-rw-------    1 root     root                547 Feb 28 10:48 vm1_1.vmdk

/vmfs/volumes/backup/vm1 # tar -cvzf compressed_vm1.tgz vm1-2010-02-28/ 
vm1-2010-02-28/
vm1-2010-02-28/vm1.vmx
tar: cannot store file 'vm1-2010-02-28/vm1_1-flat.vmdk' of size 182536110080, aborting
</code></pre><br>
<br>
Thanks.
					
				</div>
				<a name="comments-14680"></a>
				<div id="comment-14680" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2010 9:43 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-hSnHbCO9HGyjw8sy" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14680">
					Our ^M-mystery aside, I have made some minor enhancements to the 
script. More info at <a class="jive-link-external" 
href="http://www.idrift.no/gaute/ghettovcb/,">http://www.idrift.no/gaute/ghettovcb/,</a>
 but the main points are logging: We have tools which process logs on a 
daily basis and creates reports. I needed to always log ERROR: when 
there's an error, and to give a sort of summary at the end.<br>
<br>
Take a look at it and feel free to incorporate anything you like. We 
will be rolling this out to several servers, ESX3, 3i, 4 and 4i alike. 
So we will get to test it thoroughly, but I want to show it to you 
already now to get feedback. Just look at it at <a 
class="jive-link-external" href="http://www.idrift.no/gaute/ghettovcb/">http://www.idrift.no/gaute/ghettovcb/</a>
					</p>
				</div>
				<a name="comments-14649"></a>
				<div id="comment-14649" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2010 10:26 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-M27986JxEqeQmYQ9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14619" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14649">
					True, I originally wanted to make this as easy as possible w/o the 
user having to go through too many steps. Download, upload and set the 
permissions. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14695"></a>
				<div id="comment-14695" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Feb 28, 2010 10:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FR6IjzV9at18f03A" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14666" title="Go to message">conexcol</a>
							</em>
					</span>
					<p id="comment-body-14695">
					It looks like the version of <b>tar</b> that's compiled with 
version of Busybox in ESXi may have a filesize limitation, do you have 
VMs that are smaller that you can test with? I know classic ESX does not
 have this issue and we've personally backed up VMs &gt; 150GB<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14696"></a>
				<div id="comment-14696" class="jive-content-comment ">
					<span>
						<span>
							Feb 28, 2010 10:34 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-41vw3wekOJ5dOW0z" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14680" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14696">
					Cool setup, I quickly glanced at the diff and I do like the idea of
 further logging, though I think what's in the script today is 
sufficient in helping me debug user issues. I added newlines to the logs
 so it makes it easier for me to read, especially troubleshooting user 
issues, this is a personal preference. I think all the necessary areas 
that use echo is fine and the remainder section of the code uses 
logger(). <br>
<br>
I would not call VMs that have snapshots or pRDM quite "errors" since 
those are not supported use cases, perhaps warnings would probably be a 
better word. I do like the overall summary status, that maybe something 
I'll integrate into a future release of the script. <br>
<br>
Though I do have to say that it's great to see users modifying the 
script to fit their needs/requirements! <br>
<br>
Let me know how your roll out goes.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14679"></a>
				<div id="comment-14679" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 1, 2010 8:47 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FW5dYNQ0QLy56T30" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-14679">
					Hello everyone,<br>
<br>
For those that are having the NFS issue regarding the removal of the 
older backups, I had another user running into the same problem but 
using <b>ghettoVCBg2</b>. What he had found was by switching the 
filesystem type on the volume in which was exported out from the NFS 
server from <b>ext3</b> to <b>xfs</b> seemed to have resolved his issue.<br>
<br>
Take a look at this comment:<br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9843#comments-14677">http://communities.vmware.com/docs/DOC-9843#comments-14677</a><br>
<br>
For anyone that's willing to give this a shot, let me know if it helps 
or if you still continue to run into this issue.<br>
<br>
Thanks<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14705"></a>
				<div id="comment-14705" class="jive-content-comment ">
					<span>
						<span>
							Mar 2, 2010 5:00 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-I57BjGV2qG25tUmC" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14679" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14705">
					OK, I found out quickly that if I was to roll out ghettoVCB pÃ¥ 
several hosts, and then maybe update it, it wasn't so cool to have 
configuration in the script itself. So I updated it: <br>
<br>
Now all the config variables are in the script, but after they have been
 declared, a ghettoVCB.conf is sourced - if it exists. That way you can 
update the script itself without destroying the config.<br>
<br>
It's still at <a class="jive-link-external" 
href="http://idrift.no/gaute/ghettovcb/">http://idrift.no/gaute/ghettovcb/</a>
					</p>
				</div>
				<a name="comments-14706"></a>
				<div id="comment-14706" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 2, 2010 7:05 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-tl448jLMCC8LN0U8" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14705" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14706">
					Well you can easily update the latest version and then just push 
that out to all the hosts, if you have something like pair SSH keys 
setup, that is pretty trivial to do. You also have the option of moving 
all the configuration out to configuration file. I can see the benefit 
of having a global file, though I can see others wanting multiple global
 files and I wanted to keep it simple. I know most of the deployments 
may involve NFS and if you have any type of shared storage, you would 
only need to keep 1 copy of the script and just have execute from the 
NFS datastore. <br>
<br>
I'll definitely look into supporting this functionality in future 
release, just need to think about to ensure it won't break or complicate
 other functionalitys in the script. <br>
<br>
Thanks for the feedback<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14684"></a>
				<div id="comment-14684" class="jive-content-comment ">
					<span>
						<span>
							Mar 2, 2010 7:20 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-RvYnOdgNkWWoYe8k" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14706" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14684">
					Well, look at it. I'm quite sure you'll see that my way of enabling
 config-in-separate-file will not break anything for anyone who's used 
to the current way (with variables inside the script).<br>
<br>
The case for us is that we consult/manage/support a lot of businesses, 
each with their own vmware server(s), and a mix of ESX3i, 4i, 3 and 4 to
 boot. So we'll use a update-script to push new versions of ghettoVCB.sh
 out to all those servers, using SSH keys just like you point out. Now 
we can mass update ghettoVCB.sh without having to worry about 
overwriting configuration.<br>
<br>
But of course: for a less Linux-savvy user, with just a single 
installation, I presume the current way is more manageable: At best just
 one file to worry about, with a few options to alter.<br>
<br>
Thanks to you too, for the prompt and relevant feedback - and for 
cooking up this impressively functional and robust script in the first 
place (I'm something of a shell script junkie myself, and you've really 
pushed the envelope with ash/dash here... <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":-)" border="0"> )
					</p>
				</div>
				<a name="comments-14708"></a>
				<div id="comment-14708" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 2, 2010 7:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-AGl020NLyyi0kME9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14684" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14708">
					Thanks again the comments/feedback. I'm sure the "sourcing global 
conf" won't break anything, but haven't had the cycles to thoroughly 
look or think about it yet. This script alone has gotten more than 180k 
views, so need to make sure I try to perform as much of the QA as 
possible to make sure it won't "break" any previous setups from users. 
Also, this is not the only script I manage, and I'm a one man show <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0">
 <br>
<br>
Great to always get feedback from the community for improvements and 
users customizing what I've done.<br>
<br>
I'm definitely going to be lookingn at including this + updating the 
download/installation setup. Just need to test it out and ensure 
(curl/wget) won't do anything funky with tar+gzip, that hopefully should
 then end any issue with lovely "Windows" ^M character issue. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14729"></a>
				<div id="comment-14729" class="jive-content-comment ">
					<span>
						<span>
							Mar 2, 2010 6:54 PM
						</span>
							<!--<a href="/people/InformINS" title="Click to view InformINS's profile">
<img class="jive-avatar" src="/people/InformINS/avatar/16.png?a=-1" height="16" width="16" title="Click to view InformINS's profile" alt="Click to view InformINS's profile" />
</a>--><a href="http://communities.vmware.com/people/InformINS" 
id="jive-iPqe62Pa3GT68CiV" class="jive-username-link" title="Click to 
view InformINS's profile">InformINS</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14729">
					Is this script safe to run against Server 2003 Active Directory 
servers without powering down the virtual host first?<br>
<br>
Thanks, btw to the author for a contributing this very nice, free backup
 solution for ESX hosts.
					</p>
				</div>
				<a name="comments-14730"></a>
				<div id="comment-14730" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 2, 2010 7:36 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FMF23VgJIy1a0pBg" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14729" title="Go to message">InformINS</a>
							</em>
					</span>
					<p id="comment-body-14730">
					I'm not an AD expert, I would recommend you do some testing to 
validate that the system can be backed up and restored. I would hope 
that the AD server has VMware Tools installed and you probably want to 
quiesce the filesystem to ensure that everything in memory is flushed to
 disk before taking the snapshot. This is similar question around 
backing up databases and ensuring you have a consistent copy of the 
system. As a note, other backup solutions do the exact same thing, 
snapshot the VM whiles its running and then backup the RO disk while all
 changes goes out to the delta. Specific with Windows, VMware Tools can 
leverage things like VSS to ensure consistent copies but again this is 
something you'll want to validate<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14687"></a>
				<div id="comment-14687" class="jive-content-comment ">
					<span>
						<span>
							Mar 2, 2010 7:58 PM
						</span>
							<!--<a href="/people/chayawatv" title="Click to view chayawatv's profile">
<img class="jive-avatar" src="/people/chayawatv/avatar/16.png?a=-1" height="16" width="16" title="Click to view chayawatv's profile" alt="Click to view chayawatv's profile" />
</a>--><a href="http://communities.vmware.com/people/chayawatv" 
id="jive-k2MecEsI6kOqT6Ve" class="jive-username-link" title="Click to 
view chayawatv's profile">chayawatv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14535" title="Go to message">devzero</a>
							</em>
					</span>
					<p id="comment-body-14687">
					<br>
Hi,<br>
Forgot to put an update about this. error "tar: invalid tar magic" when 
you try to uncompress .gz to restore vmdk.<br>
it's actually a limitation of tar on ESX 3.5i U4. if backingup and 
compressing vmdk larger than 2 GB, when you uncompress it will give 
"tar: Invalid tar magic".<br>
For ESX 4.0i, the limitation is 8 GB. So, if vmdk file is larger than 8 
GB, when backup and compress is fine. But, uncompression will give "tar:
 Invalid tar magic" as well.<br>
<br>
My workaround on ESX 4i, I run the script and make disk format to be 
2GBSparse, then compress it. When I want to restore I just run gunzip 
without any error. However, the restore disk format will be in 2GBSparse
 format. So, if you want it in other disk format such as "thin". it has 
to be manually done with vmkfstools.<br>
<br>
I haven't tested this with ESX 3.5i U4, yet. will give update on this 
later
					</p>
				</div>
				<a name="comments-14731"></a>
				<div id="comment-14731" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 2, 2010 8:31 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-a170f10MBE398wP7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14687" title="Go to message">chayawatv</a>
							</em>
					</span>
					<p id="comment-body-14731">
					chayawatv,<br>
<br>
Thanks for this information, looks like I'll need to update the FAQ 
regarding limitation of compression. I think probably the best way to 
ensure you have the smallest backup is to use 2gbsparse files and upon a
 restore, you can manually use vmkfstools to re-expand back to either 
thin or thick disks.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14711"></a>
				<div id="comment-14711" class="jive-content-comment ">
					<span>
						<span>
							Mar 3, 2010 1:55 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-4mP4ocfQ7d6MLR7W" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14711">
					Hmm... had a sad case here. Starting to roll out the script, 
considerations had to made on ESXi regarding how it handles partiotions,
 and rolls back changes to some "system" file systems/partitions.<br>
<br>
I wanted to put a small script in /etc/rc.local.d to add cron stuff, 
seeing that /etc/rc.local enumerates and runs everything in that folder.
 And I installed ghettoVCB.sh and other stuff under /opt, which isn't 
supposed to be flushed/rolled back. Of course these servers don't boot 
so often, and I had tested this. But last night I booted a couple of 
servers and it the script under rc.local.d got deleted. I saved a lot of
 dummy test files there with just shell "# comments", different size 
files, and after the next boot rc.local.d was deleted - and /opt was 
empty! Anyone seen such a thing? Could there be a difference regarding <b>how</b>
 you reboot? I never go to maintenance mode, and I may reboot using 
'reboot' at the console, or using the vsphere client.<br>
<br>
If anyone knows anything that may shed some light on this, I'd be 
grateful.
					</p>
				</div>
				<a name="comments-14688"></a>
				<div id="comment-14688" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 3, 2010 2:18 AM
						</span>
							<!--<a href="/people/voro" title="Click to view voro's profile">
<img class="jive-avatar" src="/people/voro/avatar/16.png?a=-1" height="16" width="16" title="Click to view voro's profile" alt="Click to view voro's profile" />
</a>--><a href="http://communities.vmware.com/people/voro" 
id="jive-fCUm41mNFmMGLIO3" class="jive-username-link" title="Click to 
view voro's profile">voro</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14711" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14688">
					/etc/rc.local should be backed up when shutting down with<br>
<br>
/sbin/shutdown.sh<br>
<br>
you could try editing rc.local and then running<br>
<br>
/sbin/backup.sh 1<br>
<br>
and rebooting with your favourite method
					</p>
				</div>
				<a name="comments-14712"></a>
				<div id="comment-14712" class="jive-content-comment ">
					<span>
						<span>
							Mar 3, 2010 2:25 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-j1d9KAJTUy57QmKh" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14688" title="Go to message">voro</a>
							</em>
					</span>
					<p id="comment-body-14712">
					Thanks. That explains the rc.local issue. But not the /opt mystery -
 I mean, third party agents like hp agents are also stored in /opt, so I
 presume it was some kind of error on my part or otherwise that caused 
me to loose it last night. I'll test more - and hope anyone has anything
 to contribute.
					</p>
				</div>
				<a name="comments-14690"></a>
				<div id="comment-14690" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 3, 2010 9:03 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-NkYbj3Yj6grxuAHm" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14711" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14690">
					One thing to remember, the unsupported console is not to be treated
 as a UNIX/Linux console, it's meant for VMware Support to go in and 
help troubleshoot. So whatever expectation you may have for a standard 
UNIX/Linux distro will not hold. <br>
<br>
There's only handful of files/directories that actually persist through a
 reboot and /opt is not one of them, or at least one that gets active 
backups. The easiest way to figure out what is being backed up is to 
look at /sbin/auto-backup.sh which is a script that is cron'd to run 
every 1hr I believe which creates a bootbank image in which is restored 
upon reboot. I have an example in the CRON faq section. There's few 
places where you could edit to ensure your files are persisted but it's 
pretty manual.<br>
<br>
The easiest and recommended way is to store any files you may want 
persisted on NFS/VMFS or local VMFS volume. This way you know it'll 
always persist and if you have a shared NFS server, then this allows you
 to just store 1 copy of the script, but local VMFS volume will work. <br>
<br>
The best setup is to not setup the cron locally, put the script on 
VMFS/NFS volume and have it remotely kicked off from another system, 
even a VM that's running on an ESX(i) host would work. Though for 
whatever reason if you wanted everything residing locally, you'll need 
to make the appropriate changes to the cron entry to ensure it'll 
persist through a reboot and just place the script and any relevant 
files on the NFS/VMFS volume.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14713"></a>
				<div id="comment-14713" class="jive-content-comment ">
					<span>
						<span>
							Mar 3, 2010 9:35 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-Du4w40A85lW889UA" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14712" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14713">
					To make things persistent in the filesystem you have to add them to
 the bootbank.<br>
This is the same way 3rd parties are doing it.<br>
There already is an oem.tar in the bootbank which is empty by default 
where you can put yout extensions to the filesystem.<br>
<br>
This is the way we are doing it.<br>
<br>
Cheers,<br>
grubi.
					</p>
				</div>
				<a name="comments-14691"></a>
				<div id="comment-14691" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 3, 2010 1:22 PM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-9tsW75o9xfyrH0dq" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14691">
					I have a very strange problem ...<br>
<br>
I plan the script with the crontab of the ESXi. This are the lines I 
added to the /etc/rc.local --&gt;<br>
<br>
/bin/kill $(cat /var/run/crond.pid)<br>
/bin/echo "* 21 * * * /vmfs/volumes/Backup/ghettoVCB.sh -f 
/vmfs/volumes/Backup/VM -l /vmfs/volumes/ESXi\ Datastore/ ghettoVBB.log 
 -c /vmfs/volumes/Backup" &gt;&gt; /var/spool/cron/crontabs/root<br>
/bin/busybox crond<br>
<br>
ThatÂ´s all ok, the script starts.<br>
<br>
My problem is that the script seems to run in more than in one instance.
 In the log I can see, that the script starts very often.<br>
<br>
Can you tell me why this happens? The very strange thing to this 
problmes is, that this only happens if I schedule the script in the 
night. I have done several tests over the day ... I planed it 10 minutes
 in the future from now, make a reboot of the server (to be sure that 
all is fine), the scripts starts and stops, the log is fine, the backup 
too. But If the backup runs hours later in the night on the next morning
 the backups are often not done and in the log I can see, that the 
scripts started very often.
					</p>
				</div>
				<a name="comments-14714"></a>
				<div id="comment-14714" class="jive-content-comment ">
					<span>
						<span>
							Mar 3, 2010 1:28 PM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-2Fi4k7HCugc2qIXk" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14691" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-14714">
					Hehe, not such a mystery. The five first positions of a cron line 
means minute, hour, day of month, month, day of week respectively. A * 
means "every", so your cron-line means "every minute of the 21st hour of
 every day and every month". The script will start 21:00, 21:01, 21:02 
and so on.<br>
<br>
You need to put something like <br>
0 21 * * * (21:00) or<br>
30 21 * * * (21:30)
					</p>
				</div>
				<a name="comments-14692"></a>
				<div id="comment-14692" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 3, 2010 1:51 PM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-D0SrhIFP19p7pXhE" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14714" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14692">
					Oh yes, I did not see that mistake I did all the time. Thank you 
very much!!
					</p>
				</div>
				<a name="comments-14744"></a>
				<div id="comment-14744" class="jive-content-comment ">
					<span>
						<span>
							Mar 4, 2010 6:38 AM
						</span>
							<!--<a href="/people/Zman14" title="Click to view Zman14's profile">
<img class="jive-avatar" src="/people/Zman14/avatar/16.png?a=-1" height="16" width="16" title="Click to view Zman14's profile" alt="Click to view Zman14's profile" />
</a>--><a href="http://communities.vmware.com/people/Zman14" 
id="jive-9v4EbbEY0Y4CyHAT" class="jive-username-link" title="Click to 
view Zman14's profile">Zman14</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14744">
					OK I am sorry if this was discussed.  I want to use 
VMDK_FILES_TO_BACKUP to back one vmdk file, but when I change it, it 
backups all vmdk files, do I have to use a serperate config and I can 
not change the default config and maybe that why the do not modify line 
is before VMDK_FILES_TO_BACKUP.  Just wondering.
					</p>
				</div>
				<a name="comments-14716"></a>
				<div id="comment-14716" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 4, 2010 8:59 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-wT2m9J6fUnPgoG5Y" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14744" title="Go to message">Zman14</a>
							</em>
					</span>
					<p id="comment-body-14716">
					Please take a look at the documentation, this feature to specify 
individual VMDK(s) is only supported with individual VM backup 
configurations in which the individual VMDK(s) are specified in the 
configuration file. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14717"></a>
				<div id="comment-14717" class="jive-content-comment ">
					<span>
						<span>
							Mar 4, 2010 12:01 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-jV5e5zS41lFxm2Jl" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-14717">
					Hi everyone,<br>
<br>
To those that are having the "NFS" issue, I have some further updates. 
If your NFS volume is sitting on top of standard <b>ext3</b> 
configuration, by default, it's configured to "data=ordered" where an 
update to a file is committed to the filesystem and then meta data 
update occurs for journaling purposes. This may not be the best 
performing configuration, but would ensure that recently modified files 
would not be corrupted in the event of an unexpected reboot. <br>
<br>
For high performance of <b>ext3</b>, you'll want to change the write 
options from "data=ordered" to "data=writeback" which will not update 
the cache and only do meta data updates, similar to that of XFS and 
ReiserFS, which <u>might</u> explain why the user in my previous update 
had not seen the "NFS" issue after moving from ext3 to XFS.<br>
<br>
Another thing that you may also want to look at updating the default <b>atime</b>
 behavior, for every time a file is accessed/modified, atime value is 
updated which isn't necessary and could also be a cause for performance 
issue.<br>
<br>
I believe this <u>might</u> resolve the NFS problem. For the actual 
implementation, please do a search online for "ext3  writeback 
performance" and follow your OS specific instructions, though it should 
be same for all OSes.<br>
<br>
Thanks and I would love to get some feedback from users who are 
experiencing this problem and whether or not this is the resolution 
which can then be documented in an FAQ.<br>
<br>
Thanks everyone<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14733"></a>
				<div id="comment-14733" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 5, 2010 4:36 AM
						</span>
							<!--<a href="/people/hockeyef" title="Click to view hockeyef's profile">
<img class="jive-avatar" src="/people/hockeyef/avatar/16.png?a=-1" height="16" width="16" title="Click to view hockeyef's profile" alt="Click to view hockeyef's profile" />
</a>--><a href="http://communities.vmware.com/people/hockeyef" 
id="jive-3KsNUGIRYaqc8YlJ" class="jive-username-link" title="Click to 
view hockeyef's profile">hockeyef</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14472" title="Go to message">lacikaaa</a>
							</em>
					</span>
					<p id="comment-body-14733">
					lacikaaa, (or anyone else who can help)<br>
<br>
I am having the same issue as Furgirl39. I am new to ESXi scripting 
(even Linux scripting for that matter) and do not understand what sed 
's/.$//g' input &gt; output will do. I read up on sed, but am unsure of 
what the problem is (why the script won't run), and how sed can fix it. 
Can you please explain. <br>
<br>
Thanks.<br>
<br>
=========================================================================<br>
Scripting newbie
					</p>
				</div>
				<a name="comments-14746"></a>
				<div id="comment-14746" class="jive-content-comment ">
					<span>
						<span>
							Mar 5, 2010 6:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-41vJBur5Ty2NoU7K" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14733" title="Go to message">hockeyef</a>
							</em>
					</span>
					<p id="comment-body-14746">
					Please take a look at my comment on Feb 28, 2010 - <a 
class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-14647">http://communities.vmware.com/docs/DOC-8760#comments-14647</a><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14718"></a>
				<div id="comment-14718" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 5, 2010 4:14 PM
						</span>
							<!--<a href="/people/bpsmanagement" title="Click to view bpsmanagement's profile">
<img class="jive-avatar" src="/people/bpsmanagement/avatar/16.png?a=-1" height="16" width="16" title="Click to view bpsmanagement's profile" alt="Click to view bpsmanagement's profile" />
</a>--><a href="http://communities.vmware.com/people/bpsmanagement" 
id="jive-D4ag213jEw649k09" class="jive-username-link" title="Click to 
view bpsmanagement's profile">bpsmanagement</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14718">
					Is there a way to create a user to perform the backup task in 
vmware? I am unable to access SSH using a user I created with root and 
localadmin privledge. If I don't include 'user' I can't even log into 
the Infrastructure Client. Anyone know a way around this? Using root is 
causing issues with my ubuntu server. Doesn't delete properly after jobs
 are old. Thank you.
					</p>
				</div>
				<a name="comments-14755"></a>
				<div id="comment-14755" class="jive-content-comment ">
					<span>
						<span>
							Mar 6, 2010 4:00 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-7TmRhaBI37S5BOf0" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14718" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-14755">
					Too little info. But: I presume "ubuntu server" provides storage as
 NFS to the ESX server. Then I suggest it is easier to make the NFS 
server accept the root user from the ESX server. Please review FAQ and 
William's section "Our NFS Server Configuration", as well as previous 
answers to NFS-related questions. You probably need to put 
no_root_squash in your /etc/exports.<br>
<br>
If you need more help, you need to provide more information, particulary
 (but not limited to) contents of /etc/exports and owner/permission info
 from the NFS share (ls -la). If you absolutely need to use a non-root 
user, I presume you are already able to SSH in to ESX as this user and 
set up cron jobs for it. Please then also include at least UIDs/GIDs 
(relevant lines from /etc/passwd on both hosts and ls -lan from the NFS 
share).
					</p>
				</div>
				<a name="comments-14785"></a>
				<div id="comment-14785" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 8, 2010 12:40 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-B3T32j1v6O3Eq1NY" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14713" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-14785">
					goppi is right, of course. ESXi file system are mounted in memory 
and changes are non-persistent, save for the files that are "backed up" 
automatically by backup.sh (hourly and at boot). Other changes that you 
want to make permanent need to be in oem.tgz. I put some info here for 
those interested: <a class="jive-link-external" 
href="http://www.idrift.no/gaute/ghettovcb/">http://www.idrift.no/gaute/ghettovcb/</a><br>
<br>
Modifying oem.tgz is probably not for the non-Linux-savvy users to try, 
so for those I recommend putting ghettoVCB.sh on VMFS (a.k.a. in a 
"datastore").<br>
<br>
But: I can't seem to get this to work on ESXi 3/3.5. On ESXi 4 it's been
 a breeze: unpack oem.tgz, make changes, and whip up a new one. On a 
test on 3i this left the system failing boot, purple-screen and drop 
back to a built-in "debugging console". I pulled out the original 
oem.tgz from the backup bootbank. I tried again, also resetting 
owner/permissions, basically according to <a class="jive-link-external" 
href="http://www.vm-help.com/esx/esx3i/customize_oem_tgz.php">http://www.vm-help.com/esx/esx3i/customize_oem_tgz.php</a>.
 Anyone had this problem? Anyone successfully modified oem.tgz on ESXi 
3?
					</p>
				</div>
				<a name="comments-14786"></a>
				<div id="comment-14786" class="jive-content-comment ">
					<span>
						<span>
							Mar 8, 2010 5:26 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-nkTU9DQ2VTjyWxKr" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14786">
					How about compression done on the box that holds the target volume?
 For obvious reasons compression can be desireable. But on top of the 
enormous amount of time it takes, and potential tar size/compatibility 
issues, there is this: If you're short on space, you run 
VM_BACKUP_ROTATION_COUNT=1. You need space for two copies, of course. I 
you use compression, you need space for two compressed backups and one 
uncompressed, am I right?<br>
<br>
Now, if I set up a cron job on the target host that holds the backups, 
well between the backup jobs: "Dig through the backup folders and gzip 
each vmdk" (or even bzip2 or xz). From what I can see of the script, 
this will not break the rotation scheme or anything, since the folders 
as such are unchanged. Correct?<br>
<br>
I understand that the restore script will not work, but that is 
irrelevant for us. <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":-)" border="0">
					</p>
				</div>
				<a name="comments-14774"></a>
				<div id="comment-14774" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 8, 2010 6:42 AM
						</span>
							<!--<a href="/people/Zman14" title="Click to view Zman14's profile">
<img class="jive-avatar" src="/people/Zman14/avatar/16.png?a=-1" height="16" width="16" title="Click to view Zman14's profile" alt="Click to view Zman14's profile" />
</a>--><a href="http://communities.vmware.com/people/Zman14" 
id="jive-UVe3U9Y1bl4B4R5D" class="jive-username-link" title="Click to 
view Zman14's profile">Zman14</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14774">
					I am using the -l for logging and I notice that it doesn't delete 
with the VM backup Rotation.  Is there an easy way to set this in a cron
 job?  Thanks!
					</p>
				</div>
				<a name="comments-14790"></a>
				<div id="comment-14790" class="jive-content-comment ">
					<span>
						<span>
							Mar 8, 2010 9:01 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-pgbyfD1MuOOHyB7B" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14786" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14790">
					So I agree, that even setting the rotation equal to 1, you actually
 need space for 2 copies. When I wrote this, I wanted to be sure that we
 had at least 1 good copy before rotating out the previous, I can 
definitely update the documentation to note this requirement. However, 
as another use asked, they wanted rotation to be off in general, one way
 is just to fully disable this OR by setting a very high count if you 
don't want any deletion. <br>
<br>
Regarding compression at the target backup, this would definitely work 
... but there are a few caveats which may require you to consider before
 implementing. With the defaults today, the rotation function will go 
ahead and rename the directory of each backed up copy of a VM, so the 
structure will change.<br>
<br>
Here's an example with rotation=3<br>
<br>
1st time backup /myvm/myvm-2010-03-08*-1*<br>
2nd backup /myvm/myyvm-2010-03-08*-1* will now be <b>-2</b> and a new <b>-1</b>
 will be created<br>
3rd backup /myvm/myvm-2010-03-81*-2* will not be <b>-3</b> and <b>-1</b>
 will be <b>-2</b> and new <b>-1</b> will be created<br>
<br>
As you can see the previous backups will be renamed to older copy and so
 fourth based on your rotation count, sort of how standard logrotate 
works. So if you touch/modify this structure w/o ghettoVCB somehow 
knowing about it, you'll probably get some funky results from the 
script.<br>
<br>
My recommendation is if you're going to do any type of target volume 
compression, you'll need to either completely disable rotation from 
ghettoVCB's point of view and perhaps only do increment folder 
names/etc. to differentiate one backup from another, that way the 
folders are static and you can perform operations on the backend whether
 that's with ZFS,etc. <br>
<br>
And you're right, any modification will definitely break the restore 
script. <br>
<br>
I still need to gather some more information about the whole 'NFS' issue
 before I can do a formal update of the documentation, only gotten 
feedback from one person so far and it looks like even with <b>ext3</b> 
mods, it still causes errors. The recommendation may still be moving the
 filesystem from the exported NFS volume from ext3 to XFS for full 
resolution. I'll probably be adding few more FAQ's to cover some of 
these and other topics that's been discussed over the last few weeks. <br>
<br>
Thanks for the good discussion<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14791"></a>
				<div id="comment-14791" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 8, 2010 9:03 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-uuAqlU2DdATESr30" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14774" title="Go to message">Zman14</a>
							</em>
					</span>
					<p id="comment-body-14791">
					This has nothing to do with using <b>-l</b> logging option, you're 
most likely seeing the NFS issue that others are having when performing 
deletion of a backed up VM.<br>
<br>
Please take a look at my comment on <b>Mar 4, 2010 12:01 PM</b>, the 
current fix that seems to work is to change the exported NFS volume from
 ext3 to XFS, the ext3 tweaks don't seem like they work, though I've 
only gotten confirmation from 1 individual that tried it.<br>
<br>
Please post back with your findings so I can update the documentation.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14792"></a>
				<div id="comment-14792" class="jive-content-comment ">
					<span>
						<span>
							Mar 8, 2010 9:11 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-bSm8i2HN1oenJhn7" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14790" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14792">
					I think your folder structure would be entirely unharmed, as I 
would just cron something like this (on the backup target, a Linux box 
exporting NFS and seeing it's backup volume as /backup/myvm):<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">find /backup/myvm -name "*.vmdk" -exec gzip {} \;
</code></pre><br>
Mind you, this is yet untested. <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
As for rotation, if you would like to cater for the sorry 
space-strangled I-just-want-one-copy crowd, you could update the script 
to simply respect rotation=0, and then <i>delete</i> any present copy <i>before</i>
 backup... Then they only needed space for that single copy.
					
				</div>
				<a name="comments-14760"></a>
				<div id="comment-14760" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 8, 2010 11:08 AM
						</span>
							<!--<a href="/people/Zman14" title="Click to view Zman14's profile">
<img class="jive-avatar" src="/people/Zman14/avatar/16.png?a=-1" height="16" width="16" title="Click to view Zman14's profile" alt="Click to view Zman14's profile" />
</a>--><a href="http://communities.vmware.com/people/Zman14" 
id="jive-VvLRvid0j1BzTNRN" class="jive-username-link" title="Click to 
view Zman14's profile">Zman14</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14791" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14760">
					I am sorry, I didn't explain myself to well.  I write a log file 
with the -l and I want that log file to delete when the vm backup is 
deleted.   I don't want to have one backup and hundreds of log files 
from months of backup.
					</p>
				</div>
				<a name="comments-14794"></a>
				<div id="comment-14794" class="jive-content-comment ">
					<span>
						<span>
							Mar 8, 2010 12:16 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-1aBc3X24E7Lp3Ipo" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14760" title="Go to message">Zman14</a>
							</em>
					</span>
					<p id="comment-body-14794">
					Ah gotcha, yea you can easily add a line in the script to remove 
the log file, some users may want to archive the logs. Depending on 
where you're writing the out to, by default it goes to /tmp, so you can 
just add rm -f &lt;logfilepath&gt; as part of the final thing that runs.
 <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14763"></a>
				<div id="comment-14763" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 8, 2010 1:57 PM
						</span>
							<!--<a href="/people/Zman14" title="Click to view Zman14's profile">
<img class="jive-avatar" src="/people/Zman14/avatar/16.png?a=-1" height="16" width="16" title="Click to view Zman14's profile" alt="Click to view Zman14's profile" />
</a>--><a href="http://communities.vmware.com/people/Zman14" 
id="jive-6dTJYUK89bxKcmfW" class="jive-username-link" title="Click to 
view Zman14's profile">Zman14</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14794" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14763">
					Here is what I want to do, every night before it does a backup, I 
want to delete the log file.  Where in your script would I put that (I 
have very little scripting knowledge).  I don't even mind if I can 
append the logs to one file.  I have been putting in the -l, but if you 
said by default it goes in /tmp, then I will not need to put  the -l in.
  The only issue I have is I do not see the log file other then a file 
called vms_list, which doesn't show much.  Thanks for all your time and 
efforts, you are a life saver.
					</p>
				</div>
				<a name="comments-14767"></a>
				<div id="comment-14767" class="jive-content-comment ">
					<span>
						<span>
							Mar 10, 2010 1:42 AM
						</span>
							<!--<a href="/people/bpsmanagement" title="Click to view bpsmanagement's profile">
<img class="jive-avatar" src="/people/bpsmanagement/avatar/16.png?a=-1" height="16" width="16" title="Click to view bpsmanagement's profile" alt="Click to view bpsmanagement's profile" />
</a>--><a href="http://communities.vmware.com/people/bpsmanagement" 
id="jive-ea7vqelsLka8Gq4h" class="jive-username-link" title="Click to 
view bpsmanagement's profile">bpsmanagement</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14755" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14767">
					No gautelund.. you just read way too much into my post so perhaps I
 included too much information. The question is actually quite vanilla 
and is clearly stated as the first line in the post. Maybe I could word 
it better.. <br>
<br>
Does anyone know of a way to create a user using the infrastucture 
client that is allowed to login to the unsupported SSH console so I can 
execute the script as someone other than root?<br>
<br>
Also.. I have been using this backup solution since Jan 2009 and just 
wanted to say thank you again William!
					</p>
				</div>
				<a name="comments-14782"></a>
				<div id="comment-14782" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 10, 2010 2:08 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-tj51EH3zzWTM4fBD" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14767" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-14782">
					I had to read more into your post, because you put too little... 
You don't even say whether it is ESXi or ESX (3 or 4), which would make 
an enormous difference if anyone <i>was</i> going to try to help you 
find a solution in the direction you are looking. And you didn't state 
what the problem with root actually was. The helpful answer is quite 
often to let people look in a different direction, and while I have 
several Ubuntu-built NAS-boxes, I still don't understand your problem.<br>
<br>
Anyway: You don't have to "enable the root user", if you by that mean 
"give her a password and enable SSH logins". Setting "no_root_squash" 
for a specific share towards a specific NFS client is no major security 
breach when you control both hosts yourself.<br>
<br>
I am sorry that I can't help you with info regarding what you're 
specifically asking for - but knowing at least whether it's ESX or ESXi 
would be imperative if anyone was going to help you along. Given the 
information you have provided it seems like an unecessary cumbersome 
path to me, that's all.
					</p>
				</div>
				<a name="comments-14814"></a>
				<div id="comment-14814" class="jive-content-comment ">
					<span>
						<span>
							Mar 11, 2010 12:56 PM
						</span>
							<!--<a href="/people/denisesballs" title="Click to view denisesballs's profile">
<img class="jive-avatar" src="/people/denisesballs/avatar/16.png?a=-1" height="16" width="16" title="Click to view denisesballs's profile" alt="Click to view denisesballs's profile" />
</a>--><a href="http://communities.vmware.com/people/denisesballs" 
id="jive-R6i41tjYtH3x92i7" class="jive-username-link" title="Click to 
view denisesballs's profile">denisesballs</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14814">
					Well I've read this but I'm still a bit lost on the think backing 
up of thick disks. I see some people reporting that they are seeing some
 size reduction but I am not at all:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">./ghettoVCB.sh -f vm_backup_list 
2010-03-11 20:29:58 -- info: ============================== ghettoVCB LOG START ==============================

2010-03-11 20:29:58 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/vmware-esxi2-RAID10/backups
2010-03-11 20:29:58 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2010-03-11 20:29:58 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2010-03-11 20:29:58 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-03-11 20:29:58 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-03-11 20:29:58 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-03-11 20:29:58 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-03-11 20:29:58 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-03-11 20:29:58 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-03-11 20:29:58 -- info: CONFIG - LOG_LEVEL = info
2010-03-11 20:29:58 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout
2010-03-11 20:29:58 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-03-11 20:29:58 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-03-11 20:29:58 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-03-11 20:30:00 -- info: Initiate backup for whmcs01
2010-03-11 20:30:00 -- info: Creating Snapshot "ghettoVCB-snapshot-2010-03-11" for whmcs01
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/vmware-esxi2-RAID10/whmcs01.hw.buf.ny/whmcs01.hw.buf.ny.vmdk'...
Clone: 100% done.
2010-03-11 20:32:13 -- info: Removing snapshot from whmcs01 ...
2010-03-11 20:32:18 -- info: Backup Duration: 2.30 Minutes
2010-03-11 20:32:18 -- info: Successfully completed backup for whmcs01!
</code></pre><br>
<br>
However my backed up disks are still flat with full size. Am I missing 
something? Thanks.
					
				</div>
				<a name="comments-14823"></a>
				<div id="comment-14823" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 11, 2010 2:10 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ECE17d0TQJxuGgPo" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14814" title="Go to message">denisesballs</a>
							</em>
					</span>
					<p id="comment-body-14823">
					Please take a look at this blog post, it should answer your 
question when going from thick to thin: <a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/">http://www.yellow-bricks.com/2009/07/31/storage-vmotion-and-moving-to-a-thin-provisioned-disk/</a><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14826"></a>
				<div id="comment-14826" class="jive-content-comment ">
					<span>
						<span>
							Mar 12, 2010 6:40 AM
						</span>
							<!--<a href="/people/spray6969" title="Click to view spray6969's profile">
<img class="jive-avatar" src="/people/spray6969/avatar/16.png?a=-1" height="16" width="16" title="Click to view spray6969's profile" alt="Click to view spray6969's profile" />
</a>--><a href="http://communities.vmware.com/people/spray6969" 
id="jive-OaIg99om6Y8b4T2Y" class="jive-username-link" title="Click to 
view spray6969's profile">spray6969</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14826">
					Hi,<br>
<br>
Great job !<br>
<br>
But still 2 strange issues :<br>
<br>
</p><ul class="jive-dash">
<li>I've got an host with 2 disks :</li>
</ul>
        1 - system disk : machine-thin.vmdk<br>
        2 - data disk : machine-thin_1.vmdk<br>
<br>
ghettovcb runs every night.<br>
If you look save job result of the last 2 days you find this :<br>
<br>
Day1 :<br>
 - only disk 1 is saved and put in "day1" directory<br>
Day2 :<br>
 - only disk 1 is saved and put in "day2" directory<br>
 - disk2 of the day1 appears in "day1" directory !<br>
<br>
understood ??!!<br>
<p>
My second issue is :<br>
<br>
one of my host is about 8gb but the snapshot created by GhettoVcb is 
only 137Mb (no Compression enable)<br>
</p><p>
Thanks for your help
					</p>
				</div>
				<a name="comments-14845"></a>
				<div id="comment-14845" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 12, 2010 6:49 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-n5XiaQBD8Hs0hVqp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14826" title="Go to message">spray6969</a>
							</em>
					</span>
					<p id="comment-body-14845">
					Please post the output of the debug logs onto <a 
class="jive-link-external" href="http://pastebin.com/">http://pastebin.com/</a>
 and provide the link. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14840"></a>
				<div id="comment-14840" class="jive-content-comment ">
					<span>
						<span>
							Mar 12, 2010 7:39 PM
						</span>
							<!--<a href="/people/bpsmanagement" title="Click to view bpsmanagement's profile">
<img class="jive-avatar" src="/people/bpsmanagement/avatar/16.png?a=-1" height="16" width="16" title="Click to view bpsmanagement's profile" alt="Click to view bpsmanagement's profile" />
</a>--><a href="http://communities.vmware.com/people/bpsmanagement" 
id="jive-WH5NIJ19Wmu86Sp7" class="jive-username-link" title="Click to 
view bpsmanagement's profile">bpsmanagement</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14782" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14840">
					This script is for ESXi.. why would I be asking about ESX? Stop 
being ignorant.
					</p>
				</div>
				<a name="comments-14841"></a>
				<div id="comment-14841" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 12, 2010 7:47 PM
						</span>
							<!--<a href="/people/bpsmanagement" title="Click to view bpsmanagement's profile">
<img class="jive-avatar" src="/people/bpsmanagement/avatar/16.png?a=-1" height="16" width="16" title="Click to view bpsmanagement's profile" alt="Click to view bpsmanagement's profile" />
</a>--><a href="http://communities.vmware.com/people/bpsmanagement" 
id="jive-wF6uus7XkqwmJ10E" class="jive-username-link" title="Click to 
view bpsmanagement's profile">bpsmanagement</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14767" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-14841">
					For those that are interested in using a non-authorative user 
rather than root for SSH access you can follow my method below. <br>
<br>
This has been tested through reboot on ESXi 3.5 Update 3<br>
<br>
From ESXi host console hit 'alt+F1'<br>
Type 'unsupported'<br>
Type 'vi /etc/inetd.conf'<br>
Navigate to SSH line<br>
If SSH is not enabled then remove '#' from in front of SSH by hitting 
'x' while hovering the '#'<br>
Move to the end of the line, hit 'insert', hit the spacebar and type 
'-w'<br>
Hit Esc and type ':wq' to save and close<br>
Type 'useradd username -M -d /'<br>
Type 'passwd username' and enter new password twice<br>
Type 'ps | grep inetd'<br>
It will display two numeric groups of the same value, busybox and inetd.
 ie 1234 1234 busybox       inetd<br>
Type 'kill' and the first numeric group along with ' &amp;&amp; inetd'. 
ie kill 1234 &amp;&amp; inetd<br>
You are now ready to SSH using your new user<br>
NOTE: Type 'su -' to switch to root after logged in as non-root user
					</p>
				</div>
				<a name="comments-14860"></a>
				<div id="comment-14860" class="jive-content-comment ">
					<span>
						<span>
							Mar 13, 2010 4:35 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-S92SFoYCH3M1kcV8" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14840" title="Go to message">bpsmanagement</a>
							</em>
					</span>
					<p id="comment-body-14860">
					Hm, I was (trying to be) constructive. I know I should ignore your 
ignorant and arrogant rant at this time, as I am probably just 
furthering an ongoing pollution of the discussion, but I am compelled to
 correct your misinformation and point out that in the title <img 
class="jive-emoticon" src="DOC-8760_files/alert.gif" alt="(!)" 
border="0"> as well as all over the page, it is stated that the script 
is for ESX/ESXi 3.5 through 4.<br>
<br>
I am of course glad you found a solution and posted it here for others 
to see.
					</p>
				</div>
				<a name="comments-14862"></a>
				<div id="comment-14862" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 14, 2010 6:06 AM
						</span>
							<!--<a href="/people/buekkes" title="Click to view buekkes's profile">
<img class="jive-avatar" src="/people/buekkes/avatar/16.png?a=-1" height="16" width="16" title="Click to view buekkes's profile" alt="Click to view buekkes's profile" />
</a>--><a href="http://communities.vmware.com/people/buekkes" 
id="jive-8FjCJO93wl9cFP4G" class="jive-username-link" title="Click to 
view buekkes's profile">buekkes</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14559" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14862">
					Ok, after running it for a couple of days, here's what I did. I 
decided to leave to "tunneling" out of ghettoVCB.sh to integrate it as 
cronjobs. Comment and additions appreciated, for sure.<br>
<br>
~~~<br>
<br>
# Extend bootbank<br>
cd /;<br>
mkdir test;<br>
cp /bootbank/oem.tgz /test;<br>
cd test;<br>
tar -xzvf oem.tgz;<br>
rm oem.tgz;<br>
mkdir /test/bin;<br>
mkdir /test/etc/ghettoVCB;<br>
mkdir /test/etc/ghettoVCB/configs;<br>
mkdir /test/scripts;<br>
mkdir /test/.ssh;<br>
chmod 700 /test/.ssh;<br>
<br>
# Enable SSH connection<br>
dropbearkey -t rsa -f /test/.ssh/KEYFILE -s 2048;<br>
dbclient -i /test/.ssh/KEYFILE sleeper@HOST.de;<br>
tail -1 /.ssh/known_hosts &gt;&gt; /test/.ssh/known_hosts;<br>
<br>
# Move backup script<br>
mv /vmfs/volumes/datastore1/ghettoVCB.sh /test/scripts;<br>
chmod 755 /test/scripts/ghettoVCB.sh;<br>
<br>
# Create script to setup tunnel<br>
/bin/echo "#/bin/bash" &gt; /test/scripts/nfs_tunnel_open.sh;<br>
/bin/echo "for i in 111 2049 2233; do"  &gt;&gt; 
/test/scripts/nfs_tunnel_open.sh;<br>
/bin/echo "dbclient -T -i ~/.ssh/KEYFILE -L \$i:HOST.de:\$i 
sleeper@HOST.de sleep \$1 &amp;" &gt;&gt; 
/test/scripts/nfs_tunnel_open.sh;<br>
/bin/echo "done; exit;" &gt;&gt; /test/scripts/nfs_tunnel_open.sh;<br>
chmod 755 /test/scripts/nfs_tunnel_open.sh;<br>
<br>
# Create script to close tunnel<br>
/bin/echo "#/bin/bash" &gt; /test/scripts/nfs_tunnel_close.sh;<br>
/bin/echo "for i in \`ps -c | grep -e \"dbclient -T -i 
\/\/\.ssh\/KEYFILE -L\" | cut -f 1 -d ' '\`; do kill \$i; done;" 
&gt;&gt; /test/scripts/nfs_tunnel_close.sh;<br>
/bin/echo "exit;" &gt;&gt; /test/scripts/nfs_tunnel_close.sh;<br>
chmod 755 /test/scripts/nfs_tunnel_close.sh;<br>
<br>
# Create script to monitor tunnel<br>
/bin/echo "#/bin/bash" &gt; /test/scripts/nfs_tunnel_check.sh;<br>
/bin/echo "ID=\`ps -c | grep -e \"dbclient -T -i \/\/\.ssh\/KEYFILE -L\"
 | cut -f 1 -d ' ' | wc -l\`;" &gt;&gt; 
/test/scripts/nfs_tunnel_check.sh;<br>
/bin/echo "if <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%5C%24ID+-eq+0+">
 \$ID -eq 0 </a>; then /scripts/nfs_tunnel_open.sh 730d; fi;" &gt;&gt; 
/test/scripts/nfs_tunnel_check.sh;<br>
/bin/echo "exit;" &gt;&gt; /test/scripts/nfs_tunnel_check.sh;<br>
chmod 755 /test/scripts/nfs_tunnel_check.sh;<br>
<br>
# Create script to setup permanent nfs connection<br>
/bin/echo "#/bin/bash" &gt; /test/scripts/nfs_mount.sh;<br>
/bin/echo "/bin/vim-cmd hostsvc/datastore/nas_create nfs_backup_storage 
127.0.0.1 /home/ESXI_backup 0;" &gt;&gt; /test/scripts/nfs_mount.sh;<br>
/bin/echo "exit;" &gt;&gt; /test/scripts/nfs_mount.sh;<br>
chmod 755 /test/scripts/nfs_mount.sh;<br>
<br>
# Create script to close permanent nfs connection<br>
/bin/echo "#/bin/bash" &gt; /test/scripts/nfs_unmount.sh;<br>
/bin/echo "/bin/vim-cmd hostsvc/datastore/destroy nfs_backup_storage;" 
&gt;&gt; /test/scripts/nfs_unmount.sh;<br>
/bin/echo "exit;" &gt;&gt; /test/scripts/nfs_unmount.sh;<br>
chmod 755 /test/scripts/nfs_unmount.sh;<br>
<br>
# Create configurations in /test/etc/ghettoVCB/configs/<br>
<br>
# Create list as /test/etc/ghettoVCB/machines.list<br>
</p><p>
<br>
# Rebuild and save bootbank<br>
cd /test;<br>
tar -czvf oem.tgz * .ssh/;<br>
cp -dpR /bootbank/oem.tgz /bootbank/oem.tgz.backup;<br>
mv oem.tgz /bootbank;<br>
cp /bootbank/oem.tgz /vmfs/volumes/nfs_backup_storage/oem.tgz;<br>
cd ..;<br>
rm -r test;<br>
</p><p>
# Extend crontab<br>
/bin/kill $(cat /var/run/crond.pid)<br>
/bin/echo "05 3 * * * /scripts/ghettoVCB.sh -f 
/etc/ghettoVCB/machines.list -c /etc/ghettoVCB/configs" &gt;&gt; 
/var/spool/cron/crontabs/root<br>
/bin/echo "04 * * * * /scripts/nfs_tunnel_check.sh" &gt;&gt; 
/var/spool/cron/crontabs/root<br>
/bin/busybox crond<br>
</p><p>
# Make changes persistent<br>
/bin/echo "" &gt;&gt; /etc/rc.local<br>
/bin/echo "/bin/kill \$(cat /var/run/crond.pid)" &gt;&gt; /etc/rc.local<br>
/bin/echo "/bin/echo \"05 3 * * * /scripts/ghettoVCB.sh -f 
/etc/ghettoVCB/machines.list -c /etc/ghettoVCB/configs\" &gt;&gt; 
/var/spool/cron/crontabs/root" &gt;&gt; /etc/rc.local<br>
/bin/echo "/bin/echo \"04 * * * * /scripts/nfs_tunnel_check.sh\" 
&gt;&gt; /var/spool/cron/crontabs/root" &gt;&gt; /etc/rc.local<br>
/bin/echo "/bin/busybox crond" &gt;&gt; /etc/rc.local<br>
/bin/echo "/scripts/nfs_tunnel_open.sh 730d" &gt;&gt; /etc/rc.local<br>
/bin/echo "/scripts/nfs_mount.sh" &gt;&gt; /etc/rc.local<br>
/sbin/auto-backup.sh<br>
cp /bootbank/state.tgz /vmfs/volumes/nfs_backup_storage/state.tgz;
					</p>
				</div>
				<a name="comments-14890"></a>
				<div id="comment-14890" class="jive-content-comment ">
					<span>
						<span>
							Mar 14, 2010 12:17 PM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-9YrS6b3KgPR3kCF6" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14862" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14890">
					Post removed cause problem solved.
					</p>
				</div>
				<a name="comments-14877"></a>
				<div id="comment-14877" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 15, 2010 9:12 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-nPoMv0S8lkmkdG64" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14862" title="Go to message">buekkes</a>
							</em>
					</span>
					<p id="comment-body-14877">
					Very interesting, buekkes. I am only puzzled at one thing: Is there
 any particular reason for utilizing rc.local to modify crontab, as 
opposed to just include the modified crontab in your oem.tgz?<br>
<br>
I think you're right in keeping the tunneling in (a) separate wrapper 
script(s); it's that special. Myself, I rolled a wrapper script to 
upload the logs for automated inspection, using scp. Like you, I guess, 
my approach grew just so much that it a. requires modified bootbank, b. 
thus is not very usable to the random non-linuxy user and c. thus should
 not be included in the main script.<br>
<br>
lamw: My rollout has worked out OK so far, modifying oem.tgz and all. 
The info at <a class="jive-link-external" 
href="http://idrift.no/gaute/ghettovcb/">http://idrift.no/gaute/ghettovcb/</a>
 has been updated, although I haven't put detailed commands like 
buekkes. I think my approach should really only be used by those with <i>some</i>
 Linux experience, anyway.<br>
<br>
I really hope you'll consider my suggestions for improved logging, and 
sourcing a config file (if present). I guess others who use wrappers 
could mimic my approach too, and put their own variables in the same 
config file.<br>
<br>
Next, I'm going to try out ghettoVCBg2... <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0">
					</p>
				</div>
				<a name="comments-14879"></a>
				<div id="comment-14879" class="jive-content-comment ">
					<span>
						<span>
							Mar 16, 2010 11:41 AM
						</span>
							<!--<a href="/people/DjinjiRinji" title="Click to view DjinjiRinji's profile">
<img class="jive-avatar" src="/people/DjinjiRinji/avatar/16.png?a=-1" height="16" width="16" title="Click to view DjinjiRinji's profile" alt="Click to view DjinjiRinji's profile" />
</a>--><a href="http://communities.vmware.com/people/DjinjiRinji" 
id="jive-lBf3yxc8dTFiaQI5" class="jive-username-link" title="Click to 
view DjinjiRinji's profile">DjinjiRinji</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14879">
					Hello William and all the people here.<br>
IÂ´m trying to use this exellent script but iÂ´m getting erros and donÂ´t 
know whatÂ´s the problem.<br>
IÂ´m running ESX4 and i donÂ´t have a NFS server. Just i need a local 
backup to copy the files to other ESX.<br>
one thing itÂ´s the BK folder..... the script itÂ´s looking for a 
directoty with date in format 2010-03-16 but i see folders with names 
like TS2003-123--1<br>
<br>
why itÂ´s those characters --1 there<br>
thanks for help me<br>
best regards<br>
<br>
./VIM.sh -f VM_BACKUP_UP_LIST<br>
2010-03-16 15:21:56 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
2010-03-16 15:21:56 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/Storage2/backupvm<br>
2010-03-16 15:21:56 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-03-16 15:21:56 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-03-16 15:21:56 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-03-16 15:21:56 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-03-16 15:21:56 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-03-16 15:21:56 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-03-16 15:21:56 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-03-16 15:21:56 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-03-16 15:21:56 -- info: CONFIG - LOG_LEVEL = info<br>
2010-03-16 15:21:56 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-03-16 15:21:56 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-03-16 15:21:56 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-03-16 15:21:56 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
2010-03-16 15:21:59 -- info: Initiate backup for TS2003<br>
2010-03-16 15:21:59 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-03-16" for TS2003<br>
Create Snapshot:<br>
Missing required argument<br>
./VIM.sh: line 616: 
/vmfs/volumes/Storage2/backupvm/TS2003/TS2003-123/TS2003.vmdk: No such 
file or directory<br>
2010-03-16 15:22:04 -- info: Removing snapshot from TS2003 ...<br>
2010-03-16 15:22:10 -- info: Backup Duration: 11 Seconds<br>
2010-03-16 15:22:10 -- info: Successfully completed backup for TS2003!<br>
<br>
2010-03-16 15:22:10 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
				<a name="comments-14872"></a>
				<div id="comment-14872" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 17, 2010 9:52 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-cH5vEzkwDK7YDbaG" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14879" title="Go to message">DjinjiRinji</a>
							</em>
					</span>
					<p id="comment-body-14872">
					Hi,<br>
<br>
Can you please post the output of the debug logs onto <a 
class="jive-link-external" href="http://pastebin.com/">http://pastebin.com/</a>
  and provide the link. <br>
<br>
Thanks<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14886"></a>
				<div id="comment-14886" class="jive-content-comment ">
					<span>
						<span>
							Mar 19, 2010 8:50 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-aStak0H3B36I2suJ" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14886">
					Hello,<br>
<br>
IÂ´am using your script successful on a server with an attached iSCSI 
storage.<br>
<br>
On another server I tried to use the script for backup to an NFS 
storage. The NFS is built on an openSUSE 11. I can mount the NFS to the 
ESXi server but the script tells me, that the file system is read only.<br>
<br>
What can be wrong with the NFS?<br>
<br>
The NFS is built with four 256GB VMDKs wich are together a 1TB logical 
volume with ext3 (I also tried ext4). The logical volume is mounted to 
/mnt/nfs and the NFS storage shows to that mountpoint. This are the 
options for the NFS 
"fsid=0,crossmnt,ro,root_squash,sync,no_subtree_check".<br>
<br>
Is there any error I do?
					</p>
				</div>
				<a name="comments-14912"></a>
				<div id="comment-14912" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 19, 2010 9:59 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-nTorRXgJ32N27Id9" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14886" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-14912">
					It's your NFS config which contains "ro" - meaning read-only. See 
William's section "Our NFS Server Configuration", under "NFS Export 
Options:".<br>
<br>
-gaute
					</p>
				</div>
				<a name="comments-14913"></a>
				<div id="comment-14913" class="jive-content-comment ">
					<span>
						<span>
							Mar 19, 2010 11:10 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-uJO4jJwP1Sk383S9" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14912" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14913">
					Hi gaute,<br>
<br>
thanks for your reply. I have now set the option to 
"rw,async,all_squash,anonuid=99,anongid=99" but I get now the error 
permission denied. Is there any additional parameter I need?
					</p>
				</div>
				<a name="comments-14915"></a>
				<div id="comment-14915" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 19, 2010 11:39 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Yn9oqQojd3Rkp6NV" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14913" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-14915">
					Are you mounting the NFS volume as root and using the vSphere 
Client or esxcfg-nas?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14916"></a>
				<div id="comment-14916" class="jive-content-comment ">
					<span>
						<span>
							Mar 19, 2010 12:22 PM
						</span>
							<!--<a href="/people/bando" title="Click to view bando's profile">
<img class="jive-avatar" src="/people/bando/avatar/16.png?a=-1" height="16" width="16" title="Click to view bando's profile" alt="Click to view bando's profile" />
</a>--><a href="http://communities.vmware.com/people/bando" 
id="jive-Ur48UgLvGkWXP2Qr" class="jive-username-link" title="Click to 
view bando's profile">bando</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14132" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14916">
					I recently ran ghetto backup to backup a system with quiesce and 
memory switches turned on (backup memory). When I restored the system I 
expected it to come up where it had left off (during the backup glxgears
 were spinning) and I was logged on to the system via a console. After 
the backup we shutdown the original system and powered up the restored 
one. Shouldn't it have brought me into the console sessions with the 
glxgears running?  If not, then what does the memory backup do?  many 
thanks...
					</p>
				</div>
				<a name="comments-14918"></a>
				<div id="comment-14918" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 19, 2010 1:03 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Afi69pWFVVi3B4KI" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14916" title="Go to message">bando</a>
							</em>
					</span>
					<p id="comment-body-14918">
					bando,<br>
<br>
Sorry about the last reply, I must be having a brain freeze this morning
 (still recovering from a cold).<br>
<br>
So this option was initially added for testing and in case users wanted 
the snapshot to also capture the state of the system in case something 
happened. This state is stored in the .vmsn file which corresponds to a 
VM snapshot being taken. The snapshot is used so that the primary disks 
would be unlocked and that we could back up the VM, once the backup 
completed, the snapshot would then be committed and the delta would be 
merged back and .vmsn would be removed. The backup would contain all 
changes up to the snapshot, all changes after would be in the "live" 
running VM and would not be captured as part of the backup. The backups 
will always contain an offline VM as it does not capture the 
snapshots/etc. <br>
<br>
So the behavior is expected, unless you capture the specific snapshot + 
.vmsn, upon restore would you then keep the same state. Again, snapshots
 are not meant to be kept for long durations or backed up. <br>
<br>
Another issue around the .vmsn is if you change hardware, you may not be
 able to power on the VM.<br>
<br>
I thought I had this documented but perhaps I missed it, this maybe 
something I just need to remove all together in a future release to not 
cause any confusion. <br>
<br>
Hopefully that answered your question.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14919"></a>
				<div id="comment-14919" class="jive-content-comment ">
					<span>
						<span>
							Mar 19, 2010 1:59 PM
						</span>
							<!--<a href="/people/bando" title="Click to view bando's profile">
<img class="jive-avatar" src="/people/bando/avatar/16.png?a=-1" height="16" width="16" title="Click to view bando's profile" alt="Click to view bando's profile" />
</a>--><a href="http://communities.vmware.com/people/bando" 
id="jive-Qy1xrzQ75VR7FxL7" class="jive-username-link" title="Click to 
view bando's profile">bando</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14918" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14919">
					Cool... this now sets me to thinking, and that leads to other 
questions:<br>
<br>
1. The memory file size issue is mainly determining how many Gbytes of 
memory you have and that adds to the overall size of the backup &amp; 
snapshot space... is that the concern? <br>
<br>
2. While we're at it, I figure that for a minimum snapshot free space of
 an average 20Gbyte VM client that is backed up should be a couple 
Gbytes. Most clients I've backed up so far are on VM servers with plenty
 of Gbytes free space so no issues EXCEPT for one that failed because it
 had only 1/2 Gbytes free space. I test backed it up with the POWER_DOWN
 switch and it worked perfectly as expected. Is there a rule of thumb 
formula for determining snapshot space?<br>
<br>
3. Our database backups are performed frequently and separate from the 
ghetto VM client backups. That way I perform a quiesced monthly backup 
of those mysql servers for the purpose of a "system" restore should we 
have a major failure. The ghetto client backup is a monthly thing mainly
 to restore the system, should we have a VM server or client failure; 
then the database would be restored separately. It seems like a prudent 
use of the tools... any comments?<br>
<br>
Many thanks...
					</p>
				</div>
				<a name="comments-14920"></a>
				<div id="comment-14920" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 19, 2010 2:36 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4vT47r6GU5ophFRd" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14919" title="Go to message">bando</a>
							</em>
					</span>
					<p id="comment-body-14920">
					1) That is correct, when you capture the memory, now you have to 
account for the additional .vmsn which is equal to the size of the 
configured VM. Also, the script doesn't backup snapshots, so capturing 
the .vmsn would not be helpful. It's only useful when you revert/goto a 
specific snapshot (point in time) and you wanted to preserve memory 
state, remember all backups of the VM is offline whether or not the 
source was running or not. <br>
<br>
2) No rule thumb or formula unfortunately, it really depends on the VM 
and the application that is running and how much changes are going on 
during the duration of the backup. The longer the backup takes to 
transfer, potentially larger the snapshot gets. I guess if you really 
want to be safe, the maximum size of a single snapshot that it could 
ever be generated (assuming no funny glitches) is the largest VM that 
you have in your environment. Remember a that  a <u>single</u> snapshot 
can grow up to the original size of the VM and that multiple snapshots 
can surpass the size of your origianl VM. Though in general, I think 
20-30% free space would be more than enough<br>
<br>
3) Yea I've been asked about this and unfortunately I can't provide too 
much insight into it since it really depends on your database and number
 of  transactions occuring. In general, it's a best practice to use 
tools such as VSS or other quiescing tools within the OS to ensure 
consistency, hence the quiesce option when taking a snapshot, I know on 
the db side there are things you could do, though I'm not a dba, so I 
can't confirm. It's good that you're at least capturing a system image 
in case of  a failure, at least you'll have an image of the system. I 
know some users have played it safe and shutdown their database to take a
 backup, though I know majority of the environments out there can't take
 a downtime for backups and must do it live. I would also recommend 
looking at backups at the database layer, perhaps that might be better 
for things like SQL Server or Oracle<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14936"></a>
				<div id="comment-14936" class="jive-content-comment ">
					<span>
						<span>
							Mar 20, 2010 4:01 PM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-g9G4ziQ6RD6JMh9f" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14913" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-14936">
					I'd advise you drop the "all_squash,anonuid=99,anongid=99" config 
and try "no_root_squash". At least at first. If that works, you know the
 cause of your permissions problems.<br>
<br>
I'd just use no_root_squash if I was you, but if you absolutely have to,
 you can then try to get it working with other permissions.
					</p>
				</div>
				<a name="comments-14922"></a>
				<div id="comment-14922" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 21, 2010 2:59 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-q4oD29q7SI2bu5qV" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14936" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-14922">
					Thank you very much, the hint with "no_root_squash" was perfect. I 
have set my options now to 
"fsid=0,crossmnt,rw,no_root_squash,async,no_subtree_check,anonuid=99,anongid=99".

					</p>
				</div>
				<a name="comments-14950"></a>
				<div id="comment-14950" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 7:39 AM
						</span>
							<!--<a href="/people/DjinjiRinji" title="Click to view DjinjiRinji's profile">
<img class="jive-avatar" src="/people/DjinjiRinji/avatar/16.png?a=-1" height="16" width="16" title="Click to view DjinjiRinji's profile" alt="Click to view DjinjiRinji's profile" />
</a>--><a href="http://communities.vmware.com/people/DjinjiRinji" 
id="jive-l7do0Mf8eh6X605D" class="jive-username-link" title="Click to 
view DjinjiRinji's profile">DjinjiRinji</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14872" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14950">
					Hi lamw i posted the log output.<br>
<br>
<a class="jive-link-external" href="http://pastebin.com/YN4Xpuav">http://pastebin.com/YN4Xpuav</a><br>
<br>
Thnaks in advance
					</p>
				</div>
				<a name="comments-14951"></a>
				<div id="comment-14951" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 9:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FY5y8HN78c1Tt8HU" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14950" title="Go to message">DjinjiRinji</a>
							</em>
					</span>
					<p id="comment-body-14951">
					Can you re-run your backup using <b>dryrun</b> mode, unfortunately 
from these logs, there isn't much I can go off of.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14953"></a>
				<div id="comment-14953" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 9:42 AM
						</span>
							<!--<a href="/people/DjinjiRinji" title="Click to view DjinjiRinji's profile">
<img class="jive-avatar" src="/people/DjinjiRinji/avatar/16.png?a=-1" height="16" width="16" title="Click to view DjinjiRinji's profile" alt="Click to view DjinjiRinji's profile" />
</a>--><a href="http://communities.vmware.com/people/DjinjiRinji" 
id="jive-TC4f82xNVMvWM0mK" class="jive-username-link" title="Click to 
view DjinjiRinji's profile">DjinjiRinji</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14951" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14953">
					Dry run looks nice.... It founds the vmdk file.<br>
<br>
<a class="jive-link-external" href="http://pastebin.com/pvX8L2CS">http://pastebin.com/pvX8L2CS</a>
					</p>
				</div>
				<a name="comments-14954"></a>
				<div id="comment-14954" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 9:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FOT8A4J1ta2Fi1ss" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14953" title="Go to message">DjinjiRinji</a>
							</em>
					</span>
					<p id="comment-body-14954">
					So I don't recall if this is a use case I had tested extensively, 
where your "source" VM is not directly located at the root of the 
datastore, there is a sub-folder in which the VM is hosted in. <br>
<br>
I would need to run a few tests to see if this would cause any issues. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14929"></a>
				<div id="comment-14929" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 10:30 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-2El4yi7k96687Twm" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-14929">
					Hi,<br>
<br>
I've got an issue which is described here :<br>
<a class="jive-link-external" 
href="http://communities.vmware.com/message/1499246#1499246">http://communities.vmware.com/message/1499246#1499246</a><br>
<br>
More information : <br>
<br>
</p><ul class="jive-dash">
<li>My datastore has 1.3T available.</li>
<li>I use a local datastore for my backup (the VM are on the same 
datastore)</li>
<li>I want to compress my backup</li>
</ul>
<p>
I'll erase the snapshot which prevent me to do the backup again, and 
I'll try to reproduce the issue in debug mode.
					</p>
				</div>
				<a name="comments-14955"></a>
				<div id="comment-14955" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 10:38 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-k4KMYhuVuG6soE1O" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14929" title="Go to message">romgo75</a>
							</em>
					</span>
					<p id="comment-body-14955">
					Careful with compression on ESXi, with ESXi 3.5 the maximum size is
 4GB and with ESXi 4.0 the maximum size is 8GB. This is limitation of 
the ESXi unsupported Busybox console, so you won't be able to use 
compression to properly extract the contents upon a restore.  <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14956"></a>
				<div id="comment-14956" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 10:50 AM
						</span>
							<!--<a href="/people/DjinjiRinji" title="Click to view DjinjiRinji's profile">
<img class="jive-avatar" src="/people/DjinjiRinji/avatar/16.png?a=-1" height="16" width="16" title="Click to view DjinjiRinji's profile" alt="Click to view DjinjiRinji's profile" />
</a>--><a href="http://communities.vmware.com/people/DjinjiRinji" 
id="jive-Dh47KYtWqy74oNaA" class="jive-username-link" title="Click to 
view DjinjiRinji's profile">DjinjiRinji</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14954" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14956">
					Hi Lamw.... one thing i see... if i choose thin disk to backup 
everything goes OK.<br>
<br>
What could be the problem using zeroedthick disk type?
					</p>
				</div>
				<a name="comments-14957"></a>
				<div id="comment-14957" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 10:54 AM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-d8735xMYiB944a3u" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14955" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14957">
					</p><div class="jive-quote">Careful with compression on ESXi, with 
ESXi 3.5 the maximum size is 4GB and with ESXi 4.0 the maximum size is 
8GB.</div>
<br>
Interesting...  Does this limitation flow through to OVFTool as well?  I
 had some enormous problems migrating a VM on ESXi 3.5 to another ESXi 
3.5 box on the weekend due to what appeared to be a max size of 8GB per 
'chunk'.  But even creating an OVF with 7GB chunksize failed as well, so
 I'm not sure if this was related.  Surprisingly migration using VM 
Converter worked flawlessly.  <br>
<br>
Anyway not trying to go too 'off-topic' with this - but am curious if 
the compression issues stated here would affect any app or script on 
these boxes and not just ghettoVCB?
					
				</div>
				<a name="comments-14958"></a>
				<div id="comment-14958" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 11:18 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-43MxLIKkoz09Qv50" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14956" title="Go to message">DjinjiRinji</a>
							</em>
					</span>
					<p id="comment-body-14958">
					That's pretty interesting, there shouldn't be any issues using any 
of the disk formats. Are you seeing this problem with all your VMs? or 
just this specific one? Can you verify this?<br>
<br>
What disk format is your source VM and how big is it? <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14959"></a>
				<div id="comment-14959" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 11:28 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-QAWHIFfvjO12UK38" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14957" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-14959">
					I've not done any testing with ovftool, though I would hope not, 
though can't say for sure. The actual compressed limitation was 
identified by a user, I forget which comment it was noted in. This 
limitation of the utlities within the Busybox console, this <u>should</u>
 not affect classic ESX. <br>
<br>
I've thought about it in the past to use <b>ovftool</b> to generate a 
backup but haven't spent much time and it might actually be pretty slow 
and on larger VMs, it might not be too effective. <br>
<br>
Curious, have you ran into the same issue if you manually exported using
 the vSphere Client out to OVF format? <br>
<br>
Regarding your general question, this probably affects any type of 
compression with the use of tar with any files within the unsupported 
console. Technically there shouldn't be anything that would need to 
compress a file larger than 8GB, even the backups that are taken of the 
ESXi configuration is in kb sizes. So there should not be a need, 
remember that this console is only for troubleshooting purposes, it's 
not meant to be a general console for you to install or store files. 
Hence 8GB probably is more than enough<br>
<br>
I still need to update some documentation around the compressed 
limitation + XFS resolution to NFS problem that some of the users have 
seen. Hopefully get to that sometime this week and update the FAQ's.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14960"></a>
				<div id="comment-14960" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 12:14 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-8D4w87SrkX7A9hWG" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14959" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14960">
					</p><div class="jive-quote">I've thought about it in the past to 
use ovftool to generate a backup but haven't spent much time and it 
might actually be pretty slow and on larger VMs, it might not be too 
effective.</div>
<br>
No, actually its pretty fast - mainly because the compression is very 
good.  The problem, however, is that it forces you to power down the 
source VM before you start.  That doesn't work for us in a 24/7 
environment.<br>
<br>
<div class="jive-quote">Curious, have you ran into the same issue if you
 manually exported using the vSphere Client out to OVF format? </div>
<br>
Strange thing is that using VM Converter (converting source VM to target
 VM across ESXi hosts) worked without an issue.  Mind you, it took 6 
hours to run on a 80GB drive.  But it did maintain all the correct host 
configuration settings so I could restart the Linux VM afterwards 
without issue.  This VM had grown over time and had multiple VMDKs on 
it, with LVM and the problem was doing a clone with ghettoVCB and trying
 to restore from that never let me maintain drive names, etc. making the
 LVM die on boot each time.<br>
<br>
I haven't tried using any other tool to create the OVF file though.  
Since an OVF file would be (in essence) generic and could be restarted 
on any host, it certainly would be a desirable format for the backup to 
be saved in.  I could see great benefits of backup to OVF and restore on
 a Xen Server, or VirtualBox, etc. if needed.<br>
<br>
Myles
					
				</div>
				<a name="comments-14961"></a>
				<div id="comment-14961" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 12:20 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-2Q8uQSNKevgOGnRo" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14959" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14961">
					</p><div class="jive-quote">Curious, have you ran into the same 
issue if you manually exported using the vSphere Client out to OVF 
format? </div>
<br>
One other thing comes to mind here, though....<br>
<br>
if the goal is to create a rapid backup AND rapid restore process, you 
could clone the VMDKs to other files, but possibly integrate OVFTool 
into the script to create the OVF and MF (Manifest) files for those 
VMDKs.  I tried doing this with the VM not being in powered down state 
and it did work.  Mind you, I could get the target system to boot, but I
 still ran into the LVM issue.  That might be something separate but 
having both the VMDK files AND OVF files, etc. would mean you could 
restore on any other ESXi or OVF supported host quickly and have a full 
configuration and manifest of the original server if needed.<br>
<br>
M
					
				</div>
				<a name="comments-14962"></a>
				<div id="comment-14962" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 12:56 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-W4HkV956Nalkl0Y9" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14960" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-14962">
					</p><div class="jive-quote">
No, actually its pretty fast - mainly because the compression is very 
good. The problem, however, is that it forces you to power down the 
source VM before you start. That doesn't work for us in a 24/7 
environment.<br>
</div>
<br>
Cool, yea I don't use OVF much nor the export functionality, good to 
know. Yea one thing about that tool is that the source must be offline. <br>
<br>
<div class="jive-quote">
Strange thing is that using VM Converter (converting source VM to target
 VM across ESXi hosts) worked without an issue. <br>
</div>
<br>
Converter actually creates a new VM on the destination and keeps the 
source running if it's coming from a live source, so you don't have any 
downtime, though it can take awhile as it transfer the data over. <br>
<br>
<b>ovftool</b> might be something to investigate in, though now you'll 
include a new dependency  that was not once there, since ovftool needs 
to run on a management system (Windows or Linux). The other problem, I 
believe ovftool uses the APIs and if it's regulated like all other 
vSphere API/SDK's, then it won't work on free licensed version of ESXi<br>
<br>
If I get some free cycles from my other projects, I'll go ahead and do 
POC and see if it's something worth looking into deeper.<br>
<br>
Thanks again for all the comments<br>
<p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14963"></a>
				<div id="comment-14963" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 1:06 PM
						</span>
							<!--<a href="/people/mylesw" title="Click to view mylesw's profile">
<img class="jive-avatar" src="/people/mylesw/avatar/16.png?a=-1" height="16" width="16" title="Click to view mylesw's profile" alt="Click to view mylesw's profile" />
</a>--><a href="http://communities.vmware.com/people/mylesw" 
id="jive-4oh5HWHRzyjW1Q3q" class="jive-username-link" title="Click to 
view mylesw's profile">mylesw</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14962" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14963">
					</p><div class="jive-quote">The other problem, I believe ovftool 
uses the APIs and if it's regulated like all other vSphere API/SDK's, 
then it won't work on free licensed version of ESXi</div>
<br>
It did work just fine on 7 of the 8 VMs on my ESXi 3.5 box.  Both in 
creating the OVF file and in restoring from OVF on the target box.  
Didn't look like anything stopped it from working even though it was 
working with ESXi <br>
<br>
<div class="jive-quote">ovftool might be something to investigate in, 
though now you'll include a new dependency that was not once there, 
since ovftool needs to run on a management system (Windows or Linux). 
The other problem, I believe ovftool uses the APIs and if it's regulated
 like all other vSphere API/SDK's, then it won't work on free licensed 
version of ESXi</div>
<br>
When I tried to get OVFTool to work and failed, I did a bit of research 
on it (what it was, where it came from, etc.).  What I found was that it
 looks like it came more from a consortium group rather than something 
proprietary with VMWare.  I might be wrong on this, but as it is used 
across multiple virtualization technologies, I wouldn't be surprised if 
you find that it is actually complete free and open technology.<br>
<br>
Myles
					
				</div>
				<a name="comments-14964"></a>
				<div id="comment-14964" class="jive-content-comment ">
					<span>
						<span>
							Mar 22, 2010 1:44 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-PsQAr1UB6wB9E48Q" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14963" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-14964">
					You mentioned ESXi 3.5, what version or Update? If you're on ESXi 
3.5u2/u3, then you might be bypassing the license check due to VMware 
API bug which was fixed in U4+.<br>
<br>
To really test this, you need to verify on ESXi 3.5u4+ or on ESXi 4.0. 
If you're able to export/import VMs using ovftool, then YES, this can be
 a solution for backups. Though I have a funny feeling that the APIs 
will block you, else this would be a hole they've not fixed and 
potentially can be exploited <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14965"></a>
				<div id="comment-14965" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 22, 2010 2:12 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Stia7qcJI3Nt1C4B" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14963" title="Go to message">mylesw</a>
							</em>
					</span>
					<p id="comment-body-14965">
					I actually just did a quick test on latest version of ESXi 4.0u1 
using <b>ovftool</b> on Windows and using free licensed version. I was 
able to successfully export/import a dummy VM w/o hitting any 
"restrictions". It looks ilke ovftool isn't checking for the licensing 
information. Also note that the whole vApp import/export is using 
something called <b>NFC</b> to actually perform the operations which is 
basically a simple http/https transfer which does actually bypass their 
licensing. <br>
<br>
I'll think about how this might be incorporated into a backup solution, 
as you can see now, not only can the tool be platform independent 
(Windows or Linux), you might not even have to go into the Service 
Console for ESX or unsupported Busybox console for ESXi. All the work 
can be performed from a remote management host, and so long as it can 
talk to the storage in which you want to store the backup, it would 
work.<br>
<br>
Thanks for this information, I'll have to ponder a bit for a solution <img
 class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" 
border="0"> <br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14971"></a>
				<div id="comment-14971" class="jive-content-comment ">
					<span>
						<span>
							Mar 24, 2010 3:28 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-yeBjX4v3uCCy2EUP" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14965" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14971">
					Situation:  I have a Windows 2003 Server Std. that has two virtual 
hard drives on different physical hard drives.  E.G. Separate data 
stores / vmdks.  One, the C: drive, is the OS, and the other, the T: 
drive, Windows exports as an NFS volume which serves as a backup target.
  I noticed that I can use a config file now to alter the backup 
behavior of specific VMs, and in particular the ability to select which 
vmdks will be backed up.<br>
<br>
Mission:  Backup the Windows server C: drive, but not the T: drive NFS 
volume.<br>
<br>
Problem:  I set up the config file to backup only one of the two vmdks, 
the C: drive.  Referencing the log below, when the script runs, it 
acknowledges the request to backup only one of the vmks, but it also 
shows in the execution area that it will backup both.  <br>
<br>
What am I missing?  Thanks!<br>
<br>
==============================================<br>
A listing of /vmfs/volumes/datastore1/ghettoVCB looks like this:<br>
admin2<br>
admin2_list<br>
admin2-backup.sh<br>
ghettoVCB.sh<br>
<br>
The script that calls it,  admin2-backup.sh, contains this:<br>
/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB.sh -f 
/vmfs/volumes/datastore1/ghettoVCB/admin2_list -c 
/vmfs/volumes/datastore2/ghettoVCB -d dryrun -l 
/vmfs/volumes/nas-2/log/admin2-backup.log<br>
<br>
The config, admin2 contains this:<br>
VM_BACKUP_VOLUME=//vmfs/volumes/nas-1/backups/server2<br>
DISK_BACKUP_FORMAT=thin<br>
VM_BACKUP_ROTATION_COUNT=1<br>
POWER_VM_DOWN_BEFORE_BACKUP=0<br>
ENABLE_HARD_POWER_OFF=0<br>
ITER_TO_WAIT_SHUTDOWN=4<br>
POWER_DOWN_TIMEOUT=5<br>
SNAPSHOT_TIMEOUT=15<br>
ENABLE_COMPRESSION=0<br>
ADAPTER_FORMAT=lsilogic<br>
VM_SNAPSHOT_MEMORY=0<br>
VM_SNAPSHOT_QUIESCE=0<br>
VMDK_FILES_TO_BACKUP="admin2.vmdk"<br>
<br>
The log, /vmfs/volumes/nas-2/log/admin2-backup.log, contains this:<br>
2010-03-24 21:01:19 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
2010-03-24 21:01:20 -- info: CONFIG - USING CONFIGURATION FILE = 
/vmfs/volumes/datastore1/ghettoVCB/admin2<br>
2010-03-24 21:01:20 -- info: CONFIG - VM_BACKUP_VOLUME = 
//vmfs/volumes/nas-1/backups/server2<br>
2010-03-24 21:01:20 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1<br>
2010-03-24 21:01:20 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-03-24 21:01:20 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-03-24 21:01:20 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-03-24 21:01:20 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-03-24 21:01:20 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 4<br>
2010-03-24 21:01:20 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-03-24 21:01:20 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-03-24 21:01:20 -- info: CONFIG - LOG_LEVEL = dryrun<br>
2010-03-24 21:01:20 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/vmfs/volumes/nas-2/log/admin2-backup.log<br>
2010-03-24 21:01:20 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-03-24 21:01:20 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-03-24 21:01:20 -- info: CONFIG - VMDK_FILES_TO_BACKUP = admin2.vmdk<br>
<br>
2010-03-24 21:01:20 -- dryrun: 
###############################################<br>
2010-03-24 21:01:20 -- dryrun: Virtual Machine: admin2<br>
2010-03-24 21:01:20 -- dryrun: VM_ID: 304<br>
2010-03-24 21:01:20 -- dryrun: VMX_PATH: 
/vmfs/volumes/datastore1/admin2/admin2.vmx<br>
2010-03-24 21:01:20 -- dryrun: VMX_DIR: /vmfs/volumes/datastore1/admin2<br>
2010-03-24 21:01:20 -- dryrun: VMX_CONF: admin2/admin2.vmx<br>
2010-03-24 21:01:20 -- dryrun: VMFS_VOLUME: datastore1<br>
2010-03-24 21:01:20 -- dryrun: VMDK(s): <br>
2010-03-24 21:01:20 -- dryrun: 	
/vmfs/volumes/4a3b4c4e-2d38530e-0c2c-003048d937e7/admin2/admin2_1.vmdk<br>
2010-03-24 21:01:20 -- dryrun: 	admin2.vmdk<br>
2010-03-24 21:01:20 -- dryrun: 
###############################################<br>
<br>
2010-03-24 21:01:20 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
				<a name="comments-14973"></a>
				<div id="comment-14973" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 24, 2010 3:41 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-DeM3ohuc44EmVMmn" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14971" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-14973">
					The output is expected based on your setup, you're running <b>dryrun</b>
 which does not go through the logic of validating a VM for backup or 
it's VMDK(s) etc. The verbiage may be miss-leading but this was put in 
place to help me in troubleshooting user issues. <br>
<br>
When you go through the actual backup process, it'll go ahead and verify
 that all valid disks that are found will also be checked against <b>VMDK_FILES_TO_BACKUP</b>
 variable and check if it's set to either "all" in which case, all valid
 VMDK(s) will be backed up, else it'll compare the VMDK(s) to see which 
it should allow through.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14974"></a>
				<div id="comment-14974" class="jive-content-comment ">
					<span>
						<span>
							Mar 24, 2010 3:48 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-i8ej3v56iapp38O5" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14973" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14974">
					Perfect!  Thank you for answering, and so quickly.  What an 
incredible script.<br>
THANK YOU, THANK YOU, THANK YOU
					</p>
				</div>
				<a name="comments-14975"></a>
				<div id="comment-14975" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 24, 2010 4:23 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7Wn0yiHUwOX6zpI4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14974" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-14975">
					np. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14995"></a>
				<div id="comment-14995" class="jive-content-comment ">
					<span>
						<span>
							Mar 25, 2010 6:55 AM
						</span>
							<!--<a href="/people/QuebecCityVMwareUserGroup" title="Click to view QuebecCityVMwareUserGroup's profile">
<img class="jive-avatar" src="/people/QuebecCityVMwareUserGroup/avatar/16.png?a=2504" height="16" width="16" title="Click to view QuebecCityVMwareUserGroup's profile" alt="Click to view QuebecCityVMwareUserGroup's profile" />
</a>--><a 
href="http://communities.vmware.com/people/QuebecCityVMwareUserGroup" 
id="jive-JQdluembnDHjOiBa" class="jive-username-link" title="Click to 
view QuebecCityVMwareUserGroup's profile">QuebecCityVMwâ€¦</a>&nbsp;&nbsp;says:

					</span>
					<p id="comment-body-14995">
					Hi<br>
this my problem: on my redhat it works but not on the other servers!<br>
The size of these servers who are very big server can t he etre the 
reason?<br>
<br>
/vmfs/volumes/4b7ecd5f-26a47d05-5b67-0026b975af67 # cat ghetto_VCB.log<br>
2010-03-23 21:00:01 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-03-23 21:00:01 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/NFS/SAUVEGARDE/VM<br>
2010-03-23 21:00:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-03-23 21:00:01 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-03-23 21:00:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-03-23 21:00:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-03-23 21:00:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-03-23 21:00:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-03-23 21:00:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-03-23 21:00:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-03-23 21:00:01 -- info: CONFIG - LOG_LEVEL = info<br>
2010-03-23 21:00:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-03-23 21:00:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-03-23 21:00:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-03-23 21:00:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-03-23 21:00:03 -- info: Snapshot found for DNS-GLPI-OCS, backup 
will not take place<br>
<br>
2010-03-23 21:00:03 -- info: Snapshot found for Toshiba-Efms, backup 
will not take place<br>
<br>
2010-03-23 21:00:04 -- info: Initiate backup for RedHat<br>
2010-03-23 21:00:04 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-03-23" for RedHat<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore2/RedHat/RedHat.vmdk'...<br>
Clone: 100% done.<br>
2010-03-23 21:07:47 -- info: Removing snapshot from RedHat ...<br>
2010-03-23 21:07:52 -- info: Backup Duration: 7.80 Minutes<br>
2010-03-23 21:07:52 -- info: Successfully completed backup for RedHat!<br>
<br>
2010-03-23 21:07:54 -- info: Initiate backup for Samba Debian<br>
2010-03-23 21:07:54 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-03-23" for Samba Debian<br>
2010-03-23 21:23:08 -- info: Snapshot timed out, failed to create 
snapshot: "ghettoVCB-snapshot-2010-03-23" for Samba Debian<br>
2010-03-23 21:23:08 -- info: Backup Duration: 15.23 Minutes<br>
2010-03-23 21:23:08 -- info: Error: Unable to backup Samba Debian due to
 snapshot creation!<br>
<br>
2010-03-23 21:23:08 -- info: Snapshot found for zimbra, backup will not 
take place<br>
<br>
2010-03-23 21:23:08 -- info: ============================== ghettoVCB 
LOG END ================================<br>
<br>
2010-03-24 21:00:01 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-03-24 21:00:01 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/NFS/SAUVEGARDE/VM<br>
2010-03-24 21:00:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-03-24 21:00:01 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-03-24 21:00:01 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-03-24 21:00:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-03-24 21:00:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-03-24 21:00:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-03-24 21:00:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-03-24 21:00:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 60<br>
2010-03-24 21:00:01 -- info: CONFIG - LOG_LEVEL = info<br>
2010-03-24 21:00:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-03-24 21:00:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-03-24 21:00:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-03-24 21:00:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-03-24 21:00:02 -- info: Snapshot found for DNS-GLPI-OCS, backup 
will not take place<br>
<br>
2010-03-24 21:00:02 -- info: Snapshot found for Toshiba-Efms, backup 
will not take place<br>
<br>
2010-03-24 21:00:03 -- info: Initiate backup for RedHat<br>
2010-03-24 21:00:03 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-03-24" for RedHat<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore2/RedHat/RedHat.vmdk'...<br>
Clone: 100% done.<br>
2010-03-24 21:07:44 -- info: Removing snapshot from RedHat ...<br>
2010-03-24 21:07:49 -- info: Backup Duration: 7.77 Minutes<br>
2010-03-24 21:07:49 -- info: Successfully completed backup for RedHat!<br>
<br>
2010-03-24 21:07:50 -- info: Initiate backup for Samba Debian<br>
2010-03-24 21:07:50 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-03-24" for Samba Debian<br>
2010-03-24 22:08:42 -- info: Snapshot timed out, failed to create 
snapshot: "ghettoVCB-snapshot-2010-03-24" for Samba Debian<br>
2010-03-24 22:08:42 -- info: Backup Duration: 60.87 Minutes<br>
2010-03-24 22:08:42 -- info: Error: Unable to backup Samba Debian due to
 snapshot creation!<br>
<br>
2010-03-24 22:08:42 -- info: Snapshot found for zimbra, backup will not 
take place<br>
<br>
2010-03-24 22:08:42 -- info: ============================== ghettoVCB 
LOG END ================================<br>
Thank<br>
<br>
francois
					</p>
				</div>
				<a name="comments-14997"></a>
				<div id="comment-14997" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 25, 2010 10:32 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-RgI0G5wu600Cwx0E" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14995" title="Go to message">QuebecCityVMwâ€¦</a>
							</em>
					</span>
					<p id="comment-body-14997">
					So you probably know why the backups aren't take place since the 
snapshots were not removed and backup script does not support VMs with 
existing snapshots. <br>
<br>
Now the reason for this problem is not the script but from what I've 
seen being reported and primarily pertaining to an "NFS" configuration, 
potentially (hardware/software) that causes an issue with using NFS on 
ext3 vs NFS on XFS filesystem.<br>
<br>
Please take a look at my comment here for some details: <a 
class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-14679">http://communities.vmware.com/docs/DOC-8760#comments-14679</a><br>
<br>
Regarding why this occurs, I'm still not 100% sure. I've not been able 
to re-produce this and haven't found much commonality between the 
various reports, though it generally occurs from what I can tell on 
larger VMs but I believe there's been reports of this on smaller VMs as 
well. <br>
<br>
Not enough users have gone through further troubleshooting to further 
isolate and there just hasn't been much feedback from the community 
after my comment from above. <br>
<br>
Pretty confident that you're probably affected by this and if you 
implement the fix, the issue <b>should</b> go away.<br>
<br>
I'm looking to update the documentation with some of these findings, if 
anyone would like to share more information about the issue, please let 
me know.<br>
<br>
Thanks <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14984"></a>
				<div id="comment-14984" class="jive-content-comment ">
					<span>
						<span>
							Mar 25, 2010 5:47 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-CHVH4m8O64vk7VNv" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14997" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14984">
					
					</p>
				</div>
				<a name="comments-15011"></a>
				<div id="comment-15011" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 26, 2010 8:05 AM
						</span>
							<!--<a href="/people/cwhitmore" title="Click to view cwhitmore's profile">
<img class="jive-avatar" src="/people/cwhitmore/avatar/16.png?a=-1" height="16" width="16" title="Click to view cwhitmore's profile" alt="Click to view cwhitmore's profile" />
</a>--><a href="http://communities.vmware.com/people/cwhitmore" 
id="jive-7D3W3mg525DhFg4H" class="jive-username-link" title="Click to 
view cwhitmore's profile">cwhitmore</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15011">
					I seem to be on here every few months with a new problem. I'm 
getting an error after the script backs up the first VM. Here is a 
screen capture: <br>
<br>
/vmfs/volumes/48f62e13-c6958ca2-6bc2-0022198dec59 # ./ghettoVCB.sh -f 
vmbackups<br>
(vim.fault.DuplicateName) {<br>
   dynamicType = &lt;unset&gt;,<br>
   name = "NFS",<br>
   object = 'vim.Datastore:192.168.111.65:/mnt/vg1/data1/backup',<br>
   msg = "The name 'NFS' already exists."<br>
}<br>
2010-03-26 12:50:21 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-03-26 12:50:21 -- info: CONFIG - VM_BACKUP_VOLUME =<br>
2010-03-26 12:50:21 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 5<br>
2010-03-26 12:50:21 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-03-26 12:50:21 -- info: CONFIG - ADAPTER_FORMAT = lsilogic<br>
2010-03-26 12:50:21 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-03-26 12:50:21 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-03-26 12:50:21 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-03-26 12:50:21 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-03-26 12:50:21 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-03-26 12:50:21 -- info: CONFIG - LOG_LEVEL = info<br>
2010-03-26 12:50:21 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-03-26 12:50:21 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-03-26 12:50:21 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2010-03-26 12:50:21 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-03-26 12:50:22 -- info: Initiate backup for LegalFiles<br>
2010-03-26 12:50:22 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-03-26" for LegalFiles<br>
Destination disk format: VMFS thick<br>
Cloning disk 
'/vmfs/volumes/BackupsStore/LegalFiles/LegalFiles_1.vmdk'...<br>
Clone: 100% done.<br>
Destination disk format: VMFS thick<br>
Cloning disk '/vmfs/volumes/BackupsStore/LegalFiles/LegalFiles.vmdk'...<br>
Clone: 100% done.<br>
2010-03-26 13:58:07 -- info: Removing snapshot from LegalFiles ...<br>
ash: 5.gz: bad number<br>
./ghettoVCB.sh: ./ghettoVCB.sh: 735: Syntax error: 5.gz+1
					</p>
				</div>
				<a name="comments-15014"></a>
				<div id="comment-15014" class="jive-content-comment ">
					<span>
						<span>
							Mar 26, 2010 8:27 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-iJA58fkfy7WK4341" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15011" title="Go to message">cwhitmore</a>
							</em>
					</span>
					<p id="comment-body-15014">
					Please take a look at my comment here: <a 
class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-14997">http://communities.vmware.com/docs/DOC-8760#comments-14997</a><br>
<br>
I suspect you may be running into the lovely "nfs" issue that some of 
the other users are having. This has nothing to do with the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14987"></a>
				<div id="comment-14987" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 26, 2010 5:42 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-CvTDEgJMTXYw2z05" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15014" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14987">
					</p><div class="jive-quote"><b>"I suspect you may be running into 
the lovely "nfs" issue"</b></div>
<br>
I don't know about that.  I set some debugging flags around the code as 
shown here.<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">checkVMBackupRotation() {
set -x
set -v
...
set +x
set +v
}
</code></pre><br>
<br>
I called the script with debug logging and redirected stdout and stderr 
to a file.  The first backup made it, but the second one you can see ran
 into trouble.<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">Logging output to "/vmfs/volumes/nas-2/log/server2-backup.log" ...
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/datastore1/monitor/monitor.vmdk'...

Clone: 0% done.
Clone: 1% done.
....
Clone: 99% done.
Clone: 100% done.
+ set -v
+ local BACKUP_DIR_PATH=//vmfs/volumes/nas-1/backups/server2/monitor
+ local BACKUP_VM_NAMING_CONVENTION=//vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26
+ ls -tr //vmfs/volumes/nas-1/backups/server2/monitor
+ LIST_BACKUPS=monitor-2010-03-22--1
monitor-2010-03-26
+ [ -z 1 ]
+ IFS=

+ TMP_DIR=//vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-22--1
+ echo 1
+ TMP=1
+ [ 1 = //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26 ]
+ [ 1 -ge 1 ]
+ rm -rf //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-22--1
+ TMP_DIR=//vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26
+ echo //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26
+ TMP=//vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26
+ [ //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26 = //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26 ]
+ NEW=//vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26--1
+ mv //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26 //vmfs/volumes/nas-1/backups/server2/monitor/monitor-2010-03-26--1
+ unset IFS
+ set +x
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/datastore1/findlocw/findlocw.vmdk'...

Clone: 0% done.
Clone: 1% done.
....
Clone: 99% done.
Clone: 100% done.
+ set -v
+ local BACKUP_DIR_PATH=//vmfs/volumes/nas-1/backups/server2/findlocw
+ local BACKUP_VM_NAMING_CONVENTION=//vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-26
+ ls -tr //vmfs/volumes/nas-1/backups/server2/findlocw
+ LIST_BACKUPS=findlocw-2010-03-23
findlocw-2010-03-24
findlocw-2010-03-25
findlocw-2010-03-26
+ [ -z 1 ]
+ IFS=

+ TMP_DIR=//vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23
+ echo //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23
+ TMP=//vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23
+ [ //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23 = //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-26 ]
+ [ //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23 -ge 1 ]
sh: //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23: bad number
+ echo //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23
+ BASE=//vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23
/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB.sh: line 739: syntax error: //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23+1
</code></pre><br>
<br>
Line 739 is the call to ghettoVCB().  <br>
The following is the log file for the same run:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">2010-03-26 21:32:08 -- info: ============================== ghettoVCB LOG START ==============================

2010-03-26 21:32:09 -- info: CONFIG - VM_BACKUP_VOLUME = //vmfs/volumes/nas-1/backups/server2
2010-03-26 21:32:09 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1
2010-03-26 21:32:09 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2010-03-26 21:32:09 -- info: CONFIG - ADAPTER_FORMAT = lsilogic
2010-03-26 21:32:09 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-03-26 21:32:09 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-03-26 21:32:09 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-03-26 21:32:09 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-03-26 21:32:09 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-03-26 21:32:09 -- info: CONFIG - LOG_LEVEL = info
2010-03-26 21:32:09 -- info: CONFIG - BACKUP_LOG_OUTPUT = /vmfs/volumes/nas-2/log/server2-backup.log
2010-03-26 21:32:09 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-03-26 21:32:09 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-03-26 21:32:09 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-03-26 21:32:10 -- info: Initiate backup for monitor
2010-03-26 21:32:10 -- info: Creating Snapshot "ghettoVCB-snapshot-2010-03-26" for monitor
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/datastore1/monitor/monitor.vmdk'...

Clone: 0% done.
Clone: 1% done.
....
Clone: 99% done.
Clone: 100% done.
2010-03-26 21:56:59 -- info: Removing snapshot from monitor ...
2010-03-26 21:57:05 -- info: Backup Duration: 24.92 Minutes
2010-03-26 21:57:05 -- info: Successfully completed backup for monitor!

2010-03-26 21:57:05 -- info: CONFIG - VM_BACKUP_VOLUME = //vmfs/volumes/nas-1/backups/server2
2010-03-26 21:57:05 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 1
2010-03-26 21:57:05 -- info: CONFIG - DISK_BACKUP_FORMAT = thin
2010-03-26 21:57:05 -- info: CONFIG - ADAPTER_FORMAT = lsilogic
2010-03-26 21:57:05 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-03-26 21:57:05 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-03-26 21:57:05 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-03-26 21:57:05 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-03-26 21:57:05 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-03-26 21:57:05 -- info: CONFIG - LOG_LEVEL = info
2010-03-26 21:57:05 -- info: CONFIG - BACKUP_LOG_OUTPUT = /vmfs/volumes/nas-2/log/server2-backup.log
2010-03-26 21:57:05 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-03-26 21:57:05 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-03-26 21:57:05 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-03-26 21:57:06 -- info: Initiate backup for findlocw
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/datastore1/findlocw/findlocw.vmdk'...

Clone: 0% done.
Clone: 1% done.
....
Clone: 99% done.
Clone: 100% done.
</code></pre>
					
				</div>
				<a name="comments-15000"></a>
				<div id="comment-15000" class="jive-content-comment ">
					<span>
						<span>
							Mar 26, 2010 6:40 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5mCIT2EG39Ac3GH5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14987" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-15000">
					Let me try to explain what's going on so you understand the 
problem, as I've said before, the issue is not with the script. <br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">+ [ //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23 -ge 1 ]
sh: //vmfs/volumes/nas-1/backups/server2/findlocw/findlocw-2010-03-23: bad number
</code></pre><br>
<br>
The reason this is failing is because when it extracts the sub-numbers 
in which the individual backups are being re-named for rotation, it's 
unable to find a value and hence the comparison fails. The reason this 
is occurring is the source folder that the actual backup is in, never 
got renamed as it was supposed to be and it fails the check condition. 
The whole "NFS" issue has shown itself in various ways forms, but 
majority of the problems have been around the rotation and deletion of 
the backups. For some reason, as already explained in few previous post,
 the I/O operation that's sent is either taking too long or never 
completes within a timely manner which causes all sorts of "funny" 
things either no rotating of the directories or left behind snapshots 
that were not able to be committed.<br>
<br>
Again, these issues have always been reported around "NFS" and large 
VMs. I suspect that smaller VMs don't have this problem but once you get
 into larger VMs, this "I/O" issue with either the host or NFS server 
will start to show up. One resolution that a user has found was by 
changing their NFS server volume from ext3 to XFS which helped in 
resolving the problem and could be due to the overhead that ext3 brings 
in the way it does its update when an I/O request is sent compared to 
XFS. <br>
<br>
So my question to you is, what is difference between VM1 and VM2 in 
terms of size? If you want to test this theory out it's pretty simple, 
take the NFS server out of the picture. If you have sufficient space on 
local volume, do a backup and see if you run into the issue? I know 
others have ran these tests and found that backups always complete. I 
know plenty of users that are able to backup across all 3 types of 
datastores perfectly fine, including NFS and it's only a small set of 
users that are seeing this problem. <br>
<br>
Hopefully this makes a little more sense, so that's why I suggested that
 you're most liekly seeing the "NFS" issue as others are. <br>
<p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14988"></a>
				<div id="comment-14988" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 27, 2010 10:05 AM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-8QMedWyRx6hjhvS7" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15000" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14988">
					</p><div class="jive-quote"><b>So my question to you is, what is 
difference between VM1 and VM2 in terms of size?</b></div>
When I did this test, I switched them around to make the smaller one go 
first so I didn't have to wait so long for the results.  The first one 
did make it, and the second, larger one, did not.  But I had done that 
before to get a backup of the smaller one, and it failed.<br>
<div class="jive-quote"><b>The reason this is failing is because when it
 extracts the sub-numbers in which the individual backups are being 
re-named for rotation, it's unable to find a value and hence the 
comparison fails...Hopefully this makes a little more sense</b></div>
I read the previous posts and links earlier but that sentence clarifies 
your position on what is going on better than all of the posts put 
together.  I gather from what you are saying that the command completes,
 and when the next one executes, either the rename hasn't completed, or 
the call to the directory returns old information.  I would guess the 
latter.<br>
<div class="jive-quote"><b>...that's why I suggested that you're most 
likely seeing the "NFS" issue as others are. </b></div>
Your explanation is logical, and I don't understand the code right there
 well enough to be sure.  However, there are a couple of details that 
don't fit the profile.<br>
1.  I'm not using EXT3 or XFS, I'm using NTFS on BOTH servers that 
cross-backup VMs to each other at night.<br>
2.  This has been working fine for a long time with large VMs on the 
same two NFS volumes.  Now they both fail.<br>
<br>
<b>Possible Solution:  </b>In order to make my situation fit the NFS 
theory, I initially reasoned that the problem may have crept in as the 
result of a Microsoft update.  That would make both servers having the 
same problem at the same time, fit.  However, I kept coming back to why 
the small VM backs up without error now, while it didn't before.  While 
reflecting on that, I noticed that I had renamed parent directory to 
preserve my known-good backups while experimenting.  I had done that 
with none of the others.  I then did that with the others.  Last night, 
all of the backups executed flawlessly, including proper rotation of the
 small VM that had started working earlier.<br>
<br>
<b>Possible cause:  </b>Earlier, I mentioned one of the things that I 
liked about your new script is the ability to specify which VMDKs get 
backed up.  In the case of the two Windows 2003 R2 Servers that export 
the NFS volumes for the backups, it is important that I don't replicate 
their NFS volumes, not only due to their size, but because it would 
senseless to get a backups of a backups, and then store them back on the
 same server as the VMs they were backing up.  I used to have a separate
 hacked script to backup the main VMDKs for each of those servers.  
However, I also had to schedule the WIndows machines separately, and 
make sure there was enough time between them so they would not overlap. 
 If they were to overlap, their snapshots would snowball as they record 
changes of the changes of the changes....  After they complete, the 
nightly free-for-all backup begins where they cross-backup VMs to each 
other without issue.  One time they did overlap, and while they were 
snowballing, the nightly backups kicked.  I came back to packed NFS 
drives on both servers.  I rebooted, but then none of the VMs would 
start.  However, I always build in an "air-bubble" for things like this 
so I logged into the ESXi servers and deleted them to make space.  I 
booted the servers, started the VIMs, and cleaned house.  That's the 
only thing that I can THINK of that could have triggered this.<br>
<br>
Until last night, I've been adjusting the list orders to get backups and
 deleting the old ones by hand.  This is the first time in 6 weeks this 
has worked right.  One good day in a row does not equal a track record. 
 I'll update this in a few days with the results.<br>
<br>
PS:  Thanks again for the awesome script!
					
				</div>
				<a name="comments-15001"></a>
				<div id="comment-15001" class="jive-content-comment ">
					<span>
						<span>
							Mar 27, 2010 10:18 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-2K3931UBoF0hSq5H" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14988" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-15001">
					Thanks for the updates, as you can see I get a few questions around
 these issues per week and in general the NFS issues have been the 
culprit from what I can tell. In your situation, it sounds like 
directories that were expected were modified which potentially broke the
 rotation. I'll need to think about this and see if there's a way I can 
help protect or better log this event. The other thing you mentioned 
about "overlap", one thing I could do is setup a lock which would be 
generated upon the start of the script and hopefully removed at the end 
of the script. If any "unexpected" errors were to happen and the lock 
would not be removed, then some logic would need to be written to ensure
 the script isn't running and remove the lock and re-lock. <br>
<br>
Let me know if you have any ideas around this and thanks for the 
patience. I've been quite fortunate to have such a great and huge 
community ( script has gotten over 200,000+ views) to help QA this 
script. That's why I've been pretty confident to state that it's 
probably not the script and the issue lies in either "manual" 
manipulation of some sort OR environmental issues. If there was a real 
bug within the script, we would have more users reporting problems. 
There are definitely some things I'm thinking about adding into a future
 release and there have been suggestions around some of those features. 
Let me ponder about it some more and perhaps I'll provide an update of 
the "suggested" features and I'll go ahead and take any additional and 
see if it makes sense. <br>
<br>
What I will do this weekend is update some of the documentation and 
FAQ's around some of the things I've learned over the last few weeks 
that users may have ran into. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15017"></a>
				<div id="comment-15017" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 27, 2010 3:37 PM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-0MaQ9p512vF95EBI" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15001" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15017">
					</p><div class="jive-quote"><b>Let me know if you have any ideas 
around this</b></div>
<b>This is how I'm handling the situation now:</b><br>
1.  I use a config template for each of the Windows servers to specify 
only the system VMDKs.  I no longer need to maintain a separate hacked 
ghettoVCB.sh for my Windows NFS server backups in order to have them 
skip their NFS disks.<br>
2.  I have an admin1-backup.sh and an admin2-backup.sh on the servers 
that:<br>
  a.  Delete the old logs<br>
  b.  Call ghettoVCB.sh specifying a backup list that only contains 
themselves.<br>
3.  I have admin-backups.bat on one of the Windows servers with these 
commands:<br>
  a.  Run plink to call admin1-backup.sh<br>
  b.  Run plink to call admin2-backup.sh<br>
  c.  Run the type command on the logs and redirect the output to 
admin-logs.txt on the local disk.<br>
  d.  Run bmail to E-mail me the logs and specify admin-logs.txt for the
 message body input.<br>
*Note:  This step does indeed effectively serialize the two backups.  I 
was concerned that plink might just kick off the backup on the first 
server, return, move to the next command in the batch file, and start 
the second server before the first one completes.<br>
4.  The Windows Scheduler calls admin-backups.bat.<br>
*Note:  I initially set up the Windows Scheduler to kill the process 15 
minutes before the nightly free-for-all backups begin if the Windows NFS
 server backups were not completed by that time.  I found it terminated 
the batch file, but the currently running script on the server 
completes.  However, even if the backup were to continue on one of the 
Windows NFS servers after the other backups start, there would be no 
snowball affect.  It would result in a larger snapshot.  The only 
problem that could arise from that, is a script time-out while removing a
 larger than normal snapshot.  Thus, there was no benefit to having the 
Windows Scheduler stop the process.  The only thing that would 
accomplish is I wouldn't get the backup logs E-mailed to me.<br>
<br>
<b>Other:  </b>  For now, I left the set -vx, set -xv pair around the 
code in question in ghettoVCB.  I maintain two calls in the 
admin?-backup.sh scripts that call ghettoVCB, one normal, and one debug.
  The debug option gives me a second log file that contains the commands
 in the order they executed and the contents of the variables for the 
tagged area, and any exit errors.<br>
<pre class="jive-pre"><code class="jive-code jive-plain">.....
# Normal
#/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB.sh -f /vmfs/volumes/datastore1/ghettoVCB/server2_list -c /vmfs/volumes/datastore1/ghettoVCB -l /vmfs/volumes/nas-2/log/server2-backup.log
# Debug
/vmfs/volumes/datastore1/ghettoVCB/ghettoVCB.sh -f /vmfs/volumes/datastore1/ghettoVCB/server2_list -c /vmfs/volumes/datastore1/ghettoVCB -d debug -l /vmfs/volumes/nas-2/log/server2-backup.log &gt;/vmfs/volumes/nas-2/log/server2-debug.log 2&gt;&amp;1
.....
</code></pre><br>
<br>
Thank you for your very valuable time with this.
					
				</div>
				<a name="comments-15018"></a>
				<div id="comment-15018" class="jive-content-comment ">
					<span>
						<span>
							Mar 27, 2010 7:09 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7Jkdpb6bU6Nqgs5A" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15017" title="Go to message">IT_Architect</a>
							</em>
					</span>
					<p id="comment-body-15018">
					My comment around ideas, was for features to be added to the script
 and not specific to your backup process.<br>
<br>
e.g. Add a locking mechanisms to the script to ensure that only 1 
instance can run at any given time. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15019"></a>
				<div id="comment-15019" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 27, 2010 7:19 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-o3EU52oR9hU3I4os" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-15019">
					Hello everyone,<br>
<br>
I've just updated the documentation, for those that are affected by the 
"NFS" issue, please take a look at FAQ #29 for some details. <br>
<br>
I will also be accepting any new feature requests and take a look at 
what are the most popular ones and how they might be integrated into a 
future release of the script. Keep in mind, feature adds will be based 
on feasibility and amount of free time I have.<br>
<br>
Thanks for everyone support!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-14991"></a>
				<div id="comment-14991" class="jive-content-comment ">
					<span>
						<span>
							Mar 28, 2010 12:24 AM
						</span>
							<!--<a href="/people/IT_Architect" title="Click to view IT_Architect's profile">
<img class="jive-avatar" src="/people/IT_Architect/avatar/16.png?a=-1" height="16" width="16" title="Click to view IT_Architect's profile" alt="Click to view IT_Architect's profile" />
</a>--><a href="http://communities.vmware.com/people/IT_Architect" 
id="jive-r53Ac9B6XnRPxvge" class="jive-username-link" title="Click to 
view IT_Architect's profile">IT_Architect</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15018" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-14991">
					</p><div class="jive-quote"><b>My comment around ideas, was for 
features to be added to the script and not specific to your backup 
process.</b></div>Your script serializes the backups in the list.  What I
 wrote demonstrates how to serialize backups among servers by placing 
them in the same calling script.  This ensures only one instance of 
ghettoVCB is running at a given time.  Moreover, by further adding 
scripts that call the concurrent backups to the same script, I can force
 them to wait until the serialized backups are complete before starting 
them on separate threads to run concurrently.  Each off those threads 
are able to serialize their own operations where necessary, in this 
case, mailing their logs.  This method eliminates the complexities 
associated with semaphores.<br>
<br>
<div class="jive-quote"><b>Add a locking mechanisms to the script to 
ensure that only 1 instance can run at any given time.</b></div>Disclaimer:
  I'm a language and OS programmer, not a script programmer.  To enforce
 that no more than one instance of ghettoVCB.sh can run on a VM at any 
given time, what comes to mind is to employ a method similar to what the
 operating system uses with pid files.  The best place to store the 
"pid" files is someplace you can write, and someplace that gets cleared 
when VMWare reboots.  The "pid" file is simply has a known file name 
that you'll be overwriting periodically in order to maintain its 
timestamp.  What follows depends on the script processor having the 
ability to register a timer and process events.  It would work something
 like this:<br>
<br>
When ghettoVCB launches, and checks for its assigned "pid" file name.  
If when it starts up and it finds its "pid" and it's up to date, it 
exits because that means a copy of the ghettoVCB is active.  If it 
doesn't find it, or it's out of date, it would write a new "pid" file, 
and continue to start, and register a timer to generate a timer event 
say every 5 seconds.  When the event fires, it runs code that overwrites
 the "pid" file to update the timestamp, and then goes back  to what it 
was doing.  When ghettoVCB exits, it removes its "pid" file.<br>
<br>
PS:  This was longer, and I explained how to make your own timer if the 
script cannot register a timer, but it got blown away when I posted  it.
					
				</div>
				<a name="comments-15003"></a>
				<div id="comment-15003" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 29, 2010 1:05 AM
						</span>
							<!--<a href="/people/QuebecCityVMwareUserGroup" title="Click to view QuebecCityVMwareUserGroup's profile">
<img class="jive-avatar" src="/people/QuebecCityVMwareUserGroup/avatar/16.png?a=2504" height="16" width="16" title="Click to view QuebecCityVMwareUserGroup's profile" alt="Click to view QuebecCityVMwareUserGroup's profile" />
</a>--><a 
href="http://communities.vmware.com/people/QuebecCityVMwareUserGroup" 
id="jive-HwQS7zzCR5295d1W" class="jive-username-link" title="Click to 
view QuebecCityVMwareUserGroup's profile">QuebecCityVMwâ€¦</a>&nbsp;&nbsp;says:

							<em>
in response to:								<a href="#comments-14997" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15003">
					Hi<br>
The problem is resolved, my blocksize of my datastore was 1,<br>
The snapshot could not be made because not enough available disk space, I
 modified my blocksize in 8 and the saving was made.<br>
Thanck<br>
<br>
francois <br>
</p><p>
<br>
francois
					</p>
				</div>
				<a name="comments-14992"></a>
				<div id="comment-14992" class="jive-content-comment ">
					<span>
						<span>
							Mar 29, 2010 2:45 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-CaKflWIg1ESxD68J" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15003" title="Go to message">QuebecCityVMwâ€¦</a>
							</em>
					</span>
					<p id="comment-body-14992">
					Hi<br>
<br>
I use the script to backup one server on an ESXi4.0 free Edition host.<br>
A test backup of an other vm finalized successfully but if I want to 
backup the one vm that is important (a buildserver) there were several 
errors:<br>
</p><ul class="jive-dash">
<li>First I want the vm to be backed up during execution. In time of 
backup there are no users logged in and no buildtask was running. There 
were no snapshots. The script startet to take a snapshot, tried to clone
 disks, failed and then and that is really annoying don't revert the 
snapshots. The next run couldnt work fine.</li>
<li>Ok than I prepared the script to shutdown the vm so there will be no
 snapshotting.</li>
<li>Now the problem is, that the script apparently couldn't find the 
vmdks????</li>
</ul>
Here are the log entries:<br>
<br>
2010-03-26 07:10:02 -- info: ============================== ghettoVCB 
LOG START <br>
2010-03-26 07:10:02 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/4ae0b8d4-74b64288-137e-001cc0f2d1dd/Backup<br>
2010-03-26 07:10:02 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-03-26 07:10:02 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-03-26 07:10:02 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-03-26 07:10:02 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 1<br>
2010-03-26 07:10:02 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 1<br>
2010-03-26 07:10:02 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-03-26 07:10:02 -- info: CONFIG - POWER_DOWN_TIMEOUT = 6<br>
2010-03-26 07:10:02 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-03-26 07:10:02 -- info: CONFIG - LOG_LEVEL = info<br>
2010-03-26 07:10:02 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-03-26 07:10:02 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 1<br>
2010-03-26 07:10:02 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-03-26 07:10:02 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
2010-03-26 07:10:12 -- info: Powering off initiated for Buildserver, 
backup will not begin until VM is off...<br>
2010-03-26 07:10:18 -- info: VM is still on - Iteration: 0 - sleeping 
for 60secs (Duration: 0 seconds)<br>
2010-03-26 07:11:25 -- info: VM is powerdOff<br>
2010-03-26 07:11:25 -- info: Initiate backup for Buildserver<br>
Failed to clone disk : The file already exists (39).<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore2/Windows XP Pro SP3 Ger 05/<br>
Clone: 1% done.<br>
...<br>
Clone: 100% done.<br>
Failed to clone disk : The system cannot find the file specified (25).<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore2/Windows XP Pro SP3 Ger 05/Windows
 XP Pro SP3 Ger 05.vmdk'...<br>
2010-03-26 07:14:05 -- info: Powering back on Buildserver<br>
2010-03-26 07:14:05 -- info: Compressing VM backup 
"/vmfs/volumes/4ae0b8d4-74b64288-137e-001cc0f2d1dd/Backup/Buildserver/Buildserver-2010-03-26.gz"...<br>
2010-03-26 07:14:06 -- info: Backup Duration: 2.78 Minutes<br>
2010-03-26 07:14:06 -- info: Successfully completed backup for 
Buildserver!<br>
<br>
2010-03-26 07:14:06 -- info: ============================== ghettoVCB 
LOG END<br>
<br>
What should that mean?<br>
I would appreciate for an answer!<br>
<br>
Regards<br>
<br>
Matthias
					
				</div>
				<a name="comments-15004"></a>
				<div id="comment-15004" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 29, 2010 6:47 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-jV9iJcjsUX800lvK" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15003" title="Go to message">QuebecCityVMwâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15004">
					Yes, not having the right blocksize can affect the backups <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0">
 I'm going to assume users have a properly configured environment when 
using the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15005"></a>
				<div id="comment-15005" class="jive-content-comment ">
					<span>
						<span>
							Mar 29, 2010 6:48 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-H0Sq6EJ7FJtDW6RV" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-14992" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15005">
					Please read FAQ0<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15022"></a>
				<div id="comment-15022" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 29, 2010 7:39 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-InJOb48hP33b59T6" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15004" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15022">
					Hi<br>
<br>
ok what is the right blocksize?<br>
It is set to 1 MB and the greatest file could be 265 GB<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-14993"></a>
				<div id="comment-14993" class="jive-content-comment ">
					<span>
						<span>
							Mar 29, 2010 7:53 AM
						</span>
							<!--<a href="/people/QuebecCityVMwareUserGroup" title="Click to view QuebecCityVMwareUserGroup's profile">
<img class="jive-avatar" src="/people/QuebecCityVMwareUserGroup/avatar/16.png?a=2504" height="16" width="16" title="Click to view QuebecCityVMwareUserGroup's profile" alt="Click to view QuebecCityVMwareUserGroup's profile" />
</a>--><a 
href="http://communities.vmware.com/people/QuebecCityVMwareUserGroup" 
id="jive-bj6fJQNw4VpDAa4f" class="jive-username-link" title="Click to 
view QuebecCityVMwareUserGroup's profile">QuebecCityVMwâ€¦</a>&nbsp;&nbsp;says:

							<em>
in response to:								<a href="#comments-15022" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-14993">
					Hi<br>
By defaut with one " block size " of 1M what allows maximal partitions 
only of 256G.<br>
<br>
To exploit the integralitÃ© of the disk it is necessary to pass has a 
block size of 2M for a maximal partition of 512Go, of 4M for a maximal 
partition of 1To and of 8M for a maximal partition of 2To.<br>
</p><p>
<br>
francois
					</p>
				</div>
				<a name="comments-15007"></a>
				<div id="comment-15007" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 29, 2010 8:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9ozkrUL5UOGl93rz" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15022" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15007">
					</p><div class="jive-quote">
ok what is the right blocksize?<br>
</div>
<br>
The answer is, it depends. With vSphere, there's probably not a whole 
lot of reason not to use 8MB by default, especially with the sub-block 
allocation.<br>
<br>
Give these two links a read for further details:<br>
<a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/05/14/block-sizes-and-growing-your-vmfs/">http://www.yellow-bricks.com/2009/05/14/block-sizes-and-growing-your-vmfs/</a><br>
<a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/03/24/an-8mb-vmfs-blocksize-doesnt-increase-performance/">http://www.yellow-bricks.com/2009/03/24/an-8mb-vmfs-blocksize-doesnt-increase-performance/</a><br>
<br>
Another issue that we've personally ran into, which others could also is
 when you have a VM that has it's VMDK(s) spread across multiple 
datastores. The datastoer in which the VM's .vmx is located in has a 
smaller blocksize than the other datastore hosting the VM's disk will 
cause an issue and when you try to snapshot the VM, it'll fail.<br>
<br>
Take a look at this article for further details:<br>
<a class="jive-link-external" 
href="http://www.yellow-bricks.com/2009/08/24/vsphere-vm-snapshots-and-block-size/">http://www.yellow-bricks.com/2009/08/24/vsphere-vm-snapshots-and-block-size/</a><br>
<br>
Regarding your problem, this may or may not be the problem. Though this 
is not a beginner's script, so I expect user's to have a properly 
configured environment before using the script. <br>
<br>
Please go through the documentation + FAQ and see if you're falling into
 any of those "known" issues. If you still can't find a resolution, 
please take a look at FAQ1 before re-posting.<br>
<br>
Thanks<br>
<p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15023"></a>
				<div id="comment-15023" class="jive-content-comment ">
					<span>
						<span>
							Mar 29, 2010 10:19 AM
						</span>
							<!--<a href="/people/hburroughs" title="Click to view hburroughs's profile">
<img class="jive-avatar" src="/people/hburroughs/avatar/16.png?a=-1" height="16" width="16" title="Click to view hburroughs's profile" alt="Click to view hburroughs's profile" />
</a>--><a href="http://communities.vmware.com/people/hburroughs" 
id="jive-182m1Y2Vao3CAkDb" class="jive-username-link" title="Click to 
view hburroughs's profile">hburroughs</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15019" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15023">
					I would like to be able to power the VM down, take a snapshot, 
power the VM back up, and take a backup from the "pristine" state that 
was present at time of the snapshot.  I have a hacked version of the 
script at the moment that is now several revisions/versions behind your 
copy.  This would just be an extension of the power VM off before 
backup, except it would do a snapshot at power off, automatically power 
back on, and after a count of X seconds (to give the VM time to restart 
and settle in) begin making a backup.  This would allow the users who 
want pristine copies (vs quieting the VMs) and can afford a few minutes 
of downtime rather than waiting for a full power off backup to be done.
					</p>
				</div>
				<a name="comments-15040"></a>
				<div id="comment-15040" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 29, 2010 11:42 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-3pq5VWzMc2Jo31rk" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15023" title="Go to message">hburroughs</a>
							</em>
					</span>
					<p id="comment-body-15040">
					@hburroughs:<br>
<br>
I did also modify the script for supporting that kind of backup.<br>
Ask lamw to add this feature to future releases.<br>
If enough people ask for it, maybe we will see it in one of the next 
releases.<br>
<br>
Cheers.
					</p>
				</div>
				<a name="comments-15028"></a>
				<div id="comment-15028" class="jive-content-comment ">
					<span>
						<span>
							Mar 29, 2010 10:42 PM
						</span>
							<!--<a href="/people/pebr" title="Click to view pebr's profile">
<img class="jive-avatar" src="/people/pebr/avatar/16.png?a=-1" height="16" width="16" title="Click to view pebr's profile" alt="Click to view pebr's profile" />
</a>--><a href="http://communities.vmware.com/people/pebr" 
id="jive-4vQ2N9l075b5GGub" class="jive-username-link" title="Click to 
view pebr's profile">pebr</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15040" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-15028">
					Oh, I would like to see that kind of backup in a future release!<br>
<br>
Greets<br>
Peter
					</p>
				</div>
				<a name="comments-15029"></a>
				<div id="comment-15029" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 30, 2010 4:10 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-3CtxBJ0V45kL0Q2E" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15023" title="Go to message">hburroughs</a>
							</em>
					</span>
					<p id="comment-body-15029">
					hburroughs and goppi:<br>
<br>
If you have hacked the script to add functionality, perhaps you would 
post a diff to William's original to pastebin.com?<br>
Your additions sound interesting. That way we could discuss different 
approaches, and presumably it would be easier for William to incorporate
 different features.<br>
<br>
My own modifications are here: <a class="jive-link-external" 
href="http://pastebin.com/5zRYau9D">http://pastebin.com/5zRYau9D</a> or 
here: <a class="jive-link-external" 
href="http://www.idrift.no/gaute/ghettovcb/">http://www.idrift.no/gaute/ghettovcb/</a>
					</p>
				</div>
				<a name="comments-15024"></a>
				<div id="comment-15024" class="jive-content-comment ">
					<span>
						<span>
							Mar 30, 2010 5:24 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-I3yB9E7wr4k4jt7c" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15029" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-15024">
					Hi it's me again,<br>
<br>
the output "Units = cylinders of 2048 ..... " of busyboxs fdisk, does 
that mean the blocksize?<br>
How can I check the correct blocksize?<br>
In vSphere client is displayed 1 MB for blocksize but I have a capacity 
of approximately 500 GB in one storage.<br>
There is something wrong, isn't it?<br>
Ok then how can I change the blocksize?<br>
I fear I must reformat the hard drive?!<br>
<br>
King regards<br>
<br>
Matthias
					</p>
				</div>
				<a name="comments-15041"></a>
				<div id="comment-15041" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 30, 2010 5:57 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-2I2I9N7XWwKb8P1g" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15029" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-15041">
					@gautelund:<br>
<br>
Not sure if this is what the author of the script wants.<br>
<br>
Looking at this thread I see that he's already investing a lot of time 
for support which is not directly script related. Making forks of the 
initial script public would increase this further by people asking 
questions which are related to problems caused ny mods and have nothing 
to do with the initial script.<br>
<br>
So if anyone is interrested send me a PM and I will PM you the mods but 
please do not make them publicly available.<br>
<br>
Regards,<br>
groppi.
					</p>
				</div>
				<a name="comments-15055"></a>
				<div id="comment-15055" class="jive-content-comment ">
					<span>
						<span>
							Mar 30, 2010 11:40 AM
						</span>
							<!--<a href="/people/sant0sk1" title="Click to view sant0sk1's profile">
<img class="jive-avatar" src="/people/sant0sk1/avatar/16.png?a=-1" height="16" width="16" title="Click to view sant0sk1's profile" alt="Click to view sant0sk1's profile" />
</a>--><a href="http://communities.vmware.com/people/sant0sk1" 
id="jive-139d6Ub7q8k79SAm" class="jive-username-link" title="Click to 
view sant0sk1's profile">sant0sk1</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15055">
					I have a peculiar problem running ghettoVCB on an ESXi 3.5 (build 
110271) host with local storage backing up to an NFS share (windows 
Allegro v5).<br>
<br>
The error occurs during the vmkfstools command (line 612 of latest 
release) for each vmdk on a given virtual machine. Here is the output 
from a vm named "Radar" that has 3 disks:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">2010-03-29 17:53:37 -- info: Initiate backup for Radar
2010-03-29 17:53:37 -- info: Creating Snapshot "ghettoVCB-snapshot-2010-03-29" for Radar
Failed to clone disk : The file specified is not a virtual disk (15).
Destination disk format: VMFS thick
Cloning disk '/vmfs/volumes/main/Radar/Radar_2.vmdk'...
Failed to clone disk : The file specified is not a virtual disk (15).
Destination disk format: VMFS thick
Cloning disk '/vmfs/volumes/main/Radar/Radar_1.vmdk'...
Failed to clone disk : The file specified is not a virtual disk (15).
Destination disk format: VMFS thick
Cloning disk '/vmfs/volumes/main/Radar/Radar.vmdk'...
2010-03-29 17:54:39 -- info: Removing snapshot from Radar ...
2010-03-29 17:54:44 -- info: Backup Duration: 1.12 Minutes
2010-03-29 17:54:44 -- info: Successfully completed backup for Radar!
</code></pre><br>
<br>
I have confirmed that I get the same exact error when executing the 
command manually from a shell:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vmkfstools -i /vmfs/volumes/main/Radar/Radar.vmdk -a lsilogic /vmfs/volumes/backup/Radar/Test/test.vmdk
Destination disk format: VMFS thick
Cloning disk '/vmfs/volumes/main/Radar/Radar.vmdk'...
Failed to clone disk : The file specified is not a virtual disk (15).
</code></pre><br>
<br>
What is really strange is that this command DOES create appropriately 
sized (according to the filesystem) files in the destination directory:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">root@latka:/vmfs/volumes/60846bb9-1570a6e2/Radar/Test$ ls -lh
-rw-rw-rw-    1 9999     9999         4.0G Mar 30 18:26 test-flat.vmdk
-rw-rw-rw-    1 9999     9999          116 Mar 30 18:26 test.vmdk
</code></pre><br>
<br>
However, that 4.0G file was created in less than 1 second, which is 
simply impossible over the network. The resulting test.vmdk does NOT 
match the original Radar.vmdk (not sure if it is supposed to or not).<br>
<br>
original Radar.vmdk:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain"># Disk DescriptorFile
version=1
CID=95352490
parentCID=ffffffff
createType="vmfs"

# Extent description
RW 8388608 VMFS "Radar-flat.vmdk"

# The Disk Data Base 
#DDB

ddb.virtualHWVersion = "4"
ddb.toolsVersion = "8192"
ddb.uuid = "60 00 C2 9d 13 39 65 63-42 06 9c a9 2b 53 4d c3"
ddb.geometry.cylinders = "522"
ddb.geometry.heads = "255"
ddb.geometry.sectors = "63"
ddb.adapterType = "buslogic"
ddb.geometry.biosCylinders = "522"
ddb.geometry.biosHeads = "255"
ddb.geometry.biosSectors = "63"
</code></pre><br>
<br>
resulting test.vmdk:<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain"># Disk Descriptor file
version=1
# Extent description
RW 8388608 VMFS "test-flat.vmdk"

# The Disk Data Base 
#DDB

</code></pre><br>
<br>
I get this same error on EVERY disk for EVERY virtual machine that is 
backed up. The resulting backups cannot be restored using 
ghettoVCB-restore.sh, which is not surprising.<br>
<br>
Any assistance would be greatly appreciated!
					
				</div>
				<a name="comments-15056"></a>
				<div id="comment-15056" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 30, 2010 12:03 PM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-bVn3k27kY12Pa031" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15055" title="Go to message">sant0sk1</a>
							</em>
					</span>
					<p id="comment-body-15056">
					This is a known problem with Allegro 5 and ESXi.<br>
We already have an incident open with Franz about that issue.<br>
Please report that problem to Franz as well so they are aware that 
others are also affected.<br>
Switching back to Allegro 4.5 will solve this problem.<br>
<br>
Cheers,<br>
groppi.
					</p>
				</div>
				<a name="comments-15057"></a>
				<div id="comment-15057" class="jive-content-comment ">
					<span>
						<span>
							Mar 30, 2010 12:40 PM
						</span>
							<!--<a href="/people/sant0sk1" title="Click to view sant0sk1's profile">
<img class="jive-avatar" src="/people/sant0sk1/avatar/16.png?a=-1" height="16" width="16" title="Click to view sant0sk1's profile" alt="Click to view sant0sk1's profile" />
</a>--><a href="http://communities.vmware.com/people/sant0sk1" 
id="jive-09uNAvY2nRKLrmF3" class="jive-username-link" title="Click to 
view sant0sk1's profile">sant0sk1</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15056" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-15057">
					I'll head over and report the problem to them. Thanks for the quick
 reply.
					</p>
				</div>
				<a name="comments-15044"></a>
				<div id="comment-15044" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 30, 2010 1:18 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-o69P9cxjN5H9WfT8" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15024" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15044">
					If you don't understand what the blocksize is for, please take a 
look at this VMware KB: <a class="jive-link-external" 
href="http://kb.vmware.com/kb/1003565">http://kb.vmware.com/kb/1003565</a><br>
<br>
It has nothing to do with the actual capacity of your disk, you can 
configure 1MB blocksize on a 74gb drive or 500gb drive. Please read the 
KB article for clarification and yes you'll need to re-create the VMFS 
volume when changing the blocksize. <br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15045"></a>
				<div id="comment-15045" class="jive-content-comment ">
					<span>
						<span>
							Mar 30, 2010 1:25 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-78026RG5zJ2AocrB" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15041" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-15045">
					What I would like to see right now from the community are 
ideas/features that you would like to have, based on the feedback and 
the amount that I receive, we can go about figuring out whether they 
would be feasible. <br>
<br>
If certain feature requests have already been created/hacked together, 
more than welcome to take a look but I would like that to be kept on a 
separate thread so that when troubleshooting issues, users are using the
 current version of the script and not other various/modified versions.<br>
<br>
As of now I've seen the following:<br>
</p><ul>
<li>Ability to power off VM, offline snapshot and power the VM back on 
and proceed with the backup. </li>
<li>Global ghettoVCB configuration file</li>
<li>Implementation of some locking mechanism to ensure only 1 ghettoVCB 
instance can run at any given moment </li>
<li>Support VMs with existing snapshots</li>
<li>Ability to control whether VM backup directories are rotated in 
general or kept in-definite and leave it to end users to rotate out</li>
</ul>
<br>
I'll continue to update this list as I receive more feedback. <br>
<br>
I most likely will be conducting a private BETA for a select few as I've
 done in the past for previous releases, for those that are interested 
and has a significantly sized environment to test various 
functionality/features, shoot me an PM with your Name, Email and Quick 
summary of the testing environment (ESX(i) version/build, # of VMs, size
 of VMs, etc)<br>
<br>
Thanks again for all the great feedback<br>
<p>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15059"></a>
				<div id="comment-15059" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 30, 2010 10:56 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-2vt77d9dQTJ0PQ41" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15059">
					I can confirm that there is a limit on crond which results in 
evaporation of settings in esxi.<br>
<br>
This is why I now use plink from windows<br>
<br>
P.S. To all you people out there who, like myself, have been going 
through the veeam, nfs, scp, woefully slow transfer speeds nightmare - 
scrap it all!<br>
<br>
Centos 5.3 x64 iscsi datastore with 1Gbit nic and ghetto = 100 MB/sec 
(yes - that is 100 megabytes per second:)<br>
<br>
Six commands to configure the target and six clicks to configure the 
datastore.<br>
<br>
If everyone did this the current page would be half its length ;:
					</p>
				</div>
				<a name="comments-15048"></a>
				<div id="comment-15048" class="jive-content-comment ">
					<span>
						<span>
							Mar 31, 2010 1:11 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-loj31G70ihU3Gfvq" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15048">
					Interesting. I could reproduce this once, but after that I tried to
 add data beyond 512 bytes to the crontab several times, using vi or 
redirecting, with no problems.<br>
<br>
Well, what the hell - 512 bytes ought to be enough for anybody. <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" border="0">
					</p>
				</div>
				<a name="comments-15035"></a>
				<div id="comment-15035" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 31, 2010 7:17 AM
						</span>
							<!--<a href="/people/imorgan" title="Click to view imorgan's profile">
<img class="jive-avatar" src="/people/imorgan/avatar/16.png?a=-1" height="16" width="16" title="Click to view imorgan's profile" alt="Click to view imorgan's profile" />
</a>--><a href="http://communities.vmware.com/people/imorgan" 
id="jive-Fsab7sSjuIXvXeB3" class="jive-username-link" title="Click to 
view imorgan's profile">imorgan</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-14790" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15035">
					You say " one way is just to fully disable this OR by setting a 
very high count if you don't want any deletion."<br>
<br>
Well, I do not want the script to ever rename a past backup directory, 
which suggests that my only option is to "fully disable" rotation. But 
how do I do that? I have read the whole script, and can find no means to
 disable rotation entirely, and clearly setting 
VM_BACKUP_ROTATION_COUNT=0 would be bad indeed.<br>
<br>
Here's the deal: I need to rsync the backups off-site over a slow link. 
Since ghetoVCB renames the directories when rotating, <u>ALL</u> the 
backups have to be re-sent, not just the most recent. Can't the script 
just keep the most recent N backups directories? Why does it have to 
maintain a rotation count in the directory name at all?<br>
<br>
If I could just get ghetoVCB to stop adding a rotation count to the 
directory, or disable rotation entirely, then I can apply my own 
rotation logic outside of ghetoVCB, and then my rsync's will work 
nicely.<br>
<br>
Thanks for ghetoVCB. Until I started moving backups off-site, it worked 
like a charm! Any insight you can provide to my problem would be greatly
 appreciated.
					</p>
				</div>
				<a name="comments-15037"></a>
				<div id="comment-15037" class="jive-content-comment ">
					<span>
						<span>
							Mar 31, 2010 9:18 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0YWeFq7089QM6Vv4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15035" title="Go to message">imorgan</a>
							</em>
					</span>
					<p id="comment-body-15037">
					When I say fully disable, you just need to comment out the function
 call in which the rotation is checked. If you do 1 backup per day, this
 should be fine. Though if you do multiple backups per day, the default 
VM backup directory is not unique enough as it only holds "YYYY-MM-DD" 
and you will most definitely override any earlier backups.<br>
<br>
The whole point of the rename is similar to how system logs are rotated,
 you want to be able to keep track if you have multiple backups per day 
to see which is the oldest so you can purge after certain count, hence 
the additional number is appended in the form of "--X". If you want to 
suggest an alternative way for this, by all means I'm open to 
suggestions. This has never been a concern or problem for others, but if
 it is, I'm always up for improvements. I just need to understand the 
use case and how a change may affect others/etc. <br>
<br>
I can look into setting a configuration param that allows the user to 
decide whether rotation will be done by the script, but again, there 
needs to be some uniqueness being created on a per backup basis, else 
you'll override the previous backup. Perhaps include additional 
timestamp information (ss:ms) which would help and then maybe purge 
after n-copies?<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15052"></a>
				<div id="comment-15052" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Mar 31, 2010 2:26 PM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-yToAJtGLGbt6PEil" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15035" title="Go to message">imorgan</a>
							</em>
					</span>
					<p id="comment-body-15052">
					@imorgan + lamw:<br>
<br>
We modified the script for exactly the same reason.<br>
As we rsync the ghettoVCB backup folders to external storage, the folder
 names of the backups must not change, otherwise the same backup folder 
would be rsynced several times after a rotation took place.<br>
<br>
We changed the skrpit in the way that a a backup folder only carries the
 current date and would not change for rotation. IMHO there is no reason
 for changing names on rotation. The folder name itslef (the date) is 
enough to find out which folders are the oldest ones for beeing deleted 
when rotation takes place.<br>
<br>
We do not have the case of multiple backups on the same day which is not
 covered by this naming scheme, but not a problem anyway as you could 
simply add a continous number if a folder with the current date already 
exisits when having multiple backups on the same day.<br>
<br>
Regards,<br>
grubi.
					</p>
				</div>
				<a name="comments-15053"></a>
				<div id="comment-15053" class="jive-content-comment ">
					<span>
						<span>
							Mar 31, 2010 3:52 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-bQtQ0ddCF6y91Q0d" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15052" title="Go to message">goppi</a>
							</em>
					</span>
					<p id="comment-body-15053">
					So from what I'm hearing, it sounds like for rotation:<br>
<br>
1) Flag to disable<br>
<br>
2) Flag to enable<br>
<br>
In both cases, have some logic to figure out what the next number would 
be in case user performs multiple backups per day? Or should we screw 
the numbering and just add on "ss:ms" to ensure uniqueness and then just
 purge after N where N = max to keep? if we're in scenario #2?<br>
<br>
Is that what I'm hearing, that way it won't break things like rsync and 
probably less work for the rotation function since you don't need to 
rename directories. Originally I was using that to keep track of the 
older copies and a way to extract the current count.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15062"></a>
				<div id="comment-15062" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 1, 2010 12:46 AM
						</span>
							<!--<a href="/people/deniseche" title="Click to view deniseche's profile">
<img class="jive-avatar" src="/people/deniseche/avatar/16.png?a=-1" height="16" width="16" title="Click to view deniseche's profile" alt="Click to view deniseche's profile" />
</a>--><a href="http://communities.vmware.com/people/deniseche" 
id="jive-1bI8Lr50APJWr5oJ" class="jive-username-link" title="Click to 
view deniseche's profile">deniseche</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15062">
					Hello,<br>
<br>
Thanks for this work ! It almost work for me but i have a strange issue.<br>
Here is my environement : <br>
Host server : Esxi 4.0 Update 1 (last version)<br>
One virtual Machine, Size : 140Gb<br>
Backup datastore type : NFS. Hosted by a nas appliance (iomega).<br>
<br>
Here is the issue. The first backup is taking place, Vm is backuped up 
on the nas. But when i have a look on the log the last availbale line is
 --- 2010-03-27 10:15:46 -- info: Removing snapshot from 
server.mydomain.com ...<br>
Next backup I have this error :<br>
2010-03-29 00:19:02 -- info: Snapshot found for server.mydomain.com, 
backup will not take place<br>
<br>
The intersting thing is no snapshot on the vm when i use vpshere client.
 If i take a snapshot on the virtual machine a new snapshot appear 
called : Consolidate Helper - 0<br>
<br>
If i remove all snapshot nextime, the backup work but i have the same 
issue.<br>
<br>
Here is a link to  my logfile <a class="jive-link-external" 
href="http://pastebin.com/nq9NPNU4">http://pastebin.com/nq9NPNU4</a><br>
<br>
The problem seems to be in snapshot removal, is there something to do ?<br>
<br>
Thanks for your help.<br>
Denis.
					</p>
				</div>
				<a name="comments-15039"></a>
				<div id="comment-15039" class="jive-content-comment ">
					<span>
						<span>
							Apr 1, 2010 7:36 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MYO5wW637Ly72523" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15062" title="Go to message">deniseche</a>
							</em>
					</span>
					<p id="comment-body-15039">
					You're affected by the "NFS" problem, take a look at FAQ #18<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15070"></a>
				<div id="comment-15070" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 1, 2010 8:42 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-J2pNjd6eYUJvfO04" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15039" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15070">
					Hi,<br>
<br>
I'm running with lot of troubles ghettoVCB.<br>
<br>
I started from scratch, since I had trouble before. I want to backup 3 
VM. I'm using a backup config file for one of my VM.<br>
</p><p>
0 23 * * * /vmfs/volumes/datastore1/vmBackup.sh -d debug -f 
/vmfs/volumes/datastore1/vm_backup_list &gt; 
/vmfs/volumes/datastore1/ghettoVCB-backup-$(date +\%F).log -c 
/vmfs/volumes/datastore1/backup_config/<br>
</p><p>
But the first run of this backup only produce a backup for one VM and it
 didn't compress it. <br>
<br>
any idea  ?
					</p>
				</div>
				<a name="comments-15071"></a>
				<div id="comment-15071" class="jive-content-comment ">
					<span>
						<span>
							Apr 1, 2010 8:54 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-BC6gONp4jhN4m100" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15070" title="Go to message">romgo75</a>
							</em>
					</span>
					<p id="comment-body-15071">
					Hello,<br>
<br>
You apparently did not go through the documentation and read the FAQ's, 
specifically #0 and #1 and since you're using compression, I would also 
recommend taking a good luck at the compression FAQ's.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15073"></a>
				<div id="comment-15073" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 1, 2010 12:48 PM
						</span>
							<!--<a href="/people/rdhoore108" title="Click to view rdhoore108's profile">
<img class="jive-avatar" src="/people/rdhoore108/avatar/16.png?a=-1" height="16" width="16" title="Click to view rdhoore108's profile" alt="Click to view rdhoore108's profile" />
</a>--><a href="http://communities.vmware.com/people/rdhoore108" 
id="jive-D9e8Ad7W8Ce49Bh2" class="jive-username-link" title="Click to 
view rdhoore108's profile">rdhoore108</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15053" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15073">
					Hi William,<br>
<br>
I have a humble suggestion: to add a command line parameter where we can
 tell the script NOT to remove previous backups of a VM if there was any
 error condition during the current backup of this VM, but to remove the
 current failed one instead. <br>
<br>
Imagine I have just enough disk space for one complete set of all my 
VM's, and for making a new set (before the previous is deleted). So my 
VM_BACKUP_ROTATION_COUNT = 1. Now, if  "clone disk" fails for a VM for 
any reason, I end up with an incomplete new backup, plus my previous 
good backup is gone (deleted by the script).<br>
<br>
As it is now, the script joyfully declares the backup successful, and 
removes my previous (truly successful) backup. For example:<br>
<br>
(...)<br>
Cloning disk '/vmfs/volumes/Raid5/SQLSRV1/SQLSRV1_1.vmdk'...<br>
Clone: 49% done.Failed to clone disk : No space left on device 
(1835017).<br>
2010-04-01 17:22:00 -- info: Removing snapshot from SQLSRV1 ...<br>
2010-04-01 17:22:05 -- info: Backup Duration: 18.18 Minutes<br>
2010-04-01 17:22:05 -- info: Successfully completed backup for SQLSRV1!<br>
<br>
Maybe the script could look for an error condition, and consider the 
operation failed instead of successful, retaining the previous backups 
and removing the last instead (when a parameter of your choice is 
passed, for backward compatibility).<br>
<br>
Thank you so much for considering this. My sincere apologies if this has
 been suggested before, I've tried reading through all comments, but 
gave up halfway, there are just too many.<br>
<br>
Regards,<br>
Ronny
					</p>
				</div>
				<a name="comments-15054"></a>
				<div id="comment-15054" class="jive-content-comment ">
					<span>
						<span>
							Apr 1, 2010 3:04 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7hW2rP79r6fVSfLv" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15073" title="Go to message">rdhoore108</a>
							</em>
					</span>
					<p id="comment-body-15054">
					Yes this has been suggested already, take a look at my comment on <b>Mar
 30, 2010 1:25 PM</b><br>
<br>
I'll still need to figure out all the logic and the various use cases, 
but yes, this is something I'll be considering.<br>
<br>
Thanks<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15085"></a>
				<div id="comment-15085" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 2, 2010 2:57 PM
						</span>
							<!--<a href="/people/ianwitherow" title="Click to view ianwitherow's profile">
<img class="jive-avatar" src="/people/ianwitherow/avatar/16.png?a=-1" height="16" width="16" title="Click to view ianwitherow's profile" alt="Click to view ianwitherow's profile" />
</a>--><a href="http://communities.vmware.com/people/ianwitherow" 
id="jive-zHlh9h0FiFCDd6fW" class="jive-username-link" title="Click to 
view ianwitherow's profile">ianwitherow</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15054" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15085">
					Hey,<br>
I'm getting an error no matter what VM I try to back up. I'm running the
 command:<br>
<br>
./ghettoVCB.sh -f &lt;filename&gt;<br>
<br>
(file name has one line, the name of the VM). No matter which I try, I 
keep getting:<br>
<br>
"2010-04-02 21:48:18 -- info: Error: failed to locate and extract VM_ID 
for FTPServer!"<br>
<br>
(FTPServer was the example)<br>
Is there a line I should be changing to tell it where the VMs actually 
are on the SAN array?
					</p>
				</div>
				<a name="comments-15075"></a>
				<div id="comment-15075" class="jive-content-comment ">
					<span>
						<span>
							Apr 2, 2010 3:57 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-j24MigVDgX3hH87g" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15085" title="Go to message">ianwitherow</a>
							</em>
					</span>
					<p id="comment-body-15075">
					So if you're positive that the VM's displayName is in fact 
"FTPServer", what you can do to troubleshoot is the following command:<br>
<br>
ESX:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmware-vim-cmd vmsvc/getallvms | grep -i "FTPServer"
</code></pre><br>
<br>
ESXi<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/getallvms | grep -i "FTPServer"
</code></pre><br>
<br>
Something should return back with a line that specifies the VM's <b>vmid</b>
 along with other attributes if in fact this VM exists.<br>
<p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15086"></a>
				<div id="comment-15086" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 2, 2010 4:11 PM
						</span>
							<!--<a href="/people/ianwitherow" title="Click to view ianwitherow's profile">
<img class="jive-avatar" src="/people/ianwitherow/avatar/16.png?a=-1" height="16" width="16" title="Click to view ianwitherow's profile" alt="Click to view ianwitherow's profile" />
</a>--><a href="http://communities.vmware.com/people/ianwitherow" 
id="jive-xNf78SFvg5l8z5jQ" class="jive-username-link" title="Click to 
view ianwitherow's profile">ianwitherow</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15075" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15086">
					Thanks for that reply, it was very helpful.<br>
It's showing me the VMs from one of the folders we have set up. Is there
 a fairly simple way to increase the scope of that command to include 
other folders where we have VMs? <br>
eg: "/vmfs/volumes/ESXi-VMs" as well as  "/vmfs/volumes/A2VD1_VMs"<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-15076"></a>
				<div id="comment-15076" class="jive-content-comment ">
					<span>
						<span>
							Apr 2, 2010 4:45 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-doL8aRqVtDRQHHju" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15086" title="Go to message">ianwitherow</a>
							</em>
					</span>
					<p id="comment-body-15076">
					So the command that I'm showing you from above, lists only 
REGISTERED VMs on the current ESX(i) host. If it's not being displayed, 
then it means either A) VM is not registered B) it's running on another 
host.<br>
<br>
I'm basically providing you the method in the which the script figures 
out whether or not the VM you're looking to backup exists to pull out 
it's VMID.<br>
<br>
In your case, it sounds like it's not running on that host or you're 
getting the displayName wrong.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15088"></a>
				<div id="comment-15088" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 3, 2010 3:32 AM
						</span>
							<!--<a href="/people/goppi" title="Click to view goppi's profile">
<img class="jive-avatar" src="/people/goppi/avatar/16.png?a=-1" height="16" width="16" title="Click to view goppi's profile" alt="Click to view goppi's profile" />
</a>--><a href="http://communities.vmware.com/people/goppi" 
id="jive-RxySxeX57OSm4PkE" class="jive-username-link" title="Click to 
view goppi's profile">goppi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15085" title="Go to message">ianwitherow</a>
							</em>
					</span>
					<p id="comment-body-15088">
					@ianwitherow :<br>
<br>
You also will encounter this problem if the file containing the machines
 to backup uses the wrong EOL characters.<br>
This is somewhat difficult  to diagnose as the name of the VM displayed 
looks corret.<br>
Please ensure that the mentioned file is created under Linux and not 
under Windows or check with a hex editor that you don't see a CR+LF at 
the end of each line.<br>
<br>
HTH<br>
goppi.
					</p>
				</div>
				<a name="comments-15078"></a>
				<div id="comment-15078" class="jive-content-comment ">
					<span>
						<span>
							Apr 5, 2010 11:57 PM
						</span>
							<!--<a href="/people/deniseche" title="Click to view deniseche's profile">
<img class="jive-avatar" src="/people/deniseche/avatar/16.png?a=-1" height="16" width="16" title="Click to view deniseche's profile" alt="Click to view deniseche's profile" />
</a>--><a href="http://communities.vmware.com/people/deniseche" 
id="jive-yCPwIcbJK7N0gA1q" class="jive-username-link" title="Click to 
view deniseche's profile">deniseche</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15039" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15078">
					I had a look at FAQ #18, but i don't have Input/Output error in my 
log...<br>
By the way i tried to change from NFS protocol to Iscsi and i have the 
same issue.<br>
Any idea for a solution ?<br>
<br>
Regards.<br>
Denis.
					</p>
				</div>
				<a name="comments-15095"></a>
				<div id="comment-15095" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 6, 2010 9:08 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-D81itGjI4ccm3gcB" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15078" title="Go to message">deniseche</a>
							</em>
					</span>
					<p id="comment-body-15095">
					Well the input/output is one of many errors you may or may not see,
 basically from what you're describing, you're seeing similar problems 
when trying to delete larger files which also has a side affect of 
snapshots potentially being left behind. FAQ #29 also is related to this
 problem and it's not the NFS protocol specifically but it's still 
something we're not 100% sure. Though if you're switching between NFS 
and iSCSI and you're still seeing the error, then it looks like FAQ #29 
may apply to you. Try switching the underlying filesystem type which I'm
 assuming you're using ext3 to xfs and try it again. <br>
<br>
You'll also notice you won't run into this problem if you backup to a 
local VMFS volume on the host, so this specific to the datastore and 
it's configurations. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15069"></a>
				<div id="comment-15069" class="jive-content-comment ">
					<span>
						<span>
							Apr 8, 2010 3:53 AM
						</span>
							<!--<a href="/people/Miriano" title="Click to view Miriano's profile">
<img class="jive-avatar" src="/people/Miriano/avatar/16.png?a=-1" height="16" width="16" title="Click to view Miriano's profile" alt="Click to view Miriano's profile" />
</a>--><a href="http://communities.vmware.com/people/Miriano" 
id="jive-gSJxEXXHK7v7Qqzn" class="jive-username-link" title="Click to 
view Miriano's profile">Miriano</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15095" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15069">
					Hello William<br>
<br>
I thank you for the excellent script that makes life easier for us 
system administrators like me!<br>
<br>
if the information can be useful to other friends, I have scheduled the 
script from a Windows machine, and in combination with WinSCP and Plink 
BLAT I got a solution that makes me sleep peacefully!<br>
<br>
the real limit is that sometimes I find infrastructure machines with old
 snapshots.<br>
<br>
you think you can, provide these features in the script:<br>
<br>
</p><ul class="jive-dash">
<li>Shut down/Suspend(best) only one specific VM has a snapshot without 
make a new snapshot..</li>
<li>Perform a complete copy of the total of all files related to the VM 
in the path of the backup</li>
<li>Restart the same VM as if nothing had happened! <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":-)" 
border="0"></li>
</ul>
<br>
sorry if any argument was already addressed, but I tried to read the 
whole discussion and I found nothing.<br>
<br>
thanks again for your work!<br>
hello<br>
Miriano.
					
				</div>
				<a name="comments-15151"></a>
				<div id="comment-15151" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 15, 2010 5:58 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-L29UCEXcfeUjaEBS" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15069" title="Go to message">Miriano</a>
							</em>
					</span>
					<p id="comment-body-15151">
					It would be nice to see a mechanism to run a command on the guest 
before and after the snapshot was taken.<br>
<br>
My VM happens to be an email server, and while I probably can just have 
the whole thing shutdown, it might be "cleaner" just to have the guest 
prepare for the snapshot by shutting down any running services.<br>
<br>
Could that be easily added?
					</p>
				</div>
				<a name="comments-15153"></a>
				<div id="comment-15153" class="jive-content-comment ">
					<span>
						<span>
							Apr 15, 2010 8:34 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-50HDakO33n5AksFI" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15151" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-15153">
					No, this is not something that can be added. The ability to perform
 operations would differ from OS to OS and there's nothing you can 
leverage through a "free" solution to perform any type of operations 
within the guestOS. If you have VMware Tools installed, and you enable 
quiesce of the filesystem, it'll flush the IO to disk before the 
snapshot is taken, certain OSes such as Windows may have some built in 
frameworks as VSS to make the application aware that it's about to 
backed up. In either case, the snapshot <u>should</u> not affect the 
application running and it'll continue to perform r/w operations but all
 new writes will just go to a new delta disk. <br>
</p><p>
You of course could add your own "scripts" to say shutdown a 
service/etc. for instance SSH into a UNIX/Linux system but again this 
will be environment specific and is outside of the scope of the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15127"></a>
				<div id="comment-15127" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 15, 2010 9:47 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-ASToR5pUY8EuMwfg" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15153" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15127">
					I am not so concerned about eh VM continuing to run, but rather the
 usefulness of the snapshot that is taken.<br>
<br>
I think having a CMD that is run locally on the host before and after 
the snapshot would give me the ability to write a guest specific script 
that could essentially perform an SHH to the guest to run a script there
 that would do my shutdown and restart.<br>
<br>
I can add something to the existing script, but it seems like it might 
be a generally useful hook to add for other reasons...<br>
<br>
N'est ce pas?
					</p>
				</div>
				<a name="comments-15155"></a>
				<div id="comment-15155" class="jive-content-comment ">
					<span>
						<span>
							Apr 15, 2010 10:12 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-QQ0W2ncT5z1fb2d2" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15127" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-15155">
					</p><div class="jive-quote">
I am not so concerned about eh VM continuing to run, but rather the 
usefulness of the snapshot that is taken.<br>
</div>
<br>
Not sure I follow your comment, the "usefulness" of the <u>snapshot</u> 
is that it's required for powered on VMs to unlock the VMDK for read 
access, else it'll be locked. So that's a requirement, even for other 
backup solutions such as VMware vDR and Veeam Backup &amp; Replication.<br>
<br>
If you have a need to run guest specific commands/scripts before and 
after the backup, this is something that you'll need to create for your 
environment. Depending on restrictions/requirements of a given 
environment, the implementation of this can be done in various ways 
(e.g. using SSH keys,etc). <br>
<br>
Again, this is outside of the scope of this backup script, the point of 
the script is to provide a general backup script that can be implemented
 in any environment. If you need more specific operations that applies 
to your operating environment, then you'll need to implement those 
features yourself.<br>
<br>
Thanks<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15128"></a>
				<div id="comment-15128" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 15, 2010 10:28 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-S8v4j26EB27B6OU6" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15155" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15128">
					Like I said, my machine happens to be an email server. So, just 
grabbing a snapshot while it is processing email might not be great. For
 example (purely hypothetical), imagine it is in the middle of handling 
and incoming email so, pipes are open reading streams, and the DB has a 
transaction open, etc... Restoring to that exact point might not be 
useful since the incoming port will no longer have the data from the 
email server that sent the email in the first place (it would have been 
consumed by the continuation of the running VM). <br>
<br>
So, ideally I would shut down the email services gracefully prior to 
performing the backup to make sure the machine is nice and "quiet" for 
the snapshot to more likely be useful.<br>
<br>
At any rate, I am not looking for the scripts to actually do any of 
this, I can write that. I am just suggesting that having a hook in your 
script that allowed someone like me to specify in the VM's backup config
 file, a script that should be run prior to taking the snap shot, and 
another one after the snapshot was taken would be ideal. Something like:<br>
PRE_SNAPSHOT_CMD='shutdown.sh'<br>
POST_SNAPSHOT_CMD='restart.sh'<br>
<br>
And ghetto would simple (if the strings were not blank) execute those 
scripts on the host (checking the return values of course).<br>
<br>
Then I could write the shutdown.sh and restart.sh script to do what I 
need for that host running against my specific guest OS.<br>
<br>
See what I am getting at?
					</p>
				</div>
				<a name="comments-15156"></a>
				<div id="comment-15156" class="jive-content-comment ">
					<span>
						<span>
							Apr 15, 2010 10:43 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7ls8U6wwf15YU6mu" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15128" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-15156">
					I see where you're coming from but again I'm going to re-iterate my
 points. This is "specific" to YOUR environment, not everyone. I'm not 
going to make general assumption on how the script should be executed. 
What if I have some users that can utilize something like SSH keys to do
 the SSH to the host to execute the script and others that can't? What 
then? What if I have some users that are running Window OSes and not 
Linux OSes? You won't be executing the script in the same manner using a
 shell script/etc. What about isolated network management and VM 
networks? What if a user wants to run script A,B,C on VM1,3,4 but not 2 
and 5? The logic to implement something like this definitely not trivial
 and can be very complicate or very simple depending on the environment 
and the use cases. <br>
<br>
Regarding feature requests, I would like to point you to FAQ #15<br>
<br>
The best advice/suggestion that I can offer is you implement something 
that fits your needs, I will not be creating any type of generic 
solution for this as there are too many variables / assumptions to 
consider. <br>
<br>
Thanks for the feedback.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15129"></a>
				<div id="comment-15129" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 15, 2010 11:25 AM
						</span>
							<!--<a href="/people/ScottChapman" title="Click to view ScottChapman's profile">
<img class="jive-avatar" src="/people/ScottChapman/avatar/16.png?a=-1" height="16" width="16" title="Click to view ScottChapman's profile" alt="Click to view ScottChapman's profile" />
</a>--><a href="http://communities.vmware.com/people/ScottChapman" 
id="jive-OP67JAXdC0Ai2KKi" class="jive-username-link" title="Click to 
view ScottChapman's profile">ScottChapman</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15156" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15129">
					That's the whole point of just providing the hook; it is up to the 
user to write the actual script that is appropriate for their 
environment. The only assumption that ghetto would make is that if it is
 set, and points to a valid file, it would perform a system call to it 
and get the return value; erroring out on a non-zero return value. And 
that would be the extent of the contract ghetto would have; everything 
else would be up to the user.<br>
<br>
Also, because it would be in the VM config file, they could specify 
different scripts for different VMs if they wanted to.<br>
<br>
If the user needed to run script A,B,C for VM1 they would write a script
 that ran A,B,C and specified that script in the parameter in the config
 file for VM1. <br>
<br>
I understand your skepticism that this would indeed be useful to others,
 and thus not really interested in implementing it. I would be more than
 happy to implement it and give it back to your for your consideration.
					</p>
				</div>
				<a name="comments-15157"></a>
				<div id="comment-15157" class="jive-content-comment ">
					<span>
						<span>
							Apr 15, 2010 11:49 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-2vdenF2I4K5x730c" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15129" title="Go to message">ScottChapman</a>
							</em>
					</span>
					<p id="comment-body-15157">
					Like I said, there's definitely a way to implement something like 
this but it will not be a trivial task. This would potentially add an 
additional level of complexity on top of the script and additional 
testing. My main concern is what if these "user" scripts never return? 
Debugging whether it's the script or user scripts? Creating a simple 
Linux scriptp and using something like SSH keys wouldn't be too bad, but
 what about the use case for Window base systems? Creating the "user" 
script will differ between ESX and ESXi, since Busybox console will be 
much more limited. Simple SCP would work for UNIX/Linux systems but to 
get a script onto Windows box may not be as trivial and may require 
other binaries/components. <br>
<br>
If you come up with a method by all means, though this is something I'm 
not going to be adding into the script nor supporting. <br>
<br>
Good Luck<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15180"></a>
				<div id="comment-15180" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 18, 2010 4:13 AM
						</span>
							<!--<a href="/people/Vishy1" title="Click to view Vishy1's profile">
<img class="jive-avatar" src="/people/Vishy1/avatar/16.png?a=-1" height="16" width="16" title="Click to view Vishy1's profile" alt="Click to view Vishy1's profile" />
</a>--><a href="http://communities.vmware.com/people/Vishy1" 
id="jive-I812qzLGLK8VApIL" class="jive-username-link" title="Click to 
view Vishy1's profile">Vishy1</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15180">
					Hi ALL,<br>
<br>
I have a small issue where I have in the global file VM name â€œWinXP 
Adminâ€ with a space in between doesnâ€™t get reflected to /tmp/list file 
during comparison. However in the /tmp/currentvms file, it does pickup 
that VM name. Can someone see what I am doing wrong here.<br>
<br>
</p><ol>
<li>start</li>
</ol>
rm -rf /tmp/list<br>
vmware-vim-cmd vmsvc/getallvms | sed 's/\"<img class="jive-emoticon" 
src="DOC-8760_files/mischief.gif" alt=";\" border="0">"/g' | sed '1,1d' 
&gt; /tmp/currentvms<br>
for i in `cat /tmp/currentvms` ;do<br>
awk -v var=$i -F, '$1==var' 
/vmfs/volumes/BACKUP/scripts/globaltobecloned &gt;&gt; /tmp/list<br>
done<br>
/vmfs/volumes/BACKUP/scripts/ghettoVCB.sh -f /tmp/list<br>
<br>
Thanks in advance.<br>
Vishal<br>
<p>
<br>
If you found this information useful, please consider awarding points 
for Correct or Helpful.
					</p>
				</div>
				<a name="comments-15170"></a>
				<div id="comment-15170" class="jive-content-comment ">
					<span>
						<span>
							Apr 18, 2010 8:12 AM
						</span>
							<!--<a href="/people/webifi" title="Click to view webifi's profile">
<img class="jive-avatar" src="/people/webifi/avatar/16.png?a=-1" height="16" width="16" title="Click to view webifi's profile" alt="Click to view webifi's profile" />
</a>--><a href="http://communities.vmware.com/people/webifi" 
id="jive-IX9sF1uFHVV1XVku" class="jive-username-link" title="Click to 
view webifi's profile">webifi</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15170">
					I see as a listed feature: "Ability to include/exclude specific 
VMDK(s) per VM".<br>
<br>
However, after looking through the documentation, I see no specific 
language on how to "exclude" a VMDK, only how to specifically include a 
list of VMDKs, or "all".   This implies that the method for exclusion is
 to simply exclude a VMDK from the include list (include all but the one
 you don't want.)<br>
<br>
I would like to completely exclude a specific VM, and all of its VMDKs 
from being backed up.  How do i accomplish this?  Do I simply set 
VMDK_FILES_TO_BACKUP="" for that VM?   Is there another way to tell 
ghettoVCB to skip the VM in its entirety?<br>
<br>
Thanks,<br>
--John
					</p>
				</div>
				<a name="comments-15181"></a>
				<div id="comment-15181" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 18, 2010 9:06 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-42VTOOuW5fl79h0j" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15170" title="Go to message">webifi</a>
							</em>
					</span>
					<p id="comment-body-15181">
					This is an easy one <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
<br>
By default, not all VMs get backed up. As you can see from the 
documentation, you need to specify a <b>vmlist</b> which tells the 
script which VMs to back up, so if you want to skip a specific VM all 
together, just don't include it. If you need a more granular backup 
config such as specifying specific VMDK, then you need to create a 
backup configuration file for each VM in which you can specify exactly 
which VMDK(s) you want backed up. Again, all this relies on the vmlist 
and the VMs within the file. Hopefully this makes sense, if not, I would
 recommend you go through the documentation again.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15171"></a>
				<div id="comment-15171" class="jive-content-comment ">
					<span>
						<span>
							Apr 18, 2010 11:17 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-f8UV3Lbd7qjkEEpz" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-15171">
					Hello everyone,<br>
<br>
I've been spending some time looking at the suggestions/features 
provided by the community and have the following listed:<br>
<br>
</p><ul>
<li>1) Ability to backup all VMs w/o having to specify a list</li>
<li>2) Ability to power off VM, offline snapshot and power the VM back 
on and proceed with the backup.</li>
<li>3) Global ghettoVCB configuration file</li>
<li>4) Implementation of some locking mechanism to ensure only 1 
ghettoVCB instance can run at any given moment</li>
<li>5) Support VMs with existing snapshots</li>
<li>6) Ability to control whether VM backup directories are rotated in 
general or kept in-definite and leave it to end users to rotate out</li>
<li>7) Additional logging + overall final status of backup job</li>
</ul>
<br>
As of writing this, I've completed the implementation of #1, #3, #4, #6 
and #7. I've still got a bit more of testing to do but will be releasing
 an early preview of the script for the general public. <br>
<br>
I will not be implementing #5 as snapshots should not be used for long 
durations but also for technical reasons as the implementation of 
removing snapshots by <b>vimsh</b> is not the most robust and could lead
 into issues especially with complicated snapshot trees. With regards to
 feature suggestion #2, I still need to explore what changes that may 
mean for the script as it may not be a straight forward change.<br>
<br>
Again, thanks to the community for all the great feedback and to the 
users who have written some enhancement to the scripts, I've taken some 
of features and integrated into the new script.<br>
<br>
Keep an eye out for the new version of ghettoVCB very soon! <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15190"></a>
				<div id="comment-15190" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 19, 2010 5:55 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-yiKtWsX3HuF7HllV" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15190">
					Hello,<br>
<br>
I have got some issue with the script.<br>
<br>
here is my log file : <a class="jive-link-external" 
href="http://pastebin.com/NN5BasUw">http://pastebin.com/NN5BasUw</a><br>
<br>
ESXI 4.0<br>
SMP Release build-219382<br>
<br>
vm1 : vmdk 20 Go<br>
vm2 : vmdk 20 Go<br>
<br>
Backup datastore type : local<br>
<br>
In my backup folder I have got the following folders :<br>
<br>
vm1<br>
vm2<br>
<br>
Inside the folder vm2 :<br>
vm2-2010-04-19     vm2-2010-04-19--2  vm2-2010-04-19--3<br>
</p><p>
Inside the folder vm1 :<br>
vm1-2010-04-19--3<br>
<br>
I try this script on two different server (running the same esxi 
version). I was running the backup with the crontab.<br>
When I'm running the backup manually, everything seems allright. <br>
<br>
Thanks in advance for any help.<br>
</p><p>
</p><p>
In my vm2 folder I still have the snapshot (delta files are still 
there).<br>
<br>
Any idea ?
					</p>
				</div>
				<a name="comments-15191"></a>
				<div id="comment-15191" class="jive-content-comment ">
					<span>
						<span>
							Apr 19, 2010 6:14 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-YIi3KuwG1c14hiSM" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15190" title="Go to message">romgo75</a>
							</em>
					</span>
					<p id="comment-body-15191">
					Sorry I forgot to give the capacity of the datastore 2 :<br>
            1.8T    642.6G      1.2T  35%
					</p>
				</div>
				<a name="comments-15238"></a>
				<div id="comment-15238" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 19, 2010 10:53 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MJTg3B3y70E8J7u3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15190" title="Go to message">romgo75</a>
							</em>
					</span>
					<p id="comment-body-15238">
					Quickly looking at your logs, it seems that you have multiple 
backups running at the same time, especially <b>vm1</b>. I would double 
check your crontab entry to ensure you don't have multiple ghettoVCB 
instances running which may be over-stepping each other and that maybe 
why you're still seeing delta files. <br>
<br>
If you can manually run it without any problems, then it should be the 
same if you have it scheduled via cron. In the next release, a check has
 been implemented to ensure that only 1 instance of ghettoVCB is running
 at anytime on a given host. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15207"></a>
				<div id="comment-15207" class="jive-content-comment ">
					<span>
						<span>
							Apr 20, 2010 2:48 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-MvwLmC4l7fwqWy6q" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15238" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15207">
					Hello,<br>
<br>
thank you for you answer. I told you a bit quickly I didn't had any 
trouble by manual execution, but I finished my test and I have exactly 
the same issue. <br>
</p><p>
<br>
I try to run the script on my other ESXI server which is exactly the 
same configuration and I have trouble too. <br>
<br>
I used the following crontab :<br>
<br>
01 * * * * /vmfs/volumes/datastore2/ghettoVCB/ghettoVCB.sh  -d debug -f 
/vmfs/volumes/datastore2/ghettoVCB/vm_list -l  
/vmfs/volumes/datastore2/ghettoVCB/backup.log<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-15229"></a>
				<div id="comment-15229" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 20, 2010 11:36 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-AWwy1IvMo9EiChve" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-15229">
					Just released the latest version with the script with the changes I
 had mentioned earlier, please give the script a try and let me know 
what you think or if you find any issues/bugs.<br>
<br>
Thanks and enjoy!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15234"></a>
				<div id="comment-15234" class="jive-content-comment ">
					<span>
						<span>
							Apr 22, 2010 7:32 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-XQqPuOTGs0bXtr4Y" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15229" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15234">
					Hello William,<br>
<br>
I try your last version of the script. Now its working but I have some 
issue.<br>
<br>
I let run the script for a while see the pastebin : <a 
class="jive-link-external" href="http://pastebin.com/EdE2U5yz">http://pastebin.com/EdE2U5yz</a><br>
<br>
</p><ul class="jive-dash">
<li>I see lot of error # Failed to acquire lock, another instance of 
script may be running, giving up on /tmp/ghettoVCB.lock</li>
</ul>
But I'm running with the following crontab : <br>
01 * * * * /vmfs/volumes/datastore2/ghettoVCB/ghettoVCB.sh  -d debug -f 
/vmfs/volumes/datastore2/ghettoVCB/vm_list -l  
/vmfs/volumes/datastore2/ghettoVCB/backup.log<br>
<br>
I don't see why two instance of the script are running in the same time ?
 <br>
<br>
<ul class="jive-dash">
<li>The rotate of the backup didn't work as expected I had the following
 backup for vm2 in my folder :</li>
</ul>
<br>
vm2-2010-04-22_ 0-01-01<br>
vm2-2010-04-22_ 1-01-01<br>
vm2-2010-04-22_ 2-01-01<br>
vm2-2010-04-22_ 3-01-01<br>
vm2-2010-04-22_ 4-01-01<br>
vm2-2010-04-22_ 5-01-01<br>
vm2-2010-04-22_ 6-01-01<br>
vm2-2010-04-22_ 7-01-01<br>
vm2-2010-04-22_ 8-01-01<br>
vm2-2010-04-22_ 9-01-01<br>
vm2-2010-04-22_12-01-01<br>
vm2-2010-04-22_13-01-01<br>
vm2-2010-04-22_14-01-01<br>
<br>
I don't understand why I have got so much backup for one vm as I 
specified VM_BACKUP_ROTATION_COUNT = 3.<br>
Is there a relation with my previous issue ? <br>
<br>
Thanks in adavance
					
				</div>
				<a name="comments-15244"></a>
				<div id="comment-15244" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 22, 2010 7:58 AM
						</span>
							<!--<a href="/people/webifi" title="Click to view webifi's profile">
<img class="jive-avatar" src="/people/webifi/avatar/16.png?a=-1" height="16" width="16" title="Click to view webifi's profile" alt="Click to view webifi's profile" />
</a>--><a href="http://communities.vmware.com/people/webifi" 
id="jive-yhJD7jw9SfN8SLnp" class="jive-username-link" title="Click to 
view webifi's profile">webifi</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15229" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15244">
					The -a (all VMs) option in the new script is great, but it would be
 helpful to allow a list of VMs to exclude when using -a.
					</p>
				</div>
				<a name="comments-15246"></a>
				<div id="comment-15246" class="jive-content-comment ">
					<span>
						<span>
							Apr 22, 2010 8:51 AM
						</span>
							<!--<a href="/people/Zman14" title="Click to view Zman14's profile">
<img class="jive-avatar" src="/people/Zman14/avatar/16.png?a=-1" height="16" width="16" title="Click to view Zman14's profile" alt="Click to view Zman14's profile" />
</a>--><a href="http://communities.vmware.com/people/Zman14" 
id="jive-5Kyd0zVd2jPRGPGF" class="jive-username-link" title="Click to 
view Zman14's profile">Zman14</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15244" title="Go to message">webifi</a>
							</em>
					</span>
					<p id="comment-body-15246">
					Webifi, I second that
					</p>
				</div>
				<a name="comments-15247"></a>
				<div id="comment-15247" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 22, 2010 9:05 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-fS20OEn35w47iw5c" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15246" title="Go to message">Zman14</a>
							</em>
					</span>
					<p id="comment-body-15247">
					Hello <br>
Same here. A global exclusion would be great
					</p>
				</div>
				<a name="comments-15267"></a>
				<div id="comment-15267" class="jive-content-comment ">
					<span>
						<span>
							Apr 22, 2010 8:18 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ayM3x6m5Cc6E0kEY" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15247" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-15267">
					I'll add this to the backlog for the next release, should not be 
difficult but need to verify and test.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15271"></a>
				<div id="comment-15271" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 23, 2010 6:43 AM
						</span>
							<!--<a href="/people/romgo75" title="Click to view romgo75's profile">
<img class="jive-avatar" src="/people/romgo75/avatar/16.png?a=-1" height="16" width="16" title="Click to view romgo75's profile" alt="Click to view romgo75's profile" />
</a>--><a href="http://communities.vmware.com/people/romgo75" 
id="jive-6g2sPqjU43IcoxE5" class="jive-username-link" title="Click to 
view romgo75's profile">romgo75</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15229" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15271">
					Hello,<br>
<br>
I found a bug in the  script. This bug cause the script to be unable to 
delete the backup folder.<br>
The  default naming convention is :<br>
<br>
VM_BACKUP_DIR_NAMING_CONVENTION="$(date +%F_%k-%M-%S)"<br>
<br>
this definition induce a space in the folder name from 1am to 9am<br>
I replaced it by : <br>
<br>
VM_BACKUP_DIR_NAMING_CONVENTION="$(date +%F_%H-%M-%S)"<br>
<br>
And everything seems to be fine.
					</p>
				</div>
				<a name="comments-15213"></a>
				<div id="comment-15213" class="jive-content-comment ">
					<span>
						<span>
							Apr 23, 2010 6:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-iY01bV7iT871mBT4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15271" title="Go to message">romgo75</a>
							</em>
					</span>
					<p id="comment-body-15213">
					romgo75,<br>
<br>
Thanks for bringing this to my attention, you're right, must have fat 
fingered that entry. The issue has been resolved and I've just uploaded 
the latest version. Please download the latest version and let me know 
if you run into any other issues.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15214"></a>
				<div id="comment-15214" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 23, 2010 7:33 AM
						</span>
							<!--<a href="/people/aliog" title="Click to view aliog's profile">
<img class="jive-avatar" src="/people/aliog/avatar/16.png?a=-1" height="16" width="16" title="Click to view aliog's profile" alt="Click to view aliog's profile" />
</a>--><a href="http://communities.vmware.com/people/aliog" 
id="jive-oA7R6gD4F627K8Xt" class="jive-username-link" title="Click to 
view aliog's profile">aliog</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15214">
					Its my first visit to this thread for some time, as the ghettoVCB 
script has been running perfectly on my ESXi 3.5 setup for months. We 
are now in the process of migrating to ESX 4 so I thought I would drop 
by. <br>
<br>
Nice to see more improvements have been added since my last visit. I am 
testing the latest version on our new setup and all seems to be working 
great so far. <br>
<br>
Thanks again lamw
					</p>
				</div>
				<a name="comments-15217"></a>
				<div id="comment-15217" class="jive-content-comment ">
					<span>
						<span>
							Apr 23, 2010 10:17 AM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-YA8aeVMkprY77D06" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15267" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15217">
					Dear lamw:<br>
<br>
I have used this script over 1 year. it's really great. I like the new 
idea to seprate config file and program, so I try the new script today. 
however the script failed when I put  "ENABLE_NON_PERSISTENT_NFS=1" to 
the external config file.<br>
<br>
  after checking the script, I found the script create the nfs mount at 
the "sanityCheck" stage. but the external config have not read yet at 
that stage, it will read later. so the script failed.  hope it can be 
fixed so we can  enjoy the <br>
external settings with "ENABLE_NON_PERSISTENT_NFS=1"<br>
<br>
   and could you add "monosparse" disk format?  although it didn't show 
in the vmkfstools command help, but that format exists at least from 3.5
 to current 4.0. compare to "2gbsparse", "monosparse" is much easier to 
 handle for rsync or rdiff-backup for second phase backup. I have used 
monosparse since 3.5. and it is really good.<br>
</p><p>
   thanks again for your kindly help!!
					</p>
				</div>
				<a name="comments-15254"></a>
				<div id="comment-15254" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 23, 2010 10:54 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-vfK048TlLo3z9356" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15217" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-15254">
					Hi lamw<br>
<br>
thank you for new option: global configuratin file,<br>
however I have same problem as tbsky.<br>
Backup does not function if:<br>
</p><ul class="jive-dash">
<li>ENABLE_NON_PERSISTENT_NFS=1 is defined in global configuration file</li>
</ul>
and <br>
<ul class="jive-dash">
<li>NFS datastore does not mount manual before start of script</li>
</ul>
I think that script does not mount NFS datastore if script is running 
with parameter -g<br>
I tested that script mounts NFS storage OK if 
ENABLE_NON_PERSISTENT_NFS=1 is defined in main script<br>
<br>
Thanks<br>
<br>
Feature request:<br>
Could you extend the script for sending any log file by email in VMware 
vSphere?
					
				</div>
				<a name="comments-15272"></a>
				<div id="comment-15272" class="jive-content-comment ">
					<span>
						<span>
							Apr 23, 2010 11:21 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-JMp1ry4MSshtHRI7" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15254" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-15272">
					Roger that, I'll take a look when I get chance, little busy this 
weekend but try to get something out by Sunday.<br>
<br>
Email is not part of the scope, do a search online for email 
implementation. I know there are some hacks for classic ESX but not sure
 about ESXi and the unsupported console. I would recommend if you need 
this, you can dump the logs on NFS datastore and have a remote system 
pick them up and email. I know you can also hack around the local logger
 to have it direct the output to syslog and have that system handle it. 
In either scenario, it's not going to be handled by the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15282"></a>
				<div id="comment-15282" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 24, 2010 7:49 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-ol39t4e8TTse495r" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15254" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-15282">
					The bug has been resolved, please give the latest version a try and
 let me know.<br>
<br>
FYI - Also enhanced the script to allow for a VM exclusion list<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15295"></a>
				<div id="comment-15295" class="jive-content-comment ">
					<span>
						<span>
							Apr 26, 2010 1:51 AM
						</span>
							<!--<a href="/people/mattiarambelli" title="Click to view mattiarambelli's profile">
<img class="jive-avatar" src="/people/mattiarambelli/avatar/16.png?a=-1" height="16" width="16" title="Click to view mattiarambelli's profile" alt="Click to view mattiarambelli's profile" />
</a>--><a href="http://communities.vmware.com/people/mattiarambelli" 
id="jive-yq7ff7R1wT3zrCwq" class="jive-username-link" title="Click to 
view mattiarambelli's profile">mattiarambelli</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15295">
					Hi, i'm having a strange problem with ghettovcb/esxi4:<br>
the first backup went well, but i haven't snapshots associated with the 
VM and ghettovcb fails for the "snapshot found" reason.<br>
I looked in the iSCSI disk where the vm is and it's structured like 
there's a backup, but the snapshot manager doesn't see it, nor it's 
removed by vim-cmd command.<br>
Have someone of you had my same problem with iSCSI disks?<br>
If i enable the poweroff backup, will it backup well even if there are 
the vm-000000n disks?<br>
thank you for your help<br>
Mattia Rambelli
					</p>
				</div>
				<a name="comments-15310"></a>
				<div id="comment-15310" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 26, 2010 2:49 AM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-MqU77sM38b2QhC44" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15282" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15310">
					Dear lamw:<br>
    the script now runs fine. but it show an error "./ghettoVCB.sh: line
 798: cannot create : nonexistent directory".<br>
    after tracing, that error comes from the "logger" function. when it 
is called by "reConfigureGhettoVCBConfiguration()". it wants to log to 
${LOG_OUTPUT} but the variable didn't exist at that stage. it seems the 
chicken-egg problem. maybe "logger" function can just log to stdout if  
${LOG_OUTPUT} is empty?<br>
    and I find the script now need the "adapter" info. can we just skip 
that part if we need to keep the original adapter, no mater what 
type(buslogic or ide or ...) it is?<br>
    thanks a lot for your help!!
					</p>
				</div>
				<a name="comments-15283"></a>
				<div id="comment-15283" class="jive-content-comment ">
					<span>
						<span>
							Apr 26, 2010 6:43 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-D5TYTbohX5IMP2De" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15310" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-15283">
					Odd, I ran through few of my tests and did not run into the problem
 using the latest version of the script from 04/24/2010<br>
<br>
I've just updated where the global configuration gets set, can download 
the latest version and give it a try. If you still continue to run into 
issues for whatever reason, can you provide a little background on the 
configuration you have setup? (e.g. options you're using and if this is 
on ESX or ESXi/etc.) - Please check out FAQ #1 if you have more 
questions.<br>
<br>
Regarding the adapter, that has always been a required parameter, if you
 did not explicitly set it, it relies on the default which is buslogic. 
I'm assuming you haven't been modifying the script?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15296"></a>
				<div id="comment-15296" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 26, 2010 8:11 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-EWG72UypzlxYm162" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15296">
					Where is the -a "backup all VMs" option mentioned above? It does 
not seem to be in the actual ghettoVCB.sh:<br>
<br>
./ghettoVCB.sh -a<br>
./ghettoVCB.sh: line 729: usage: not found<br>
<br>
There is no -a listed in options:<br>
<br>
   -f     List of VMs to backup<br>
   -c     Configuration directory for VM backups<br>
   -l     File to output logging<br>
   -d     Debug level <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=debug"
 title="dryrun">info</a> (default: info)
					</p>
				</div>
				<a name="comments-15297"></a>
				<div id="comment-15297" class="jive-content-comment ">
					<span>
						<span>
							Apr 26, 2010 8:15 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-gegJC0q22s4M7BPS" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15296" title="Go to message">chrb</a>
							</em>
					</span>
					<p id="comment-body-15297">
					Ok forget this, the site must have served up an old version of the 
script - I have re-clicked and got the new version with -a.
					</p>
				</div>
				<a name="comments-15285"></a>
				<div id="comment-15285" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 26, 2010 10:10 AM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-tm7DW36wcIeXaVao" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15283" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15285">
					Dear lamw:<br>
      sorry I didn't make it clear. maybe you don't use global 
configuration file, so you didn't encounter the error.<br>
I use global cofiguration file to backup every vm. my backup command is 
 "ghettoVCB.sh -f backup_list -g  ghettoVCB.conf". with that config, the
 newest script  will read global config at sequence below<br>
<br>
line 145:   reConfigureGhettoVCBConfiguration "${GLOBAL_CONF}"  <br>
line  279:   logger "info" "CONFIG - USING GLOBAL GHETTOVCB 
CONFIGURATION FILE = ${GLOBAL_CONF}"<br>
line  38:	if ........... then<br>
</p><p>
 at line 38, LOG_TO_STDOUT is not exist yet, so it go to:<br>
</p><p>
line 50: 	echo -e "${TIME} -- ${LOG_TYPE}: ${MSG}" &gt;&gt; 
"${LOG_OUTPUT}"<br>
</p><p>
 ${LOG_OUTPUT} is not exist either, so script  give out error message<br>
<br>
I suggest maybe modify line 38 to check empty ${LOG_TO_STDOUT} to 
prevent chick-egg problem.<br>
</p><p>
and my ghettoVCB.conf:<br>
DISK_BACKUP_FORMAT=2gbsparse<br>
VM_BACKUP_DIR_NAMING_CONVENTION=image<br>
VM_BACKUP_ROTATION_COUNT=1<br>
POWER_VM_DOWN_BEFORE_BACKUP=0<br>
ENABLE_HARD_POWER_OFF=0<br>
SNAPSHOT_TIMEOUT=30<br>
ENABLE_COMPRESSION=0<br>
ADAPTER_FORMAT=lsilogic<br>
VM_SNAPSHOT_MEMORY=0<br>
VM_SNAPSHOT_QUIESCE=1<br>
ENABLE_NON_PERSISTENT_NFS=1<br>
UNMOUNT_NFS=1<br>
NFS_SERVER=10.1.1.1<br>
NFS_MOUNT=/share/nfs<br>
NFS_LOCAL_NAME=nfs_storage_backup<br>
NFS_VM_BACKUP_DIR=backup<br>
<br>
     and about  "adapter" type. old script didn't use "-a" when doing 
vmkfstools, it just respect the original adapter type. that's the 
behavior I want. because I just want my backup to use the same adapter 
type as original, no matter it is buslogic, lsilogic, or ide. <br>
<br>
     about modification, now I only modify the script a little to use 
"monosparse" instead of "2gbsparse". <br>
I can live with that I think. it seems few people need "monosparse"  
backups..<br>
<br>
    thanks again for your kindly help!!
					</p>
				</div>
				<a name="comments-15288"></a>
				<div id="comment-15288" class="jive-content-comment ">
					<span>
						<span>
							Apr 26, 2010 5:08 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-k65G38Hd987v4Jd5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15285" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-15288">
					Okay, I've moved the output of using the global configuration 
further down into the script. All that output is used for is for me to 
know that someone is using a global conf and mainly around for 
troubelshooting. The fix should resolve the problem and if not, please 
let me know. <br>
<br>
I've actually had requests about specifying the adapter type and 
probably was added in one of the subsequent release. It may have been in
 the very early version of the script that adapter type was not 
something you can specify.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15298"></a>
				<div id="comment-15298" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 27, 2010 3:46 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-KhmRTKhMf30YPach" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15288" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15298">
					Hi guys<br>
<br>
I've got a new problem:<br>
Failed to clone disk : The system cannot find the file specified (25)<br>
Thats the log entry.<br>
I've searched the web and found that if this issue occurs I have to take
 the spaces from the filenames.<br>
So far so good, I have done this in every filename, .vmdk, .vmx , .vmxf 
but the error still occurs.<br>
The VM boots up again it can still work but I cant take a backup.<br>
<br>
What can I do?<br>
<br>
Thanks for your replies<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-15289"></a>
				<div id="comment-15289" class="jive-content-comment ">
					<span>
						<span>
							Apr 27, 2010 6:35 AM
						</span>
							<!--<a href="/people/tbsky" title="Click to view tbsky's profile">
<img class="jive-avatar" src="/people/tbsky/avatar/16.png?a=-1" height="16" width="16" title="Click to view tbsky's profile" alt="Click to view tbsky's profile" />
</a>--><a href="http://communities.vmware.com/people/tbsky" 
id="jive-eLoeCS2VGesvP6bv" class="jive-username-link" title="Click to 
view tbsky's profile">tbsky</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15288" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15289">
					Dear lamw:<br>
    now the script works perfect for me. thanks again for your great 
help!!
					</p>
				</div>
				<a name="comments-15300"></a>
				<div id="comment-15300" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 27, 2010 9:18 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-54lsFRcHYKg7NvFW" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15289" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-15300">
					Awesome, glad to hear!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15301"></a>
				<div id="comment-15301" class="jive-content-comment ">
					<span>
						<span>
							Apr 27, 2010 9:19 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-62Utx14y7tMGu8JY" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15298" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15301">
					Please read FAQ #1<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15303"></a>
				<div id="comment-15303" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 27, 2010 4:19 PM
						</span>
							<!--<a href="/people/scowse" title="Click to view scowse's profile">
<img class="jive-avatar" src="/people/scowse/avatar/16.png?a=-1" height="16" width="16" title="Click to view scowse's profile" alt="Click to view scowse's profile" />
</a>--><a href="http://communities.vmware.com/people/scowse" 
id="jive-JoLrkObi3Hoqiwi7" class="jive-username-link" title="Click to 
view scowse's profile">scowse</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15285" title="Go to message">tbsky</a>
							</em>
					</span>
					<p id="comment-body-15303">
					I have seen no evidence that the "adapter type" setting has ever 
changed the adapter type on a backed up vm.<br>
<br>
Anyone seen this do anything?<br>
<br>
I do not actually want it to change but there seems to be a lot of 
confusion about this setting and it's effect.
					</p>
				</div>
				<a name="comments-15293"></a>
				<div id="comment-15293" class="jive-content-comment ">
					<span>
						<span>
							Apr 28, 2010 1:36 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-uyEL5Wd036dSh4T3" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15293">
					Hi,<br>
<br>
yesterday I tried the new version of ghettoVCB with the exclusion list 
feature. This worked for me on one of two servers. On that one where it 
did not worked the script tried to backup all VMs although I defined one
 VM not to backup.<br>
<br>
What can be the reason for that problem?<br>
<br>
One other problem I have on that server. It is an error I get for one of
 the VMs "2010-04-27 23:30:04 -- info: Error: failed to locate and 
extract VM_ID for ..." What can cause this error?<br>
Are there any naming conventions for the VMs? I ask because we have 
names with "/" and "(...)"?<br>
<br>
Thanks, Tom
					</p>
				</div>
				<a name="comments-15294"></a>
				<div id="comment-15294" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 28, 2010 2:50 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-5p5XUIM5E1p2qD3r" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15294">
					Removing snapshot hangs:<br>
<br>
Clone: 100% done.<br>
2010-04-28 09:16:42 -- info: Removing snapshot from Web_TESTBOX6 ...<br>
<br>
It should take about 10 seconds but I leave it for 20 minutes before 
quitting. I see this has already been reported several times. Is there 
any solution?<br>
</p><p>
I take it that david pyer's solution above (387 ${VMWARE_CMD} 
vmsvc/snapshot.removeall ${VM_ID} &gt; /dev/null 2&gt;&amp;1) will 
remove all snapshots rather than just the one made for backup?<br>
<br>
Edit: Also, it would be nice if a single host backup failing like this 
didn't end the backup when using -a... if problems with backing up a 
single host were handled better so the script would continue on and 
still backup the other hosts. At the moment I am waiting an hour for a 
failure, and hosts following the ones that hangs are not being backed 
up.
					</p>
				</div>
				<a name="comments-15315"></a>
				<div id="comment-15315" class="jive-content-comment ">
					<span>
						<span>
							Apr 28, 2010 6:50 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-oEH4w6WYQ2xQGx52" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15294" title="Go to message">chrb</a>
							</em>
					</span>
					<p id="comment-body-15315">
					This may be related to FAQ #18 and #29. Are you running ESXi and 
using and NFS datastore to backup your VMs? If you are in fact hitting 
these issues related to the "NFS" issue, there's not much that can be 
done since the backups do complete for the existing VM but something 
causes the script to hang and everything has pointed back to either the 
ESXi host or the NFS server. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15316"></a>
				<div id="comment-15316" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 28, 2010 6:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GW1Eo9uq9b3pl622" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15293" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15316">
					I suspect it's most likely due to your naming convention for your 
VMs, perhaps the "/" is causing some issues. In general, I don't 
recommend using odd characters for your VM names. Even though Windows 
allows it, I prefer to use things like "-" or "_" or even maybe "." to 
separate out a name. <br>
<br>
I would need to test to see if this is the case, but it should be 
trivial for you to test by properly renaming the VM not only the display
 name but the actual files backing the VM and re-run your backup. You 
can also try running this in <b>dryrun</b> mode and see if it's able to 
properly parse our your VM, I would expect that it may not show up in 
the dryrun as it's not able to search for the VM due to the special 
chars. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15327"></a>
				<div id="comment-15327" class="jive-content-comment ">
					<span>
						<span>
							Apr 29, 2010 1:49 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-fX2lCQuBUTTdJxPy" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15315" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15327">
					GhettoVCB.sh hangs on one specific VM persistently when attempting 
to remove the snapshot. The weird thing is that this VM has snapshots 
and should not be being backed up anyway. VMX_DIR has:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain"> 
 # ls -l /vmfs/volumes/datastore4/TESTBOX6
-rw-------    1 root     root         8589934592 Mar 11 17:38 TESTBOX5-000001-flat.vmdk
-rw-------    1 root     root                503 Mar 11 17:38 TESTBOX5-000001.vmdk
-rw-------    1 root     root         8589934592 Mar 11 17:38 TESTBOX5-000002-flat.vmdk
-rw-------    1 root     root                503 Mar 11 17:38 TESTBOX5-000002.vmdk
-rw-------    1 root     root         8589934592 Mar 11 17:33 TESTBOX5-000004-flat.vmdk
-rw-------    1 root     root                503 Mar 11 17:33 TESTBOX5-000004.vmdk
-rw-------    1 root     root         8589934592 Apr 29 08:45 TESTBOX5-000005-flat.vmdk
-rw-------    1 root     root                503 Apr 29 08:35 TESTBOX5-000005.vmdk
-rw-------    1 root     root          268435456 Mar 12 10:56 TESTBOX5-425ed04f.vswp
-rw-------    1 root     root          269643751 Mar 11 17:12 TESTBOX5-Snapshot7.vmsn
-rw-------    1 root     root         8589934592 Mar 11 16:54 TESTBOX5-flat.vmdk
-rw-------    1 root     root               8684 Apr 29 02:15 TESTBOX5.nvram
-rw-------    1 root     root                470 Mar 11 17:05 TESTBOX5.vmdk
-rw-------    1 root     root               2358 Apr 29 08:35 TESTBOX5.vmsd
-rw-------    1 root     root               3039 Apr 29 08:35 TESTBOX5.vmx
-rw-------    1 root     root                263 Apr 21 15:28 TESTBOX5.vmxf
-rw-------    1 root     root              63270 Mar 11 16:54 vmware-11.log
-rw-------    1 root     root             165654 Mar 11 16:54 vmware-12.log
-rw-------    1 root     root             105954 Mar 11 16:54 vmware-6.log
-rw-------    1 root     root             240822 Mar 11 16:54 vmware-7.log
-rw-------    1 root     root              62127 Mar 11 16:54 vmware-8.log
-rw-------    1 root     root             105384 Mar 11 16:54 vmware-9.log
-rw-r--r--    1 root     root             309577 Apr 29 08:35 vmware.log
</code></pre> <br>
<br>
GhettoVCB.sh checks for a snapshot by using "grep -delta" but as you can
 see from the listing the snapshot does not have a -delta file. (If it 
helps, I think this VM was probably cloned from another, maybe using 
VMware Converter). <br>
<br>
More generally, I am curious as to the technical reasons as to why 
snapshots should not be used long-term. For testing we use boxes which 
are snapshotted after an OS install, so we can install software over the
 top of it, test, and then revert. Also for testing we will have 
multiple product configs saved as snapshots derived from the same 
initial install. This enables quickly changing between different configs
 for faster testing. Is there some technical reason why this is a bad 
thing to do with VMware?
					
				</div>
				<a name="comments-15328"></a>
				<div id="comment-15328" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 29, 2010 1:55 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-M0mMrTTGkoBIuNiW" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15316" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15328">
					Hi William, you are right, the problem was the "()". I removed them
 and did a dryrun and it seems to work.<br>
<br>
Thank you for that usefull hint!
					</p>
				</div>
				<a name="comments-15330"></a>
				<div id="comment-15330" class="jive-content-comment ">
					<span>
						<span>
							Apr 29, 2010 9:35 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-It59uvGjWB72cF26" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15327" title="Go to message">chrb</a>
							</em>
					</span>
					<p id="comment-body-15330">
					So my personal stance on snapshots, is that it does have it's place
 but many times it's not properly understood and is abused as an easy 
way to "revert" back in time. The problem is many users don't understand
 the implication when a snapshot is created, especially on a live 
running VM and what happens to that snapshot as time goes on.<br>
<br>
I would invite you take a look at the following links:<br>
<a class="jive-link-external" href="http://kb.vmware.com/kb/1015180">VMware
 KB - How do snapshots work?</a><br>
<a class="jive-link-external" 
href="http://www.yellow-bricks.com/2008/01/07/delete-all-snapshots/">The
 process &amp; space required when committing/deleting multiple 
snapshots</a><br>
<a class="jive-link-external" href="http://www.vmdamentals.com/?p=332">Performance
 Impact when using VMware snapshots</a><br>
<br>
The way VMware snapshots are implemented, they're really meant for short
 duration of time. Unless you're very clear on the changes and even 
then, you really need some solid monitoring on your VM's disk + 
datastore. If you have a VM that's been allocated to be 20GB and you 
take a snapshot while it runs, a new "delta" disk is created which 
starts out at 16MB, that's how much it grows. The original disk is now 
left in a "read-only" state and no longer grows. All changes going 
forward now will write to the delta disk, now lets say you do a bunch of
 changes and install new applications and start writing and you grow the
 disk ... this new "delta" can actually get up to the size of the 
original disk if you introduce huge amounts of change and let's say it 
gets to 15GB, we now take another snapshot. We now have a new delta disk
 that continues to grow/etc. You can see how easily w/o proper 
monitoring that you can take multiple snapshots and potentially fill up 
your datastore. <br>
<br>
This example is just with one VM but you can see how bad this can be 
with bunch more VMs. The other piece of it, as deltas get larger, when 
you commit the changes, it also takes quite a bit of time an generates 
quite a bit of I/O on the backend which can impact performance. If you 
take a look at Duncan's article on how snapshot commit/delete are done, 
they require so much more additional space than the snapshot size as it 
requires to commit every snapshot before it actually deletes it. <br>
<br>
So it's not that snapshots are bad thing, but its not well understood 
and generally users run into all sorts of problems when they start to 
use snapshots without understanding how they really work. I've seen 
several posting on the VMTN forums where users end up with 500GB or 1TB 
snapshots that grew for a year! and commits that took few days to a few 
weeks. <br>
<br>
This is why I do not promote the use of snapshots for long durations of 
time, they have their place like you've mentioned for critical 
patches/updates. Heck even VMware's VUM utility allows you to snapshot a
 VM prior to patching and then removing the snapshot after x-days, but 
it's a temporarily thing and not mean to be long lived. <br>
<br>
Now regarding your VM, I'm not sure what state it was in ... but usually
 when you properly clone a VM, at least from vCenter, it'll consolidate 
the snapshot to your destination (e.g. the newly cloned VM will won't 
have snapshots and will just carry the latest changes)<br>
<br>
To verify if you truly have snapshots, you may want to go to vSphere 
Client and check the snapshot manager to see if it see's any snapshots. 
It's not uncommon that the vSphere Client may not see the snapshots but 
you still have them and also it's not uncommon to end up with orphaned 
snapshots. I'm not an expert in figuring out the whole snapshot tree and
 what links to what and what can be deleted ... but in generally ,if 
you're not sure. You should be able to create a new snapshot using the 
vSphere Client and then do a "delete all" and that should commit all the
 changes and hopefully clean up any leftovers. If there are still 
snapshot files, then they may actually be orphaned. <br>
<br>
Hopefully this helps you understand how VMware snapshots work and their 
impact <br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15337"></a>
				<div id="comment-15337" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 30, 2010 2:12 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-4T9G5vp13zJeARW2" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15301" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15337">
					Hi lamw<br>
<br>
i have posted my logoutput to pastebin.com<br>
here is the link<br>
<a class="jive-link-external" href="http://pastebin.com/xgiG3dNa">http://pastebin.com/xgiG3dNa</a><br>
<br>
Regards<br>
<br>
Matthias
					</p>
				</div>
				<a name="comments-15309"></a>
				<div id="comment-15309" class="jive-content-comment ">
					<span>
						<span>
							Apr 30, 2010 2:42 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-w2YrwK3OiNrUXnfT" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15309">
					Hi William,<br>
<br>
first I want say thank you for this great script. IÂ´am using this now 
since two months and it works great!<br>
<br>
With the new version I have only one problem, it does not recognize the 
VM_BACKUP_ROTATION_COUNT option. This option is set on 2 backups 
(VM_BACKUP_ROTATION_COUNT=2).<br>
<br>
I saw today that I have 4 backups in the folders of my vmware 
appliances. The first one was created with an "older" version of 
ghettoVCB, so the naming is different (Servername-2010-04-26--1) and the
 other three are in the new naming scheme with the scheduled time of the
 backup (Servername-2010-04-27_20-00-01).<br>
<br>
So the script does not delete the old backups. What can cause this 
problem?
					</p>
				</div>
				<a name="comments-15355"></a>
				<div id="comment-15355" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 30, 2010 6:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-SViEj9bK9ujidh4S" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15309" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15355">
					Yes, this was a known bug that caused a space to be created within 
the output name. This has resolved in one of the updates, please 
manually delete the backup with the spaces or manually rename and 
download the new script and you should not run into this problem. <br>
<br>
The latest version is always updated within the documentation and if you
 look at the title now, it includes the last revision date. All changes 
are documented in the change log, I would recommend that you take a look
 prior to posting to see if certain bugs/features have been added. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15356"></a>
				<div id="comment-15356" class="jive-content-comment ">
					<span>
						<span>
							Apr 30, 2010 6:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-UwlUQ887fl4alf2S" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15337" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15356">
					Could you also include a dryrun output as well? It's interesting 
that the errors is that it can't find the specified disks. You may also 
need to provide me your directory structure to this VM + .vmx file to 
compare, since that is where the script is pulling the paths to the 
VMDK(s). <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15344"></a>
				<div id="comment-15344" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 30, 2010 6:58 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-1AkA0AnkCNA375C9" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15355" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15344">
					IÂ´am using already the latest version of the script. I have 
downloaded this on monday the 26th and installed it after.
					</p>
				</div>
				<a name="comments-15345"></a>
				<div id="comment-15345" class="jive-content-comment ">
					<span>
						<span>
							Apr 30, 2010 7:09 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-hKTVaDqp2pEP37U5" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15356" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15345">
					Hi lamw,<br>
<br>
thanks for the fast reply.<br>
Here is the link to pastbin.com<br>
<a class="jive-link-external" href="http://pastebin.com/hHczvj1M">http://pastebin.com/hHczvj1M</a><br>
But now I have used the new version from your script.<br>
Maybe I haven't got the problem (?!) but I can't test a real run yet!<br>
<br>
On tuesday next week I can paste the real run log.<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-15338"></a>
				<div id="comment-15338" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Apr 30, 2010 8:19 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-t9EOG2qpqNyH3FEB" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15344" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15338">
					Actually there were two updates that day. The problem that you're 
referring to was fixed in the latest version, you can easily verify by 
greping out "date" and you'll see that there's a difference in the way 
the date is generated. You mentioned earlier you were using an old 
version of the script which created the "space" and that has been 
resolved, please download the latest version and let me know if you 
still run into the problems. I would also either delete OR update the 
current backups so they match the existing format, else the rotation 
will have issues.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15386"></a>
				<div id="comment-15386" class="jive-content-comment ">
					<span>
						<span>
							May 3, 2010 4:13 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-8u3KBVG9dUW1GUU4" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15330" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15386">
					William,<br>
<br>
Thank you for the detailed reply regarding snapshots.<br>
<br>
I have another problem. VMs with whitespace in the VM name are not being
 removed during rotation. A fix diff follows:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">--- ghettoVCB.sh.orig   2010-05-03 09:52:52.845261356 +0100
+++ ghettoVCB.sh        2010-05-03 10:07:25.342935259 +0100
@@ -390,6 +390,8 @@
        LIST_BACKUPS=$(ls -t "${BACKUP_DIR_PATH}")
        BACKUPS_TO_KEEP=$(ls -t "${BACKUP_DIR_PATH}" | head -"${VM_BACKUP_ROTATION_COUNT}")

+       OLD_IFS=$IFS
+       IFS="$(echo -e "\n\r")"
         for i in ${LIST_BACKUPS};
         do
                 FOUND=0
@@ -405,6 +407,7 @@
                        rm -rf "$BACKUP_DIR_PATH/$i"
                 fi
         done
+       IFS=$OLD_IFS
 }

 ghettoVCB() {
</code></pre>
					
				</div>
				<a name="comments-15400"></a>
				<div id="comment-15400" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 3, 2010 11:14 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-E2NlJuujpTKLme6z" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15386" title="Go to message">chrb</a>
							</em>
					</span>
					<p id="comment-body-15400">
					Thanks for reporting this, if you've read the documentation, you 
know my stance on using "spaces" in a name <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"> When you ran this 
test, was it on ESX or ESXi?<br>
<br>
I'll get this updated tonight and post the new version.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15388"></a>
				<div id="comment-15388" class="jive-content-comment ">
					<span>
						<span>
							May 4, 2010 2:22 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-FIgz38gkkSgyymhA" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15356" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15388">
					Hi lamw,<br>
<br>
now, with the actualized script the logoutput is only:<br>
<br>
" 2010-05-04 09:01:03 -- debug: Failed to acquire lock, another instance
 of script may be running, giving up on /tmp/ghettoVCB.lock"<br>
<br>
Are the vmdks locked?<br>
<br>
what can I do?<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-15402"></a>
				<div id="comment-15402" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 4, 2010 6:47 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-L2XEdx124U98UGr5" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15388" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15402">
					As the message states: <br>
</p><p>
</p><div class="jive-quote">another instance of script may be running</div>
<br>
This is a new feature introduced which prevents multiple instances of 
the script launching. In the past this has bitten certain users who 
miss-configured their cron entry, this has nothing to do with VMDK 
locking<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15403"></a>
				<div id="comment-15403" class="jive-content-comment ">
					<span>
						<span>
							May 4, 2010 9:45 AM
						</span>
							<!--<a href="/people/maxsupremicus" title="Click to view maxsupremicus's profile">
<img class="jive-avatar" src="/people/maxsupremicus/avatar/16.png?a=-1" height="16" width="16" title="Click to view maxsupremicus's profile" alt="Click to view maxsupremicus's profile" />
</a>--><a href="http://communities.vmware.com/people/maxsupremicus" 
id="jive-UjGQ4WDYMdmKubEv" class="jive-username-link" title="Click to 
view maxsupremicus's profile">maxsupremicus</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15171" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15403">
					I wrote a summarize script in AWK that summarizes the output log. 
Not sure anyone will find it helpful, but here's the script:<br>
<br>
----<br>
<br>
<strike>root@openfiler backups</strike># cat summarize-esxi-log.sh<br>
#!/bin/awk -f<br>
<br>
/Initiate backup/ {<br>
        error="";<br>
        printf "%-20s ", $NF;<br>
};<br>
<br>
/Failed/ {<br>
        error=substr($0,match($0,"Failed"))<br>
};<br>
<br>
/Backup Duration/ {<br>
        printf "duration: %s %s", $(NF-1), $NF<br>
};<br>
<br>
/(Successfully|Error)/ {<br>
        if ($5 == "Successfully" &amp;&amp; length(error) == 0)<br>
                printf "\tSUCCESS";<br>
        else<br>
                printf "\tFAILED";<br>
<br>
        if (length(error) &gt; 0)<br>
                printf " : %s\n", error;<br>
        else<br>
                printf "\n"<br>
};<br>
<br>
/Snapshot found for .*, backup will not take place/ {<br>
        printf "%-20s no backup =&gt; has snapshot\tFAILED\n", 
substr($8, 1, length($8)-1)<br>
};<br>
<br>
----<br>
<br>
When you run one of the ghetto backup log files through this awk script,
 you get this formatted output which I have a job email to me daily:<br>
<br>
<strike>root@openfiler backups</strike># ./summarize-esxi-log.sh 
logs/zeta-weekly-201005012332.log<br>
delaware             duration: 17.80 Minutes    SUCCESS<br>
connecticut          duration: 33.57 Minutes    SUCCESS<br>
scrod                duration: 10.70 Minutes    SUCCESS<br>
earth                duration: 52.73 Minutes    SUCCESS<br>
uranus               duration: 67.03 Minutes    FAILED : Failed to clone
 disk : No space left on device (1835017).<br>
georgia              duration: 17.18 Minutes    SUCCESS<br>
pike                 duration: 34.17 Minutes    SUCCESS<br>
rattler              duration: 15.50 Minutes    FAILED<br>
python               duration: 15.55 Minutes    FAILED<br>
neptune              duration: 20.47 Minutes    SUCCESS<br>
newjersey            duration: 21.07 Minutes    SUCCESS<br>
<br>
I find it easier to quickly glance at this report and see if anything 
needs addressed.<br>
<br>
Enjoy!
					</p>
				</div>
				<a name="comments-15406"></a>
				<div id="comment-15406" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 5, 2010 3:46 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-M7oNJk1sKtjAajP0" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15338" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15406">
					Hi William,<br>
<br>
the problem still exists, also with the updated script the old backups 
will not be deleted.<br>
<br>
What else can cause the problem?
					</p>
				</div>
				<a name="comments-15420"></a>
				<div id="comment-15420" class="jive-content-comment ">
					<span>
						<span>
							May 5, 2010 7:07 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Qp0p41ajUz5SI35N" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15406" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15420">
					Do you have spaces in your VM names? This was recently reported, 
but I'm still waiting for confirmation that it suggest fix is resolved 
prior to posting. <br>
<br>
Could you provide a directory structure listing of the backup directory 
and post it here?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15391"></a>
				<div id="comment-15391" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 5, 2010 7:34 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-2ueF0vSQW7MbRxmD" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15420" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15391">
					Hi William,<br>
<br>
yes we use spaces in the names. Sorry I did not read it before (maybe I 
did not understand well because english is not my native language).<br>
<br>
I canÂ´t give you a listing of the backup directory, because the names 
too much detailed, such like domain names and so on ... sorry.
					</p>
				</div>
				<a name="comments-15421"></a>
				<div id="comment-15421" class="jive-content-comment ">
					<span>
						<span>
							May 5, 2010 7:41 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-vY53npl066ExUCtz" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15391" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15421">
					That's okay, then you're running into the problem that one of the 
users reported earlier on. I'll post a fix shortly and you can verify if
 it resolves the problem.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15422"></a>
				<div id="comment-15422" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 5, 2010 8:16 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-ceJNHz1jceDG0lt2" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15400" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15422">
					Yes, spaces in names sometimes suck, but VMware allows it and I 
can't control what other people do. <br>
<br>
The problem I ran into with VMs with spaces in the names not being 
removed was with esxi 4.0.
					</p>
				</div>
				<a name="comments-15424"></a>
				<div id="comment-15424" class="jive-content-comment ">
					<span>
						<span>
							May 5, 2010 8:23 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-r9vLtMdoSgTkiXgz" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15422" title="Go to message">chrb</a>
							</em>
					</span>
					<p id="comment-body-15424">
					np. I've just updated the script and did a quick verification. 
Thanks for reporting the bug<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15407"></a>
				<div id="comment-15407" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 5, 2010 5:30 PM
						</span>
							<!--<a href="/people/mogmios" title="Click to view mogmios's profile">
<img class="jive-avatar" src="/people/mogmios/avatar/16.png?a=-1" height="16" width="16" title="Click to view mogmios's profile" alt="Click to view mogmios's profile" />
</a>--><a href="http://communities.vmware.com/people/mogmios" 
id="jive-WcrX7R0NJoN41U6j" class="jive-username-link" title="Click to 
view mogmios's profile">mogmios</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15407">
					You're command to check that crond is running doesn't seem to work 
on ESXi 4. But this alternative seems to work.<br>
<br>
ps | grep "$(cat /var/run/crond.pid)"
					</p>
				</div>
				<a name="comments-15409"></a>
				<div id="comment-15409" class="jive-content-comment ">
					<span>
						<span>
							May 6, 2010 4:52 AM
						</span>
							<!--<a href="/people/mitch2k" title="Click to view mitch2k's profile">
<img class="jive-avatar" src="/people/mitch2k/avatar/16.png?a=-1" height="16" width="16" title="Click to view mitch2k's profile" alt="Click to view mitch2k's profile" />
</a>--><a href="http://communities.vmware.com/people/mitch2k" 
id="jive-n155i2R5XSbgXpFs" class="jive-username-link" title="Click to 
view mitch2k's profile">mitch2k</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15409">
					Hi guys,<br>
<br>
thanks for the great script. currently im having trouble with the latest
 script.<br>
<br>
im running ghettovcb via cronjob on full esx with the following syntax:<br>
<br>
00 1  * * 7 /root/ghettoVCB/ghettoVCB.sh -f /root/ghettoVCB/vms -d debug
 -l /tmp/ghettoVCB.log<br>
the cronjob is starting the script successfully but not all vm's are 
getting backed up. it seems that the script is too fast with the backup?
 output of the logfile:<br>
<br>
2010-05-06 11:46:05 -- info: Initiate backup for backup_hostname1<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk 
'/vmfs/volumes/vgdata01/backup_hostname1_3/backup_hostname1_1.vmdk'...<br>
^MClone: 0% done.^MClone: 1% done.^MClone: 2% done.^MClone: 3% 
done.^MClone: 4% done.^MClone: 5% done.^MClone: 6% done.^MClone: 7% 
done.^MClone: 8% done.^MClone: 9% done.^MClone: 10% done.^MClone: 11% 
done.^MClone: 12% done.^MClone: 13% done.^MClone: 14% done.^MClone: 15% 
done.^MClone: 16% done.^MClone: 17% done.^MClone: 18% done.^MClone: 19% 
done.^MClone: 20% done.^MClone: 21% done.^MClone: 22% done.^MClone: 23% 
done.^MClone: 24% done.^MClone: 25% done.^MClone: 26% done.^MClone: 27% 
done.^MClone: 28% done.^MClone: 29% done.^MClone: 30% done.^MClone: 31% 
done.^MClone: 32% done.^MClone: 33% done.^MClone: 34% done.^MClone: 35% 
done.^MClone: 36% done.^MClone: 37% done.^MClone: 38% done.^MClone: 39% 
done.^MClone: 40% done.^MClone: 41% done.^MClone: 42% done.^MClone: 43% 
done.^MClone: 44% done.^MClone: 45% done.^MClone: 46% done.^MClone: 47% 
done.^MClone: 48% done.^MClone: 49% done.^MClone: 50% done.^MClone: 51% 
done.^MClone: 52% done.^MClone: 53% done.^MClone: 54% done.^MClone: 55% 
done.^MClone: 56% done.^MClone: 57% done.^MClone: 58% done.^MClone: 59% 
done.^MClone: 60% done.^MClone: 61% done.^MClone: 62% done.^MClone: 63% 
done.^MClone: 64% done.^MClone: 65% done.^MClone: 66% done.^MClone: 67% 
done.^MClone: 68% done.^MClone: 69% done.^MClone: 70% done.^MClone: 71% 
done.^MClone: 72% done.^MClone: 73% done.^MClone: 74% done.^MClone: 75% 
done.^MClone: 76% done.^MClone: 77% done.^MClone: 78% done.^MClone: 79% 
done.^MClone: 80% done.^MClone: 81% done.^MClone: 82% done.^MClone: 83% 
done.^MClone: 84% done.^MClone: 85% done.^MClone: 86% done.^MClone: 87% 
done.^MClone: 88% done.^MClone: 89% done.^MClone: 90% done.^MClone: 91% 
done.^MClone: 92% done.^MClone: 93% done.^MClone: 94% done.^MClone: 95% 
done.^MClone: 96% done.^MClone: 97% done.^MClone: 98% done.^MClone: 99% 
done.^MClone: 100% done.<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk 
'/vmfs/volumes/vgdata01/backup_hostname1_3/backup_hostname1.vmdk'...<br>
2010-05-06 13:30:08 -- info: Backup Duration: 104.05 Minutes<br>
2010-05-06 13:30:08 -- info: Successfully completed backup for 
backup_hostname1!<br>
<br>
the other ones:<br>
<br>
Cloning disk 
'/vmfs/volumes/vgdata01/backup_hostname6/backup_hostname6_1.vmdk'...<br>
^MClone: 0% done.2010-05-06 13:35:48 -- info: Backup Duration: 5.63 
Minutes<br>
2010-05-06 13:35:48 -- info: Successfully completed backup for 
backup_hostname6!<br>
<br>
2010-05-06 13:35:51 -- info: Initiate backup for backup_hostname2<br>
2010-05-06 13:36:01 -- info: Backup Duration: 10 Seconds<br>
2010-05-06 13:36:01 -- info: Successfully completed backup for 
backup_hostname2!<br>
<br>
2010-05-06 13:36:04 -- info: Initiate backup for backup_hostname3<br>
2010-05-06 13:36:05 -- info: Backup Duration: 1 Seconds<br>
2010-05-06 13:36:05 -- info: Successfully completed backup for 
backup_hostname3!<br>
<br>
2010-05-06 13:36:06 -- info: Initiate backup for backup_hostname4<br>
2010-05-06 13:36:12 -- info: Backup Duration: 6 Seconds<br>
2010-05-06 13:36:12 -- info: Successfully completed backup for 
backup_hostname4!<br>
<br>
2010-05-06 13:36:15 -- info: Initiate backup for backup_hostname5<br>
2010-05-06 13:36:20 -- info: Backup Duration: 5 Seconds<br>
2010-05-06 13:36:20 -- info: Successfully completed backup for 
backup_hostname5!<br>
<br>
the backup of the other is not completed, for example backup_hostname6 
has approx. 600gb.<br>
does anyone know what is happening here?<br>
<br>
thanks for help!
					</p>
				</div>
				<a name="comments-15412"></a>
				<div id="comment-15412" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 9, 2010 11:25 AM
						</span>
							<!--<a href="/people/ibhp1" title="Click to view ibhp1's profile">
<img class="jive-avatar" src="/people/ibhp1/avatar/16.png?a=-1" height="16" width="16" title="Click to view ibhp1's profile" alt="Click to view ibhp1's profile" />
</a>--><a href="http://communities.vmware.com/people/ibhp1" 
id="jive-m6Oppm65g1h6yvG9" class="jive-username-link" title="Click to 
view ibhp1's profile">ibhp1</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15409" title="Go to message">mitch2k</a>
							</em>
					</span>
					<p id="comment-body-15412">
					Hello all<br>
<br>
I've got a strange Problem with the new version. My Backup's are taken 
perfectly. But after the backups are finished, not only the snapshots 
are deletet but also the actual backup directory with the newest 
backups.<br>
<br>
The log file (debug) shows the following interresting lines. Please hava
 a look at the "Naming Convention" and you will see exactly the 
directory with this name is beeing deletet at the last line...:<br>
<br>
2010-05-07 23:26:01 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/Second_1TB_HD/Backup<br>
2010-05-07 23:26:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 0<br>
2010-05-07 23:26:01 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-05-07_23-26-01<br>
...<br>
...<br>
2010-05-08 01:54:42 -- debug: Removing 
/vmfs/volumes/Second_1TB_HD/Backup/Win_2008_Server_PH_1/Win_2008_Server_PH_1-2010-05-07_23-26-01<br>
</p><p>
Any ideas?<br>
Thank you, ibhp
					</p>
				</div>
				<a name="comments-15413"></a>
				<div id="comment-15413" class="jive-content-comment ">
					<span>
						<span>
							May 9, 2010 11:28 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0dcf4A876FM42zgr" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15412" title="Go to message">ibhp1</a>
							</em>
					</span>
					<p id="comment-body-15413">
					This looks like an expected behavior, <b>VM_BACKUP_ROTATION_COUNT</b>
 is being set as 0? Any reason you have that set to be 0? It sounds like
 the script is doing exactly as it should by following the # of 
rotations to keep and in this case, it looks like you don't want to keep
 any? Try changing it to something that is &gt; 0<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15414"></a>
				<div id="comment-15414" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 9, 2010 11:30 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-QgA194T3ejVftfMo" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15409" title="Go to message">mitch2k</a>
							</em>
					</span>
					<p id="comment-body-15414">
					The output from the log does not seem like it's in "debug" mode, 
else you should have more information. Can you backup the remainder VMs 
when running it interactively? Can you please ensure that the logging is
 in debug mode and re-post using pastebin, please take a look at FAQ #1<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15399"></a>
				<div id="comment-15399" class="jive-content-comment ">
					<span>
						<span>
							May 9, 2010 12:35 PM
						</span>
							<!--<a href="/people/Furgirl39" title="Click to view Furgirl39's profile">
<img class="jive-avatar" src="/people/Furgirl39/avatar/16.png?a=-1" height="16" width="16" title="Click to view Furgirl39's profile" alt="Click to view Furgirl39's profile" />
</a>--><a href="http://communities.vmware.com/people/Furgirl39" 
id="jive-OyAMgV392TE5Ykjc" class="jive-username-link" title="Click to 
view Furgirl39's profile">Furgirl39</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15399">
					Hi William,<br>
<br>
Thanks for your great work! <br>
<br>
You're probably sick of the subject, but would you mind tarring up the 
restore script as well?
					</p>
				</div>
				<a name="comments-15430"></a>
				<div id="comment-15430" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 10, 2010 6:35 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-8hy2vXvdT7mF1WC8" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15421" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15430">
					Thank you very much William, I can confirm that the script now 
works well and the rotation count works also for VMs with spaces in the 
name.
					</p>
				</div>
				<a name="comments-15446"></a>
				<div id="comment-15446" class="jive-content-comment ">
					<span>
						<span>
							May 10, 2010 1:47 PM
						</span>
							<!--<a href="/people/kasala78" title="Click to view kasala78's profile">
<img class="jive-avatar" src="/people/kasala78/avatar/16.png?a=-1" height="16" width="16" title="Click to view kasala78's profile" alt="Click to view kasala78's profile" />
</a>--><a href="http://communities.vmware.com/people/kasala78" 
id="jive-ktreJnu1486e8zFU" class="jive-username-link" title="Click to 
view kasala78's profile">kasala78</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15446">
					I have had the ghettoVCB scripts running for an number of months 
with no problems.  Thank you for creating them!  Of late, I've had an 
issue where one of the VM's, when the script goes to create the 
snapshot, indicates that the snapshot already exists.  2 of the three 
VM's work correctly.  I've tried creating a new snapshot in the VSphere 
client, removing all snapshots, etc. with now luck.  Can someone give me
 some guidence on resolving this?  It's on a production environment and 
is somewhat urgent.<br>
<br>
Thanks!
					</p>
				</div>
				<a name="comments-15461"></a>
				<div id="comment-15461" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 10, 2010 7:46 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-k34p9t5Q3D813122" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15399" title="Go to message">Furgirl39</a>
							</em>
					</span>
					<p id="comment-body-15461">
					Done.<br>
<br>
In the future, please post your inquiry/comment in the appropriate forum
 <img class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" 
border="0"> I get notifications on all documents/scripts I've created, I
 don't monitor one document more than any others. I get traffic on 
pretty much all of them <img class="jive-emoticon" 
src="DOC-8760_files/wink.gif" alt=";)" border="0"><br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15462"></a>
				<div id="comment-15462" class="jive-content-comment ">
					<span>
						<span>
							May 10, 2010 7:47 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-M60z2i84nYXyiWDC" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15430" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15462">
					Great to hear!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15463"></a>
				<div id="comment-15463" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 10, 2010 7:49 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-e3IJLL4Pkssc8h8s" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15446" title="Go to message">kasala78</a>
							</em>
					</span>
					<p id="comment-body-15463">
					Please refer to FAQ #0 and #1 before posting<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15464"></a>
				<div id="comment-15464" class="jive-content-comment ">
					<span>
						<span>
							May 10, 2010 9:54 PM
						</span>
							<!--<a href="/people/kasala78" title="Click to view kasala78's profile">
<img class="jive-avatar" src="/people/kasala78/avatar/16.png?a=-1" height="16" width="16" title="Click to view kasala78's profile" alt="Click to view kasala78's profile" />
</a>--><a href="http://communities.vmware.com/people/kasala78" 
id="jive-7GDQ9L72j0H199VM" class="jive-username-link" title="Click to 
view kasala78's profile">kasala78</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15463" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15464">
					My appologies.<br>
<br>
Here's the log: <a class="jive-link-external" 
href="http://pastebin.com/Av6Wtq38">http://pastebin.com/Av6Wtq38</a><br>
<br>
Environment:<br>
VMWare Server: ESXi4 4.0.0, 208167<br>
HP Proliant ML370 G5<br>
Storage: Local<br>
Guests: 3<br>
Guest 1: 73GB - 73GB Used<br>
Guest 2: 48GB - 48GB Used<br>
Guest 3: 138GB - 39GB Used (Problem system)<br>
<br>
Did I miss anything?
					</p>
				</div>
				<a name="comments-15447"></a>
				<div id="comment-15447" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 10, 2010 10:02 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GD3l6AjR0rmF2eAs" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15464" title="Go to message">kasala78</a>
							</em>
					</span>
					<p id="comment-body-15447">
					What exactly is the problem? What is the name of "Guest 3", please 
be very specific.<br>
<br>
From the looks of your log, my guess is you're having issues with 
*WPB-APPS*? As you can see from the log, there's a snapshot that's been 
identified with this specific VM, hence it will not be backed up.<br>
<br>
Is this the problem you're referring to?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15465"></a>
				<div id="comment-15465" class="jive-content-comment ">
					<span>
						<span>
							May 11, 2010 12:35 AM
						</span>
							<!--<a href="/people/above2m" title="Click to view above2m's profile">
<img class="jive-avatar" src="/people/above2m/avatar/16.png?a=-1" height="16" width="16" title="Click to view above2m's profile" alt="Click to view above2m's profile" />
</a>--><a href="http://communities.vmware.com/people/above2m" 
id="jive-NtVCPTPD5toGVaxK" class="jive-username-link" title="Click to 
view above2m's profile">above2m</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15465">
					Hi lamw,<br>
<br>
first i want to say is, that  i linke that script, great work!<br>
I have a question maybe you or someone else can answer it very quick?! <br>
<br>
I use the free Version of the ESXi 4.0 Hypervisor an my backups go to a 
QNAP NAS via NFS.<br>
For  a better view i write a separate Logfile to a share on my nas, 
which i can access via smb, so i can see, if a backup was successfull or
 not.<br>
<br>
Here is my cronjob: <br>
<b><br>
0 2 * * 2-6 /vmfs/volumes/Hypervisor3/ghettoVCB.sh -f 
/vmfs/volumes/Hypervisor3/serverlist -l 
/vmfs/volumes/Logfiles/ESXi-Backup-$(date +\%A-%d-%b-%Y).log<br>
</b><br>
it works fine for me, so i tried to put that to /etc/rc.local:<br>
<br>
<b><br>
/bin/kill $(cat /var/run/crond.pid)<br>
/bin/echo "0 2 * * 2-6 /vmfs/volumes/Hypervisor3/ghettoVCB.sh -f 
/vmfs/volumes/Hypervisor3/serverlist -l 
/vmfs/volumes/Logfiles/ESXi-Backup-$(date +\%A-%d-%b-%Y).log" &gt;&gt; 
/var/spool/cron/crontabs/root<br>
/bin/busybox crond<br>
</b><br>
<br>
Now, when the Hypervisor is rebootet the entry in the /etc/rc.local 
write that to my cronjob:<br>
<b><br>
0 2 * * 2-6 /vmfs/volumes/Hypervisor3/ghettoVCB.sh -f 
/vmfs/volumes/Hypervisor3/serverlist -l 
/vmfs/volumes/Logfiles/ESXi-Backup-Saturday-08-May-2010.log<br>
</b><br>
So that from that point every backup log will be written to the same 
File called <b>"ESXi-Backup-Saturday-08-May-2010.log"</b><br>
<br>
Can you tell me, how i have to change the syntax in the rc.local, so 
that following entry will be written to the cronjob after reboot of the 
ESXi Server:<br>
<b><br>
0 2 * * 2-6 /vmfs/volumes/Hypervisor3/ghettoVCB.sh -f 
/vmfs/volumes/Hypervisor3/serverlist -l 
/vmfs/volumes/Logfiles/ESXi-Backup-$(date +\%A-%d-%b-%Y).log<br>
</b><br>
Sorry for my bad english and my ignorance of Unix/Linux because iÂ´m a 
windows admin <img class="jive-emoticon" src="DOC-8760_files/happy.gif" 
alt=":-)" border="0"><br>
<br>
Best regards from germany,<br>
Alex
					</p>
				</div>
				<a name="comments-15432"></a>
				<div id="comment-15432" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 11, 2010 5:52 AM
						</span>
							<!--<a href="/people/MatthiasLuraTech" title="Click to view MatthiasLuraTech's profile">
<img class="jive-avatar" src="/people/MatthiasLuraTech/avatar/16.png?a=-1" height="16" width="16" title="Click to view MatthiasLuraTech's profile" alt="Click to view MatthiasLuraTech's profile" />
</a>--><a href="http://communities.vmware.com/people/MatthiasLuraTech" 
id="jive-odNqzCqUCTp3Dj5M" class="jive-username-link" title="Click to 
view MatthiasLuraTech's profile">MatthiasLuraTâ€¦</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15402" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15432">
					Hi lamw<br>
<br>
today the backup ran again. The script started through a cronjob. I use 
the newest script. The only logentry is now like the one last time:<br>
<br>
"2010-05-11 07:01:02 -- debug: Failed to acquire lock, another instance 
of script may be running, giving up on /tmp/ghettoVCB.lock"<br>
<br>
There is no other cronjob running this script and I did not start it 
manually.<br>
<br>
Does this entry mean another instance of ghettovcb ?<br>
How can I check which scripts access the files during backup?<br>
Sorry my linux knowledge is somewhat limited!<br>
<br>
Thanks and Regards
					</p>
				</div>
				<a name="comments-15466"></a>
				<div id="comment-15466" class="jive-content-comment ">
					<span>
						<span>
							May 11, 2010 6:55 AM
						</span>
							<!--<a href="/people/kasala78" title="Click to view kasala78's profile">
<img class="jive-avatar" src="/people/kasala78/avatar/16.png?a=-1" height="16" width="16" title="Click to view kasala78's profile" alt="Click to view kasala78's profile" />
</a>--><a href="http://communities.vmware.com/people/kasala78" 
id="jive-J97PP1aI0zgAxkdP" class="jive-username-link" title="Click to 
view kasala78's profile">kasala78</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15447" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15466">
					Yes, that is the problem I am referring to.  I have attempted to 
create and remove Snapshots through the VSphere client and this works 
fine.  VSphere does not believe there to be any snapshots existing at 
this time.  I have tried a complete restart of the VM environment again 
with no luck.  <br>
<br>
Guest1 - WPB-DC1<br>
Guest2 - WPB-SQL<br>
Guest3 - WPB-APPS.<br>
<br>
I inadvertently left in the placeholders I used when gathering 
information for the post.
					</p>
				</div>
				<a name="comments-15433"></a>
				<div id="comment-15433" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 11, 2010 7:01 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8q9Ipo8nvyNx8660" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15432" title="Go to message">MatthiasLuraTâ€¦</a>
							</em>
					</span>
					<p id="comment-body-15433">
					Like I've said in the past, this could be caused by incorrect setup
 of your cron entry, if you have further questions do a search online. 
If the cron job tried to launch two instances of the script, one of them
 will return back failed to acquire lock<br>
<br>
To see if there's another instance running, you'll run something like 
"ps -ef | grep -i ghetto", on ESXi, I don't recall if the "-ef" flags 
work. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15434"></a>
				<div id="comment-15434" class="jive-content-comment ">
					<span>
						<span>
							May 11, 2010 7:03 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0aPR9YR7F4fJBWle" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15466" title="Go to message">kasala78</a>
							</em>
					</span>
					<p id="comment-body-15434">
					It's not unheard of that you don't see any snapshots within the 
vSphere Client, but they still actually exists and rebooting a VMs will 
not solve the problem as this is outside of the guest.<br>
<br>
Can you do a listing (ls -la) of Guest3's directory, I'm guessing 
there's probably a delta file located in the directory which is why the 
script is stopping the backup. This could be from an orphaned 
snapshot/etc. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15467"></a>
				<div id="comment-15467" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 11, 2010 7:14 AM
						</span>
							<!--<a href="/people/kasala78" title="Click to view kasala78's profile">
<img class="jive-avatar" src="/people/kasala78/avatar/16.png?a=-1" height="16" width="16" title="Click to view kasala78's profile" alt="Click to view kasala78's profile" />
</a>--><a href="http://communities.vmware.com/people/kasala78" 
id="jive-o7Ny6wtUQ93Pc5YS" class="jive-username-link" title="Click to 
view kasala78's profile">kasala78</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15434" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15467">
					Note the .old Delta file.  I renamed then when the problem arose.  I
 was VERY hesitant to delete any files whatsoever...  Are there specific
 files in here I should just delete?<br>
<br>
/vmfs/volumes/4b543323-8f89e722-5a24-001a4be8a9ae/WPB-APPS # ls -l<br>
-rw-------    1 root     root         4312977639 Apr  2 12:46 
WPB-APPS-58ad2553.vmss<br>
-rw-------    1 root     root         4294967296 Apr  2 12:46 
WPB-APPS-58ad2553.vswp<br>
-rw-r--r--    1 root     root                 13 May  3 21:33 
WPB-APPS-aux.xml<br>
-rw-------    1 root     root        21474836480 May 11 08:11 
WPB-APPS-flat.vmdk<br>
-rw-------    1 root     root               8684 May  6 14:58 
WPB-APPS.nvram<br>
-rw-------    1 root     root                602 May  6 14:31 
WPB-APPS.vmdk<br>
-rw-------    1 root     root                668 May  3 21:33 
WPB-APPS.vmsd<br>
-rwxr-xr-x    1 root     root               3671 May  6 14:31 
WPB-APPS.vmx<br>
-rw-------    1 root     root               1851 May  6 14:34 
WPB-APPS.vmxf<br>
-rw-------    1 root     root               1851 May  3 15:52 
WPB-APPS.vmxf.old<br>
-rw-------    1 root     root           16984064 May  3 13:37 
WPB-APPS_1-000001-delta.vmdk.old<br>
-rw-------    1 root     root                361 May  3 13:37 
WPB-APPS_1-000001.kmdk.old<br>
-rw-------    1 root     root        10737418240 May 11 08:11 
WPB-APPS_2-flat.vmdk<br>
-rw-------    1 root     root                449 May  6 14:32 
WPB-APPS_2.vmdk<br>
-rw-------    1 root     root       107374182400 May  9 07:26 
WPB-APPS_3-flat.vmdk<br>
-rw-------    1 root     root                477 May  6 14:32 
WPB-APPS_3.vmdk<br>
-rw-r--r--    1 root     root              68423 Jan 18 13:30 
vmware-2.log<br>
-rw-r--r--    1 root     root             117996 Jan 18 14:36 
vmware-3.log<br>
-rw-r--r--    1 root     root             348708 Feb 22 14:12 
vmware-4.log<br>
-rw-r--r--    1 root     root              95281 Apr  2 12:31 
vmware-5.log<br>
-rw-r--r--    1 root     root              84319 Apr  4 07:24 
vmware-6.log<br>
-rw-r--r--    1 root     root            1874944 May  3 23:13 
vmware-7.log<br>
-rw-r--r--    1 root     root              67268 May  6 14:39 vmware.log<br>
/vmfs/volumes/4b543323-8f89e722-5a24-001a4be8a9ae/WPB-APPS #
					</p>
				</div>
				<a name="comments-15468"></a>
				<div id="comment-15468" class="jive-content-comment ">
					<span>
						<span>
							May 11, 2010 8:28 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Kirz8e671DWNiK9o" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15467" title="Go to message">kasala78</a>
							</em>
					</span>
					<p id="comment-body-15468">
					The rename won't help, the keyword "delta" still exists in the 
filename and the script does a directory listing looking for delta 
files. From the looks of it, a snapshot was taken and may have gotten 
into an orphaned state, so the script was doing exactly as it was 
designed to. I would recommend the following in resolving the snapshot 
issue. Rename the files back to original names, take a snapshot using 
the vSphere Client and then do a delete which is just a commit, 
generally this will clean up any old snapshots. If you're still unable 
to clean these up, I would recommend posting you question in the general
 VMTN forum to get further assistance. You'll need to get this cleaned 
up before the script will work. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15436"></a>
				<div id="comment-15436" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 11, 2010 9:17 AM
						</span>
							<!--<a href="/people/waldrondigital" title="Click to view waldrondigital's profile">
<img class="jive-avatar" src="/people/waldrondigital/avatar/16.png?a=-1" height="16" width="16" title="Click to view waldrondigital's profile" alt="Click to view waldrondigital's profile" />
</a>--><a href="http://communities.vmware.com/people/waldrondigital" 
id="jive-3koYMaDNe57SMbW5" class="jive-username-link" title="Click to 
view waldrondigital's profile">waldrondigital</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15436">
					I've created a ghettoVCB log to e-mail batch file based on the 
BLAT.EXE mailer.  It will run on any Windows host (I use it on a XP VM).<br>
<br>
<a class="jive-link-external" 
href="http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/">http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/</a><br>
<br>
Works for me!
					</p>
				</div>
				<a name="comments-15472"></a>
				<div id="comment-15472" class="jive-content-comment ">
					<span>
						<span>
							May 11, 2010 10:36 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-PR34xkfT4McmR0O4" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15436" title="Go to message">waldrondigital</a>
							</em>
					</span>
					<p id="comment-body-15472">
					Very cool, I'll update the links in the document to share with the 
community as well.<br>
<br>
I also forgot, I had another user contact me, he also created a utility 
to integrate with ghettoVCB and it's Windows base application: <a 
class="jive-link-external" 
href="http://www.magikmon.com/mkbackup/ghettovcb.en.html">http://www.magikmon.com/mkbackup/ghettovcb.en.html</a><br>
<br>
Awesome to see the community create tools/addons to enhance the script! 
If there are any others that I've missed, please let me know<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15443"></a>
				<div id="comment-15443" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 12, 2010 8:01 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-vp22spWG43cfeQDu" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15472" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15443">
					Hi again William,<br>
<br>
I've running a previous version of the script for awhile with no 
problems on ESX 4.0 U2 servers and I am familiar with it already. I am 
testing now the latest version and I'm having some issues when running 
it with the -g option (not using -g option works fine). It appears it 
cannot read/find the global file or it just ignores it?. I have double 
checked its available and it's there with content and has permissions 
but keeps complaining at line 279 with No such file or directory . See 
below. Am I doing something wrong?<br>
<br>
Location<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">[root@esx01 vcb-config]# pwd
/vmfs/volumes/nas-nfs-backup/vcb-config
</code></pre><br>
<br>
Content of the directory /vmfs/volumes/nas-nfs-backup/vcb-config<br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@esx01 vcb-config]# ls -l
-rwxrwxrwx 1 96 96   501 May 11 15:39 ghettoVCB.conf
-rwxr-xr-x 1 96 96 31898 May 11 15:37 vcb-esx01.sh
drwxr-xr-x 1 96 96  4096 May 11 15:17 vm-backup-config
-rwxr-xr-x 1 96 96    86 May 11 09:08 vm-list
</code></pre><br>
<br>
Content of the global file ghettoVCB.conf<br>
<pre class="jive-pre"><code class="jive-code jive-plain">VM_BACKUP_VOLUME=/vmfs/volumes/nas-nfs-backup/vcb-backups
DISK_BACKUP_FORMAT=thin
VM_BACKUP_ROTATION_COUNT=1
POWER_VM_DOWN_BEFORE_BACKUP=0
ENABLE_HARD_POWER_OFF=0
ITER_TO_WAIT_SHUTDOWN=3
POWER_DOWN_TIMEOUT=5
ENABLE_COMPRESSION=0
ADAPTER_FORMAT=lsilogic
VM_SNAPSHOT_MEMORY=1
VM_SNAPSHOT_QUIESCE=1
ENABLE_NON_PERSISTENT_NFS=0
UNMOUNT_NFS=0
NFS_SERVER=172.30.0.195
NFS_MOUNT=/nfsshare
NFS_LOCAL_NAME=nfs_storage_backup
NFS_VM_BACKUP_DIR=mybackups
SNAPSHOT_TIMEOUT=15
</code></pre><br>
<br>
Running script. I renamed it to vcb-esx01.sh and did not modify anything
 as I expect to get the config from the global file. <br>
<pre class="jive-pre"><code class="jive-code jive-plain">[root@esx01 vcb-config]# ./vmfs/volumes/nas-nfs-backup/vcb-config/vcb-esx01.sh -f /vmfs/volumes/nas-nfs-backup/vcb-config/vm-list -g /vmfs/volumes/nas-nfs-backup/vcb-config/ghettoVCB.conf -c /nas/vcb-config/vm-backup-config  -l /vmfs/volumes/nas-nfs-backup/vcb_ls-esx01.log -d debug
/nas/vcb-config/vcb-esx01.sh: line 279: .//vmfs/volumes/nas-nfs-backup/vcb-config/ghettoVCB.conf: No such file or directory
Logging output to "/vmfs/volumes/nas-nfs-backup/vcb_ls-esx01.log" ...
mkdir: cannot create directory `/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups': Operation not permitted
</code></pre><br>
<br>
Output for log (debug mode)<br>
<pre class="jive-pre"><code class="jive-code jive-plain">2010-05-12 10:31:27 -- info: ============================== ghettoVCB LOG START ==============================

2010-05-12 10:31:27 -- debug: Succesfully acquired lock directory - /tmp/ghettoVCB.lock

2010-05-12 10:31:27 -- debug: HOST BUILD: VMware ESX 4.0.0 build-208167
2010-05-12 10:31:27 -- debug: HOSTNAME: ls-esx01.lynk.com

2010-05-12 10:31:27 -- info: CONFIG - USING GLOBAL GHETTOVCB CONFIGURATION FILE = /vmfs/volumes/nas-nfs-backup/vcb-config/ghettoVCB.conf
2010-05-12 10:31:27 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS
2010-05-12 10:31:27 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3
2010-05-12 10:31:27 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 2010-05-12_10-31-26
2010-05-12 10:31:27 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick
2010-05-12 10:31:27 -- info: CONFIG - ADAPTER_FORMAT = buslogic
2010-05-12 10:31:27 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0
2010-05-12 10:31:27 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0
2010-05-12 10:31:27 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3
2010-05-12 10:31:27 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5
2010-05-12 10:31:27 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15
2010-05-12 10:31:27 -- info: CONFIG - LOG_LEVEL = debug
2010-05-12 10:31:27 -- info: CONFIG - BACKUP_LOG_OUTPUT = /vcb-backups/vcb_ls-esx01.log
2010-05-12 10:31:27 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0
2010-05-12 10:31:27 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0
2010-05-12 10:31:27 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all

2010-05-12 10:31:28 -- info: Unable to create "/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS/test-xp2"! - Ensure VM_BACKUP_VOLUME was defined correctly
</code></pre>
					
				</div>
				<a name="comments-15449"></a>
				<div id="comment-15449" class="jive-content-comment ">
					<span>
						<span>
							May 12, 2010 10:53 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-94EI2G19Hj42u7Yv" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15443" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-15449">
					Okay, I think I know what's wrong. I'll see if I can get a fix out 
later this evening.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15451"></a>
				<div id="comment-15451" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 12, 2010 7:27 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-AzGV6Pw6k8AmExwR" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-15451">
					Hello,<br>
<br>
I've just updated the script with few enhancement, one which <u>may</u> 
resolve or at least provide a temporarily work around for users that are
 hitting the NFS I/O issue.<br>
<br>
Thanks to user <b>Rodder</b> who submitted the patch for the workaround.
 The script basically will check for the return code after the "rm" 
operation for VMs that are to be rotated, if the return code is not 
successful, we may be running into the NFS I/O issue and the script will
 basically sleep and check periodically to see if it can create a dummy 
file on the NFS volume. If it can, then NFS server is responding back 
and we can then move onto the next VM for backup or deletion. <br>
<br>
I've only tested the basic functionality of the script, but I would 
encourage those that are having this issue give the new version of the 
script a try. The timeout value for the sleeper is 60seconds, else 
you'll get a log message saying it failed the work around. Depending on 
the outcome of testing, this can be something that could be increase if 
the work around works. <br>
<br>
I've also resolved the problem with specifying the full path to the 
global configuration file.<br>
<br>
I look forward to the comments and hopefully this work around will work!<br>
<br>
Thanks everyone<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15490"></a>
				<div id="comment-15490" class="jive-content-comment ">
					<span>
						<span>
							May 13, 2010 8:47 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-VrL8h94KMG4hRagJ" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15443" title="Go to message">XavierE</a>
							</em>
					</span>
					<p id="comment-body-15490">
					XavierE,<br>
<br>
Yes as mentioned on the comment, this issue has been resolved. The 
reason is not the "double /", it's actually the use of "./" within the 
script which causes it to look for the path in its current working 
directory, which it'll never find unless your global config is in the 
same directory. <br>
<br>
Go ahead and download the latest version and let me know if you run into
 any issues.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15476"></a>
				<div id="comment-15476" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 13, 2010 8:59 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-3S19CEi0yexGt9My" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15490" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15476">
					William, <br>
Yes, sorry I got distracted and did not finish reading the whole 
comment, I noticed right after I had posted my response and I removed it
 already but perhaps it was too late. <br>
Yes I see it's fixed after testing again. <br>
I appreciate your response. Thanks.
					</p>
				</div>
				<a name="comments-15480"></a>
				<div id="comment-15480" class="jive-content-comment ">
					<span>
						<span>
							May 16, 2010 7:05 AM
						</span>
							<!--<a href="/people/gvmorley" title="Click to view gvmorley's profile">
<img class="jive-avatar" src="/people/gvmorley/avatar/16.png?a=-1" height="16" width="16" title="Click to view gvmorley's profile" alt="Click to view gvmorley's profile" />
</a>--><a href="http://communities.vmware.com/people/gvmorley" 
id="jive-TL5Dy20wIeyfjfSK" class="jive-username-link" title="Click to 
view gvmorley's profile">gvmorley</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15480">
					Hi William,<br>
<br>
I've got a quick question about performance of internal vs NFS storage 
for the 'source' of a VM Backup.<br>
<br>
So the scenario is that if I have a thin-provisioned VM Guest with:<br>
<br>
100GB Provisioned<br>
3GB Used<br>
<br>
</p><ul class="jive-dash">
<li>When that VM Guest is on internal storage, on a VMFS volume, the 
ghettoVCB script seems to only need to read that actual 'used' data, so 
the backup is very, very fast (say 2.5 minutes).</li>
<li>When that VM Guest is on NFS storage, the ghettoVCB script / ESXi 
Server seems to need to read the full 100GB of data, in order to do the 
back. Therefore, this takes significantly longer (say 17 minutes)</li>
</ul>
<br>
OK, so that's not a huge difference in time, but the problem escalates 
if you have a 500GB or 1TB provisioned VM Guest.<br>
<br>
The destination for the VM Guest backup in both scenarios is a 
standalone NFS array, on a different vNIC, on a different vSwtich, on a 
different network.<br>
<br>
This is all on ESXi 4.0.0 236512, in both cases, the destination format 
of the backup is also 'thin'.<br>
<br>
Watching the network traffic to the Guest's NFS datastore, you can see 
that the reads are what's taking the time.<br>
<br>
Any ideas on why there is the need to do what appears to be 'extra 
reads' when the guest is NFS hosted? Is this a VMFS vs NFS thing?<br>
<br>
Cheers,<br>
<br>
Graham.
					
				</div>
				<a name="comments-15481"></a>
				<div id="comment-15481" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 16, 2010 7:36 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5k3JatzXDXyqt8kJ" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15480" title="Go to message">gvmorley</a>
							</em>
					</span>
					<p id="comment-body-15481">
					Graham,<br>
<br>
Interesting observations, I can't explicitly comment as we don't run VMs
 directly off of an NFS datastore and I've not heard of this issue 
before. I would say that if you want to figure out if this is in fact an
 NFS issue, that you'll need to also test the scenario of using non-thin
 provisioned disks such as using "zeroethick" and if you get the same 
results, then it's the NFS connection. I would also go as far as 
comparing against iSCSI vs local, that way you're comparing against 
block level protocol and it would also be a good network test. There 
have been posting in the general VMTN about performance issues specific 
with ESXi but again I'm not familiar enough with the issues reported to 
really comment. <br>
<br>
It would be interesting to see what you find out and perhaps it might 
make more sense to post this in the general VMTN community to see what 
others have to say about this. Though doing few additional tests should 
allow you to figure out if this is a network/NFS bottleneck in your 
environment or if there's something VMware does when it reads data off 
of NFS vs VMFS. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15503"></a>
				<div id="comment-15503" class="jive-content-comment ">
					<span>
						<span>
							May 19, 2010 12:02 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-8caf8bfKwef8F2H0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
					</span>
					<p id="comment-body-15503">
					Hello everyone,<br>
<br>
We recently hit a snag with our development environment and we need your
 help - <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/help.html">http://engineering.ucsb.edu/~duonglt/vmware/help.html</a>
 <br>
<br>
Any contributions are appreciated!<br>
<br>
Thanks!<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15504"></a>
				<div id="comment-15504" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 19, 2010 6:21 AM
						</span>
							<!--<a href="/people/caster" title="Click to view caster's profile">
<img class="jive-avatar" src="/people/caster/avatar/16.png?a=-1" height="16" width="16" title="Click to view caster's profile" alt="Click to view caster's profile" />
</a>--><a href="http://communities.vmware.com/people/caster" 
id="jive-sJCXP231GVd3HPjV" class="jive-username-link" title="Click to 
view caster's profile">caster</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15503" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15504">
					Im getting a panic error and have read the FAQ and cannot find 
anything relating to my issue.  below is the output from sh -x<br>
<br>
+ /sbin/vmkfstools -i /vmfs/volumes/datastore1/Redhat Linux x64/Redhat 
Linux x64.vmdk -a lsilogic -d zeroedthick /vmfs/volumes/nfshare1//Redhat
 Linux x64/Redhat Linux x64-2010-05-19_13-12-13/Redhat Linux x64.vmdk<br>
+ tee -a -i /dev/null<br>
PANIC bora/lib/unicode/unicodeCommon.c:384<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Redhat Linux x64/Redhat Linux 
x64.vmdk'...
					</p>
				</div>
				<a name="comments-15524"></a>
				<div id="comment-15524" class="jive-content-comment ">
					<span>
						<span>
							May 19, 2010 6:45 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-s9T7Ww847TfRWwzN" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15504" title="Go to message">caster</a>
							</em>
					</span>
					<p id="comment-body-15524">
					Hello,<br>
<br>
I believe I might have seen your post in the general VMTN forum? 
Regarding your panic, the only time I've seen this issue which is pretty
 rare is when the <b>hostd</b> agent is not happy and something caused 
it to go haywire when you try to perform CLI operations. From what I 
remember on your original post, the panic occurs when you either A) 
snapshot the VM b) start backing up the VM using <b>vmkfstools</b><br>
<br>
Are you able to perform either of these operations manually through the 
CLI? This is mostly likely an environmental issue, depending on if 
you're running ESX or ESXi, I would try to restart the management agent 
on the host.<br>
<br>
ESX:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">service mgmt-vmware restart
</code></pre><br>
<br>
ESXi:<br>
Login into the DCUI and restart the management system<br>
<br>
If you continue to get the panics, you may actually need to reboot your 
host. <br>
<br>
As you can see my last public comment, our development environment is 
currently offline.<br>
<p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15525"></a>
				<div id="comment-15525" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 19, 2010 8:33 AM
						</span>
							<!--<a href="/people/SteeWell" title="Click to view SteeWell's profile">
<img class="jive-avatar" src="/people/SteeWell/avatar/16.png?a=-1" height="16" width="16" title="Click to view SteeWell's profile" alt="Click to view SteeWell's profile" />
</a>--><a href="http://communities.vmware.com/people/SteeWell" 
id="jive-2g4Wf5gXb669KO8e" class="jive-username-link" title="Click to 
view SteeWell's profile">SteeWell</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15525">
					Hello,<br>
<br>
First of all thanks for this great script!<br>
<br>
I experienced some weird issue with vpshere + ghettovcb (probably). I 
had a faulty snapshot on machine1, which couldn't be deleted by the 
snapshot manager. I created a new snapshot and deleted it. The faulty 
snapshot was also removed so everything was fine. <br>
<br>
The weird thing was that for the next machine (machine2) in line a 
snapshot was created. I never told Vsphere to create a new snapshot for 
machine2 nor is the ghettoVCB script scheduled to run at this time. 
After 1 hour the snapshot was removed and when i looked at my vmbackup 
location, i saw that an extra backup was created (as third while i set 
the script to only allow 2 backups). The weirdest thing of all was that 
the datestamp told me it was created on april the 29th (this all happend
 today 19th of May), the size of the vmdk was a bigger then the backup 
from the 18th of May(so this backup was more recent then the last one) .
 I really can't wrap my head around what is happening here, so help 
would be appreciated!<br>
<br>
ps.This is not a mayor issue! This backup ran wel and the vm was fine 
afterwards. Only problem i can imaging is that my backup volume is 
filling up, since it doesn't delete the third backup of this 
machine(I've seen this happen before).<br>
<br>
Thanks in advance.
					</p>
				</div>
				<a name="comments-15526"></a>
				<div id="comment-15526" class="jive-content-comment ">
					<span>
						<span>
							May 19, 2010 9:24 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-cfNhAzr3Ic2LI6Pb" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15525" title="Go to message">SteeWell</a>
							</em>
					</span>
					<p id="comment-body-15526">
					If you're able to see the snapshot using the snapshot manager and 
it has "ghettoVCB" as the name of the snapshot, then you can tell it was
 created by the script. If not, then it may have been some other 
process/script/individual. I would recommend checking all VMs and seeing
 which ones have snapshots/etc. and clean them out if need be and then 
retry the backup process cleanly and see if you still run into any 
issues. <br>
<br>
Please take a look at FAQ #0 and #1 if you do run into issues but due to
 snag in our own development environment, I probably won't be able to 
validate or test anything for awhile. Until wet our infrastructure up 
and running which may take awhile, I'll be relying on replies + your 
logs. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15527"></a>
				<div id="comment-15527" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 19, 2010 11:20 AM
						</span>
							<!--<a href="/people/caster" title="Click to view caster's profile">
<img class="jive-avatar" src="/people/caster/avatar/16.png?a=-1" height="16" width="16" title="Click to view caster's profile" alt="Click to view caster's profile" />
</a>--><a href="http://communities.vmware.com/people/caster" 
id="jive-FEw5Xdo5Y387zLMo" class="jive-username-link" title="Click to 
view caster's profile">caster</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15524" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15527">
					the below command when I put it in via ssh doesnt run and just 
returns the program options?  Should I reboot esxi and try again?<br>
<br>
sbin/vmkfstools -i /vmfs/volumes/datastore1/Redhat Linux x64/Redhat 
Linux x64.vmdk -a lsilogic -d zeroedthick /vmfs/volumes/nfshare1//Redhat
 Linux x64/Redhat Linux x64-2010-05-19_13-12-13/Redhat Linux x64.vmdk
					</p>
				</div>
				<a name="comments-15528"></a>
				<div id="comment-15528" class="jive-content-comment ">
					<span>
						<span>
							May 19, 2010 12:45 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9iG7bAU2iCOm8G5h" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15527" title="Go to message">caster</a>
							</em>
					</span>
					<p id="comment-body-15528">
					Try the following, when you have spaces you'll need to add double 
quotes:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vmkfstools -i "/vmfs/volumes/datastore1/Redhat Linux x64/Redhat Linux x64.vmdk" -a lsilogic -d zeroedthick "/vmfs/volumes/nfshare1//Redhat Linux x64/Redhat Linux x64-2010-05-19_13-12-13/Redhat Linux x64.vmdk"
</code></pre><br>
<br>
I would also double check to make sure the destination directory 
structure exists. <br>
<br>
If this fails and does not provide any output, you may need to your ESXi
 host and try again as mentioned your hostd agent could be hung. <br>
<p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15529"></a>
				<div id="comment-15529" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 19, 2010 12:58 PM
						</span>
							<!--<a href="/people/caster" title="Click to view caster's profile">
<img class="jive-avatar" src="/people/caster/avatar/16.png?a=-1" height="16" width="16" title="Click to view caster's profile" alt="Click to view caster's profile" />
</a>--><a href="http://communities.vmware.com/people/caster" 
id="jive-WUuqtvzHd531lq79" class="jive-username-link" title="Click to 
view caster's profile">caster</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15528" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15529">
					below is what I entered and it said it couldnt lock the file<br>
<br>
/vmfs/volumes/a7cd8d3e-a3f6c873 # /sbin/vmkfstools -i 
"/vmfs/volumes/datastore1/Redhat Linux x64/Redhat Linux x64.vmdk" -a 
lsilogic -d zeroedthick "/vmfs/volumes/nfshare1/Redhat Linux x64.vmdk"<br>
Destination disk format: VMFS zeroedthick<br>
Failed to open '/vmfs/volumes/datastore1/Redhat Linux x64/Redhat Linux 
x64.vmdk': Failed to lock the file (16392).
					</p>
				</div>
				<a name="comments-15530"></a>
				<div id="comment-15530" class="jive-content-comment ">
					<span>
						<span>
							May 19, 2010 1:16 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-LdbflGY93gN45232" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15529" title="Go to message">caster</a>
							</em>
					</span>
					<p id="comment-body-15530">
					That's correct, if the VM is running and there is not a snapshot, 
the VMDK will be locked. At least this time you got some output from the
 command. Manually take a snapshot using the CLI and then re-run the 
command and see if you run into any issues.<br>
<br>
To manually take a snapshot you'll need to do the following:<br>
<br>
1) Get the vmid for your vm<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/getallvms | grep "name of your vm"
</code></pre><br>
<br>
2) This should return you with a line of output if the above operation 
executed properly, then you'll use that to create a snapshot based on 
the vmid<br>
<br>
<pre class="jive-pre"><code class="jive-code jive-plain">vim-cmd vmsvc/createsnapshot &lt;vmid&gt; "name of snapshot" "desc of snapshot" 0 0
</code></pre><br>
<br>
3) The above should take a snapshot with the name you specified and 
description and it will not include the memory nor quiesce for 
simplicity sake<br>
<br>
4) Perform the clone disk operation and see if you get the error, if you
 do, then you most likely need to reboot your host as there is something
 wrong with your hostd agent and try the script again<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15531"></a>
				<div id="comment-15531" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 19, 2010 4:22 PM
						</span>
							<!--<a href="/people/caster" title="Click to view caster's profile">
<img class="jive-avatar" src="/people/caster/avatar/16.png?a=-1" height="16" width="16" title="Click to view caster's profile" alt="Click to view caster's profile" />
</a>--><a href="http://communities.vmware.com/people/caster" 
id="jive-W8RJs5byb2KU81ve" class="jive-username-link" title="Click to 
view caster's profile">caster</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15530" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15531">
					looks like its failing due to directory syntax?<br>
<br>
~ # vim-cmd vmsvc/snapshot.create 16  "redhat linux" "redhat" 0 0<br>
Create Snapshot:<br>
<br>
~ # /sbin/vmkfstools -i "/vmfs/volumes/datastore1/Redhat Linux 
x64/Redhat Linux x64.vmdk" -a lsilogic -d zeroedthick 
"/vmfs/volumes/nfshare1//Redhat Linux x64/Redhat Linux 
x64-2010-05-19_01-35-34/Redhat Linux x64.vmdk"<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Redhat Linux x64/Redhat Linux 
x64.vmdk'...<br>
Failed to clone disk : The system cannot find the file specified (25).<br>
<br>
~ # /sbin/vmkfstools -i "/vmfs/volumes/datastore1/Redhat Linux 
x64/Redhat Linux x64.vmdk" -a lsilogic -d zeroedthick 
"/vmfs/volumes/nfshare1//Redhat Linux x64.vmdk"<br>
Destination disk format: VMFS zeroedthick<br>
Cloning disk '/vmfs/volumes/datastore1/Redhat Linux x64/Redhat Linux 
x64.vmdk'...<br>
Clone: 74% done.
					</p>
				</div>
				<a name="comments-15486"></a>
				<div id="comment-15486" class="jive-content-comment ">
					<span>
						<span>
							May 19, 2010 6:39 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-UAU1C91z9d7sm3uS" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15531" title="Go to message">caster</a>
							</em>
					</span>
					<p id="comment-body-15486">
					Well if the directory structure does not exists, then you probably 
will get an error. I would recommend starting fresh and trying to re-run
 the script and clean up any directories or files that may or may not 
have been created.<br>
<br>
I would also recommend taking a look at FAQ #0 and #1 when you post the 
results of the rerun. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15580"></a>
				<div id="comment-15580" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 24, 2010 2:49 AM
						</span>
							<!--<a href="/people/kpc" title="Click to view kpc's profile">
<img class="jive-avatar" src="/people/kpc/avatar/16.png?a=-1" height="16" width="16" title="Click to view kpc's profile" alt="Click to view kpc's profile" />
</a>--><a href="http://communities.vmware.com/people/kpc" 
id="jive-1zNqAlQRqy1biQ73" class="jive-username-link" title="Click to 
view kpc's profile">kpc</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15486" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15580">
					Hi guys<br>
<br>
Just updated to the latest version and have moved to using it to back my
 existing ESX 3.5 servers in addition to my ESXi server.  On one of the 
ESX 3.5 hosts I keep getting the following error:<br>
<br>
2010â€‘05â€‘22 21:31:11 â€‘â€‘ info: WARNING: A physical RDM "fcrprogress01.vmdk<br>
/vmfs/volumes/4639b64dâ€‘3c5c34dcâ€‘18b1â€‘0019b9b1037b/progress/fcrprogress01.vmdk"
 was found for fcrprogress01, which will not be backed up<br>
<br>
I've kind of inherited these VM's and from what I can see there is no 
RDM mappings, it's just a normal 30GB VM residing on a local disk.<br>
<br>
The strange thing is 
/vmfs/volumes/4639b64dâ€‘3c5c34dcâ€‘18b1â€‘0019b9b1037b/progress/fcrprogress01.vmdk"
 doesn't even exist, the actual file location is 
/vmfs/volumes/4639b64dâ€‘3c5c34dcâ€‘18b1â€‘0019b9b1037b/fcrprogress01.vmdk" 
(no /progress)<br>
<br>
Does anyone know where it's getting this incorrect path from? And what I
 can do to try to fix it?<br>
<br>
Many thanks
					</p>
				</div>
				<a name="comments-15567"></a>
				<div id="comment-15567" class="jive-content-comment ">
					<span>
						<span>
							May 25, 2010 3:01 AM
						</span>
							<!--<a href="/people/AlainSpineux" title="Click to view AlainSpineux's profile">
<img class="jive-avatar" src="/people/AlainSpineux/avatar/16.png?a=-1" height="16" width="16" title="Click to view AlainSpineux's profile" alt="Click to view AlainSpineux's profile" />
</a>--><a href="http://communities.vmware.com/people/AlainSpineux" 
id="jive-B0Nau0bslwdtP9ln" class="jive-username-link" title="Click to 
view AlainSpineux's profile">AlainSpineux</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15580" title="Go to message">kpc</a>
							</em>
					</span>
					<p id="comment-body-15567">
					Hi kpc <br>
<br>
The problem is your VM has a "ghost" disk called fcrprogress01.vmdk<br>
GhettoVCB badly report it as a RDM but this is because it cannot find it
 and cannot check it .<br>
<br>
Check in your vmx file for this fcrprogress01.vmdk !<br>
<br>
LAMW  : your are checking for RDM using <br>
grep "vmfsPassthroughRawDeviceMap" "${SOURCE_VMDK}" <br>
</p><ul class="jive-dash">
<li>you should check if the file exist first to avoid to report a bad 
error</li>
<li>my RDM .vmdk  contains :</li>
</ul>
createType="vmfsRawDeviceMap"<br>
I have created them using : vmkfstools -r 
/vmfs/devices/disks/vmhba32\:0\:0\:0 sata500-1.vmdk<br>
on ESXi4,  maybe you should  check for "RawDeviceMap" instead of  
"vmfsPassthroughRawDeviceMap"<br>
<br>
Regards
					
				</div>
				<a name="comments-15583"></a>
				<div id="comment-15583" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 25, 2010 5:48 AM
						</span>
							<!--<a href="/people/kpc" title="Click to view kpc's profile">
<img class="jive-avatar" src="/people/kpc/avatar/16.png?a=-1" height="16" width="16" title="Click to view kpc's profile" alt="Click to view kpc's profile" />
</a>--><a href="http://communities.vmware.com/people/kpc" 
id="jive-Fu30oTBy6qi0Jn6t" class="jive-username-link" title="Click to 
view kpc's profile">kpc</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15567" title="Go to message">AlainSpineux</a>
							</em>
					</span>
					<p id="comment-body-15583">
					Hi Alain<br>
<br>
After looking at the vmx file I had an old line in there that I hashed 
out a while back, even though it was hashed out seems like it was 
causing me to get this error, after I deleted the line the backup worked
 fine.  Thanks for your help Alain.<br>
<br>
Cheers
					</p>
				</div>
				<a name="comments-15568"></a>
				<div id="comment-15568" class="jive-content-comment ">
					<span>
						<span>
							May 25, 2010 5:37 PM
						</span>
							<!--<a href="/people/agustaf4" title="Click to view agustaf4's profile">
<img class="jive-avatar" src="/people/agustaf4/avatar/16.png?a=-1" height="16" width="16" title="Click to view agustaf4's profile" alt="Click to view agustaf4's profile" />
</a>--><a href="http://communities.vmware.com/people/agustaf4" 
id="jive-PKsfCXb6fye270cF" class="jive-username-link" title="Click to 
view agustaf4's profile">agustaf4</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15568">
					My vmdk disks where created with the default esxi 4 freebie vsphere
 client settings, as thick. But I do not see in your vmdk types thick 
only. Also I enabled the option to power down the vm before backup which
 works fine, but when the backup is complete the vm is not powered back 
on. thanks
					</p>
				</div>
				<a name="comments-15569"></a>
				<div id="comment-15569" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 26, 2010 12:52 AM
						</span>
							<!--<a href="/people/kpc" title="Click to view kpc's profile">
<img class="jive-avatar" src="/people/kpc/avatar/16.png?a=-1" height="16" width="16" title="Click to view kpc's profile" alt="Click to view kpc's profile" />
</a>--><a href="http://communities.vmware.com/people/kpc" 
id="jive-F9y5c6Bswo39nvrz" class="jive-username-link" title="Click to 
view kpc's profile">kpc</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15568" title="Go to message">agustaf4</a>
							</em>
					</span>
					<p id="comment-body-15569">
					Hi Agustaf, doesn't really matter what you created your VM's with, 
the setting DISK_BACKUP_FORMAT=thin refers to the output of the backup 
file....
					</p>
				</div>
				<a name="comments-15553"></a>
				<div id="comment-15553" class="jive-content-comment ">
					<span>
						<span>
							May 26, 2010 8:30 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-trOPs5kA83d1kbQb" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15568" title="Go to message">agustaf4</a>
							</em>
					</span>
					<p id="comment-body-15553">
					The VMDK format mapping is as follows:<br>
<br>
thick = zeroedthick<br>
eagerzeroedthick<br>
thin<br>
2gb sparse<br>
<br>
By default, when you create a "thick" VMDK, it'll be allocated as 
zeroedthick unless you select the option for clustering or FT, in which 
case the disk will be allocated as eagerzeroedthick. As mentioned from 
kpc, when selecting the <b>DISK_BACKUP_FORMAT</b>, it's what format you 
want to store your backup which can be different from what the current 
format is, this is useful if you need to reduce the amount of space 
required for your backups, especially if you're current source are 
allocated as eagerzeroedthick<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15574"></a>
				<div id="comment-15574" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 26, 2010 10:20 AM
						</span>
							<!--<a href="/people/agustaf4" title="Click to view agustaf4's profile">
<img class="jive-avatar" src="/people/agustaf4/avatar/16.png?a=-1" height="16" width="16" title="Click to view agustaf4's profile" alt="Click to view agustaf4's profile" />
</a>--><a href="http://communities.vmware.com/people/agustaf4" 
id="jive-lGVeqLY24F9kycSe" class="jive-username-link" title="Click to 
view agustaf4's profile">agustaf4</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15574">
					Maybe somebody here can answer this, within the console when 
running the ls -al command to show me everything I see the standard vmdk
 file (for example mines is called v1.vmdk), but there is also another 
one in there called v1-flat.vmdk which is actually showing the real size
 of the vmdk file. Basically every vmdk file in there aside from its 
usual name of *.vmdk has a *-flat.vmdk to it. The -flat entry. Im 
guessing that the standard vmdk is a pointer to the real one which has 
the -flat on it ??. eitherway when running vmkfstools against the one 
with the -flat on it, you get an error saying that it is an invdalid 
vmdk file, only goes through when run against the one with the .vmdk on 
it. Basically just would like to know what is the one with the -flat on 
it. <br>
<br>
Other question is, this file that is backed up by the scrip the vmdk 
one, can I mount on it on workstation 7, in case there is an emergency 
and i need to pull some files out of it. thanks
					</p>
				</div>
				<a name="comments-15559"></a>
				<div id="comment-15559" class="jive-content-comment ">
					<span>
						<span>
							May 26, 2010 10:58 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GGaAW4PboWg0L30N" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15574" title="Go to message">agustaf4</a>
							</em>
					</span>
					<p id="comment-body-15559">
					FAQ #24 answers your question and <b>vmkfstools</b> accepts the 
descriptor file and not the actual *-flat.vmdk as input. <br>
<br>
Please note, this script assumes some familiarity with ESX and/or ESXi 
and the commandline utilities such as <b>vmkfstools</b> and is not for 
beginners. Though much of the complexity of the script is hidden from 
the end user, it is good to understand what is actually going on when a 
backup is taking place and what must be done for certain scenarios. <br>
<br>
I've not tried to mount using WS7, I believe with the latest version of 
WS7, vmdks created from WS7 <u>might</u> be able to just mount assuming 
it's using one of the supported formats that ESX/ESXi supports but I'm 
not sure if the other way around works as well. It's worth a try and you
 can post back with your findings<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15560"></a>
				<div id="comment-15560" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 27, 2010 4:07 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-48xakK6B1T9ygoE3" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15560">
					Some weeks ago the user "above2m" asked a question regarding adding
 the date to the logfile. His question wasnÂ´t answered until today, 
maybe someone could answer to his question because itÂ´s very interesting
 for me too.<br>
<br>
The questions --&gt; <a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-15465">http://communities.vmware.com/docs/DOC-8760#comments-15465</a>
					</p>
				</div>
				<a name="comments-15627"></a>
				<div id="comment-15627" class="jive-content-comment ">
					<span>
						<span>
							May 28, 2010 6:00 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-5m180ulco0F6p7YN" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15627">
					I found a new problem for me. I have 11 VMs on 2 different servers.
 On each server I use <b>VM_BACKUP_ROTATION_COUNT=2</b>. It works great 
with the exception of 1 VM. There the script does not delete the oldest 
backup. I donÂ´t know why but I found an error message in the log:<br>
<br>
<b>Slept 1 seconds to work around NFS I/O error</b><br>
<br>
The VM does not have any special characters in the name, only capital 
letters.<br>
<br>
I know that the server can reach the NFS, otherwise all backups would 
fail - but the donÂ´t. The NFS is not mounted via the script, itÂ´s 
mounted with vSpehere Client. I use the same NFS configuration like you 
have 
(fsid=0,crossmnt,rw,no_root_squash,async,no_subtree_check,anonuid=99,anongid=99).<br>
<br>
What could cause the problem? Is it a timeout, because the deletion 
lasts too long? ItÂ´s my biggest VM with about 210GB on data.
					</p>
				</div>
				<a name="comments-15656"></a>
				<div id="comment-15656" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 31, 2010 7:19 AM
						</span>
							<!--<a href="/people/MSCChile" title="Click to view MSCChile's profile">
<img class="jive-avatar" src="/people/MSCChile/avatar/16.png?a=-1" height="16" width="16" title="Click to view MSCChile's profile" alt="Click to view MSCChile's profile" />
</a>--><a href="http://communities.vmware.com/people/MSCChile" 
id="jive-noN5A9TlTmhzi5cR" class="jive-username-link" title="Click to 
view MSCChile's profile">MSCChile</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15627" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15656">
					I have vCenter and 4 ESXi all in HA and DRS, so I do not know an 
what Server the VMs are running on.<br>
Is there a solution for this?<br>
</p><p>
Also, is there a way that if the ESXi Server is rebooted the files stay 
on the server? (the scripts)<br>
<br>
George.<br>
<br>
<a href="http://georgedlake.blogspot.com/">From the Captain's Chair</a>
					</p>
				</div>
				<a name="comments-15657"></a>
				<div id="comment-15657" class="jive-content-comment ">
					<span>
						<span>
							May 31, 2010 9:16 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Lwr06fVfO37y0yo0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15627" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15657">
					Yes, if you run into the message you've mentioned above, you're 
hitting the "NFS timeout" issue and generally involves larger VMs that 
are 100+GB. This was suggested by a user by waiting to see if the NFS 
server would allow for a new update else sleep. I forget what the 
default amount of sleeps are before it eventually gives up, but I would 
need to see more of the log to be able to tell you that? What might be 
worth while to test is to increase it to see if it helps your situation 
and again this did work for the other user who presented the solution 
but I'm not sure how many people have tested the latest version. <br>
<br>
If you do want to further investigate, please take a FAQ #1 as it asks 
to post any entries into pastebin along with debug flag on so I can have
 more information about what's going on. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15658"></a>
				<div id="comment-15658" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							May 31, 2010 9:25 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-j23MrDbWX38GxwQF" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15656" title="Go to message">MSCChile</a>
							</em>
					</span>
					<p id="comment-body-15658">
					The main use case for ghettoVCB are standalone un-managed ESX and 
ESXi hosts from a vCenter perspective.<br>
<br>
One method to get this working within a DRS enabled cluster which I've 
suggested in the past and I believe some of the users out there in the 
community may have this implemented. What I generally recommend is to 
keep one copy of the backup script and the list of VMs to backup on 
shared storage, whether that be on NFS, iSCSI SAN or FC SAN. <br>
<br>
Now depending on how you setup your backup, you can A) have the script 
backup ALL vms B) specify specific VMs, in either case what you want to 
do is have the backup script kicked off via cron or from automated 
system and upon a backup, update a text file that says you've backed up 
that VM for that day or backup period. Of course this is not implemented
 in the script and the exact process will be an exercise left for the 
user, though this will allow you to not duplicate any backups and ensure
 that all expected VMs that should have been backed up will be backed 
up, even in a DRS cluster where VMs can float between hosts.<br>
<br>
Good Luck<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware ESX/ESXi scripts and resources at: <a class="jive-link-external" 
href="http://engineering.ucsb.edu/%7Eduonglt/vmware/">http://engineering.ucsb.edu/~duonglt/vmware/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15671"></a>
				<div id="comment-15671" class="jive-content-comment ">
					<span>
						<span>
							Jun 1, 2010 2:57 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-BwsBqTlWutfN4d70" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15671">
					Hi William,<br>
<br>
I have made the last backup with the debug option. Here you can find the
 log-output: <a class="jive-link-external" 
href="http://pastebin.com/8QM1CGfF">http://pastebin.com/8QM1CGfF</a><br>
<br>
I tried to delete the oldest backup fom the commandline of the ESXi 
server (so he tried to delete in the NFS) and it faild like the script. 
The error I got there was similar "Input/Output error". The days before I
 found a thread were somebody had the same problem and they solved it 
using XFS insted of ext3 for their NFS storage (today I donÂ´t find the 
thread - I forgot to bookmark).<br>
<br>
</p><p>
One more thing: Do you have an answer to the question above2m asked? (<a
 class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-8760#comments-15465">http://communities.vmware.com/docs/DOC-8760#comments-15465</a>).

					</p>
				</div>
				<a name="comments-15672"></a>
				<div id="comment-15672" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 1, 2010 7:41 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0lIi4Q1A9H9fCNHP" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15671" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15672">
					So looking at your logs, it seems that your backup was successful? 
was it not? You're right you did hit the NFS timeout issue as mentioned 
in the last reply, but there is a section of code that hopes to provide a
 quick fix by just sleeping until a specified internal which I believe 
is up to 5min to see if it can get access back from the NFS server. If 
it does, then it'll move forward through the code else you'll get an 
error that it tried to apply the "NFS I/O" hack but failed. In your 
case, it did not have the failed logs ... so as far as I can tell, it 
was successful? Can you confirm and let me know what you have in both 
your source and destination folders of the backup?<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15644"></a>
				<div id="comment-15644" class="jive-content-comment ">
					<span>
						<span>
							Jun 1, 2010 11:24 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-Q9tG12SMAJ5KAsO7" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15672" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15644">
					Hi William,<br>
<br>
maybe it was a misunderstanding, I did not mean that the backup failed. I
 wanted to mention that the deletion, following the rotation count, 
fails with my biggest VM (TITAN - you see in log)<br>
<br>
Today I formated the NFS store with XFS, maybe with this filesystem the 
problem is gone.
					</p>
				</div>
				<a name="comments-15645"></a>
				<div id="comment-15645" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 1, 2010 11:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-4CzVHjbaCC27aT8m" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15644" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15645">
					That's correct, generally the NFS issue is hit on large deletions 
as mentioned earlier. If the backup was successful and no orphaned 
snapshots were left behind, then the fix that was implemented in the 
most recent release of the script worked! <br>
<br>
Moving off of ext3 which is what I'm assuming your NFS volume was 
configured originally to XFS is the other fix which is described in the 
documentation above. <br>
<br>
Glad to hear you got it working<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10878">Getting Started with
 the vMA (tips/tricks)</a><br>
<a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10837">Getting Started with
 the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15646"></a>
				<div id="comment-15646" class="jive-content-comment ">
					<span>
						<span>
							Jun 1, 2010 2:37 PM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-b2BeUB5cJ2Dz70zL" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15645" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15646">
					I noticed now that I have a really bad performance with XFS. The 
backup of my first sever lasts 3 times longer than with ext3. Do you 
have some recommendations for parameters to tune up the XFS performance?<br>
<br>
The other option would be to go back to ext3 and try the <b>data=writeback
 mode</b>, is it correct?<br>
<br>
What about an other filesystems like ext4? Do they have the same 
problem?
					</p>
				</div>
				<a name="comments-15661"></a>
				<div id="comment-15661" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 1, 2010 2:51 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-i255rHMHM70955hL" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15646" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-15661">
					In terms of performnce tuning, I would recommend doing some 
research on the web, those will probably be your best resources. For 
those that reported back from switching from EXT3 to XFS, did not 
mention any performance issues, again this is not an issue we hit so 
it's hard for us to really say. <br>
<br>
That's correct, you can try to change it to "writeback mode" and see if 
you're able to get around the NFS timeout issue. <br>
<br>
Also other things that may affect your testing is the # of spindles 
behind your NFS volume, you may also want to research that with the 
various filesystems you'll be performing the test on and ensure you're 
using the most optimal configuration. <br>
<br>
I'll be interesting to see what comes out of your testing and perhaps 
there is a better solution.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15706"></a>
				<div id="comment-15706" class="jive-content-comment ">
					<span>
						<span>
							Jun 10, 2010 3:48 AM
						</span>
							<!--<a href="/people/Whtiy" title="Click to view Whtiy's profile">
<img class="jive-avatar" src="/people/Whtiy/avatar/16.png?a=-1" height="16" width="16" title="Click to view Whtiy's profile" alt="Click to view Whtiy's profile" />
</a>--><a href="http://communities.vmware.com/people/Whtiy" 
id="jive-rzo3Fs1A45EG8Cdk" class="jive-username-link" title="Click to 
view Whtiy's profile">Whtiy</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15706">
					While setting up the script to backup our server i found two 
whings:<br>
<br>
1. Round brackets<br>
VMs with brackets in the name (like "machine xy (Test)") do not work. 
The brackets have to be escaped for the grep command.<br>
<br>
2. Exclusion List<br>
The VM name should only match an entry in the exclusion list if it is 
exactly the same. For example, i wanted to exclude an excluded machine 
for one run and added a "#" in front of the name in the exclusion list. 
But the name still matched because the grep command in the script also 
matches, if the machine name is a part of an line in the exclude file. 
So i changed the grep command a bit (line 475) from:<br>
<br>
grep -E "${VM_NAME_ESC}" "${VM_EXCLUSION_FILE}" &gt; /dev/null 
2&gt;&amp;1<br>
<br>
to:<br>
<br>
grep -E "^${VM_NAME_ESC}\$" "${VM_EXCLUSION_FILE}" &gt; /dev/null 
2&gt;&amp;1<br>
<br>
Urs
					</p>
				</div>
				<a name="comments-15767"></a>
				<div id="comment-15767" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 17, 2010 5:26 AM
						</span>
							<!--<a href="/people/diplan" title="Click to view diplan's profile">
<img class="jive-avatar" src="/people/diplan/avatar/16.png?a=-1" height="16" width="16" title="Click to view diplan's profile" alt="Click to view diplan's profile" />
</a>--><a href="http://communities.vmware.com/people/diplan" 
id="jive-OL1tCU9fWUTy6uY2" class="jive-username-link" title="Click to 
view diplan's profile">diplan</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15767">
					Hello,<br>
<br>
We have a problem with my backup and we canÂ´t find the problem.<br>
We use the ESXi 4.0.0 VMWare Server and ghettoVCB (last modified 
05/12/2010)<br>
<br>
We try to backup a VM with two disks. The first disk is located under 
"/vmfs/volumes/RAID-SAS/VM_1" (35GB). The backup works on this disk. <br>
The second Disk is located under "/vmfs/volumes/RAID-SATA/VM_1"(800GB). 
Means the disks are in diffrent datastores. If i try to backup this disk
 the backup fail. <br>
Below please find the logfile of the failed backup.<br>
<br>
I already try to set the "SNAPSHOT_TIMEOUT" to "115", didnÂ´t solve the 
problem.<br>
<br>
Any ideas whats going wrong? Or need more information about 
configuration and environment?<br>
<br>
Here is the log from the faild backup:<br>
<br>
/ghettoVCB # ./ghettoVCB.sh -f ./vms_to_backup -g ./ghettoVCB.conf -d 
debug<br>
2010-06-17 09:13:03 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-06-17 09:13:03 -- debug: Succesfully acquired lock directory - 
/tmp/ghettoVCB.lock<br>
<br>
2010-06-17 09:13:03 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-244038<br>
2010-06-17 09:13:03 -- debug: HOSTNAME: esx1<br>
<br>
2010-06-17 09:13:03 -- info: CONFIG - USING GLOBAL GHETTOVCB 
CONFIGURATION FILE = ./ghettoVCB.conf<br>
2010-06-17 09:13:03 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/RAID-SATA/backup/<br>
2010-06-17 09:13:03 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-06-17 09:13:03 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-06-17_09-13-03<br>
2010-06-17 09:13:03 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2010-06-17 09:13:03 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-06-17 09:13:03 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-06-17 09:13:03 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-06-17 09:13:03 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-06-17 09:13:03 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-06-17 09:13:03 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-06-17 09:13:03 -- info: CONFIG - LOG_LEVEL = debug<br>
2010-06-17 09:13:03 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-06-17 09:13:03 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-06-17 09:13:03 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-06-17 09:13:03 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-06-17 09:13:06 -- info: Initiate backup for VM_1<br>
2010-06-17 09:13:06 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-06-17" for VM_1<br>
2010-06-17 09:13:07 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-06-17" to be created<br>
2010-06-17 09:13:07 -- debug: Snapshot timeout set to: 900 seconds<br>
2010-06-17 09:13:08 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 0 - sleeping for 60secs (Duration: 0 seconds)<br>
2010-06-17 09:14:09 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 1 - sleeping for 60secs (Duration: 30 seconds)<br>
2010-06-17 09:15:10 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 2 - sleeping for 60secs (Duration: 60 seconds)<br>
2010-06-17 09:16:11 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 3 - sleeping for 60secs (Duration: 90 seconds)<br>
2010-06-17 09:17:12 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 4 - sleeping for 60secs (Duration: 120 seconds)<br>
2010-06-17 09:18:13 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 5 - sleeping for 60secs (Duration: 150 seconds)<br>
2010-06-17 09:19:13 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 6 - sleeping for 60secs (Duration: 180 seconds)<br>
2010-06-17 09:20:14 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 7 - sleeping for 60secs (Duration: 210 seconds)<br>
2010-06-17 09:21:15 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 8 - sleeping for 60secs (Duration: 240 seconds)<br>
2010-06-17 09:22:16 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 9 - sleeping for 60secs (Duration: 270 seconds)<br>
2010-06-17 09:23:17 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 10 - sleeping for 60secs (Duration: 300 seconds)<br>
2010-06-17 09:24:18 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 11 - sleeping for 60secs (Duration: 330 seconds)<br>
2010-06-17 09:25:19 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 12 - sleeping for 60secs (Duration: 360 seconds)<br>
2010-06-17 09:26:20 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 13 - sleeping for 60secs (Duration: 390 seconds)<br>
2010-06-17 09:27:21 -- debug: Waiting for snapshot creation to be 
completed - Iteration: 14 - sleeping for 60secs (Duration: 420 seconds)<br>
2010-06-17 09:28:22 -- info: Snapshot timed out, failed to create 
snapshot: "ghettoVCB-snapshot-2010-06-17" for VM_1<br>
2010-06-17 09:28:22 -- debug: Removing 
/vmfs/volumes/4bf393c5-edde2dfb-7cb5-001517d7e5d5/backup/VM_1/VM_1-2010-06-16_11-08-26<br>
2010-06-17 09:28:22 -- info: Backup Duration: 15.27 Minutes<br>
2010-06-17 09:28:22 -- info: Error: Unable to backup VM_1 due to 
snapshot creation!<br>
<br>
2010-06-17 09:28:22 -- info: ###### Final status: ERROR: All VMs failed!
 ######<br>
<br>
2010-06-17 09:28:22 -- debug: Succesfully removed lock directory - 
/tmp/ghettoVCB.lock<br>
<br>
2010-06-17 09:28:22 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
				<a name="comments-15821"></a>
				<div id="comment-15821" class="jive-content-comment ">
					<span>
						<span>
							Jun 19, 2010 12:54 AM
						</span>
							<!--<a href="/people/jcbosacoma" title="Click to view jcbosacoma's profile">
<img class="jive-avatar" src="/people/jcbosacoma/avatar/16.png?a=-1" height="16" width="16" title="Click to view jcbosacoma's profile" alt="Click to view jcbosacoma's profile" />
</a>--><a href="http://communities.vmware.com/people/jcbosacoma" 
id="jive-227eLRl18YTidIEW" class="jive-username-link" title="Click to 
view jcbosacoma's profile">jcbosacoma</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15767" title="Go to message">diplan</a>
							</em>
					</span>
					<p id="comment-body-15821">
					Hello,<br>
<br>
Where are you getting the latest version of ghettoVCB? <a 
class="jive-link-external" href="http://sourceforge.net/">http://sourceforge.net/</a>
 is not producing a download but an html file.<br>
</p><p>
Thanks
					</p>
				</div>
				<a name="comments-15822"></a>
				<div id="comment-15822" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 19, 2010 12:59 AM
						</span>
							<!--<a href="/people/jcbosacoma" title="Click to view jcbosacoma's profile">
<img class="jive-avatar" src="/people/jcbosacoma/avatar/16.png?a=-1" height="16" width="16" title="Click to view jcbosacoma's profile" alt="Click to view jcbosacoma's profile" />
</a>--><a href="http://communities.vmware.com/people/jcbosacoma" 
id="jive-fiFow9cGL5Ma15en" class="jive-username-link" title="Click to 
view jcbosacoma's profile">jcbosacoma</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15706" title="Go to message">Whtiy</a>
							</em>
					</span>
					<p id="comment-body-15822">
					Hello,<br>
<br>
I am getting an error when running the script with no compression.<br>
<br>
</p><ul>
<li>Failed to clone disk : The file already exists (39).</li>
</ul>
<br>
<ul>
<li>but creates a gz file on the target. Any thoughts?</li>
</ul>
<br>
Also if i run the script with no compression i get the following errors:<br>
<br>
<ul>
<li>Failed to clone disk : The file already exists (39).</li>
<li>mv: unable to rename `/vmfs/volumes/WinL/AABBES.COM-2010-06-19': 
Input/output error</li>
</ul>
<br>
any thoughts?<br>
<br>
Thank you...
					
				</div>
				<a name="comments-15829"></a>
				<div id="comment-15829" class="jive-content-comment ">
					<span>
						<span>
							Jun 20, 2010 3:21 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Bb2sTCtKnqj4U85j" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15706" title="Go to message">Whtiy</a>
							</em>
					</span>
					<p id="comment-body-15829">
					Sorry for the late reply, I've been studying for an exam these last
 few weeks and just been swamped with other things. <br>
<br>
I think I mentioned this somewhere in the documentation, but I'm not a 
fan of using spaces or special chars in a naming convention for your VMs
 or hosts. Yes, Windows and VMwares allows you to do this, but I prefer 
to use underscores or dashes to separate words. <br>
<br>
Regarding #2, I'll go ahead and mark this down and make sure it's 
resolved in a future release of the script. Thanks for your findings.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15830"></a>
				<div id="comment-15830" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 20, 2010 3:23 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6toC6ykzc4DAWj9H" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15767" title="Go to message">diplan</a>
							</em>
					</span>
					<p id="comment-body-15830">
					Sorry for the late reply, I've been studying for an exam these last
 few weeks and just been swamped with other things. <br>
<br>
I'm a little confused from your comments. You're able to backup this VM 
which has 2 VMDKs and one is successful and the other is not? Based on 
the logs, it's not able to create a snapshot which means if the VM was 
powered on a backup would have not happened. <br>
<br>
Could you provide some more details in your exact execution? Are you 
trying to backup each VMDK and found that only the first one works but 
not the second? <br>
<br>
FYI - Please refer FAQ #1 for posting logs.<br>
<br>
Thanks<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15831"></a>
				<div id="comment-15831" class="jive-content-comment ">
					<span>
						<span>
							Jun 20, 2010 3:24 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-h7bjYg4d6PG5YXpp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15822" title="Go to message">jcbosacoma</a>
							</em>
					</span>
					<p id="comment-body-15831">
					Sorry for the late reply, I've been studying for an exam these last
 few weeks and just been swamped with other things. <br>
<br>
You may want to refer to FAQ #18<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15836"></a>
				<div id="comment-15836" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 21, 2010 2:57 AM
						</span>
							<!--<a href="/people/sembsl" title="Click to view sembsl's profile">
<img class="jive-avatar" src="/people/sembsl/avatar/16.png?a=-1" height="16" width="16" title="Click to view sembsl's profile" alt="Click to view sembsl's profile" />
</a>--><a href="http://communities.vmware.com/people/sembsl" 
id="jive-33bBYiCC3f0v0PjL" class="jive-username-link" title="Click to 
view sembsl's profile">sembsl</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15836">
					Hi, great little tool. I have used this to successfully backup a 
number of machines.<br>
<br>
I noticed in the VMA client GUI that when it is doing the copy (the slow
 bit) there is a little percentage bar at the bottom. I like this 
feature and would like to incorporate this into the script. <br>
<br>
The command that actually does the copy is; /usr/bin/vmkfstools --server
 "SSS" --username "UUU" --password "funkytmppass" -i "ds file" -a 
buslogic -d thin "ds file"<br>
<br>
Is there any way to get the progress of the command? I've tried looking 
at the file size but it seems to allocate it all upfront... maybe a 
separate VMA interface call? <br>
<br>
Any ideas appreciated.
					</p>
				</div>
				<a name="comments-15851"></a>
				<div id="comment-15851" class="jive-content-comment ">
					<span>
						<span>
							Jun 21, 2010 6:34 AM
						</span>
							<!--<a href="/people/diplan" title="Click to view diplan's profile">
<img class="jive-avatar" src="/people/diplan/avatar/16.png?a=-1" height="16" width="16" title="Click to view diplan's profile" alt="Click to view diplan's profile" />
</a>--><a href="http://communities.vmware.com/people/diplan" 
id="jive-Bqf5x9RTvOAmsj81" class="jive-username-link" title="Click to 
view diplan's profile">diplan</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15830" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15851">
					Hello,<br>
<br>
In the first step we backed up only disk number one of the VM. The 
backup worked well. The second disk was independend (no snapshot).<br>
<br>
Then we tried to backup the vmdk file with the option 
"VMDK_FILES_TO_BACKUP=" didnt work. <br>
Here are the 3 versions we try(ghettoVCB.conf): <br>
<br>
VMDK_FILES_TO_BACKUP="VM_1_1_1.vmdk"<br>
VMDK_FILES_TO_BACKUP="/vmfs/volumes/RAID5-SATA/VM_1/VM_1_1_1.vmdk"<br>
VMDK_FILES_TO_BACKUP="/vmfs/volumes/4bf393c5-edde2dfb-7cb5-001517d7e5d5/VM_1/VM_1_1_1.vmdk"<br>
<br>
This didnt work. <br>
<br>
after that we configured the second disk to be "dependant" in order to 
be included in the snapshots.<br>
<br>
Here the link to the logfile: <a class="jive-link-external" 
href="http://pastebin.com/brtVtgLm">http://pastebin.com/brtVtgLm</a><br>
<br>
Summary: <br>
1. When both disks are configured to be "dependant" the backup fails.<br>
2. When only the first disk is configured to be "dependant" then the 
backup succeeds!
					</p>
				</div>
				<a name="comments-15866"></a>
				<div id="comment-15866" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 21, 2010 8:43 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-glJsH4Ce81BAhBJD" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15836" title="Go to message">sembsl</a>
							</em>
					</span>
					<p id="comment-body-15866">
					If you ran the <b>vmkfstools</b> interactively, you'll get a % 
completed but there is no bar that exists. This tool is meant to run in 
the background, if you need to see the current progress you can run it 
interactively OR tail the logs<br>
<br>
If you're referring to the progress bar found in the vSphere Client, 
that is only available when using the vSphere API, when you manually 
call vmkfstools from the Service Console or the unsupported Busybox 
console, this is not reflected on the UI. ghettoVCBg2 uses the vSphere 
API, hence when logging directly into an ESX or ESXi host while the 
backup is being performed, you'll notice the progress for a given VMDK 
copy.<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15867"></a>
				<div id="comment-15867" class="jive-content-comment ">
					<span>
						<span>
							Jun 21, 2010 8:49 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5pyDiT90J69oo8m0" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15851" title="Go to message">diplan</a>
							</em>
					</span>
					<p id="comment-body-15867">
					So the format of <b>VMDK_FILES_TO_BACKUP</b> variable is just the 
VMDK name, you don't need to specify the full path and if you do, it 
probably will not pass the checks as the script is looking for a 
specific name (e.g. mydisk.vmdk) This is clearly documented, so the 1st 
configuration is correct and should be used.<br>
<br>
Secondly, make sure you disks are can be snapshotted. <br>
<br>
I'll need the following pieces of information: <br>
1) Can you please provide screen shots of your VM configurations, 
specifically for each of the VMDK. Click on the VM settings, highlight 
each VMDK and provide a snapshot of the configuration<br>
2) You mentioned this VM resides on 2 separate datastores? Are they both
 VMFS or NFS? If its VMFS, can you provide the VMFS blocksize configured
 for each datastore that this VM in question resides in<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15868"></a>
				<div id="comment-15868" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 21, 2010 11:59 AM
						</span>
							<!--<a href="/people/sembsl" title="Click to view sembsl's profile">
<img class="jive-avatar" src="/people/sembsl/avatar/16.png?a=-1" height="16" width="16" title="Click to view sembsl's profile" alt="Click to view sembsl's profile" />
</a>--><a href="http://communities.vmware.com/people/sembsl" 
id="jive-FioOLAy4Dd5gpzOV" class="jive-username-link" title="Click to 
view sembsl's profile">sembsl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15866" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15868">
					I ran the command interactively - it took about 5minutes - and 
completed successfully. But I did not see any percentage completed 
output.<br>
<br>
I also tried extracting the logs (hostd, message) from the ESX server 
using vilogger - but these logs also did not contain a % output. Which 
logs were you referring to?
					</p>
				</div>
				<a name="comments-15869"></a>
				<div id="comment-15869" class="jive-content-comment ">
					<span>
						<span>
							Jun 21, 2010 12:10 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9e0kz4TQ83jqYt1y" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15868" title="Go to message">sembsl</a>
							</em>
					</span>
					<p id="comment-body-15869">
					If you ran the copy command manually with vmkfstools, you should 
have seen a counter displaying the progress which should be changing on 
your screen.<br>
<br>
The logs I'm referring to is the ghettoVCB logs that are being 
generated, they also capture the status. Also note that timestamps are 
captured in the log along with the completion time for your records <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15870"></a>
				<div id="comment-15870" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 21, 2010 12:20 PM
						</span>
							<!--<a href="/people/jjj0923" title="Click to view jjj0923's profile">
<img class="jive-avatar" src="/people/jjj0923/avatar/16.png?a=-1" height="16" width="16" title="Click to view jjj0923's profile" alt="Click to view jjj0923's profile" />
</a>--><a href="http://communities.vmware.com/people/jjj0923" 
id="jive-4H45G46Kef3Jdllp" class="jive-username-link" title="Click to 
view jjj0923's profile">jjj0923</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-10421" title="Go to message">Shaveht</a>
							</em>
					</span>
					<p id="comment-body-15870">
					ok - here's my problem.<br>
<br>
I put ghettovcb.sh and the control file that contains the names of the 
file to backup in the root directory of my esxi3.5 box and after I 
reboot the server - the files are GONE!<br>
<br>
why is this?<br>
<br>
thanks in advance.<br>
<br>
Jeff
					</p>
				</div>
				<a name="comments-15871"></a>
				<div id="comment-15871" class="jive-content-comment ">
					<span>
						<span>
							Jun 21, 2010 12:30 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-3s7L9KCB0pF5j32D" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15870" title="Go to message">jjj0923</a>
							</em>
					</span>
					<p id="comment-body-15871">
					Changes in the ESXi unsupported Busybox console are not persisted 
after reboots other than for a few configuration file. You should store 
your script in either the local VMFS volume or on shared storage else 
they'll be wiped each time the host reboots <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15872"></a>
				<div id="comment-15872" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 21, 2010 1:10 PM
						</span>
							<!--<a href="/people/sembsl" title="Click to view sembsl's profile">
<img class="jive-avatar" src="/people/sembsl/avatar/16.png?a=-1" height="16" width="16" title="Click to view sembsl's profile" alt="Click to view sembsl's profile" />
</a>--><a href="http://communities.vmware.com/people/sembsl" 
id="jive-F6oE3uvexyaT3qwx" class="jive-username-link" title="Click to 
view sembsl's profile">sembsl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15869" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15872">
					I must have screwed something up, because It didn't output 
anything.. I did find tho, if i put "--verbose 3" on the command line it
 spits out a bunch of XML, where one of the fields is a percentage 
&lt;progress&gt;. I will strip out that field.
					</p>
				</div>
				<a name="comments-15840"></a>
				<div id="comment-15840" class="jive-content-comment ">
					<span>
						<span>
							Jun 22, 2010 7:00 AM
						</span>
							<!--<a href="/people/mkennetha" title="Click to view mkennetha's profile">
<img class="jive-avatar" src="/people/mkennetha/avatar/16.png?a=-1" height="16" width="16" title="Click to view mkennetha's profile" alt="Click to view mkennetha's profile" />
</a>--><a href="http://communities.vmware.com/people/mkennetha" 
id="jive-IxBG4ARAK9ugFNV1" class="jive-username-link" title="Click to 
view mkennetha's profile">mkennetha</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15872" title="Go to message">sembsl</a>
							</em>
					</span>
					<p id="comment-body-15840">
					Hi there,<br>
<br>
My users need to retain multiple snapshots of their virtual machines. Is
 there any way to backup machines with snapshots? Would it work to:<br>
<br>
a) create a snapshot<br>
b) "vmkfstools -i 2nd_last_snap.vndk ...."<br>
c) remove the last snapshot<br>
<br>
Has anyone figured out the addressing scheme for snapshots using 
"vim-cmd vmcvs/snapshot.remove". The docs specify the arguments  
snapshotLevel and snapshotIndex, but I haven't figured out how they work
 with branched trees yet..<br>
</p><p>
Thanks!
					</p>
				</div>
				<a name="comments-15841"></a>
				<div id="comment-15841" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 22, 2010 7:11 AM
						</span>
							<!--<a href="/people/jjj0923" title="Click to view jjj0923's profile">
<img class="jive-avatar" src="/people/jjj0923/avatar/16.png?a=-1" height="16" width="16" title="Click to view jjj0923's profile" alt="Click to view jjj0923's profile" />
</a>--><a href="http://communities.vmware.com/people/jjj0923" 
id="jive-7lfa9Rp0vnBlWaYM" class="jive-username-link" title="Click to 
view jjj0923's profile">jjj0923</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15840" title="Go to message">mkennetha</a>
							</em>
					</span>
					<p id="comment-body-15841">
					multiple snapshots are accomodated for right in the script file<br>
<br>
VM_BACKUP_ROTATION_COUNT=5<br>
<br>
or whatever number you want to save and you can vary to backup schedule 
in the cron entry.
					</p>
				</div>
				<a name="comments-15842"></a>
				<div id="comment-15842" class="jive-content-comment ">
					<span>
						<span>
							Jun 22, 2010 7:28 AM
						</span>
							<!--<a href="/people/mkennetha" title="Click to view mkennetha's profile">
<img class="jive-avatar" src="/people/mkennetha/avatar/16.png?a=-1" height="16" width="16" title="Click to view mkennetha's profile" alt="Click to view mkennetha's profile" />
</a>--><a href="http://communities.vmware.com/people/mkennetha" 
id="jive-f0S7Kk6PVFUo3U0T" class="jive-username-link" title="Click to 
view mkennetha's profile">mkennetha</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15841" title="Go to message">jjj0923</a>
							</em>
					</span>
					<p id="comment-body-15842">
					Thanks, but doesn't VM_BACKUP_ROTATION_COUNT just determine the 
number of backups to save for each virtual machine?<br>
I need to be able backup virtual machines that have virtual machine 
snapshots. I don't really need to retain the snapshots in the backup, 
but I can't delete the snapshots on the virtual machines. From the 
"Features" section at the top of this page:<br>
<br>
"VM(s) that intially contain snapshots will not be backed up and will be
 ignored"
					</p>
				</div>
				<a name="comments-15852"></a>
				<div id="comment-15852" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 22, 2010 8:46 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FFJWVg16BcISnKvY" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15842" title="Go to message">mkennetha</a>
							</em>
					</span>
					<p id="comment-body-15852">
					@mkennetha you are correct, the variable <b>VM_BACKUP_ROTATION_COUNT</b>
 is used to determine the number of backups for each VM which is a 
complete backup of a given VM w/o snapshots.<br>
<br>
As mentioned in the documentation and in FAQ #11, VMs w/prior snapshots 
is NOT supported. It's not a best practice to keep snapshots for long 
durations and more commonly they're miss-used and miss-understood. Here 
is another article on why snapshots are NOT meant to be used for backups
 - <a class="jive-link-external" 
href="http://blogs.vmware.com/kb/2010/06/vmware-snapshots.html">http://blogs.vmware.com/kb/2010/06/vmware-snapshots.html</a><br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15853"></a>
				<div id="comment-15853" class="jive-content-comment ">
					<span>
						<span>
							Jun 22, 2010 9:14 AM
						</span>
							<!--<a href="/people/mkennetha" title="Click to view mkennetha's profile">
<img class="jive-avatar" src="/people/mkennetha/avatar/16.png?a=-1" height="16" width="16" title="Click to view mkennetha's profile" alt="Click to view mkennetha's profile" />
</a>--><a href="http://communities.vmware.com/people/mkennetha" 
id="jive-3g7zRu23cgqbOFzh" class="jive-username-link" title="Click to 
view mkennetha's profile">mkennetha</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15852" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15853">
					Thanks for your reply. <br>
<br>
I certainly agree that snapshot retention is neither resource-friendly 
nor suitable as a backup strategy. <br>
The situation that I am confronted with is that the developers I support
 have a workflow in place which makes copious use of snapshots. Poorly 
conceived, perhaps, but nevertheless I do have to provide some kind of 
backup strategy.  <br>
<br>
Up to now, I've been more or less manually using the workflow described 
in my first post. I haven't been able to reliably script it yet, because
 I haven't been able to address snapshots after a snapshot tree has been
 forked. I suppose the "snapshotIndex" is relevant, but I haven't been 
able to find documentation and my own experimental poking has not yet 
yielded results.
					</p>
				</div>
				<a name="comments-15854"></a>
				<div id="comment-15854" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 23, 2010 1:58 AM
						</span>
							<!--<a href="/people/giunat" title="Click to view giunat's profile">
<img class="jive-avatar" src="/people/giunat/avatar/16.png?a=-1" height="16" width="16" title="Click to view giunat's profile" alt="Click to view giunat's profile" />
</a>--><a href="http://communities.vmware.com/people/giunat" 
id="jive-UwIubtM24IJeOR65" class="jive-username-link" title="Click to 
view giunat's profile">giunat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15853" title="Go to message">mkennetha</a>
							</em>
					</span>
					<p id="comment-body-15854">
					Hi,<br>
<br>
I'm using this script to backup my vm in vsphere environment (i send a 
batch from Windows).<br>
The script work right with ESX4 ,but I have some problem with ESXi 4: 
the backup is OK (also the restore) but the log file is empty.<br>
Kindly, can you help me?<br>
<br>
Thanks for all
					</p>
				</div>
				<a name="comments-15844"></a>
				<div id="comment-15844" class="jive-content-comment ">
					<span>
						<span>
							Jun 23, 2010 8:33 AM
						</span>
							<!--<a href="/people/vmbru" title="Click to view vmbru's profile">
<img class="jive-avatar" src="/people/vmbru/avatar/16.png?a=-1" height="16" width="16" title="Click to view vmbru's profile" alt="Click to view vmbru's profile" />
</a>--><a href="http://communities.vmware.com/people/vmbru" 
id="jive-Rpd3K7o28r2nhYBA" class="jive-username-link" title="Click to 
view vmbru's profile">vmbru</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15844">
					Pretty nifty code.<br>
<br>
Wondering...<br>
<br>
1.  Are you phasing off this script and telling users to switch to the 
ghettoVCBg2?  If so skip #4.<br>
<br>
2. To truly create a backup window, don't see a way to terminate the 
backup process if we want the backups to stop at... lets say 7am then 
resume at 6pm.  Is this possible?<br>
<br>
3.  any dedupe features coming... like VDR has? or would that hose the 
esxi host too much?  Backups are fast, the compressing of VM's to *.gz 
is the slowest.  The backup/compress every night will take awhile for 30
 or more VM's.<br>
<br>
4. email feature?  we have script that can email log but would be nice 
there were an email feature.<br>
<br>
We're beta testing VDR, but I need something for production until Azmir 
fixes the slow Integrity Checks.  :  )  waiting patiently.<br>
</p><p>
</p><ul>
<li>- VMware truly needs to focus efforts on its backup stragety of VM's
 for its Advanced or higher license customers, the core software and 
other features are fine, VDR just needs more attention.</li>
</ul>

					
				</div>
				<a name="comments-15857"></a>
				<div id="comment-15857" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 23, 2010 9:45 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-7OJ866gb79b6M8Pc" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15854" title="Go to message">giunat</a>
							</em>
					</span>
					<p id="comment-body-15857">
					Have you taken a look at some of the resources above in the 
documentation with regards to executing the script from a Windows 
environment? That should give you some tips on setting it up, if you're 
sending the correct command, it should log to the destination datastore<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15845"></a>
				<div id="comment-15845" class="jive-content-comment ">
					<span>
						<span>
							Jun 23, 2010 10:03 AM
						</span>
							<!--<a href="/people/giunat" title="Click to view giunat's profile">
<img class="jive-avatar" src="/people/giunat/avatar/16.png?a=-1" height="16" width="16" title="Click to view giunat's profile" alt="Click to view giunat's profile" />
</a>--><a href="http://communities.vmware.com/people/giunat" 
id="jive-TVXp0P0EQKkmxUbO" class="jive-username-link" title="Click to 
view giunat's profile">giunat</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15857" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15845">
					Hi William,<br>
<br>
thanks for reply.<br>
this is the batch file that i have scheduled in Windows:<br>
<br>
C:\backup_vm\plink.exe root@10.1.0.13 -pw password "nohup 
/vmfs/volumes/4bbc4a19-fe5178cd-1a04-d8d3855fa43e/copia_vm/ghettoVCB.sh 
-f /vmfs/volumes/4bbc4a19-fe5178cd-1a04-d8d3855fa43e/copia_vm/serverweb 
&gt; /vmfs/volumes/ce5226e0-34047eed/Backup/backuplogserverweb.txt 
&amp;"<br>
<br>
The backup is correct but the log is empty(ESX 4i).<br>
The same script works correctly in ESX4<br>
<br>
I have read some tips but I'm unable to identify the solution.<br>
<br>
Thanks
					</p>
				</div>
				<a name="comments-15858"></a>
				<div id="comment-15858" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 23, 2010 10:08 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-FlOkFtVi1NUwIWco" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15844" title="Go to message">vmbru</a>
							</em>
					</span>
					<p id="comment-body-15858">
					Hello,<br>
<br>
1. I'm not phasing ghettoVCB, on the contrary, I have more users on this
 script than ghettoVCBg2. The primary reason I can think of, is 
ghettoVCB supports free ESXi which is used for many small shops, labs 
and even some mid size shops. I continue to get feedback from the 
community and provide enhancements/fixes as appropriate and as time 
permits. Please refer to FAQ #15 for more questions on enhancement 
requests<br>
<br>
2. Not possible and I don't plan on supporting this type of complicated 
backup process. Remember this solution is not doing any type of 
"incremental" backup, this is using vmkfstools which I <u>expect</u> 
users of this script to understand how that works and how the backups 
are actually taking place. If you understand that, then you'll see that 
implementing a "pause" option would not work<br>
<br>
3. Please refer to comment #2 from above and FAQ #25. If you're looking 
for de-dupe capabilities, this will have to be on the actual storage 
subsystem whether that be an NFS/ZFS server or an array that has de-depe
 capabilities. Things like change block tracking is not possible using 
vmkfstools, this is provided via the vSphere API and is implemented in 
various commercial backup solutions such as VMware vDR, Veeam 
Backup/Replication, etc. if you're looking for those features, you need 
to look at a commercial product. As much as I would love to implement a 
ghettoCBT, it just does not exists or available via the methods this 
script<br>
<br>
4. Yes it would be nice, there have been some posts on the internet on 
getting email sent from classic ESX, the problem arises when you're 
dealing with ESXi. If you need email capabilities, have a remote 
management system grab the logs after the backup or after n-period of 
time and email it to you, this allow for custom configuration/etc. if a 
user wanted the email to come from a centralized system. No plans to 
support this in the future<br>
<br>
I've heard horror stories with vDR and from what I "hear", it's still a 
1.0 product. If you're looking for a mature and reliable commercial 
product, take a look at Veeam Backup and Replication.<br>
<br>
Hopefully this answered your questions<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15846"></a>
				<div id="comment-15846" class="jive-content-comment ">
					<span>
						<span>
							Jun 23, 2010 10:15 AM
						</span>
							<!--<a href="/people/XavierE" title="Click to view XavierE's profile">
<img class="jive-avatar" src="/people/XavierE/avatar/16.png?a=3297" height="16" width="16" title="Click to view XavierE's profile" alt="Click to view XavierE's profile" />
</a>--><a href="http://communities.vmware.com/people/XavierE" 
id="jive-TQX1ws9G6Q6Nm5tC" class="jive-username-link" title="Click to 
view XavierE's profile">XavierE</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15845" title="Go to message">giunat</a>
							</em>
					</span>
					<p id="comment-body-15846">
					Giunat,<br>
I personally use the vMA appliance -you could use any linux flavor- to 
remotely via SSH trigger the ghettovcb script on ESX/ESXi hosts. The 
backup repository is a NFS server attached to all hosts which also 
centralizes the configuration/scripts. It has been working really good 
and have found no problems. I wrote a small script to handle the logging
 and email notifications that include the backup log. <br>
<br>
If you are interested on implementing in this -similar- way let me know 
and I can email you more details.
					</p>
				</div>
				<a name="comments-15849"></a>
				<div id="comment-15849" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 23, 2010 11:48 PM
						</span>
							<!--<a href="/people/traugust" title="Click to view traugust's profile">
<img class="jive-avatar" src="/people/traugust/avatar/16.png?a=-1" height="16" width="16" title="Click to view traugust's profile" alt="Click to view traugust's profile" />
</a>--><a href="http://communities.vmware.com/people/traugust" 
id="jive-I3xnnugrOjoacUOH" class="jive-username-link" title="Click to 
view traugust's profile">traugust</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15858" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15849">
					Hi Wiliam,<br>
<br>
Thanks for this great tool - it really helps all of us 
'part-time-admins' in small projects a lot!!<br>
<br>
I would like to mention 3 things:<br>
<br>
1. I ran into a problem when the NFS mount ran out of space during disk 
clone. This was reported by vmkfstools on the screen and in the debug 
log as follows:<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">--- snip ---
2010-06-23 11:19:08 -- debug: Waiting for snapshot "ghettoVCB-snapshot-2010-06-23" to be created
2010-06-23 11:19:08 -- debug: Snapshot timeout set to: 900 seconds
Destination disk format: VMFS thin-provisioned
Cloning disk '/vmfs/volumes/vmsOnC2edev13/vmc2eocs03/vmc2eocs03.vmdk'...

Clone: 0% done.
Clone: 1% done.
Clone: 2% done.
Clone: 3% done.
Clone: 4% done.
Clone: 5% done.
Clone: 6% done.
Clone: 7% done.
Clone: 8% done.
Clone: 9% done.
Clone: 10% done.
Clone: 11% done.
Clone: 12% done.
Clone: 13% done.
Clone: 14% done.
Clone: 15% done.
Clone: 16% done.
Clone: 17% done.
Clone: 18% done.
Clone: 19% done.
Clone: 20% done.
Clone: 21% done.
Clone: 22% done.
Clone: 23% done.
Clone: 24% done.
Clone: 25% done.
Clone: 26% done.
Clone: 27% done.
Clone: 28% done.
Clone: 29% done.
Clone: 30% done.
Clone: 31% done.
Clone: 32% done.
Clone: 33% done.
Clone: 34% done.
Clone: 35% done.
Clone: 36% done.
Clone: 37% done.
Clone: 38% done.
Clone: 39% done.
Clone: 40% done.
Clone: 41% done.
Clone: 42% done.
Clone: 43% done.
Clone: 44% done.
Clone: 45% done.
Clone: 46% done.
Clone: 47% done.
Clone: 48% done.
Clone: 49% done.
Clone: 50% done.
Clone: 51% done.
Clone: 52% done.
Clone: 53% done.
Clone: 54% done.
Clone: 55% done.
Clone: 56% done.
Clone: 57% done.
Clone: 58% done.
Clone: 59% done.
Clone: 60% done.
Clone: 61% done.
Clone: 62% done.
Clone: 63% done.
Clone: 64% done.
Clone: 65% done.
Clone: 66% done.
Clone: 67% done.
Clone: 68% done.
Clone: 69% done.
Clone: 70% done.
Clone: 71% done.
Clone: 72% done.
Clone: 73% done.
Clone: 74% done.
Clone: 75% done.
Clone: 76% done.Failed to clone disk : No space left on device (1835017).
2010-06-23 12:05:29 -- info: Removing snapshot from vmc2eocs03 ...
2010-06-23 12:06:04 -- info: Backup Duration: 46.95 Minutes
2010-06-23 12:06:04 -- info: Successfully completed backup for vmc2eocs03!

2010-06-23 12:06:05 -- info: Initiate backup for vSphere Management Assistant
--- snip ---
</code></pre> <br>
As you can see ghettoVCB did not find this situation to be an error and 
continued the backup and reported backup success. Ist there any chance 
to change this? Perhaps checking the vmkfstools call's return value?<br>
<br>
2. I built a small customization for logwatch (see <a 
class="jive-link-external" href="http://www.logwatch.org/">http://www.logwatch.org/</a>)
 that parses a directory containing the ghettoVCB log files of several 
hosts (i.e. on the central NFS backup datastore) and outputs a report on
 the executions and statuses of the backup operations that were 
performed as cron jobs on several ESXi hosts. And the logwatch tool runs
 as cron job on the Server that provides the NFS share to the ESXI 
hosts.    The E-Mail report looks as follows [due to testing the 
error-detection there are more error messages that success messages in 
the report, but that errors were produced intentionally <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";-)" border="0">
 ]:<br>
<pre class="jive-pre"><code class="jive-code jive-plain"> ################### Logwatch 7.3 (03/24/06) #################### 
        Processing Initiated: Thu Jun 24 08:17:00 2010
        Date Range Processed: all
      Detail Level of Output: 0
              Type of Output: unformatted
           Logfiles for Host: xxxxxxxxxxxxxxxxxx
  ################################################################## 
 
 --------------------- GhettoVCB VM backups Begin ------------------------ 

 !!!WARNING!!! You may have backup errors
 localhost.localdomain:vmc2eocs03 @ 2010-06-23 11:19:08:
 		Clone: 76% done.Failed to clone disk : No space left on device (1835017).: 1 time(s)
 localhost.localdomain:vmc2eocs03 @ 2010-06-23 13:03:42:
 		Clone: 76% done.Failed to clone disk : No space left on device (1835017).: 1 time(s)
 localhost.localdomain: @ 2010-06-22 11:07:25:
 		 -- info: ###### Final status: ERROR: All VMs failed! ######: 1 time(s)
 localhost.localdomain: @ 2010-06-22 11:07:01:
 		 -- info: ###### Final status: ERROR: All VMs failed! ######: 1 time(s)
 localhost.localdomain: @ 2010-06-23 07:02:02:
 		 -- info: ###### Final status: ERROR: All VMs failed! ######: 1 time(s)
 localhost.localdomain: @ 2010-06-23 12:11:28:
 		 -- info: ###### Final status: ERROR: Only some of the VMs backed up! ######: 1 time(s)
 
 
 ------------------------------------------------------------------
 ------------------------       Backup summary      ---------------
 ------------------------------------------------------------------
 Host:			Build:
 	VM:
 		Backup     			Success:   	duration:
 ------------------------------------------------------------------
 localhost.localdomain	VMware ESXi 4.0.0 build-208167
 	vSphere Management Assistant
 		2010-06-23 12:06:05	success	5.38 Minutes
 ------------------------------------------------------------------
 	vmc2eappsvct-esxi
 		2010-06-22 06:33:03	success	9.15 Minutes
 		2010-06-22 07:00:03	success	9.15 Minutes
 		2010-06-22 11:07:01	!!omitted!!	- unknown -  
 		2010-06-22 11:07:25	!!omitted!!	- unknown -  
 		2010-06-23 07:02:02	!!omitted!!	- unknown -  
 		2010-06-23 07:31:48	success	9.15 Minutes
 		2010-06-23 11:14:26	- unknown -	- unknown -  
 		2010-06-23 11:19:06	!!omitted!!	- unknown -  
 		2010-06-23 12:52:41	success	10.98 Minutes
 ------------------------------------------------------------------
 	vmc2eocs03
 		2010-06-23 11:19:07	!!Error!!	- unknown -  
 		2010-06-23 13:03:41	!!Error!!	- unknown -  
 ------------------------------------------------------------------
 ------------------------------------------------------------------
 esxihost2.x.com	VMware ESXi 4.0.0 build-208167
 	FW-Builder
 		2010-06-24 05:33:32	success	12.43 Minutes
 ------------------------------------------------------------------
 	VAS win2k
 		2010-06-24 05:56:59	success	17.02 Minutes
 ------------------------------------------------------------------
 	vasa xp
 		2010-06-24 05:46:00	success	10.97 Minutes
 ------------------------------------------------------------------
 	vmccccontrol
 		2010-06-24 06:14:02	- unknown -	- unknown -  
 ------------------------------------------------------------------
 ------------------------------------------------------------------
 
 ---------------------- GhettoVCB VM backups End ------------------------- 

 
 ###################### Logwatch End ######################### 

</code></pre><br>
I assume this to be a good starting point for a community tool - but I 
have not the time to maintain this script for the community and provide 
support and a comprehensive documentation for the tool - So I would 
leave a *.tar.gz somewhere with some short usage notes and provide this 
script  <b>as is</b>. Where and how would I leave such a script?   <br>
<br>
3. One information I woluld like to have parseable in the log file (for 
my logwatch report ) would be the actual disk size of the backup 
performed (and perhaps the free space on the backup datastore before and
 after backup operation). This would be a useful information for my 
logwatch report, so in case you are doing work on your script anyway 
this would be a nice addition. <br>
<br>
Again, thanks for your great work <br>
<p>
Greetings <br>
<br>
Thomas
					</p>
				</div>
				<a name="comments-15895"></a>
				<div id="comment-15895" class="jive-content-comment ">
					<span>
						<span>
							Jun 24, 2010 9:25 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-Yl990Py0XTcH05F8" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15849" title="Go to message">traugust</a>
							</em>
					</span>
					<p id="comment-body-15895">
					1. Good catch! I presume all we need to do is add something like 
this to the script immediately after each vmkfstools clone operation:<br>
<a class="jive-link-external" href="http://pastebin.com/tY1Ypby3">http://pastebin.com/tY1Ypby3</a><br>
<br>
(untested yet)<br>
<br>
2. Up to you IMHO.<br>
<br>
3. Interesting. Maybe you would propose a patch?
					</p>
				</div>
				<a name="comments-15896"></a>
				<div id="comment-15896" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 24, 2010 9:26 AM
						</span>
							<!--<a href="/people/gautelund" title="Click to view gautelund's profile">
<img class="jive-avatar" src="/people/gautelund/avatar/16.png?a=-1" height="16" width="16" title="Click to view gautelund's profile" alt="Click to view gautelund's profile" />
</a>--><a href="http://communities.vmware.com/people/gautelund" 
id="jive-M1iyKwBcX088X1iT" class="jive-username-link" title="Click to 
view gautelund's profile">gautelund</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15896">
					William,<br>
<br>
after your updates in april-may it has been a few weeks before I got 
around to try it out on our servers (instead of my own cooked version). 
It appears to be a "drop in replacement", and of course I'd prefer to 
use "upstream" instead of a separate version. <br>
<br>
Nevertheless I still have a few questions. They might be a bit lengthy 
for a comment here, so they're here: <a class="jive-link-external" 
href="http://pastebin.com/EkfWfG2K">http://pastebin.com/EkfWfG2K</a><br>
<br>
Take a look and let me know.
					</p>
				</div>
				<a name="comments-15910"></a>
				<div id="comment-15910" class="jive-content-comment ">
					<span>
						<span>
							Jun 24, 2010 9:55 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-uDW0L4lqa2RnXhX3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15849" title="Go to message">traugust</a>
							</em>
					</span>
					<p id="comment-body-15910">
					Hi traugust,<br>
<br>
Thanks for the commends, I'm aware of this scenario and will be properly
 handled in a future release. I'll make a note of your comments but 
depending on my free cycles, some of these may or may not make it into 
future release.<br>
<br>
Very cool report btw.<br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15911"></a>
				<div id="comment-15911" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 24, 2010 9:56 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-33dMr7MmeGmm2vjC" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15896" title="Go to message">gautelund</a>
							</em>
					</span>
					<p id="comment-body-15911">
					gautelund,<br>
<br>
Let me take a look at get back to you, got lots on my plate <img 
class="jive-emoticon" src="DOC-8760_files/wink.gif" alt=";)" border="0">
 Remember this is not the only script I manage and have to keep up to 
date. <br>
<br>
Thanks for the feedback<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15903"></a>
				<div id="comment-15903" class="jive-content-comment ">
					<span>
						<span>
							Jun 29, 2010 5:11 AM
						</span>
							<!--<a href="/people/diplan" title="Click to view diplan's profile">
<img class="jive-avatar" src="/people/diplan/avatar/16.png?a=-1" height="16" width="16" title="Click to view diplan's profile" alt="Click to view diplan's profile" />
</a>--><a href="http://communities.vmware.com/people/diplan" 
id="jive-a3kd09p5U2G00PN9" class="jive-username-link" title="Click to 
view diplan's profile">diplan</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15867" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15903">
					Hi,<br>
<br>
Here are the two screenshots.<br>
<br>
<a class="jive-link-external" href="http://yfrog.com/mtvmdisk1jx">http://yfrog.com/mtvmdisk1jx</a><br>
<br>
Both disks are VMFS typed. The First disk has a maximum disk size 256GB.
 The second disk 1024GB maximum size.<br>
<br>
The first disk is stored in RAID5-SAS with blocksize 1MB.<br>
The second disk is stored in RAID5-SATA with blocksize 4MB
					</p>
				</div>
				<a name="comments-15918"></a>
				<div id="comment-15918" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jun 29, 2010 8:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-DqEj2J5iyx6OYxrd" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15903" title="Go to message">diplan</a>
							</em>
					</span>
					<p id="comment-body-15918">
					This can be an issue if your main VM configuration file is stored 
on a VMFS volume with a smaller blocksize configured than it's other 
VMDK with larger block size. We personally hit a snag with a similar 
configuration that caused our VM to actually crash as documented here - <a
 class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/vsphere-esx-40-crash-vm-bug.html">http://www.virtuallyghetto.com/2010/05/vsphere-esx-40-crash-vm-bug.html</a><br>
<br>
It's probably best to either keep the same blocksize or if you're going 
to have a mix, ensure that the VM's configuration file is actually 
stored on the VMFS volume with the larger blocksize else you will be 
restricted by the VMFS volume with the small blocksize. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15920"></a>
				<div id="comment-15920" class="jive-content-comment ">
					<span>
						<span>
							Jul 1, 2010 11:27 AM
						</span>
							<!--<a href="/people/bklynjae" title="Click to view bklynjae's profile">
<img class="jive-avatar" src="/people/bklynjae/avatar/16.png?a=-1" height="16" width="16" title="Click to view bklynjae's profile" alt="Click to view bklynjae's profile" />
</a>--><a href="http://communities.vmware.com/people/bklynjae" 
id="jive-PDUmFXuCyP3A7r1k" class="jive-username-link" title="Click to 
view bklynjae's profile">bklynjae</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15918" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15920">
					If we are running this script locally on a shared lun and 
configuring it to run from cron. Would the cron job be configured on the
 VMA? <br>
<br>
Do you have a vma/ghettovcb2 for dummies.. Sorry..
					</p>
				</div>
				<a name="comments-15891"></a>
				<div id="comment-15891" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 1, 2010 1:25 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-10E55JiwpvYN2hwU" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15920" title="Go to message">bklynjae</a>
							</em>
					</span>
					<p id="comment-body-15891">
					It does not have to be on vMA, any remote manage host will do just 
fine. You can also schedule it via Windows using the task scheduler. You
 just need to ensure the scheduled task/cron is outside of the ESX or 
ESXi host<br>
<br>
FYI - You're posting in ghettoVCB and not ghettoVCBg2<br>
<br>
In either case, the documentation has information on setting up a 
cronjob <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15955"></a>
				<div id="comment-15955" class="jive-content-comment ">
					<span>
						<span>
							Jul 7, 2010 8:36 AM
						</span>
							<!--<a href="/people/diplan" title="Click to view diplan's profile">
<img class="jive-avatar" src="/people/diplan/avatar/16.png?a=-1" height="16" width="16" title="Click to view diplan's profile" alt="Click to view diplan's profile" />
</a>--><a href="http://communities.vmware.com/people/diplan" 
id="jive-HhXE7fTG7Fmx3ODw" class="jive-username-link" title="Click to 
view diplan's profile">diplan</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15918" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15955">
					Hello,<br>
<br>
Thank you for your help. After i moved all date on the SAS store to the 
SATA store i cant delete the SAS store in the GUI.<br>
I solved the problem with the vmkfstools:<br>
<br>
vmkfstools --createfs vmfs3 --blocksize 4M -S RAID5-SAS.new 
/vmfs/devices/disks/mpx.vmhba2\:C0\:T0\:L0\:3<br>
<br>
Now i have an other problem:<br>
If i try to backup the VM i get this message:<br>
<br>
2010-07-07 13:45:48 -- info: Snapshot found for VM_1, backup will not 
take place<br>
<br>
I already tryed to delete the snapshot in the vClient. I used the 
"delete all" button in the snapshot magager. After i delete all 
snapshots i get the same errormessage again.<br>
Here is a list with existing files after deleting snapshots in the 
manager:<br>
<br>
<a class="jive-link-external" href="http://pastebin.com/Gr2dcZvq">http://pastebin.com/Gr2dcZvq</a><br>
<br>
After deleting the snapshot the ghetto script tells me that snapshots 
are found anyway. How can i delete the snapshot that the gehtto script 
is working?
					</p>
				</div>
				<a name="comments-15941"></a>
				<div id="comment-15941" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 7, 2010 9:30 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-89Dmq2HFvH2a9oLt" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15955" title="Go to message">diplan</a>
							</em>
					</span>
					<p id="comment-body-15941">
					The script searches for 2 types of files: *-delta.vmdk (snapshot 
descriptor) and *.vmsn (snapshot state files). You will need to get rid 
of these else you'll continue to hit the error. I would recommend 
manually creating a snapshot and then deleting it, hopefully this will 
cleanly remove any stale files leftover. If not, then you can manually 
delete these .vmsn files only<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15956"></a>
				<div id="comment-15956" class="jive-content-comment ">
					<span>
						<span>
							Jul 7, 2010 1:52 PM
						</span>
							<!--<a href="/people/dkcote9" title="Click to view dkcote9's profile">
<img class="jive-avatar" src="/people/dkcote9/avatar/16.png?a=-1" height="16" width="16" title="Click to view dkcote9's profile" alt="Click to view dkcote9's profile" />
</a>--><a href="http://communities.vmware.com/people/dkcote9" 
id="jive-etot54B7y3lA7dt6" class="jive-username-link" title="Click to 
view dkcote9's profile">dkcote9</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15956">
					Hi William -<br>
<br>
Great script! You have definitely filled a need in the community (but 
you know that).  I have read and (mostly) memorized this page and have 
learned much in the process.  I have reached an impasse however, and am 
looking for some help as to why I the 2gbsparse format is not working 
for me.  I can't use thick as my destination is not large enough to hold
 the whole image and Windows NFS does not support "thin".<br>
<br>
I am trying to backup to a Windows NFS mount and am using the 2gbspares 
format.  However, the files are all filling up the whole 2GB which 
ultimately fills up the NFS and the copy fails.  The strange thing is 
that when I did this manually last week, it worked!  I saw the various 
files all with different file sizes.<br>
<br>
What am I missing?  I though that Windows NFS supported 2gbsparse.  Is 
there a (WSFU) NFS configuration that I overlooked?<br>
<br>
Thanks in advance!<br>
</p><hr>
<br>
2010-07-07 17:26:59 -- info: ============= ghettoVCB LOG START 
==============================<br>
<br>
2010-07-07 17:26:59 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/esxi_backups/vm-backups<br>
2010-07-07 17:26:59 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-07-07 17:26:59 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-07-07_17-26-59<br>
2010-07-07 17:26:59 -- info: CONFIG - DISK_BACKUP_FORMAT = 2gbsparse<br>
2010-07-07 17:26:59 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-07-07 17:26:59 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-07-07 17:26:59 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-07-07 17:26:59 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-07-07 17:26:59 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-07-07 17:26:59 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-07-07 17:26:59 -- info: CONFIG - LOG_LEVEL = info<br>
2010-07-07 17:26:59 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/vmfs/volumes/VMDataStore1/ghettoVCB/ghettoVCB.sh.log<br>
2010-07-07 17:26:59 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-07-07 17:26:59 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 1<br>
2010-07-07 17:26:59 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
2010-07-07 17:27:02 -- info: Initiate backup for Rainier<br>
2010-07-07 17:27:02 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-07-07" for Rainier<br>
Destination disk format: sparse with 2GB maximum extent size<br>
Cloning disk 
'/vmfs/volumes/VMDataStore1/Rainier-2010-06-22_18-58-43/Rainier-0.vmdk'...<br>
...^MClone: 84% done.Failed to clone disk : Insufficient permission to 
access file (38).<br>
2010-07-07 19:35:16 -- info: Removing snapshot from Rainier ...<br>
2010-07-07 19:35:21 -- info: Backup Duration: 128.32 Minutes<br>
2010-07-07 19:35:21 -- info: Successfully completed backup for Rainier!<br>
<hr>

					
				</div>
				<a name="comments-15957"></a>
				<div id="comment-15957" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 7, 2010 5:28 PM
						</span>
							<!--<a href="/people/dkcote9" title="Click to view dkcote9's profile">
<img class="jive-avatar" src="/people/dkcote9/avatar/16.png?a=-1" height="16" width="16" title="Click to view dkcote9's profile" alt="Click to view dkcote9's profile" />
</a>--><a href="http://communities.vmware.com/people/dkcote9" 
id="jive-qj3n9KwEcSB7Ajy1" class="jive-username-link" title="Click to 
view dkcote9's profile">dkcote9</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15956" title="Go to message">dkcote9</a>
							</em>
					</span>
					<p id="comment-body-15957">
					Additional Info:<br>
<br>
ESXi 4.0U1 w/ most recent ghettoVCB script<br>
3 Active VMs<br>
2 DataStores internal RAID-5 storage <br>
1 Persistent NFS DataStore running on Windows WSFU (No other problems 
with the NFS datastore)<br>
<br>
*The VMA VM backs up fine, but again the first 2 VMDK-part files are the
 full 2GB.<br>
*I can see the creation of all 2GB part files at the beginning of the 
process and then each one being written to 2GB.<br>
</p><ul>
<li>I revise my previous statement to that I only "think" I saw it work 
last week (that was so long ago and it may have been a test run on a 
local data store).</li>
</ul>

					
				</div>
				<a name="comments-15962"></a>
				<div id="comment-15962" class="jive-content-comment ">
					<span>
						<span>
							Jul 9, 2010 6:06 AM
						</span>
							<!--<a href="/people/jayclen" title="Click to view jayclen's profile">
<img class="jive-avatar" src="/people/jayclen/avatar/16.png?a=-1" height="16" width="16" title="Click to view jayclen's profile" alt="Click to view jayclen's profile" />
</a>--><a href="http://communities.vmware.com/people/jayclen" 
id="jive-Lmz912lpDRcQpUPc" class="jive-username-link" title="Click to 
view jayclen's profile">jayclen</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15962">
					Hello,<br>
<br>
I am using ESXi 4 and just started using the latest version of the 
backup script. I experienced the following problem each time I tried to 
backup a VM that had a .vmdk file that was on another datastore. This is
 probably a bug, but I'm not sure if other users have experienced this 
issue. When it would create the folder with the name of the datastore 
UUID that the .vmdk was on, and then also when it would create the 
backup .vmdk file in that folder, the name of both the folder and file 
would be incorrect. Some characters were replaced with spaces. For 
example, the UUID of the datastore was 
"4bb1f74c-ee55f49c-5525-001b212f6af8", but the folder was created as 
"4bb1f74c-ee55f49c-55 5-001b 1 f6af8". Then the .vmdk that was put into 
the folder was "C EN  0  3.vmdk", which also has spaces that have 
replaced characters. To solve the problem I changed the following 
consecutive three lines of code. <br>
<br>
old:<br>
DS_UUID="$(echo ${VMDK#/vmfs/volumes/*})"<br>
DS_UUID="$(echo ${DS_UUID%/*/*})"<br>
VMDK_DISK="$(echo ${VMDK##/*/})"<br>
<br>
new:<br>
DS_UUID="${VMDK#/vmfs/volumes/*}"<br>
DS_UUID="${DS_UUID%/*/*}"<br>
VMDK_DISK="${VMDK##/*/}"<br>
<br>
It appears that using the echo command was giving me adverse results, 
but it is really not needed to do string manipulations.
					</p>
				</div>
				<a name="comments-15971"></a>
				<div id="comment-15971" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 9, 2010 1:08 PM
						</span>
							<!--<a href="/people/ipadl" title="Click to view ipadl's profile">
<img class="jive-avatar" src="/people/ipadl/avatar/16.png?a=-1" height="16" width="16" title="Click to view ipadl's profile" alt="Click to view ipadl's profile" />
</a>--><a href="http://communities.vmware.com/people/ipadl" 
id="jive-GuKQTxyyfBx3hzH5" class="jive-username-link" title="Click to 
view ipadl's profile">ipadl</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15971">
					Hi William et al,<br>
<br>
I really like the script and have started to use is in my Production 
environment after running some tests this past week.  Curiously, I ran 
into the problem in question 8:<br>
<br>
8Q: I noticed that the backup rotation is occurring after a backup. I 
don't have enough local storage space, can the process be changed?<br>
8A: This is primarily done to ensure that you have at least one good 
backup in case the new backup fails. If you would like to modify the 
script, you're more than welcome to do so. <br>
<br>
In our case, I have 2 NASes that I am using to backup our Production 
server - one on MWF, one on TTHS.  We are running this way because it 
provides a little more redundancy in the event that we have a NAS 
failure.  Due to size constraints, how can I modify the ghettoVCB script
 to delete the old backup first?<br>
<br>
Thanks in advance,<br>
<br>
Seth
					</p>
				</div>
				<a name="comments-15964"></a>
				<div id="comment-15964" class="jive-content-comment ">
					<span>
						<span>
							Jul 10, 2010 12:42 PM
						</span>
							<!--<a href="/people/shaggy63" title="Click to view shaggy63's profile">
<img class="jive-avatar" src="/people/shaggy63/avatar/16.png?a=-1" height="16" width="16" title="Click to view shaggy63's profile" alt="Click to view shaggy63's profile" />
</a>--><a href="http://communities.vmware.com/people/shaggy63" 
id="jive-6CqHKRN97L8Qnapl" class="jive-username-link" title="Click to 
view shaggy63's profile">shaggy63</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-15964">
					I have found if you add too many lines to 
/var/spool/cron/crontabs/root the file becomes blank.<br>
if you delete it first then you can add in as many lines as needed.<br>
<br>
Put the following in /etc/rc.local right after the line for killing 
crond and before you add any entries manually, delete the file but don't
 forget to readd the first two lines.<br>
<br>
/bin/rm /var/spool/cron/crontabs/root<br>
/bin/echo "01 01 * * * /sbin/tmpwatch.sh"&gt; 
/var/spool/cron/crontabs/root<br>
/bin/echo "01 * * * * /sbin/auto-backup.sh"&gt;&gt; 
/var/spool/cron/crontabs/root
					</p>
				</div>
				<a name="comments-15972"></a>
				<div id="comment-15972" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 12, 2010 10:12 AM
						</span>
							<!--<a href="/people/dkcote9" title="Click to view dkcote9's profile">
<img class="jive-avatar" src="/people/dkcote9/avatar/16.png?a=-1" height="16" width="16" title="Click to view dkcote9's profile" alt="Click to view dkcote9's profile" />
</a>--><a href="http://communities.vmware.com/people/dkcote9" 
id="jive-9EE3X90MUprxTOs5" class="jive-username-link" title="Click to 
view dkcote9's profile">dkcote9</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15957" title="Go to message">dkcote9</a>
							</em>
					</span>
					<p id="comment-body-15972">
					After the weekend, I have new and strange results from my continued
 attempts to copy off the snapshot vmdk file created with ghettoVCB 
using the 2gbsparse directive.<br>
<br>
There were three attempts at this since Friday - the Sat and Sun backup 
dirs contained only the .vmx file which is consistent with what I've 
been seeing.  However, to my total surprise, this morning's backup 
performed correctly!!!  It contains multiple variable length .vmdk files
 which it what I would expect from the 2gbsparse format.  This is in 
spite of not being touched all weekend.<br>
<br>
Has anybody seen this kind of inconsistent behavior using the 2gbsparse 
directive?<br>
<br>
I cannot begin to imagine why the backup operation suddenly succeeds 
where it has failed for the previous 10 attempts.  Any assistance would 
be very much appreciated!!
					</p>
				</div>
				<a name="comments-15946"></a>
				<div id="comment-15946" class="jive-content-comment ">
					<span>
						<span>
							Jul 12, 2010 3:57 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-M0y3eIo4tJrFtN8D" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15962" title="Go to message">jayclen</a>
							</em>
					</span>
					<p id="comment-body-15946">
					Thanks for the info, I can take a look into this but having the 
extra "echo" statement <u>should</u> not make a difference. If this was 
an issue, there probably would have been more reports.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15947"></a>
				<div id="comment-15947" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 12, 2010 4:01 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-6gE41Vcl1E28Ed4c" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15971" title="Go to message">ipadl</a>
							</em>
					</span>
					<p id="comment-body-15947">
					</p><div class="jive-quote">
Due to size constraints, how can I modify the ghettoVCB script to delete
 the old backup first?<br>
</div>
<br>
This is something you'll need to investigate and modify in the script, I
 can't provide any details else I would be performing the work myself. I
 would recommend that you have sufficient space for your backups meaning
 that you can hold at least 2 copies for any given VM. If you have 2 
separate NFS servers, you can easily set policies to only keep 1 backup 
per device and use a cronjob to alternate the configurations based on 
the days. This would allow you to keep 1 copy on each NFS server and 
overall have at least 2 copies. <br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15948"></a>
				<div id="comment-15948" class="jive-content-comment ">
					<span>
						<span>
							Jul 12, 2010 4:03 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-LJJsuEwR9C09s9iR" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-15972" title="Go to message">dkcote9</a>
							</em>
					</span>
					<p id="comment-body-15948">
					If you take a look at your earlier log posts from the script:<br>
<br>
</p><pre class="jive-pre"><code class="jive-code jive-plain">Cloning disk '/vmfs/volumes/VMDataStore1/Rainier-2010-06-22_18-58-43/Rainier-0.vmdk'...
...^MClone: 84% done.Failed to clone disk : Insufficient permission to access file (38).
</code></pre><br>
<br>
you'll notice the issue had nothing to do with the script but more of a <b>permission</b>
 issue on your NFS server. This most likely prevent your backups to go 
though. I would bet that something changed with regards to the 
permissions on your NFS server that allowed the backups to complete 
properly.<br>
<p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-15974"></a>
				<div id="comment-15974" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 12, 2010 6:28 PM
						</span>
							<!--<a href="/people/dkcote9" title="Click to view dkcote9's profile">
<img class="jive-avatar" src="/people/dkcote9/avatar/16.png?a=-1" height="16" width="16" title="Click to view dkcote9's profile" alt="Click to view dkcote9's profile" />
</a>--><a href="http://communities.vmware.com/people/dkcote9" 
id="jive-58j2Cksq0afk4pMG" class="jive-username-link" title="Click to 
view dkcote9's profile">dkcote9</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15948" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-15974">
					Thanks for addressing this, so let me clarify..<br>
<br>
1) Although the error says "permission" I believe it's actually because 
the disk is full (it happens at the same point in the copy every time 
and the first 83 files all are occupying the full 2GB. <br>
<br>
2) I am the only one with access to the NFS server (Windows Box) and its
 WSFU NFS configuration and nothing changed over the weekend while I was
 away to make it suddenly work. (I know - that's weird).<br>
<br>
I realize this is not an issue with the script, but rather with either 
the NFS server or VMWare itself.  I am mostly interested to see if 
anyone has ever experienced the same problem with 2gbsparse file copies 
so that I might get some insight into what is happening...<br>
<br>
Thanks!
					</p>
				</div>
				<a name="comments-16002"></a>
				<div id="comment-16002" class="jive-content-comment ">
					<span>
						<span>
							Jul 15, 2010 5:54 PM
						</span>
							<!--<a href="/people/roberthobson" title="Click to view roberthobson's profile">
<img class="jive-avatar" src="/people/roberthobson/avatar/16.png?a=-1" height="16" width="16" title="Click to view roberthobson's profile" alt="Click to view roberthobson's profile" />
</a>--><a href="http://communities.vmware.com/people/roberthobson" 
id="jive-n33jlT5BaypR41qr" class="jive-username-link" title="Click to 
view roberthobson's profile">roberthobson</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16002">
					/ghettoVCB # vmware -v<br>
VMware ESXi 4.0.0 build-208167<br>
<br>
==========================================================================================<br>
Running this command...<br>
<br>
/ghettoVCB # ./ghettoVCB.sh -f vms_to_backup<br>
<br>
where vms_to_backup has 1 host in it to test<br>
<br>
==========================================================================================<br>
<br>
Here is the output...<br>
<br>
==========================================================================================<br>
./ghettoVCB.sh: line 15: SNAPSHOT_TIMEOUT: not found<br>
./ghettoVCB.sh: line 16: LOG_LEVEL: not found<br>
./ghettoVCB.sh: line 17: BACKUP_LOG_OUTPUT: not found<br>
sh: 1: unknown operand<br>
2010-07-15 19:36:24 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-07-15 19:36:24 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/datastore1/backups/<br>
2010-07-15 19:36:24 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-07-15 19:36:24 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-07-15_19-36-24<br>
2010-07-15 19:36:24 -- info: CONFIG - DISK_BACKUP_FORMAT =<br>
2010-07-15 19:36:24 -- info: CONFIG - ADAPTER_FORMAT =<br>
2010-07-15 19:36:24 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-07-15 19:36:24 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-07-15 19:36:24 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-07-15 19:36:24 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-07-15 19:36:24 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-07-15 19:36:24 -- info: CONFIG - LOG_LEVEL = info<br>
2010-07-15 19:36:24 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-07-15 19:36:24 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-07-15 19:36:24 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-07-15 19:36:24 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
<br>
sh: 1: unknown operand<br>
2010-07-15 19:36:27 -- info: Initiate backup for sync.domain.local<br>
2010-07-15 19:36:27 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-07-15" for sync.domain.local<br>
2010-07-15 19:36:31 -- info: Removing snapshot from sync.domain.local 
...<br>
2010-07-15 19:36:37 -- info: Backup Duration: 10 Seconds<br>
2010-07-15 19:36:37 -- info: Successfully completed backup for 
sync.domain.local!<br>
<br>
sh: 1: unknown operand<br>
2010-07-15 19:36:37 -- info: ###### Final status: All VMs backed up OK! 
######<br>
<br>
2010-07-15 19:36:37 -- info: ============================== ghettoVCB 
LOG END ================================<br>
<br>
==========================================================================================<br>
</p><p>
Check the location...  All I see is the vmx - where's the beef?  <img 
class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":)" border="0"><br>
</p><p>
ls -alh 
/vmfs/volumes/datastore1/backups/sync.domain.local/sync.domain.local-2010-07-15_19-24-31/<br>
drwxr-xr-x    1 root     root          420 Jul 15 19:24 .<br>
drwxr-xr-x    1 root     root          560 Jul 15 19:36 ..<br>
-rwxr-xr-x    1 root     root         2.9k Jul 15 19:24 
sync.domain.local.vmx<br>
<br>
==========================================================================================<br>
</p><p>
I see the "sh: 1: unknown operand" errors...  Am i missing something?  
my guess is it is looking for a command that does not exist?<br>
<br>
-R
					</p>
				</div>
				<a name="comments-15983"></a>
				<div id="comment-15983" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 15, 2010 10:31 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-t7xBeLDJtw19bGFn" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16002" title="Go to message">roberthobson</a>
							</em>
					</span>
					<p id="comment-body-15983">
					Looks like the script was either edited incorrectly or there's some
 syntax errors as you should not be seeing those "unknown operand". Try 
to re-download the script and extract the contents on the ESXi host if 
you are not doing that already.<br>
<br>
Please take a look at FAQ #0 and #1<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16023"></a>
				<div id="comment-16023" class="jive-content-comment ">
					<span>
						<span>
							Jul 20, 2010 3:45 AM
						</span>
							<!--<a href="/people/JanWalti" title="Click to view JanWalti's profile">
<img class="jive-avatar" src="/people/JanWalti/avatar/16.png?a=-1" height="16" width="16" title="Click to view JanWalti's profile" alt="Click to view JanWalti's profile" />
</a>--><a href="http://communities.vmware.com/people/JanWalti" 
id="jive-XqAn1PUNRC0QSzju" class="jive-username-link" title="Click to 
view JanWalti's profile">JanWalti</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16023">
					Hi,<br>
<br>
i just tried to backup and then restore some of my VMs. I have ESXi 4.0 
installed and after a restart all my backup scripts and configs were 
gone! I asked google and it told me:<br>
<br>
"Because the in-memory file system does not persist when the power is 
shut down, log files do not survive a reboot. ESXi has the ability to 
configure a remote syslog server, enabling you to save all log 
information on an external system."<br>
<br>
My Question: Is it even possible to use GhettoVCB if all the files are 
deleted after a reboot?<br>
<br>
Thank you for your answers!
					</p>
				</div>
				<a name="comments-15993"></a>
				<div id="comment-15993" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 22, 2010 7:11 AM
						</span>
							<!--<a href="/people/hyperguru" title="Click to view hyperguru's profile">
<img class="jive-avatar" src="/people/hyperguru/avatar/16.png?a=-1" height="16" width="16" title="Click to view hyperguru's profile" alt="Click to view hyperguru's profile" />
</a>--><a href="http://communities.vmware.com/people/hyperguru" 
id="jive-1UyiN7UGKztzm7Y2" class="jive-username-link" title="Click to 
view hyperguru's profile">hyperguru</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16023" title="Go to message">JanWalti</a>
							</em>
					</span>
					<p id="comment-body-15993">
					Dear Jan<br>
<br>
If you search through this page for rc.local you'll see a reference 
explaining what you need to do. So long as you put the backup script 
somewhere under /vmfs/volumes/datastore1 then it won't get deleted (this
 is where the vm's are also stored in a standard local setup).
					</p>
				</div>
				<a name="comments-15994"></a>
				<div id="comment-15994" class="jive-content-comment ">
					<span>
						<span>
							Jul 22, 2010 7:29 AM
						</span>
							<!--<a href="/people/JanWalti" title="Click to view JanWalti's profile">
<img class="jive-avatar" src="/people/JanWalti/avatar/16.png?a=-1" height="16" width="16" title="Click to view JanWalti's profile" alt="Click to view JanWalti's profile" />
</a>--><a href="http://communities.vmware.com/people/JanWalti" 
id="jive-8Y2QDbTVBB7384F5" class="jive-username-link" title="Click to 
view JanWalti's profile">JanWalti</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15993" title="Go to message">hyperguru</a>
							</em>
					</span>
					<p id="comment-body-15994">
					Dear hyperguru,<br>
<br>
thank you for your answer but I already figured it out myself.<br>
<br>
FYI, I figured out a way to start the backups and restores from a 
windows server with scheduled tasks and WinSCP. WinSCP has a quite good 
way to get this done, if someone's interested heres the link:<br>
<br>
<a class="jive-link-external" 
href="http://winscp.net/eng/docs/scripting#using_scripting">http://winscp.net/eng/docs/scripting#using_scripting</a>
					</p>
				</div>
				<a name="comments-16048"></a>
				<div id="comment-16048" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 23, 2010 12:39 AM
						</span>
							<!--<a href="/people/letsgovirtual" title="Click to view letsgovirtual's profile">
<img class="jive-avatar" src="/people/letsgovirtual/avatar/16.png?a=-1" height="16" width="16" title="Click to view letsgovirtual's profile" alt="Click to view letsgovirtual's profile" />
</a>--><a href="http://communities.vmware.com/people/letsgovirtual" 
id="jive-UC0pEktBqx5Jq40p" class="jive-username-link" title="Click to 
view letsgovirtual's profile">letsgovirtual</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16048">
					Hi there,<br>
<br>
I am having trouble backing up some machines on ESXi 4.0.<br>
The message I get is<br>
2010-07-23 07:31:11 -- info: Backup Duration: 0 Seconds<br>
and really there is nothing done. <img class="jive-emoticon" 
src="DOC-8760_files/sad.gif" alt=":(" border="0"><br>
<br>
Other machines on the same host get backed up normally.<br>
Anyone any idea?
					</p>
				</div>
				<a name="comments-16050"></a>
				<div id="comment-16050" class="jive-content-comment ">
					<span>
						<span>
							Jul 23, 2010 1:14 AM
						</span>
							<!--<a href="/people/letsgovirtual" title="Click to view letsgovirtual's profile">
<img class="jive-avatar" src="/people/letsgovirtual/avatar/16.png?a=-1" height="16" width="16" title="Click to view letsgovirtual's profile" alt="Click to view letsgovirtual's profile" />
</a>--><a href="http://communities.vmware.com/people/letsgovirtual" 
id="jive-6nI5gz691l2D2Qfh" class="jive-username-link" title="Click to 
view letsgovirtual's profile">letsgovirtual</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16048" title="Go to message">letsgovirtual</a>
							</em>
					</span>
					<p id="comment-body-16050">
					found a solution (workaround) myself.<br>
<br>
This problem is caused by the "Independent" setting of the HDD of the 
VM.<br>
<br>
Looks like an "undocumented feature" or do I miss any parameter in the 
configuration?<br>
I am using the latest version of the script and it surprises me that 
there is a comment like this<br>
"Fixes: Independent disk aware " in the changelog for 11/17/09<br>
<br>
Anyone any idea?
					</p>
				</div>
				<a name="comments-16082"></a>
				<div id="comment-16082" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 27, 2010 8:32 AM
						</span>
							<!--<a href="/people/azsysteam" title="Click to view azsysteam's profile">
<img class="jive-avatar" src="/people/azsysteam/avatar/16.png?a=-1" height="16" width="16" title="Click to view azsysteam's profile" alt="Click to view azsysteam's profile" />
</a>--><a href="http://communities.vmware.com/people/azsysteam" 
id="jive-40gNnDnAz6Csga28" class="jive-username-link" title="Click to 
view azsysteam's profile">azsysteam</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16082">
					I would like to know whether it is possible to have two 
configuration file for both online snapshot or powered off vm because I 
have a configuration which will take snapshot if the VMs are power on. 
However sometimes if we shutdown the VM accidentally and we use the 
online configuration. The snapshot of powered off vm will fail and the 
backup of that vm fails too. I wonder if we can check the power status 
of a VM and switch to suitable settings. Eg. there are 5 vms and 4 are 
powered on and one is powered off. when we run the backup, it will 
snapshot those 4 vms and skip snapshot of powered off one. Thanks
					</p>
				</div>
				<a name="comments-16071"></a>
				<div id="comment-16071" class="jive-content-comment ">
					<span>
						<span>
							Jul 30, 2010 3:58 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-BnBxCKDSfBlX2sxk" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16071">
					Hi lamw<br>
<br>
I tested your new feature: email backup logs<br>
I cannot help remarking that usage netcat is briliant idea.<br>
However I identified that it has problem with my SMTP server (Lotus 
Domino)<br>
I analyzed it and I think that I found reason and solution.<br>
It will work correctly after adding of characters for new line and 
carriage return in command echo,<br>
i.e. <br>
echo -n -e "HELO $(hostname -s)\r\n" &gt;&gt; "${EMAIL_LOG_OUTPUT}" <br>
echo -n -e "MAIL FROM: &lt;${EMAIL_FROM}&gt;\r\n" &gt;&gt; 
"${EMAIL_LOG_OUTPUT}"<br>
etc.<br>
<br>
For more information: <br>
<a class="jive-link-external" 
href="http://fixunix.com/security/17957-telnet-vs-netcat.html">http://fixunix.com/security/17957-telnet-vs-netcat.html</a><br>
<br>
Please, will you do adequate changes in your ghetto script in your free 
time?<br>
Thanks<br>
<br>
P.S.<br>
Can you extend global configuration for definition log file?<br>
If yes and if it supports variables, your script will be perfect...
					</p>
				</div>
				<a name="comments-16107"></a>
				<div id="comment-16107" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 30, 2010 8:43 AM
						</span>
							<!--<a href="/people/w1ll1ng" title="Click to view w1ll1ng's profile">
<img class="jive-avatar" src="/people/w1ll1ng/avatar/16.png?a=-1" height="16" width="16" title="Click to view w1ll1ng's profile" alt="Click to view w1ll1ng's profile" />
</a>--><a href="http://communities.vmware.com/people/w1ll1ng" 
id="jive-lIHN5t3vBrLCqsDk" class="jive-username-link" title="Click to 
view w1ll1ng's profile">w1ll1ng</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16071" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16107">
					Hi all,<br>
<br>
Does anyone know where I can view <br>
Detail instructions on how to configure/schedule ghettoVCB on Windows 
(Raj Perumal's The World Runs on Technology Blog):<br>
 The inserted hyperlinks go to site that doesn't compliment whats 
stated.  Thanks
					</p>
				</div>
				<a name="comments-16073"></a>
				<div id="comment-16073" class="jive-content-comment ">
					<span>
						<span>
							Jul 30, 2010 9:55 AM
						</span>
							<!--<a href="/people/AlainSpineux" title="Click to view AlainSpineux's profile">
<img class="jive-avatar" src="/people/AlainSpineux/avatar/16.png?a=-1" height="16" width="16" title="Click to view AlainSpineux's profile" alt="Click to view AlainSpineux's profile" />
</a>--><a href="http://communities.vmware.com/people/AlainSpineux" 
id="jive-tr9AkFuL8WQOvh9f" class="jive-username-link" title="Click to 
view AlainSpineux's profile">AlainSpineux</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16107" title="Go to message">w1ll1ng</a>
							</em>
					</span>
					<p id="comment-body-16073">
					What about the use of MKBackup ? <a class="jive-link-external" 
href="http://www.magikmon.com/mkbackup/ghettovcb.html">http://www.magikmon.com/mkbackup/ghettovcb.html</a>
					</p>
				</div>
				<a name="comments-16074"></a>
				<div id="comment-16074" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Jul 30, 2010 10:15 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-pj6GGbbvA6YqlKMI" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16107" title="Go to message">w1ll1ng</a>
							</em>
					</span>
					<p id="comment-body-16074">
					Hm, it looks like Raj's blog no longer exists. He did have a very 
nice write up, perhaps you can find it via Google Cache<br>
<br>
In the meantime, if you know how to execute the script using plink, then
 you can just setup a normal schedule task in Windows. I'm not a Windows
 expert, so can't provide all the details but I'm sure you find plenty 
of information about plink &amp; windows scheduler online<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16120"></a>
				<div id="comment-16120" class="jive-content-comment ">
					<span>
						<span>
							Jul 30, 2010 9:17 PM
						</span>
							<!--<a href="/people/w1ll1ng" title="Click to view w1ll1ng's profile">
<img class="jive-avatar" src="/people/w1ll1ng/avatar/16.png?a=-1" height="16" width="16" title="Click to view w1ll1ng's profile" alt="Click to view w1ll1ng's profile" />
</a>--><a href="http://communities.vmware.com/people/w1ll1ng" 
id="jive-iDpuTpYX3xYfgGAT" class="jive-username-link" title="Click to 
view w1ll1ng's profile">w1ll1ng</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16074" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16120">
					Hi,<br>
<br>
I am testing this script atm. I am currently running it from datastore1.
  My vms are in datastore3.  My dry run works fine along with other conf
 like exclusion list etc. I will want to try global -g, I configured the
 the sample conf and put the path to it but no work.  I am using a 
netapp box and conf with nfs as backup destination.  I think i setup the
 nfs share wrong, I made it only at the vol level (vol/vol1), I didn't 
associate a qtree to compliment nfs path. None of the less nfs is 
enabled and with root privilige read write access and I put the share 
path in the script conf. I will re try with a qtree. During the backup I
 checked connections on the netapp box and didn't see any from the esxi 
host to the box nor did I see calls. My real question is that I ran a 
backup and it ran successful.  Where did the backups go?; the logs don't
 output destination. I didn't get chance to check a couple things but 
what do you think or adivce, see log below:<br>
<br>
/vmfs/volumes/4ba20621-11d5b991-3893-001b2150a7fe/ghettoVCB # 
./ghettoVCB.sh -a -e vm_exclusion_list<br>
2002-02-14 01:46:04 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2002-02-14 01:46:04 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/datastore3/RYANS_BACKUPS<br>
2002-02-14 01:46:04 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 5<br>
2002-02-14 01:46:04 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2002-02-14_01-46-04<br>
2002-02-14 01:46:04 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>
2002-02-14 01:46:04 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2002-02-14 01:46:04 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2002-02-14 01:46:04 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2002-02-14 01:46:04 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2002-02-14 01:46:04 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2002-02-14 01:46:04 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2002-02-14 01:46:04 -- info: CONFIG - LOG_LEVEL = info<br>
2002-02-14 01:46:04 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2002-02-14 01:46:04 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2002-02-14 01:46:04 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2002-02-14 01:46:04 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
2002-02-14 01:46:04 -- info: CONFIG - EMAIL_LOG = 0<br>
2002-02-14 01:46:04 -- info: <br>
<br>
2002-02-14 01:46:07 -- info: Initiate backup for Windows Server 2003 Lab
 DNS<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore3/Windows Server 2003 Lab 
DNS/Windows Server 2003 Lab DNS.vmdk'...<br>
Clone: 43% done.#exclusion list<br>
Clone: 49% done.T=vm_exclusion_list<br>
2002-02-14 01:48:55 -- info: Backup Duration: 2.80 Minutes<br>
2002-02-14 01:48:55 -- info: Successfully completed backup for Windows 
Server 2003 Lab DNS!<br>
<br>
2002-02-14 01:48:56 -- info: Initiate backup for XP Client1<br>
Destination disk format: VMFS thin-provisioned<br>
Cloning disk '/vmfs/volumes/datastore3/XP Client1/XP Client1.vmdk'...<br>
Clone: 85% done.<br>
2002-02-14 01:52:17 -- info: Backup Duration: 3.35 Minutes<br>
2002-02-14 01:52:17 -- info: Successfully completed backup for XP 
Client1!<br>
<br>
2002-02-14 01:52:17 -- info: ###### Final status: All VMs backed up OK! 
######<br>
<br>
2002-02-14 01:52:17 -- info: ============================== ghettoVCB 
LOG END ==
					</p>
				</div>
				<a name="comments-16101"></a>
				<div id="comment-16101" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 2, 2010 11:26 PM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-nmIA5BIN4KhJUNc3" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16071" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16101">
					Hi lamw,<br>
read you my post form 30.7.2010 12:58 ?<br>
Can you tell me your opinion ?<br>
Thanks.
					</p>
				</div>
				<a name="comments-16135"></a>
				<div id="comment-16135" class="jive-content-comment ">
					<span>
						<span>
							Aug 3, 2010 10:03 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Bitp1W335gt65s7x" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16101" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16135">
					Please take a look at FAQ #0 and #1 before posting.<br>
</p><p>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16131"></a>
				<div id="comment-16131" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 3, 2010 12:58 PM
						</span>
							<!--<a href="/people/JonWeatherhead" title="Click to view JonWeatherhead's profile">
<img class="jive-avatar" src="/people/JonWeatherhead/avatar/16.png?a=-1" height="16" width="16" title="Click to view JonWeatherhead's profile" alt="Click to view JonWeatherhead's profile" />
</a>--><a href="http://communities.vmware.com/people/JonWeatherhead" 
id="jive-W14AxOu6SQ9N2mDO" class="jive-username-link" title="Click to 
view JonWeatherhead's profile">JonWeatherhead</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16131">
					William, <br>
Thanks for all of your hard work on this.<br>
I actually did take the time to read all the posts here (it took 3 
days... no joke).  Several people asked how to kill this script if 
needed.  If I remember right the prescribed way was to kill crond.  And I
 found that if you were running it manually you would need to kill ash. 
 Even though killing the script just leaves a mess that you have to go 
back and clean up, I would still feel better if there was a more 
specific way to kill the script.<br>
<br>
I have added this to your script:<br>
echo $$ &gt; /var/run/ghetto.pid<br>
<br>
This way I can find the process ID for the script and kill it off if 
necessary.  <br>
Is there any possibility something like this could find its way into 
your script?<br>
I'm working with ESXi 4.1 so I don't know if this syntax would work for 
all of the supported versions or not... Although I suspect it would.
					</p>
				</div>
				<a name="comments-16113"></a>
				<div id="comment-16113" class="jive-content-comment ">
					<span>
						<span>
							Aug 4, 2010 1:10 AM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-AwS22u12UXMdX8RB" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16131" title="Go to message">JonWeatherhead</a>
							</em>
					</span>
					<p id="comment-body-16113">
					Hello William, <br>
I am running your script since about 2 years now. Thanks a lot. 
Yesterday I updated the script to latest version to fix this NFS IO 
error while rotating the name, which sometimes oc. So config files etc. 
nothing changed. About 12 VMs are backuped well but two had a problem. 
Dryrun is ok and real backup is also starting. At about 70% it stops. No
 error ,  nothing. Also nothing to find in esx logs at this time. I did a
 backup with shutdown the VM. The only difference to other VMs is the 
size (about 200GB ). Source and dest. are both NFS and with your older 
script it worked without problems.<br>
Anything what I could do ?<br>
<a class="jive-link-external" href="http://pastebin.com/KHYXP9BF">http://pastebin.com/KHYXP9BF</a>
					</p>
				</div>
				<a name="comments-16137"></a>
				<div id="comment-16137" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2010 3:12 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-AW5nRwHC69Fb0N8i" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16113" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-16137">
					Hello shechtl<br>
I have similar problem as you.  Backup stop randomly without error, 
sometimes it finish in 89%, another time or other VM in 99%, never in 
100%.<br>
What do you use version? ESX classic or ESXi? 4.0 or 4.1?
					</p>
				</div>
				<a name="comments-16138"></a>
				<div id="comment-16138" class="jive-content-comment ">
					<span>
						<span>
							Aug 4, 2010 3:25 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-nfDOVVG0t4pzxHGp" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16135" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16138">
					Hi lamw,<br>
excuse me, but I don't see the reason why I have to take look at FAQ. I 
know that netcat (nc) have problem send email on any SMTP servers.<br>
You try read over this link: <a class="jive-link-external" 
href="http://fixunix.com/security/17957-telnet-vs-netcat.html">http://fixunix.com/security/17957-telnet-vs-netcat.html</a><br>
Thanks.
					</p>
				</div>
				<a name="comments-16139"></a>
				<div id="comment-16139" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2010 3:30 AM
						</span>
							<!--<a href="/people/shechtl" title="Click to view shechtl's profile">
<img class="jive-avatar" src="/people/shechtl/avatar/16.png?a=-1" height="16" width="16" title="Click to view shechtl's profile" alt="Click to view shechtl's profile" />
</a>--><a href="http://communities.vmware.com/people/shechtl" 
id="jive-1ARvgDl4brw5fkqi" class="jive-username-link" title="Click to 
view shechtl's profile">shechtl</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16137" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16139">
					I use esxi 4.0 build 261974, both problematic VMs are the last VMs 
in my backup vmlist (maybe thats a problem)
					</p>
				</div>
				<a name="comments-16140"></a>
				<div id="comment-16140" class="jive-content-comment ">
					<span>
						<span>
							Aug 4, 2010 4:14 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-G9mjVfFz3dU6mB3F" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16139" title="Go to message">shechtl</a>
							</em>
					</span>
					<p id="comment-body-16140">
					I guees that problem lies in the use of command vmkfstools.<br>
New version of script have different definition for log file...<br>
Perhaps in combination with NFS destination it not working well...
					</p>
				</div>
				<a name="comments-16114"></a>
				<div id="comment-16114" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2010 6:21 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-H1MQxgHcfyiL1qba" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16120" title="Go to message">w1ll1ng</a>
							</em>
					</span>
					<p id="comment-body-16114">
					Please take a look at FAQ #0 and #1 before posting.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16115"></a>
				<div id="comment-16115" class="jive-content-comment ">
					<span>
						<span>
							Aug 4, 2010 6:25 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-L7FjQHF921apgJJp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16138" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16115">
					@vlho, my apologies, the comment was meant for @w1ll1ng<br>
<br>
I thought I had replied to you but perhaps I might have gotten that 
mixed up with another thread. In any case, I've taken a look at your 
suggestions and is still testing the changes out. As mentioned in the 
documentation this is an experimental feature and provided as-is. 
Hopefully the fix will work for your email server along with others but 
it was expected that a few users will not be able to get this working 
depending on how their mail servers were configured. Also as an FYI, 
this was tested on generic Postfix installation and it works and I've 
also gotten confirmation from other users for the feature working on 
their mail servers. <br>
<br>
I just want to make sure users are aware that this is not the only 
script I manage, I have more than 100+ and this is all done out of my 
free time. <br>
<br>
I probably won't have the time to release an update before VMworld, this
 may probably come after. There are a few other things I wanted to add 
as well. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16141"></a>
				<div id="comment-16141" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2010 8:31 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-39Lw4h667bVvK7Fs" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16115" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16141">
					Hi lamw,<br>
thanks for your response, I'd like to remark that I did not want to push
 you, I was just asking.<br>
<br>
And now about problem with unfinished backup.<br>
I think that I know where's error.<br>
In script is this row:<br>
${VMKFSTOOLS_CMD} -i ... &gt; "${VMDK_OUTPUT}" $2&gt;&amp;1<br>
<br>
Redirect to $2&gt;&amp;1 ?  $2 ?<br>
I'd say that correctly is only 2&gt;&amp;1 without symbol "$" which 
indicates variable ($2 means second command line parameter)<br>
Right?
					</p>
				</div>
				<a name="comments-16134"></a>
				<div id="comment-16134" class="jive-content-comment ">
					<span>
						<span>
							Aug 4, 2010 8:48 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-2gA43f9QMW1glw0s" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16141" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16134">
					@vlho<br>
<br>
Yep, that looks like a problem but should not affect the actual backup. 
I'll get that fix in the next release. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16150"></a>
				<div id="comment-16150" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2010 8:51 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-3pksDX06BFhHvbwY" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16131" title="Go to message">JonWeatherhead</a>
							</em>
					</span>
					<p id="comment-body-16150">
					@JonWeatherhead<br>
<br>
Yep, that's a fair request. Though I don't want to rely on the actual 
filesystem to store the pid as it potentially could be removed by some 
other process (unlikely) but what I can do is capture and output the PID
 within the logs or stdout, depending on how you have your logging 
setup. This should help you identify the PID that is running and allow 
you to kill it<br>
<br>
I'll add this to the backlog along with the other fixes/features<br>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16142"></a>
				<div id="comment-16142" class="jive-content-comment ">
					<span>
						<span>
							Aug 4, 2010 9:37 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-EuqYuB7ko64NVeN8" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16134" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16142">
					Hi lamw,<br>
you had the right, I tested script with removed $ a clone finished in 
99% again.<br>
I tried remove complete string for redirection, i.e. &gt; 
"${VMDK_OUTPUT}" 2&gt;&amp;1 and now backup work well.<br>
However I do not know why.<br>
Note:<br>
I run script manualy with parameters: -f ... and -g ... without -l ...
					</p>
				</div>
				<a name="comments-16143"></a>
				<div id="comment-16143" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 4, 2010 9:53 PM
						</span>
							<!--<a href="/people/w1ll1ng" title="Click to view w1ll1ng's profile">
<img class="jive-avatar" src="/people/w1ll1ng/avatar/16.png?a=-1" height="16" width="16" title="Click to view w1ll1ng's profile" alt="Click to view w1ll1ng's profile" />
</a>--><a href="http://communities.vmware.com/people/w1ll1ng" 
id="jive-nHc35i6K6KLk0C07" class="jive-username-link" title="Click to 
view w1ll1ng's profile">w1ll1ng</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16142" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16143">
					Hi,<br>
<br>
I am testing the script with nfs share as destination.  The script works
 fine so with regard to backing up but can someone please explain why 
the dry run and log output of the backup went smooth and I can also 
verify the vm at the destination but i keep getting this duplicate name 
error even though it works see below:<br>
<br>
(vim.fault.DuplicateName) {<br>
   dynamicType = &lt;unset&gt;, <br>
   faultCause = (vmodl.MethodFault) null, <br>
   name = "metnetapp", <br>
   object = 'vim.Datastore:192.168.10.31:/vol/vol1/VMBACKUP', <br>
   msg = "The name 'metnetapp' already exists."<br>
<br>
metnetapp is the name of my NFS server and I  used it for the 
NFS_LOCAL_NAME  in configs. One thing to note, on the first run of the 
script it did not show error. Does anyone have solution to this, thanks<br>
<br>
Update, i realize that I am now seeing this error <br>
<br>
2010-08-05 19:15:57 -- info: Initiate backup for XP Client1<br>
2010-08-05 19:15:57 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-08-05" for XP Client1<br>
DISKLIB-LIB   : Unable to get file system ID for filename 
"/vol/vol1/VMBACKUP/XP Client1/XP Client1-2010-08-05_19-15-55/XP 
Client1.vmdk"<br>
Failed to clone disk : File too large (1769481)<br>
<br>
I realize that this does not happen at all when using vmfs local storage
 as destination backup it works gr8, only with nfs, I really want to use
 the nfs to function properly<br>
Advice plz!!
					</p>
				</div>
				<a name="comments-16144"></a>
				<div id="comment-16144" class="jive-content-comment ">
					<span>
						<span>
							Aug 5, 2010 9:21 PM
						</span>
							<!--<a href="/people/Hackie" title="Click to view Hackie's profile">
<img class="jive-avatar" src="/people/Hackie/avatar/16.png?a=-1" height="16" width="16" title="Click to view Hackie's profile" alt="Click to view Hackie's profile" />
</a>--><a href="http://communities.vmware.com/people/Hackie" 
id="jive-RWX8qj967xMEbozl" class="jive-username-link" title="Click to 
view Hackie's profile">Hackie</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16144">
					Hi lamw,<br>
<br>
the following BUG / ERROR occurs when trying to backup VMware machines 
which names contain letters I've put in parentheses, here:<br>
<br>
2010-08-06 03:26:33 -- info: Successfully completed backup for Debian 
NS3 Name Server!<br>
--&gt; this one works containing "only" blanks and letters.<br>
<br>
2010-08-06 03:26:33 -- info: ERROR: failed to locate and extract VM_ID 
for Debian BROADCAST Server 1 (libamentum)!<br>
--&gt; this one fails, containing parantheses.<br>
<br>
Do you have an idea how to fix this issue?<br>
<br>
Thanks for your feedback,<br>
-Florian
					</p>
				</div>
				<a name="comments-16155"></a>
				<div id="comment-16155" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 6, 2010 1:11 PM
						</span>
							<!--<a href="/people/w1ll1ng" title="Click to view w1ll1ng's profile">
<img class="jive-avatar" src="/people/w1ll1ng/avatar/16.png?a=-1" height="16" width="16" title="Click to view w1ll1ng's profile" alt="Click to view w1ll1ng's profile" />
</a>--><a href="http://communities.vmware.com/people/w1ll1ng" 
id="jive-08zYam7Jx2GHg0BS" class="jive-username-link" title="Click to 
view w1ll1ng's profile">w1ll1ng</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16144" title="Go to message">Hackie</a>
							</em>
					</span>
					<p id="comment-body-16155">
					Ok lamw,<br>
<br>
I got the your scripts to work stable. I was getting those intermittent 
issues mentioned above with name already exists and file too large 
sometimes. <br>
<br>
That was whilst going direct to the nfs store using the NFS option in 
the script. I realized when using local stores it worked perfect.  So 
instead of using nfs direct I mounted the nfs as a store so I could 
backup similar to vmfs.  Works excellent along with cron as well.<br>
<br>
I also used your ghetto restore script and it works excellent as well. I
 really appreciate your scripts m8<br>
<br>
Is it possible to restore to a resource pool directly instead of 
manually sliding it back?
					</p>
				</div>
				<a name="comments-16191"></a>
				<div id="comment-16191" class="jive-content-comment ">
					<span>
						<span>
							Aug 10, 2010 5:27 AM
						</span>
							<!--<a href="/people/AlainSpineux" title="Click to view AlainSpineux's profile">
<img class="jive-avatar" src="/people/AlainSpineux/avatar/16.png?a=-1" height="16" width="16" title="Click to view AlainSpineux's profile" alt="Click to view AlainSpineux's profile" />
</a>--><a href="http://communities.vmware.com/people/AlainSpineux" 
id="jive-3mmDYEtoNHIy2K95" class="jive-username-link" title="Click to 
view AlainSpineux's profile">AlainSpineux</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16144" title="Go to message">Hackie</a>
							</em>
					</span>
					<p id="comment-body-16191">
					Hi Hackie<br>
You can easily rename your VM from inside your VSphere client. <br>
Remove parenthesis and avoid spaces !<br>
I already did it myself without any issue.<br>
<br>
Alain
					</p>
				</div>
				<a name="comments-16215"></a>
				<div id="comment-16215" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 15, 2010 4:13 AM
						</span>
							<!--<a href="/people/Hackie" title="Click to view Hackie's profile">
<img class="jive-avatar" src="/people/Hackie/avatar/16.png?a=-1" height="16" width="16" title="Click to view Hackie's profile" alt="Click to view Hackie's profile" />
</a>--><a href="http://communities.vmware.com/people/Hackie" 
id="jive-vuMHib95k9OWelXT" class="jive-username-link" title="Click to 
view Hackie's profile">Hackie</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16191" title="Go to message">AlainSpineux</a>
							</em>
					</span>
					<p id="comment-body-16215">
					Hi Alain,<br>
<br>
thanks for your advice:<br>
Renaming the VM from inside the VSphere client by replacing parenthesis 
by underscores did the trick here, too <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":-)" border="0"><br>
<br>
Spaces/Blanks seem to work without any issue or do you know of any 
further trouble using spaces/blanks for the VM name?<br>
<br>
-Florian
					</p>
				</div>
				<a name="comments-16225"></a>
				<div id="comment-16225" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2010 1:38 PM
						</span>
							<!--<a href="/people/smcsupport" title="Click to view smcsupport's profile">
<img class="jive-avatar" src="/people/smcsupport/avatar/16.png?a=-1" height="16" width="16" title="Click to view smcsupport's profile" alt="Click to view smcsupport's profile" />
</a>--><a href="http://communities.vmware.com/people/smcsupport" 
id="jive-9V9Dv4QENC5s585T" class="jive-username-link" title="Click to 
view smcsupport's profile">smcsupport</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16225">
					Thank you so much for such a great resource!<br>
<br>
Your script works wonderfully; what I'm having issues with is starting 
and stopping the cron daemon in ESXi 4.1.0. Logged in as root, I'm 
using:<br>
<br>
kill $(cat /var/run/crond.pid)<br>
<br>
which returns:<br>
<br>
"ash: cannot kill pid 438824: No such process"<br>
<br>
The command is obviously pulling the process ID from the location, but I
 am unable to kill the process. This effectively eliminates my ability 
to run the script on a schedule, from the server itself. I wondered if 
perhaps VMware changed the user cron runs under, disallowing the root 
(?!) from being able to kill the process. I tried running the "su" 
command first, and was able to kill the process <b>once</b>. However, 
the service appeared to automatically restart with a different PID, and 
could not be killed subsequently, even after issuing the "su" command.<br>
<br>
Any advise you could give would be mucho appreciated.<br>
<br>
Thanks, again!
					</p>
				</div>
				<a name="comments-16218"></a>
				<div id="comment-16218" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2010 1:49 PM
						</span>
							<!--<a href="/people/w1ll1ng" title="Click to view w1ll1ng's profile">
<img class="jive-avatar" src="/people/w1ll1ng/avatar/16.png?a=-1" height="16" width="16" title="Click to view w1ll1ng's profile" alt="Click to view w1ll1ng's profile" />
</a>--><a href="http://communities.vmware.com/people/w1ll1ng" 
id="jive-u5F08oPxCUV5hq0h" class="jive-username-link" title="Click to 
view w1ll1ng's profile">w1ll1ng</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16225" title="Go to message">smcsupport</a>
							</em>
					</span>
					<p id="comment-body-16218">
					Hi,<br>
<br>
I usually find the process by using the same command you used<br>
'#cat /var/run/crond.pid'<br>
which shows the process id e.g '12345'<br>
<br>
then I kill it<br>
'kill 12345'<br>
<br>
then restart it<br>
'busybox crond'<br>
<br>
which should give you a new id, hope this helps
					</p>
				</div>
				<a name="comments-16209"></a>
				<div id="comment-16209" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2010 1:54 PM
						</span>
							<!--<a href="/people/vmbru" title="Click to view vmbru's profile">
<img class="jive-avatar" src="/people/vmbru/avatar/16.png?a=-1" height="16" width="16" title="Click to view vmbru's profile" alt="Click to view vmbru's profile" />
</a>--><a href="http://communities.vmware.com/people/vmbru" 
id="jive-oa3UBRz1mu6a9Gb6" class="jive-username-link" title="Click to 
view vmbru's profile">vmbru</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16225" title="Go to message">smcsupport</a>
							</em>
					</span>
					<p id="comment-body-16209">
					smcsupport,<br>
<br>
Would killing the PID (aka ghettovcbg2 process) cleanly stop the backup 
job and remove snapshot created, etc...?<br>
<br>
We use a pre script that executes backup at 6pm and ONLY if previous job
 is completed.  It would be nice to specify a backup window and 
ghettovcbg2 know to stop/cleanup and end task at 7am.  Only VDR 1.2 from
 vmWare has this that I know of.
					</p>
				</div>
				<a name="comments-16226"></a>
				<div id="comment-16226" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2010 1:56 PM
						</span>
							<!--<a href="/people/smcsupport" title="Click to view smcsupport's profile">
<img class="jive-avatar" src="/people/smcsupport/avatar/16.png?a=-1" height="16" width="16" title="Click to view smcsupport's profile" alt="Click to view smcsupport's profile" />
</a>--><a href="http://communities.vmware.com/people/smcsupport" 
id="jive-ne50hhra2t4Pt7jm" class="jive-username-link" title="Click to 
view smcsupport's profile">smcsupport</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16218" title="Go to message">w1ll1ng</a>
							</em>
					</span>
					<p id="comment-body-16226">
					That is exactly what "kill $(cat /var/run/crond.pid)" does. If I 
break it out into two separate commands, I get the same results. It <b>does</b>
 give me the PID; but when I try to kill that PID, it tells me there is 
no such process.
					</p>
				</div>
				<a name="comments-16219"></a>
				<div id="comment-16219" class="jive-content-comment ">
					<span>
						<span>
							Aug 16, 2010 2:13 PM
						</span>
							<!--<a href="/people/w1ll1ng" title="Click to view w1ll1ng's profile">
<img class="jive-avatar" src="/people/w1ll1ng/avatar/16.png?a=-1" height="16" width="16" title="Click to view w1ll1ng's profile" alt="Click to view w1ll1ng's profile" />
</a>--><a href="http://communities.vmware.com/people/w1ll1ng" 
id="jive-hBzD8lpf94sM6xB7" class="jive-username-link" title="Click to 
view w1ll1ng's profile">w1ll1ng</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16226" title="Go to message">smcsupport</a>
							</em>
					</span>
					<p id="comment-body-16219">
					because its probably killed already, check the processes running 
after u re enable the busy box (ps), should be new id
					</p>
				</div>
				<a name="comments-16240"></a>
				<div id="comment-16240" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 16, 2010 2:21 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-T86BVPX1B6ShFBWp" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16225" title="Go to message">smcsupport</a>
							</em>
					</span>
					<p id="comment-body-16240">
					There's a possibility that the pid file may still exists but the 
actual cron daemon is no longer running.<br>
<br>
Can you run "ps | grep -i crond" and see if anything returns? <br>
<br>
If it does not, then you can start cron by running "crond". <br>
</p><p>
As FYI - In the next release, I'll be providing the PID of the ghettoVCB
 script in the logs if users need to stop the script for whatever 
reason. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16220"></a>
				<div id="comment-16220" class="jive-content-comment ">
					<span>
						<span>
							Aug 17, 2010 2:24 AM
						</span>
							<!--<a href="/people/yxcvyxcv" title="Click to view yxcvyxcv's profile">
<img class="jive-avatar" src="/people/yxcvyxcv/avatar/16.png?a=-1" height="16" width="16" title="Click to view yxcvyxcv's profile" alt="Click to view yxcvyxcv's profile" />
</a>--><a href="http://communities.vmware.com/people/yxcvyxcv" 
id="jive-yVfOel1mTB0EQGzC" class="jive-username-link" title="Click to 
view yxcvyxcv's profile">yxcvyxcv</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16220">
					hi,<br>
a backup on the local disk works fine<br>
i get an error if i backup on a nfs share: Failed to clone disk : The 
called function cannot be performed on partial chains. Please open the 
parent virtual disk (5).<br>
</p><p>
my config:<br>
VM_BACKUP_VOLUME=/vmfs/volumes/test/<br>
DISK_BACKUP_FORMAT=zeroedthick<br>
VM_BACKUP_ROTATION_COUNT=1<br>
POWER_VM_DOWN_BEFORE_BACKUP=0<br>
ENABLE_HARD_POWER_OFF=0<br>
ITER_TO_WAIT_SHUTDOWN=3<br>
POWER_DOWN_TIMEOUT=5<br>
ENABLE_COMPRESSION=0<br>
ADAPTER_FORMAT=lsilogic<br>
VM_SNAPSHOT_MEMORY=0<br>
VM_SNAPSHOT_QUIESCE=0<br>
ENABLE_NON_PERSISTENT_NFS=1<br>
UNMOUNT_NFS=0<br>
NFS_SERVER=x.x.x.x<br>
NFS_MOUNT=/vmfs/volumes/vmnpvstore/backup/<br>
NFS_LOCAL_NAME=backup<br>
NFS_VM_BACKUP_DIR=backups<br>
<br>
my NFS config:<br>
/vmfs/volumes/vmnpvstore/backup/ 
x.x.x.x(rw,async,all_squash,anonuid=99,anongid=99)<br>
</p><p>
thx
					</p>
				</div>
				<a name="comments-16230"></a>
				<div id="comment-16230" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 17, 2010 8:36 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-Em94cV35L3pJFq00" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16220" title="Go to message">yxcvyxcv</a>
							</em>
					</span>
					<p id="comment-body-16230">
					This is an issue with the VMDK(s) for this specific VM - Here is a 
thread that may help - <a class="jive-link-thread" 
href="http://communities.vmware.com/thread/221208">failed to extend disk
 the called function cannot be performed on partial chains please open 
the parent virtual disk</a><br>
<br>
I suggest you take a look at the VM to see if it had any snapshots in 
the past, generally chains are referring to snapshot chains.<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16231"></a>
				<div id="comment-16231" class="jive-content-comment ">
					<span>
						<span>
							Aug 17, 2010 10:33 PM
						</span>
							<!--<a href="/people/gregtjones" title="Click to view gregtjones's profile">
<img class="jive-avatar" src="/people/gregtjones/avatar/16.png?a=-1" height="16" width="16" title="Click to view gregtjones's profile" alt="Click to view gregtjones's profile" />
</a>--><a href="http://communities.vmware.com/people/gregtjones" 
id="jive-X690Klptm62Tzr4a" class="jive-username-link" title="Click to 
view gregtjones's profile">gregtjones</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16231">
					Firstly, thanks for an excellent piece of code.   I do have an 
issue with it not being fully rsync friendly due to the directory name 
changing, even with a rotation of 1.  This directory name change forces a
 complete recopy of what rsync sees as a new directory with new files in
 it and of course deletes the previous directory on the destination.<br>
<br>
What I would desperately like is a code change that does the following:<br>
<br>
Suggest the following changes:<br>
<br>
Variables<br>
</p><ul class="jive-dash">
<li>VM_Backup_Rotation_count =1</li>
<li>RSYNC_Friendly = 1</li>
</ul>
<br>
Script logic change.<hr>
Objective: Backs up to the same name directory (full path) each and 
every time. No Date or time stamp in the path.  eg.   Propose 
VM_BACKUP_VOLUM/VM_NAME/RSYNC/...     This path is the only path that 
you would normally see except for the duration that the script runs...  
as per below.<br>
<br>
How<br>
<hr>
<ul class="jive-dash">
<li>When creating the script it creates new backup in </li>
</ul>
/VM_BACKUP_VOLUM/VM_NAME/YYYY_MM_DD HH:MM:SS/.........   <br>
<ul class="jive-dash">
<li>When new backup is complete.</li>
</ul>
   - Remove RSYNC dir.<br>
  - Rename YYYY_MM__DD HH:MM:SS directory to be RSYNC<br>
<br>
Thanks in advance for any guidance/changes.
					
				</div>
				<a name="comments-16251"></a>
				<div id="comment-16251" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 17, 2010 11:26 PM
						</span>
							<!--<a href="/people/yxcvyxcv" title="Click to view yxcvyxcv's profile">
<img class="jive-avatar" src="/people/yxcvyxcv/avatar/16.png?a=-1" height="16" width="16" title="Click to view yxcvyxcv's profile" alt="Click to view yxcvyxcv's profile" />
</a>--><a href="http://communities.vmware.com/people/yxcvyxcv" 
id="jive-9Kc23TK5UBJ1jJHk" class="jive-username-link" title="Click to 
view yxcvyxcv's profile">yxcvyxcv</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16230" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16251">
					hi,<br>
there is no snapshot on the vm. i only get the error if i backup to a 
nfs (the nfs is on another ESX4 host)<br>
when i backup on local disk everything works fine.<br>
<br>
thx
					</p>
				</div>
				<a name="comments-16252"></a>
				<div id="comment-16252" class="jive-content-comment ">
					<span>
						<span>
							Aug 17, 2010 11:34 PM
						</span>
							<!--<a href="/people/AlainSpineux" title="Click to view AlainSpineux's profile">
<img class="jive-avatar" src="/people/AlainSpineux/avatar/16.png?a=-1" height="16" width="16" title="Click to view AlainSpineux's profile" alt="Click to view AlainSpineux's profile" />
</a>--><a href="http://communities.vmware.com/people/AlainSpineux" 
id="jive-FFsUJQ9fEnff6qSL" class="jive-username-link" title="Click to 
view AlainSpineux's profile">AlainSpineux</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16231" title="Go to message">gregtjones</a>
							</em>
					</span>
					<p id="comment-body-16252">
					Hi <br>
<br>
If you have only one directory in the "backup" directory, you can use 
the "shell wildcard " expansion.<br>
<br>
I mean , instead of  using this command<br>
</p><div class="jive-quote"># rsync -av /source/backup/  /target/</div>
use instead :<br>
<div class="jive-quote"># rsync -av /source/backup/*/  /target/</div>
<br>
If their is only one directory in  /source/backup/, then whatever its 
name, its content will be synced into /target<br>
<br>
You dont need to change the script.<br>
<br>
Anyway William could create a symbolic name  called  "last" pointing 
always to the last backup. <br>
This is easy and would help a lot.<br>
<br>
Regards.
					
				</div>
				<a name="comments-16232"></a>
				<div id="comment-16232" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 17, 2010 11:59 PM
						</span>
							<!--<a href="/people/gregtjones" title="Click to view gregtjones's profile">
<img class="jive-avatar" src="/people/gregtjones/avatar/16.png?a=-1" height="16" width="16" title="Click to view gregtjones's profile" alt="Click to view gregtjones's profile" />
</a>--><a href="http://communities.vmware.com/people/gregtjones" 
id="jive-X3qs8NSKEnVdXNoP" class="jive-username-link" title="Click to 
view gregtjones's profile">gregtjones</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16252" title="Go to message">AlainSpineux</a>
							</em>
					</span>
					<p id="comment-body-16232">
					Appreciate the quick response to my query.   <br>
<br>
Being useless at Unix, I'm using a NAS appliance that simply requests 
nominating a 'share' on one NAS (where ghettoVCB backs up to) which it 
rsyncs to a share on a destination NAS appliance.  I'm not comfortable 
using rsync at the shell level level to do wild card rsyncing and would 
like to continue to use standard appliance GUI for rsync config..<br>
<br>
The symbolic linking idea is a     GREAT IDEA   though,   if it works. <br>
<br>
If RSYNC will in fact sync a 'linked to file/files' you could then 
simply set a flag in the script (for dummys like me who run appliance 
NASes) which creates a directory at the same level as the time stamped 
ones called (for example) "Last Backup".  This would be symbolicly 
linked to the directory containing the last backup.   I would then rsync
 that 'Last Backup" directory to the remote location. <br>
<br>
Would this work?
					</p>
				</div>
				<a name="comments-16234"></a>
				<div id="comment-16234" class="jive-content-comment ">
					<span>
						<span>
							Aug 18, 2010 9:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-5i65YfTkgP7eRmJe" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16232" title="Go to message">gregtjones</a>
							</em>
					</span>
					<p id="comment-body-16234">
					@gregtjones <br>
<br>
I would have to agree with Alain, symlink would be the best option and 
what I was thinking if this were to be implemented. Remember, this 
script is not meant to fit every single backup use case and there has 
not been a huge request for rsync support. Generally, feature request 
will be dictated by the amount of feedback I get as it's work that needs
 to be done both updating the script and testing. <br>
<br>
What I would suggest is that you use ghettoVCB and do a normal backup, 
then manually create a symlink to the backup with the date. Then run 
rsync to see if it'll pick up the changes and you may want to do this 
for few additional backups and update the symlink pointer. If this 
works, I'll consider this for a feature release which most likely will 
be a flag that'll dynamically create a "common" symlink that is based 
ont he VM's name.<br>
<br>
Thanks<br>
</p><p>
How you can help - <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/p/how-you-can-help.html">http://www.virtuallyghetto.com/p/how-you-can-help.html</a><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16235"></a>
				<div id="comment-16235" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 18, 2010 9:33 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-GbfwjGk5M4of006U" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16251" title="Go to message">yxcvyxcv</a>
							</em>
					</span>
					<p id="comment-body-16235">
					There may have been a snapshot in the past, in any case, this is 
not an issue with the script. <br>
<br>
If you can manually do a vmkfstools copy on the VMDK w/o issues, then 
the script should work. I would recommend you try that and setting up 
the destination on both local VMFS volume + NFS and see if the problem 
is the same as if you ran the script. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16224"></a>
				<div id="comment-16224" class="jive-content-comment ">
					<span>
						<span>
							Aug 19, 2010 3:09 AM
						</span>
							<!--<a href="/people/Thuizt" title="Click to view Thuizt's profile">
<img class="jive-avatar" src="/people/Thuizt/avatar/16.png?a=-1" height="16" width="16" title="Click to view Thuizt's profile" alt="Click to view Thuizt's profile" />
</a>--><a href="http://communities.vmware.com/people/Thuizt" 
id="jive-g852QtUi96z7o4ad" class="jive-username-link" title="Click to 
view Thuizt's profile">Thuizt</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16235" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16224">
					Why in the world is it so hard to make a normal link to the 
download location of this script.<br>
I might be a complete moron but am searching now over half an hour to 
find the script that can be downloaded and of which:<br>
<br>
"The latest version is available on this page at the bottom"<br>
<br>
Finding the script seems to be harder than getting the script to run <img
 class="jive-emoticon" src="DOC-8760_files/happy.gif" alt=":-)" 
border="0"><br>
<br>
There are even two FAQ's (14 &amp; 19) dedicated to finding the script 
so probably I'm not the only moron here.
					</p>
				</div>
				<a name="comments-16237"></a>
				<div id="comment-16237" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 19, 2010 8:44 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-r7scxQ2XlST6cCqO" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16224" title="Go to message">Thuizt</a>
							</em>
					</span>
					<p id="comment-body-16237">
					Hello,<br>
<br>
I know the document is long, but if you carefully go through it, you'll 
see that the download is located at the very bottom. As you mentioned, 
FAQ #14 and #19 tells you exactly where the download is but some people 
still miss it. <br>
<br>
Here is a screenshot if you still can not locate it - <a 
class="jive-link-external" 
href="http://img337.imageshack.us/img337/9651/picture1tm.png">http://img337.imageshack.us/img337/9651/picture1tm.png</a><br>
<br>
There's only been a few people who have not been able to locate the 
download. I agree it probably could be place in a better location but I 
have ZERO control over this as it's regulated by the JIVE forum 
software. <br>
<br>
Thanks<br>
</p><p>
</p><p>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16256"></a>
				<div id="comment-16256" class="jive-content-comment ">
					<span>
						<span>
							Aug 20, 2010 3:06 AM
						</span>
							<!--<a href="/people/Whtiy" title="Click to view Whtiy's profile">
<img class="jive-avatar" src="/people/Whtiy/avatar/16.png?a=-1" height="16" width="16" title="Click to view Whtiy's profile" alt="Click to view Whtiy's profile" />
</a>--><a href="http://communities.vmware.com/people/Whtiy" 
id="jive-OSrt2dCfRaS9qyix" class="jive-username-link" title="Click to 
view Whtiy's profile">Whtiy</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16256">
					Hi<br>
<br>
Wanted to exclude one single VMDK from a machine, but did not found how 
to do it. It's listed in the features list:<br>
</p><ul class="jive-dash">
<li>Ability to include/exclude specific VMDK(s) per VM (requires 
individual VM backup policy setup)</li>
</ul>
<br>
Don't want to do an include list, because, if i add a new disk to the VM
 and forget to add it to the include list, it is not backed up. And that
 could end ins some troubles...<br>
<br>
Thanks<br>
Urs
					
				</div>
				<a name="comments-16239"></a>
				<div id="comment-16239" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 20, 2010 6:40 AM
						</span>
							<!--<a href="/people/tohe" title="Click to view tohe's profile">
<img class="jive-avatar" src="/people/tohe/avatar/16.png?a=-1" height="16" width="16" title="Click to view tohe's profile" alt="Click to view tohe's profile" />
</a>--><a href="http://communities.vmware.com/people/tohe" 
id="jive-RTEvo3u0uwGDHctq" class="jive-username-link" title="Click to 
view tohe's profile">tohe</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16239">
					Hi William,<br>
<br>
do you have plams to implement an OVF option, I mean backup the VMs in 
OVF?
					</p>
				</div>
				<a name="comments-16285"></a>
				<div id="comment-16285" class="jive-content-comment ">
					<span>
						<span>
							Aug 20, 2010 7:22 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-05KR1Mu16Qr83Vi1" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16256" title="Go to message">Whtiy</a>
							</em>
					</span>
					<p id="comment-body-16285">
					Yes this is a feature that is supported, please take a look at the 
documentation for an example. Specifically search for "Backup policy for
 "VCAP" (backup only 2 specific VMDKs)" and you'll see an example of the
 VM backup policy file that is required to backup individual VMDKs<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16286"></a>
				<div id="comment-16286" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 20, 2010 7:26 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-nqGClXzI8lmEll31" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16239" title="Go to message">tohe</a>
							</em>
					</span>
					<p id="comment-body-16286">
					No plans, remember that we're still running the script in either 
the classic ESX Service Console or ESXi's Busybox console. There is no 
support for the ovftool and it may install on classic ESX, though it 
definitely won't install on ESXi. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16318"></a>
				<div id="comment-16318" class="jive-content-comment ">
					<span>
						<span>
							Aug 22, 2010 3:10 AM
						</span>
							<!--<a href="/people/ralfoertner" title="Click to view ralfoertner's profile">
<img class="jive-avatar" src="/people/ralfoertner/avatar/16.png?a=-1" height="16" width="16" title="Click to view ralfoertner's profile" alt="Click to view ralfoertner's profile" />
</a>--><a href="http://communities.vmware.com/people/ralfoertner" 
id="jive-elvewa91jbO1O145" class="jive-username-link" title="Click to 
view ralfoertner's profile">ralfoertner</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16138" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16318">
					Hello!<br>
<br>
Having mails of the3 logs would be a very interesting feature for me. <br>
But how do I set it up?<br>
I filled all the fields mail server and so on.<br>
But where must netcat be placed on the esxi?<br>
If yes in which directory?<br>
And what version must be used?<br>
A fedora or can it also be a debian?<br>
Is it true I have to upgrade to esxi 4.1 (I'm using 4.0 now)?<br>
<br>
Thank you for your help!<br>
Ralf  Oertner
					</p>
				</div>
				<a name="comments-16319"></a>
				<div id="comment-16319" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 22, 2010 11:33 PM
						</span>
							<!--<a href="/people/Whtiy" title="Click to view Whtiy's profile">
<img class="jive-avatar" src="/people/Whtiy/avatar/16.png?a=-1" height="16" width="16" title="Click to view Whtiy's profile" alt="Click to view Whtiy's profile" />
</a>--><a href="http://communities.vmware.com/people/Whtiy" 
id="jive-UU0AblI8tx86fP2N" class="jive-username-link" title="Click to 
view Whtiy's profile">Whtiy</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16285" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16319">
					Hello William<br>
<br>
</p><div class="jive-quote">Specifically search for "Backup policy for 
"VCAP" (backup only 2 specific VMDKs)" and you'll see an example of the 
VM backup policy file that is required to backup individual VMDKs</div>
<br>
Thats exactly what i don't want. The example is about making a list of 
files to include (Only backup the VMDK's which are in the list). I need 
(would like to have) a list of VMDK's to <b>exclude</b> from being 
backed up. Backup all VMDK's except the ones in the list.<br>
<br>
Thanks<br>
Urs
					
				</div>
				<a name="comments-16320"></a>
				<div id="comment-16320" class="jive-content-comment ">
					<span>
						<span>
							Aug 23, 2010 8:28 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-63tW5fHpmhWNu7PL" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16319" title="Go to message">Whtiy</a>
							</em>
					</span>
					<p id="comment-body-16320">
					Sorry, to do what you're asking for you'll need to specify VMDKs 
you wish to backup, any that are not listed will not be backed up. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16358"></a>
				<div id="comment-16358" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 24, 2010 1:47 AM
						</span>
							<!--<a href="/people/RSW-Orga" title="Click to view RSW-Orga's profile">
<img class="jive-avatar" src="/people/RSW-Orga/avatar/16.png?a=-1" height="16" width="16" title="Click to view RSW-Orga's profile" alt="Click to view RSW-Orga's profile" />
</a>--><a href="http://communities.vmware.com/people/RSW-Orga" 
id="jive-Rq918D9KBfOk4uwr" class="jive-username-link" title="Click to 
view RSW-Orga's profile">RSW-Orga</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16358">
					Hello William,<br>
<br>
i experimented with your backup script(07/27/2010). i worked very well. 
but i found a little bug and made the email a little prettier.<br>
Hope this is the right way to send you this bugreport<br>
Here is the patch to fix it:<br>
<a class="jive-link-external" href="http://pastebin.com/g4WfvUXd">http://pastebin.com/g4WfvUXd</a><br>
<br>
Thanks,<br>
Dieter
					</p>
				</div>
				<a name="comments-16326"></a>
				<div id="comment-16326" class="jive-content-comment ">
					<span>
						<span>
							Aug 24, 2010 8:57 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-lIcqlosAtWsLioaP" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16358" title="Go to message">RSW-Orga</a>
							</em>
					</span>
					<p id="comment-body-16326">
					@RSW-Orga Much appreciated. I'll take a look after VMworld, 
definitely planning a minor release with few features + fixes. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16329"></a>
				<div id="comment-16329" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 25, 2010 2:22 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-G5UUXq07S6hU7aW7" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16329">
					I noticed the latest version of the script has a mail option. You 
may be interested in this mail script I wrote:<br>
<br>
<a class="jive-link-external" href="http://pastebin.com/zBUkKhzp">http://pastebin.com/zBUkKhzp</a><br>
<br>
I call it from a nightly buildbot (you could call it from cron). It 
produces  a concise email of which hosts were backed up and which 
couldn't be (snaphots). You will need to modify it for your local setup.
					</p>
				</div>
				<a name="comments-16370"></a>
				<div id="comment-16370" class="jive-content-comment ">
					<span>
						<span>
							Aug 25, 2010 12:05 PM
						</span>
							<!--<a href="/people/nsrugis" title="Click to view nsrugis's profile">
<img class="jive-avatar" src="/people/nsrugis/avatar/16.png?a=-1" height="16" width="16" title="Click to view nsrugis's profile" alt="Click to view nsrugis's profile" />
</a>--><a href="http://communities.vmware.com/people/nsrugis" 
id="jive-x8WmAV80LNcRhj8O" class="jive-username-link" title="Click to 
view nsrugis's profile">nsrugis</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16370">
					Does anyone know how to stagger the backups of a ghettovcb script? I
 looked through the comments and googled it with no luck. I have 5 
guests on 2 hosts and want to back them all up using ghettoVCB and cron.
 Thanks!<br>
<br>
Nate
					</p>
				</div>
				<a name="comments-16371"></a>
				<div id="comment-16371" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Aug 26, 2010 7:34 AM
						</span>
							<!--<a href="/people/spitzmann2" title="Click to view spitzmann2's profile">
<img class="jive-avatar" src="/people/spitzmann2/avatar/16.png?a=-1" height="16" width="16" title="Click to view spitzmann2's profile" alt="Click to view spitzmann2's profile" />
</a>--><a href="http://communities.vmware.com/people/spitzmann2" 
id="jive-Jn1Fcb97F18VkCvd" class="jive-username-link" title="Click to 
view spitzmann2's profile">spitzmann2</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16371">
					I'd like to store VM backups in another ESXi host directly. the 
GhettoVCB  script has an option to store backups in another computer by 
NFS. How can I use that for an ESXi host destination ?<br>
<br>
What's the best way to deal with VM backups when there's no "entherprise
 class" solution around ? I only have two servers running ESXi 4.1 and a
 USB mass storage with 500GB. What can I do to make a good backup 
solution with that ?
					</p>
				</div>
				<a name="comments-16437"></a>
				<div id="comment-16437" class="jive-content-comment ">
					<span>
						<span>
							Aug 30, 2010 2:59 AM
						</span>
							<!--<a href="/people/AdiNugraha" title="Click to view AdiNugraha's profile">
<img class="jive-avatar" src="/people/AdiNugraha/avatar/16.png?a=-1" height="16" width="16" title="Click to view AdiNugraha's profile" alt="Click to view AdiNugraha's profile" />
</a>--><a href="http://communities.vmware.com/people/AdiNugraha" 
id="jive-33oM1R1Mg8pzRH1u" class="jive-username-link" title="Click to 
view AdiNugraha's profile">AdiNugraha</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16437">
					Hi, can anyone explain the DISK_BACKUP_FORMAT parameter ? I'm 
trying to create thin disk backups but all the backup I did using the 
script comes out as thick disks..
					</p>
				</div>
				<a name="comments-16450"></a>
				<div id="comment-16450" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 1, 2010 12:56 AM
						</span>
							<!--<a href="/people/HMuster" title="Click to view HMuster's profile">
<img class="jive-avatar" src="/people/HMuster/avatar/16.png?a=-1" height="16" width="16" title="Click to view HMuster's profile" alt="Click to view HMuster's profile" />
</a>--><a href="http://communities.vmware.com/people/HMuster" 
id="jive-V92jluXR8eSUo7x9" class="jive-username-link" title="Click to 
view HMuster's profile">HMuster</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-15962" title="Go to message">jayclen</a>
							</em>
					</span>
					<p id="comment-body-16450">
					Hi jayclen,<br>
<br>
I've experienced the same problem with ESXi 3.5 U5. I almost became 
desperate, but then I saw your hint and it works fine. Thank you!<br>
<br>
Regards
					</p>
				</div>
				<a name="comments-16456"></a>
				<div id="comment-16456" class="jive-content-comment ">
					<span>
						<span>
							Sep 1, 2010 3:23 AM
						</span>
							<!--<a href="/people/eqj" title="Click to view eqj's profile">
<img class="jive-avatar" src="/people/eqj/avatar/16.png?a=-1" height="16" width="16" title="Click to view eqj's profile" alt="Click to view eqj's profile" />
</a>--><a href="http://communities.vmware.com/people/eqj" 
id="jive-wdiv4A93U96pTgfw" class="jive-username-link" title="Click to 
view eqj's profile">eqj</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16456">
					In MKBackup you can specify the name of the VM according to the 
alias in VSphere.  How does this work? And how do you do this by 
executing the ghettoVCB.sh script directly?  There is 
VMDK_FILES_TO_BACKUP but that is the VMDK name and not the alias.
					</p>
				</div>
				<a name="comments-16457"></a>
				<div id="comment-16457" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 1, 2010 11:07 AM
						</span>
							<!--<a href="/people/ccrome" title="Click to view ccrome's profile">
<img class="jive-avatar" src="/people/ccrome/avatar/16.png?a=-1" height="16" width="16" title="Click to view ccrome's profile" alt="Click to view ccrome's profile" />
</a>--><a href="http://communities.vmware.com/people/ccrome" 
id="jive-wiagMQ36iI9Q5S8q" class="jive-username-link" title="Click to 
view ccrome's profile">ccrome</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16457">
					For anybody having the following problem:<br>
<br>
info: ERROR: failed to locate and extract VM_ID for &lt;vm name&gt;<br>
<br>
I found that on my setup, my line endings in my vms-to-backup file got 
translated to DOS style CRLF, so there were extra ^M at the end of the 
line.  This caused the script grep of /tmp/vms_list to fail.  The line 
in the script was:<br>
<br>
                VM_ID=`grep -E "\"${VM_NAME}\"" /tmp/vms_list | awk -F 
";" '{print $1}' | sed 's/"//g'`<br>
<br>
but since VM_NAME had a ^M in it, the grep failed.<br>
<br>
The simple solution was to translate the line endings back to unix 
style, and everything worked just fine.
					</p>
				</div>
				<a name="comments-16445"></a>
				<div id="comment-16445" class="jive-content-comment ">
					<span>
						<span>
							Sep 3, 2010 8:36 AM
						</span>
							<!--<a href="/people/BinarySolo" title="Click to view BinarySolo's profile">
<img class="jive-avatar" src="/people/BinarySolo/avatar/16.png?a=-1" height="16" width="16" title="Click to view BinarySolo's profile" alt="Click to view BinarySolo's profile" />
</a>--><a href="http://communities.vmware.com/people/BinarySolo" 
id="jive-60BxDizX2Qin5lkf" class="jive-username-link" title="Click to 
view BinarySolo's profile">BinarySolo</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16326" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-16445">
					Hi William,<br>
<br>
This has worked nicely for me - many thanks. One question though:<br>
<br>
I notice that the EVENTS tab in the esxi client does not display 
information regarding the backup being performed. Is this what you would
 expect or does the absence of events indicate a problem with my backup?<br>
<br>
Thanks,<br>
<br>
Peter
					</p>
				</div>
				<a name="comments-16488"></a>
				<div id="comment-16488" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 8, 2010 4:01 AM
						</span>
							<!--<a href="/people/JEJensen" title="Click to view JEJensen's profile">
<img class="jive-avatar" src="/people/JEJensen/avatar/16.png?a=-1" height="16" width="16" title="Click to view JEJensen's profile" alt="Click to view JEJensen's profile" />
</a>--><a href="http://communities.vmware.com/people/JEJensen" 
id="jive-mSFQJRHQhuOAxfJU" class="jive-username-link" title="Click to 
view JEJensen's profile">JEJensen</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-12068" title="Go to message">DSTAVERT</a>
							</em>
					</span>
					<p id="comment-body-16488">
					GhettoVBC on ESX(i) 4.1.0 give the same messages<br>
You're not running ESX(i) 3.5+ or 4.0+!<br>
Any solution for this ?
					</p>
				</div>
				<a name="comments-16512"></a>
				<div id="comment-16512" class="jive-content-comment ">
					<span>
						<span>
							Sep 8, 2010 9:23 AM
						</span>
							<!--<a href="/people/chrb" title="Click to view chrb's profile">
<img class="jive-avatar" src="/people/chrb/avatar/16.png?a=-1" height="16" width="16" title="Click to view chrb's profile" alt="Click to view chrb's profile" />
</a>--><a href="http://communities.vmware.com/people/chrb" 
id="jive-6n6z0GuQhBhH6qn0" class="jive-username-link" title="Click to 
view chrb's profile">chrb</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16488" title="Go to message">JEJensen</a>
							</em>
					</span>
					<p id="comment-body-16512">
					You have an old version of ghettovcb. The new versions work with 
ESXi 4.1.
					</p>
				</div>
				<a name="comments-16490"></a>
				<div id="comment-16490" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 8, 2010 1:43 PM
						</span>
							<!--<a href="/people/yulena" title="Click to view yulena's profile">
<img class="jive-avatar" src="/people/yulena/avatar/16.png?a=-1" height="16" width="16" title="Click to view yulena's profile" alt="Click to view yulena's profile" />
</a>--><a href="http://communities.vmware.com/people/yulena" 
id="jive-dRJjtLaB5yYJyoJ0" class="jive-username-link" title="Click to 
view yulena's profile">yulena</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16490">
					Hi, thanks for the Script is nice,  well  .....  ,  i have a issue 
when i try to backup 2 VM.<br>
I have a file with the names of the VM and we use the cron for execute 
the script, but only backup the first VM of the file, if we change the 
order of the name then backup only the first, and in the log at the end 
say" delete the snap of VMNAME ......", but dont show the intention to 
try to do the other snap.<br>
<br>
I will like to know if there is something to do to fix my problem.<br>
<br>
Thank for any help.<br>
<br>
See u.
					</p>
				</div>
				<a name="comments-16517"></a>
				<div id="comment-16517" class="jive-content-comment ">
					<span>
						<span>
							Sep 9, 2010 5:08 AM
						</span>
							<!--<a href="/people/JEJensen" title="Click to view JEJensen's profile">
<img class="jive-avatar" src="/people/JEJensen/avatar/16.png?a=-1" height="16" width="16" title="Click to view JEJensen's profile" alt="Click to view JEJensen's profile" />
</a>--><a href="http://communities.vmware.com/people/JEJensen" 
id="jive-AT7iYjk4fT1DAj00" class="jive-username-link" title="Click to 
view JEJensen's profile">JEJensen</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16512" title="Go to message">chrb</a>
							</em>
					</span>
					<p id="comment-body-16517">
					You're not running ESX(i) 3.5+ or 4.0+!<br>
<br>
And ghettovcb-restore.sh do you have a solution for this script ?
					</p>
				</div>
				<a name="comments-16592"></a>
				<div id="comment-16592" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 12, 2010 11:27 PM
						</span>
							<!--<a href="/people/GarFin1965" title="Click to view GarFin1965's profile">
<img class="jive-avatar" src="/people/GarFin1965/avatar/16.png?a=-1" height="16" width="16" title="Click to view GarFin1965's profile" alt="Click to view GarFin1965's profile" />
</a>--><a href="http://communities.vmware.com/people/GarFin1965" 
id="jive-NnAtQoabhaxi4StU" class="jive-username-link" title="Click to 
view GarFin1965's profile">GarFin1965</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-16071" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-16592">
					Hi, i had the same problem as you , forwarding to an IIS server, 
which also expected &lt;CR&gt;&lt;LF&gt;<br>
<br>
What i did was use 'sed' to replace &lt;LF&gt; with &lt;CR&gt;&lt;LF&gt;<br>
<br>
Regards<br>
</p><p>
sendMail() {<br>
	#close email message<br>
	if ; then<br>
        	echo "." &gt;&gt; "${EMAIL_LOG_OUTPUT}"<br>
	        echo "QUIT" &gt;&gt; "${EMAIL_LOG_OUTPUT}"<br>
<br>
		sed "s/$/`echo -e \\\r`/" "${EMAIL_LOG_OUTPUT}" &gt; 
"${EMAIL_LOG_OUTPUT}".DOS<br>
		"${NC_BIN}" "${EMAIL_SERVER}" "${EMAIL_SERVER_PORT}" &lt; ".DOS &gt; 
/dev/null 2&gt;&amp;1<br>
		if <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=+%24%3F+-eq+1+">
 $? -eq 1 </a>; then<br>
			logger "info" "ERROR: Failed to email log output to 
${EMAIL_SERVER}:${EMAIL_SERVER_PORT} to ${EMAIL_TO}\n"<br>
		fi<br>
		rm -rf "${EMAIL_LOG_OUTPUT}"<br>
		rm -rf "${EMAIL_LOG_OUTPUT}".DOS<br>
	fi
					</p>
				</div>
				<a name="comments-16571"></a>
				<div id="comment-16571" class="jive-content-comment ">
					<span>
						<span>
							Sep 13, 2010 9:36 AM
						</span>
							<!--<a href="/people/afragola" title="Click to view afragola's profile">
<img class="jive-avatar" src="/people/afragola/avatar/16.png?a=-1" height="16" width="16" title="Click to view afragola's profile" alt="Click to view afragola's profile" />
</a>--><a href="http://communities.vmware.com/people/afragola" 
id="jive-67L0YjQzF2WkyjVh" class="jive-username-link" title="Click to 
view afragola's profile">afragola</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16571">
					Hi. Thank you for your great work <img class="jive-emoticon" 
src="DOC-8760_files/happy.gif" alt=":-)" border="0"><br>
<br>
is there a way to schedule and rotate backup on 2 different directory?<br>
i mean, day 1 it backups on a directory, day 2 on a second directory, 
day 3 backup on directory 1 BUT only if in directory 2 is present 
previous backup, so that backups can be divided on different datastores 
for higher security...<br>
<br>
is it possible to take care of this situation? monitor backup and 
rotation this way?<br>
<br>
thanks for any kind answer
					</p>
				</div>
				<a name="comments-16581"></a>
				<div id="comment-16581" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 15, 2010 1:32 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-9N5Td3egNzKgjLBR" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16571" title="Go to message">afragola</a>
							</em>
					</span>
					<p id="comment-body-16581">
					Hi,<br>
<br>
Rotation is only supported on on directory per VM, this is not a feature
 that I plan on supporting. <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16582"></a>
				<div id="comment-16582" class="jive-content-comment ">
					<span>
						<span>
							Sep 15, 2010 1:34 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-qzthlwEmU0wVLA5j" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-16517" title="Go to message">JEJensen</a>
							</em>
					</span>
					<p id="comment-body-16582">
					The solution is actually pretty simple, I've just not had the time 
to update. Now that VMworld is over, I should be able to get a new 
release of the script. To be honest, the fix is just adding 4.1 build 
number into the script, everything else should stay the same. You can 
take a look at the code that does the version check from ghettoVCB.sh 
and add that to ghettoVCB-restore.sh. <br>
<br>
I don't have the time to verify the restore, but you're more than 
welcome to let me know if you hit any issues and please post anything 
released to ghettoVCB-restore here - <a class="jive-link-wiki" 
href="http://communities.vmware.com/docs/DOC-10595">Ghetto Tech Preview -
 ghettoVCB-restore.sh - Restoring VM's backed up from ghettoVCB to 
ESX(i) 3.5 and 4.x+</a><br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-16584"></a>
				<div id="comment-16584" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 16, 2010 9:31 AM
						</span>
							<!--<a href="/people/waldrondigital" title="Click to view waldrondigital's profile">
<img class="jive-avatar" src="/people/waldrondigital/avatar/16.png?a=-1" height="16" width="16" title="Click to view waldrondigital's profile" alt="Click to view waldrondigital's profile" />
</a>--><a href="http://communities.vmware.com/people/waldrondigital" 
id="jive-m6XlI5Q6GyC8giRp" class="jive-username-link" title="Click to 
view waldrondigital's profile">waldrondigital</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-16584">
					gvlog2em update - Solution for downloading/parsing ghettoVCB backup
 logs in Windows without RCLI:<br>
<br>
I could not get the experimental email feature to work, and I sold the 
NAS/NFS/SMB box from my environment where I used to store the backup 
logs and point my gvlog2em batch file to (SMB).  I added some 
instructions on my blog for using WGET.exe to pull your log files from 
the web-based datastore without needing RCLI tools.  You simply pull the
 log using WGET, place it on your local Windows disk, and then call my 
gvlog2em.bat log parser.  <br>
<br>
Scroll to the bottom of the post where the text is in RED:<br>
<a class="jive-link-external" 
href="http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/">http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/</a>
					</p>
				</div>
				<a name="comments-17018"></a>
				<div id="comment-17018" class="jive-content-comment ">
					<span>
						<span>
							Sep 29, 2010 12:25 AM
						</span>
							<!--<a href="/people/RSW-Orga" title="Click to view RSW-Orga's profile">
<img class="jive-avatar" src="/people/RSW-Orga/avatar/16.png?a=-1" height="16" width="16" title="Click to view RSW-Orga's profile" alt="Click to view RSW-Orga's profile" />
</a>--><a href="http://communities.vmware.com/people/RSW-Orga" 
id="jive-pq6L10c65BA9cn38" class="jive-username-link" title="Click to 
view RSW-Orga's profile">RSW-Orga</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17018">
					Hi<br>
I saw you released a new version 2010-09-28. there is still this little 
bug in line 257:<br>
should be<br>
</p><table class="jive-wiki-table">
<tbody><tr>
<td> awk '{print $1}' </td>
</tr>
</tbody></table>
<br clear="left">

					
				</div>
				<a name="comments-17037"></a>
				<div id="comment-17037" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 29, 2010 6:57 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-fyq7wih5MC83M0QW" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-17018" title="Go to message">RSW-Orga</a>
							</em>
					</span>
					<p id="comment-body-17037">
					Hi RSW-Orga,<br>
<br>
Thanks for making a note of this, this has been fixed and you can 
download the latest version now.<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-17019"></a>
				<div id="comment-17019" class="jive-content-comment ">
					<span>
						<span>
							Sep 29, 2010 7:30 AM
						</span>
							<!--<a href="/people/philled99" title="Click to view philled99's profile">
<img class="jive-avatar" src="/people/philled99/avatar/16.png?a=-1" height="16" width="16" title="Click to view philled99's profile" alt="Click to view philled99's profile" />
</a>--><a href="http://communities.vmware.com/people/philled99" 
id="jive-lgP0hhv8oC409ub2" class="jive-username-link" title="Click to 
view philled99's profile">philled99</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17019">
					Hi. This is a great script, but I have a couple of questions.<br>
<br>
1) I am using the experimental email support and have noticed that the 
email settings in VM specific config files in a separate directory get 
overriden by the email settings in ghettoVCB.sh. Surely the config files
 specified in the directory by -c should take precedence, otherwise 
anyone using the -c option is going to end up spamming you with emails 
(as it's your email details in ghettoVCB.sh by default)?<br>
<br>
2) I can't get the functionality to backup a subset of a VM's VMDK files
 to work. With the setting VMDK_FILES_TO_BACKUP="Ash.vmdk" I get these 
VMDK files backed up:<br>
/vmfs/volumes/4c2b6a95-f03e05a5-9f13-0019bb5303ea/Ash-Samba-Backups/Ash_1_1.vmdk<br>
/vmfs/volumes/4c2b6a90-ce10ce23-db24-0019bb5303ea/Ash-Homes/Ash_1.vmdk<br>
/vmfs/volumes/4c2b6a90-ce10ce23-db24-0019bb5303ea/Ash/Ash.vmdk<br>
<br>
But with the setting VMDK_FILES_TO_BACKUP="Ash.vmdk" I don't get any 
backed up. What am I doing wrong?
					</p>
				</div>
				<a name="comments-17038"></a>
				<div id="comment-17038" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Sep 29, 2010 8:29 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-MvLOlrM39K554LmI" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-17019" title="Go to message">philled99</a>
							</em>
					</span>
					<p id="comment-body-17038">
					Hi Philled99,<br>
<br>
1) Remember when using the -c option, you are <u>only</u> specifying 
specific configuration at a <u>VM</u> level, this has nothing to do with
 global configurations which is contained in either ghettoVCB.conf. 
Email settings is one of the various ghettoVCB global configurations 
which can be controlled directly in the script or specifying a 
configuration file using -g option. Please carefully look over the 
documentation for more details and examples<br>
<br>
2) Please take a look at FAQ #0 and #1 <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-17172"></a>
				<div id="comment-17172" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2010 3:27 AM
						</span>
							<!--<a href="/people/kamal2222ahmed" title="Click to view kamal2222ahmed's profile">
<img class="jive-avatar" src="/people/kamal2222ahmed/avatar/16.png?a=-1" height="16" width="16" title="Click to view kamal2222ahmed's profile" alt="Click to view kamal2222ahmed's profile" />
</a>--><a href="http://communities.vmware.com/people/kamal2222ahmed" 
id="jive-w1wULoiilCsfoG0E" class="jive-username-link" title="Click to 
view kamal2222ahmed's profile">kamal2222ahmed</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-13921" title="Go to message">lamw</a>
							</em>
					</span>
					<p id="comment-body-17172">
					Hi Lam,<br>
<br>
I have read through the whole FAQ and comment section but still have the
 nfs issue even though i created a new NFS share and formatted it as 
XFS.<br>
<br>
Here is the configuration:<br>
Number of VM's = 9<br>
Size of VM to be backed up = 60 GB<br>
VMware ESXi 4.1.0 build-260247<br>
<br>
For execution and dry run, see stdout screen capture at :<br>
<br>
<a class="jive-link-external" href="http://pastebin.com/k5wRJU2S">http://pastebin.com/k5wRJU2S</a><br>
<br>
I would appreciate if anyone can help and resolve this nfs issue once 
and for all.<br>
<br>
Thanks,<br>
-Kamal.
					</p>
				</div>
				<a name="comments-17116"></a>
				<div id="comment-17116" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 6, 2010 5:03 AM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-BTdLs48uAg5Qv1fo" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17116">
					Hello all, using ghettovbc on ESX 4.1 and a Nexenta NFS storage via
 a cron with good success.<br>
<br>
Question is can the script check the target storage space before trying 
to run a backup for a VM? Last night ran out of space and the error 
reported is:<br>
<br>
2010-10-06 00:23:15 -- info: Initiate backup for TRB1<br>
2010-10-06 00:23:16 -- info: ERROR: error in backing up of 
"/vmfs/volumes/nas-store01/TRB1/TRB1.vmdk" for TRB1<br>
2010-10-06 00:23:16 -- info: Backup Duration: 1 Seconds<br>
2010-10-06 00:23:16 -- info: ERROR: Unable to backup TRB1 due to error 
in VMDK backup!<br>
<br>
There is no error on the VMDK, there is just no space on the target NFS 
only.<br>
<br>
Besides this minor issue it works great.<br>
<br>
Also, is the new VM Paravirtual SCSI driver supported?<br>
<br>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-17218"></a>
				<div id="comment-17218" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2010 5:30 AM
						</span>
							<!--<a href="/people/RSW-Orga" title="Click to view RSW-Orga's profile">
<img class="jive-avatar" src="/people/RSW-Orga/avatar/16.png?a=-1" height="16" width="16" title="Click to view RSW-Orga's profile" alt="Click to view RSW-Orga's profile" />
</a>--><a href="http://communities.vmware.com/people/RSW-Orga" 
id="jive-5fmBkI5M43Ft1fGl" class="jive-username-link" title="Click to 
view RSW-Orga's profile">RSW-Orga</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-17116" title="Go to message">NickelNetworks</a>
							</em>
					</span>
					<p id="comment-body-17218">
					i donÂ´t think this kind of check should be part of the script. 
There might be systems that do not behave good when you try to determine
 the free space left. ( Had a problem a few years ago, when a df-command
 took about 30min to finish).<br>
I think it would be better if you could create some pre-run, post-run 
scripts that get called before or after each backup.<br>
With this you should be able to analyse your free disk space and work 
some other magic to make sure the backup will succeed.
					</p>
				</div>
				<a name="comments-17118"></a>
				<div id="comment-17118" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 6, 2010 7:02 AM
						</span>
							<!--<a href="/people/kamal2222ahmed" title="Click to view kamal2222ahmed's profile">
<img class="jive-avatar" src="/people/kamal2222ahmed/avatar/16.png?a=-1" height="16" width="16" title="Click to view kamal2222ahmed's profile" alt="Click to view kamal2222ahmed's profile" />
</a>--><a href="http://communities.vmware.com/people/kamal2222ahmed" 
id="jive-2SS06U3UvH5up0nC" class="jive-username-link" title="Click to 
view kamal2222ahmed's profile">kamal2222ahmed</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-17116" title="Go to message">NickelNetworks</a>
							</em>
					</span>
					<p id="comment-body-17118">
					Hi Paul,<br>
<br>
Is there any notes or documentation, on how to setup Nexenta NFS 
storage. Did you setup Nexenta as a Virtual Machine ? I am using 
openfiler <a class="jive-link-external" href="http://www.openfiler.com/">http://www.openfiler.com/</a><br>
<br>
Thanks,<br>
-Kamal.
					</p>
				</div>
				<a name="comments-17227"></a>
				<div id="comment-17227" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2010 6:58 PM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-t0ieISx756pM0J3n" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-17218" title="Go to message">RSW-Orga</a>
							</em>
					</span>
					<p id="comment-body-17227">
					Perhaps there is a way in the API to check for the total and free 
space. Based on the fact that VMW is moving away from the linux console 
in future releases it probably is a bad idea on relaying on DF or linux 
commands if there is a way via some API to get the same.<br>
</p><p>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-17228"></a>
				<div id="comment-17228" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 6, 2010 7:35 PM
						</span>
							<!--<a href="/people/NickelNetworks" title="Click to view NickelNetworks's profile">
<img class="jive-avatar" src="/people/NickelNetworks/avatar/16.png?a=-1" height="16" width="16" title="Click to view NickelNetworks's profile" alt="Click to view NickelNetworks's profile" />
</a>--><a href="http://communities.vmware.com/people/NickelNetworks" 
id="jive-N1eeYCU3fKCLx2FL" class="jive-username-link" title="Click to 
view NickelNetworks's profile">NickelNetworks</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-17118" title="Go to message">kamal2222ahmed</a>
							</em>
					</span>
					<p id="comment-body-17228">
					Using Nexenta on a regular physical server. This was an HP X1400 
Storage Server which is nothing else than an HP DL 320 G6. I got tired 
of wasting my time with Windows and HP and found Nexenta one day and 
been very impressed with the performance.<br>
<br>
What I did is created a 40 GB partition and installed Nextenta on it. <br>
I also created a larger raid 5 pool for my VM's and a log pool of 6 GB. 
(it is used as a caching thing I guess)<br>
<br>
Then I created the volume using the definitnion I did on the raid 5 
pool. All this is done on the Data Management, Data Sets menus.<br>
<br>
Then on Data Management / Shares I selected Create a New Folder and used
 the following fields.<br>
Name: nas01-vol1/nas-store01 (nas01-vol1 is the volume name created on 
which the pools exist. A volume has the pools and logs)<br>
Folder Name: whatever name you want<br>
Description: whatever description you want<br>
Record Size: 128K<br>
Log BIAS: Latency<br>
Deduplication; off<br>
Compression: off<br>
Number of Copies:1<br>
Case sensitive: mixed<br>
Unicode Only: off<br>
Sync: standard<br>
<br>
Once is created you go back to the Data Management / Shares / Show 
Summary and there you have checkboxes on the right for CIFS, NFS, FTP, 
RSYNC, etc. Check on NFS and then Edit.  On Auth Type I used the first 
option on the Pull Down.<br>
Anonymous is checked (must be checked, but security is disabled or 
controlled by a field called Extra Options later)<br>
<br>
Read-Write: *<br>
Root: @10.5.36.0/24 (this is my local subnet)<br>
Extra Options: anon=0 (this disables anonymous access)<br>
<br>
Then in ESX you add the storage as follows:<br>
<br>
Server: IP of Nexenta<br>
Folder: /volumes/nas01-vol1/nas-store01<br>
Datastore Name: nas-store01<br>
<br>
That is pretty much it.<br>
<br>
Regards,<br>
<br>
Paul Aviles<br>
www.nickelnetworks.com
					</p>
				</div>
				<a name="comments-17233"></a>
				<div id="comment-17233" class="jive-content-comment ">
					<span>
						<span>
							Oct 6, 2010 7:46 PM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-0CazF1FL9v6LMA5I" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-17227" title="Go to message">NickelNetworks</a>
							</em>
					</span>
					<p id="comment-body-17233">
					Hi NickelNetworks,<br>
<br>
I'll have to agree with <b>RSW-Orga</b>, this check should not be part 
of the script. The expectation is that the destination datastore should 
have sufficient space for your backups, after all, these are for your <u>backups</u>.
 Yes, we can perform clever tricks to check for space, but there are 
some down sides as mentioned plus the other issue is how do you check 
for "real" free space? What if systems are thin provisioned? What if the
 storage volume is thin provisioned on the array? What is free space at 
that point? I think this is something that should be monitored from an 
organization and alerted on if you're low on free space and not the job 
of the script. Sounds like there needs to be some monitoring setup for 
your backup datastores if you're running out of space<br>
<br>
Regarding any type of API calls .... remember all operations are 
happening in the Service Console or Busybox Console, we're not using any
 APIs,etc. <br>
<br>
Thanks<br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-17307"></a>
				<div id="comment-17307" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 9, 2010 12:15 PM
						</span>
							<!--<a href="/people/waldrondigital" title="Click to view waldrondigital's profile">
<img class="jive-avatar" src="/people/waldrondigital/avatar/16.png?a=-1" height="16" width="16" title="Click to view waldrondigital's profile" alt="Click to view waldrondigital's profile" />
</a>--><a href="http://communities.vmware.com/people/waldrondigital" 
id="jive-0XHb9R5O4189heno" class="jive-username-link" title="Click to 
view waldrondigital's profile">waldrondigital</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17307">
					Just updated my gvlog2email Windows batch to version 0.99.  The new
 version has built-in functionality to pull the ghettoVCB logfile out a 
datastore using WGET (no need for CLI tools, making it very portable).  
All you need is a Windows machine to run/schedule the task.<br>
<br>
A great way to get notifications of your backup status if the built-in 
functionality of gvcb isn't working for you or is not sufficient for 
your needs.  I use this script personally and at clients - IT WORKS!<br>
<br>
<a class="jive-link-external" 
href="http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/">http://www.waldrondigital.com/2010/05/11/ghettovcb-e-mail-rotate-logs-batch-file-for-vmware/</a>
					</p>
				</div>
				<a name="comments-17848"></a>
				<div id="comment-17848" class="jive-content-comment ">
					<span>
						<span>
							Oct 15, 2010 1:21 AM
						</span>
							<!--<a href="/people/serez" title="Click to view serez's profile">
<img class="jive-avatar" src="/people/serez/avatar/16.png?a=-1" height="16" width="16" title="Click to view serez's profile" alt="Click to view serez's profile" />
</a>--><a href="http://communities.vmware.com/people/serez" 
id="jive-SDfxpMDsheayrRsI" class="jive-username-link" title="Click to 
view serez's profile">serez</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17848">
					hello TS<br>
<br>
i`ve been going through your guide (until comments) since 4days ago  to 
understand how to use this thing. and i think that my problem isnt here 
yet.<br>
<br>
i`m currently testing this script onto esxi 4.1.0 and after configured 
everything i found that no VMs are backed up.<br>
</p><p>
<br>
Log :<br>
<br>
/ghettoVCB # ./ghettoVCB.sh -a<br>
2010-10-15 15:59:13 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-10-15 15:59:13 -- info: CONFIG - GHETTOVCB_PID = 70106<br>
2010-10-15 15:59:13 -- info: CONFIG - VM_BACKUP_VOLUME = /espinBackup<br>
2010-10-15 15:59:13 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-10-15 15:59:13 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-10-15_15-59-13<br>
2010-10-15 15:59:13 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-10-15 15:59:13 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-10-15 15:59:13 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-10-15 15:59:13 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-10-15 15:59:13 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-10-15 15:59:13 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-10-15 15:59:13 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-10-15 15:59:13 -- info: CONFIG - LOG_LEVEL = info<br>
2010-10-15 15:59:13 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-10-15 15:59:13 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-10-15 15:59:13 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-10-15 15:59:13 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
2010-10-15 15:59:13 -- info: CONFIG - EMAIL_LOG = 0<br>
2010-10-15 15:59:13 -- info:<br>
<br>
2010-10-15 15:59:14 -- info: Initiate backup for WinXP Test<br>
2010-10-15 15:59:14 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-10-15" for WinXP Test<br>
<br>
2010-10-15 15:59:17 -- info: ERROR: error in backing up of 
"/vmfs/volumes/datastore1/WinXP Test/WinXP Test.vmdk" for WinXP Test<br>
2010-10-15 15:59:20 -- info: Removing snapshot from WinXP Test ...<br>
2010-10-15 15:59:20 -- info: Backup Duration: 6 Seconds<br>
2010-10-15 15:59:20 -- info: ERROR: Unable to backup WinXP Test due to 
error in VMDK backup!<br>
<br>
2010-10-15 15:59:20 -- info: Initiate backup for OpenSUse Test<br>
2010-10-15 15:59:20 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-10-15" for OpenSUse Test<br>
<br>
2010-10-15 15:59:23 -- info: ERROR: error in backing up of 
"/vmfs/volumes/datastore1/OpenSUse Te<br>
2010-10-15 15:59:27 -- info: Removing snapshot from OpenSUse Test ...<br>
2010-10-15 15:59:27 -- info: Backup Duration: 7 Seconds<br>
2010-10-15 15:59:27 -- info: ERROR: Unable to backup OpenSUse Test due 
to error in VMDK backup!<br>
<br>
2010-10-15 15:59:27 -- info: ###### Final status: ERROR: No VMs backed 
up! ######<br>
<br>
2010-10-15 15:59:27 -- info: ============================== ghettoVCB 
LOG END ==================<br>
</p><p>
can you help me to clarify what is the main problem of this?<br>
thank you
					</p>
				</div>
				<a name="comments-17851"></a>
				<div id="comment-17851" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 15, 2010 5:06 AM
						</span>
							<!--<a href="/people/lamw" title="Click to view lamw's profile">
<img class="jive-avatar" src="/people/lamw/avatar/16.png?a=1174" height="16" width="16" title="Click to view lamw's profile" alt="Click to view lamw's profile" />
</a>--><a href="http://communities.vmware.com/people/lamw" 
id="jive-uACKi23JscNmxEh3" class="jive-username-link" title="Click to 
view lamw's profile">lamw</a>&nbsp;				<img 
src="DOC-8760_files/statusicon-vexpert.gif" title="vExpert" 
alt="vExpert" class="vmware-group-icon">
&nbsp;says:
							<em>
in response to:								<a href="#comments-17848" title="Go to message">serez</a>
							</em>
					</span>
					<p id="comment-body-17851">
					One issue I see is that <b>VM_BACKUP_VOLUME</b> variable needs to 
be the full VMFS path (e.g. /vmfs/volumes/datastore/mybackup_folder, you
 do not have it setup up correctly which is probably why it's failing. 
You probably would get more details by changing the debug level. Try 
updating that and see if you have better success and make sure you go 
through the documentation and look at the example configs to help <br>
</p><p>
<br>
=========================================================================<br>
William Lam<br>
VMware vExpert 2009,2010<br>
VMware VCP3,4<br>
VMware VCAP-DCA4<br>
VMware scripts and resources at: <a class="jive-link-external" 
href="http://www.virtuallyghetto.com/">http://www.virtuallyghetto.com/</a><br>
<a class="jive-link-external" href="http://twitter.com/lamw">Twitter: 
@lamw</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/docs/DOC-9852">vGhetto Script 
Repository</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vma.html">Getting
 Started with the vMA (tips/tricks)</a><br>
<a class="jive-link-external" 
href="http://www.virtuallyghetto.com/2010/05/getting-started-with-vsphere-sdk-for.html">Getting
 Started with the vSphere SDK for Perl</a><br>
<a class="jive-link-community" 
href="http://communities.vmware.com/community/developer/codecentral" 
title="Sample Code for VMware vSphere SDKs and APIs">VMware Code Central
 - Scripts/Sample code for Developers and Administrators</a><br>
<a class="jive-link-external" 
href="http://communities.vmware.com/community/developer">VMware 
Developer Community</a><br>
<br>
<img src="DOC-8760_files/vexpert_silver_icon.jpg" 
alt="http://engineering.ucsb.edu/~duonglt/vmware/vexpert_silver_icon.jpg"
 class="jive-image"><br>
<br>
If you find this information useful, please award points for "correct" 
or "helpful".
					</p>
				</div>
				<a name="comments-17943"></a>
				<div id="comment-17943" class="jive-content-comment ">
					<span>
						<span>
							Oct 17, 2010 7:46 PM
						</span>
							<!--<a href="/people/serez" title="Click to view serez's profile">
<img class="jive-avatar" src="/people/serez/avatar/16.png?a=-1" height="16" width="16" title="Click to view serez's profile" alt="Click to view serez's profile" />
</a>--><a href="http://communities.vmware.com/people/serez" 
id="jive-y7NIeGJ4jh7643La" class="jive-username-link" title="Click to 
view serez's profile">serez</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17943">
					thank you lamw finally i managed to do the backup and restore as 
well. thanks for your help. appreciate that.
					</p>
				</div>
				<a name="comments-17982"></a>
				<div id="comment-17982" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 18, 2010 9:26 AM
						</span>
							<!--<a href="/people/eqj" title="Click to view eqj's profile">
<img class="jive-avatar" src="/people/eqj/avatar/16.png?a=-1" height="16" width="16" title="Click to view eqj's profile" alt="Click to view eqj's profile" />
</a>--><a href="http://communities.vmware.com/people/eqj" 
id="jive-huj1nei5lIF1N1K9" class="jive-username-link" title="Click to 
view eqj's profile">eqj</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-17307" title="Go to message">waldrondigital</a>
							</em>
					</span>
					<p id="comment-body-17982">
					walderondigital, I use MKBACKUP to run ghettovcb backups.  It 
emails the summary back to you indicating success or failure and 
attaches a whole bunch of logs.
					</p>
				</div>
				<a name="comments-17991"></a>
				<div id="comment-17991" class="jive-content-comment ">
					<span>
						<span>
							Oct 19, 2010 6:57 AM
						</span>
							<!--<a href="/people/RobRZ" title="Click to view RobRZ's profile">
<img class="jive-avatar" src="/people/RobRZ/avatar/16.png?a=-1" height="16" width="16" title="Click to view RobRZ's profile" alt="Click to view RobRZ's profile" />
</a>--><a href="http://communities.vmware.com/people/RobRZ" 
id="jive-S9dkCU8LSG93jOky" class="jive-username-link" title="Click to 
view RobRZ's profile">RobRZ</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-17991">
					Hi there.<br>
<br>
Great tool but I stumbed across the "segmentation fault" error when it 
comes to backup a given machine. <br>
<br>
This error seems to trigger when the script executes the $VMWARE_CMD 
vmsvc/power.getstate &lt;ID&gt; where &lt;ID&gt; is the ID of a given 
VM.<br>
<br>
I have no errors under VMware ESXi 4.1.0 but I do have some under ESXi 
3.5.0.<br>
<br>
Here's an example:<br>
<br>
</p><ol>
<li>vim-cmd vmsvc/getallvms</li>
</ol>
Skipping invalid VM '48'<br>
64     Srv1     <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=datastore2">datastore2</a>
 WinXP/WinXP.vmx    slesGuest                          vmx-04<br>
96     Srv2     <a class="jive-link-adddocument" 
href="http://communities.vmware.com/community-document-picker.jspa?communityID=&amp;subject=datastore2">datastore2</a>
 Srv2/Srv2.vmx             winNetEnterpriseGuest   vmx-04   <br>
<br>
<ol>
<li>vim-cmd vmsvc/power.getstate 64</li>
</ol>
Segmentation fault<br>
<br>
<ol>
<li>vim-cmd vmsvc/power.getstate 96</li>
</ol>
Segmentation fault<br>
<br>
Dunno if this is a bug under 3.5 but the above condition cause GhetooVCB
 to fail.<br>
<br>
Cheers,<br>
Rob
					
				</div>
				<a name="comments-18871"></a>
				<div id="comment-18871" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Oct 28, 2010 6:51 AM
						</span>
							<!--<a href="/people/avatar1481" title="Click to view avatar1481's profile">
<img class="jive-avatar" src="/people/avatar1481/avatar/16.png?a=-1" height="16" width="16" title="Click to view avatar1481's profile" alt="Click to view avatar1481's profile" />
</a>--><a href="http://communities.vmware.com/people/avatar1481" 
id="jive-22ffIL23eM261LEh" class="jive-username-link" title="Click to 
view avatar1481's profile">avatar1481</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-18871">
					Hi,<br>
i have this issue when I try to backup some VMs:<br>
<br>
2010-10-28 13:45:33 -- info: Initiate backup for ServerX<br>
2010-10-28 13:45:33 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-10-28" for ServerX<br>
2010-10-28 13:45:34 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-10-28" to be created<br>
2010-10-28 13:45:34 -- debug: Snapshot timeout set to: 900 seconds<br>
2010-10-28 13:45:36 -- debug: /sbin/vmkfstools -i 
"/vmfs/volumes/iSCSI_Openfiler/ServerX/ServerX.vmdk" -a "buslogic" -d 
"zeroedthick" 
"/vmfs/volumes/NAS_QNAP/BKPs//ServerX/ServerX-2010-10-28_13-45-29/ServerX.vmdk"<br>
<br>
2010-10-28 13:45:36 -- info: ERROR: error in backing up of 
"/vmfs/volumes/iSCSI_Openfiler/ServerX/ServerX.vmdk" for ServerX<br>
2010-10-28 13:45:38 -- info: Removing snapshot from ServerX ...<br>
2010-10-28 13:45:43 -- debug: Removing 
/vmfs/volumes/NAS_QNAP/BKPs//Server07/Server07-2010-10-28_13-41-27<br>
2010-10-28 13:45:43 -- info: Backup Duration: 10 Seconds<br>
2010-10-28 13:45:43 -- info: ERROR: Unable to backup Server07 due to 
error in VMDK backup!<br>
<br>
2010-10-28 13:45:43 -- info: ###### Final status: ERROR: No VMs backed 
up! ######<br>
<br>
2010-10-28 13:45:43 -- debug: Succesfully removed lock directory - 
/tmp/ghettoVCB.lock<br>
<br>
Some times the backup was done, in most cases not.<br>
<br>
I search on google but nothing...<br>
<br>
Any idea?<br>
<br>
thx
					</p>
				</div>
				<a name="comments-19003"></a>
				<div id="comment-19003" class="jive-content-comment ">
					<span>
						<span>
							Nov 2, 2010 3:00 AM
						</span>
							<!--<a href="/people/serez" title="Click to view serez's profile">
<img class="jive-avatar" src="/people/serez/avatar/16.png?a=-1" height="16" width="16" title="Click to view serez's profile" alt="Click to view serez's profile" />
</a>--><a href="http://communities.vmware.com/people/serez" 
id="jive-31tIbvaWOqOlYKVY" class="jive-username-link" title="Click to 
view serez's profile">serez</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-19003">
					hi all. thanks for the backup script. it works well with my current
 setup.<br>
 i have a question regarding the storage. apart from backing up to local
 datastore or NFS, is there any way to send all backup images to ftp 
server using this script? i read all the comments and until now i still 
dont get the idea on how to mount the ftp server storage to the esxi 
datastore.. <br>
<br>
thanks for your help.
					</p>
				</div>
				<a name="comments-18981"></a>
				<div id="comment-18981" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 2, 2010 4:16 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-Jn46Mkl7PG8vHiF4" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-18981">
					Hi lamw<br>
I tested your new version of ghettoVCB. Script sends email log now. It 
is fine.<br>
But I and my customers had problem with unfinished backup,  see my post 
form Aug 4, 2010 9:37 AM <br>
I think that there is conflict between commands tail and vmkfstools 
while using NFS datastore.<br>
My solution rests in usage redirection by classic command tee. It works 
OK now.<br>
Next I need to have result of vmfkstools operation in log file and/or in
 email. <br>
Therefore I did changes in script:<br>
<br>
First part<br>
</p><hr>
logger() { <br>
...<br>
        if [ &amp;&amp; [ || [ || [; then<br>
                TIME=$(date +%F" "%H:%M:%S)<br>
       	        if ; then<br>
                        echo -e "${TIME} -- ${LOG_TYPE}: ${MSG}"<br>
                else<br>
              	        echo -e "${TIME} -- ${LOG_TYPE}: ${MSG}" &gt;&gt;
 "${LOG_OUTPUT}"<br>
                fi<br>
<br>
                if ; then<br>
                        echo -ne "${TIME} -- ${LOG_TYPE}: ${MSG}\r\n" 
&gt;&gt; "${EMAIL_LOG_OUTPUT}"		<br>
                fi <br>
+	else<br>
+	        if ; then<br>
+	               TIME=$(date +%F" "%H:%M:%S)<br>
+	               if ; then<br>
+                              echo -e "${TIME} -- ${LOG_TYPE}: ${MSG}" 
&gt;&gt; "${LOG_OUTPUT}"<br>
+       	        	      cat ${MSG} &gt;&gt; "${LOG_OUTPUT}"<br>
+       	        	      echo &gt;&gt; "${LOG_OUTPUT}" <br>
<p>
+		       fi<br>
<br>
+		       if ; then<br>
+			      echo -ne "${TIME} -- ${LOG_TYPE}: ${MSG}\r\n" &gt;&gt; 
"${EMAIL_LOG_OUTPUT}"<br>
+                              cat ${MSG} &gt;&gt; "${EMAIL_LOG_OUTPUT}"<br>
+                              echo &gt;&gt; "${EMAIL_LOG_OUTPUT}"		<br>
+		       fi<br>
+		fi<br>
	fi<br>
</p><hr>
Second part<br>
<hr>
        VMDK_OUTPUT=$(mktemp /tmp/ghettovcb.XXXXXX)<br>
<ol>
<li>tail -f "${VMDK_OUTPUT}" &amp;</li>
<li>TAIL_PID=$!</li>
</ol>
        if   ; then<br>
                logger "debug" "${VMKFSTOOLS_CMD} -i \"${SOURCE_VMDK}\" 
-a \"${ADAPTER_FORMAT}\" \"${DESTINATION_VMDK}\""<br>
<ol>
<li>${VMKFSTOOLS_CMD} -i "${SOURCE_VMDK}" -a "${ADAPTER_FORMAT}" 
"${DESTINATION_VMDK}" &gt; "${VMDK_OUTPUT}" 2&gt;&amp;1</li>
</ol>
+               ${VMKFSTOOLS_CMD} -i "${SOURCE_VMDK}" -a 
"${ADAPTER_FORMAT}" "${DESTINATION_VMDK}" 2&gt;&amp;1 | tee 
"${VMDK_OUTPUT}"					<br>
        else <br>
                logger "debug" "${VMKFSTOOLS_CMD} -i \"${SOURCE_VMDK}\" 
-a \"${ADAPTER_FORMAT}\" -d \"${FORMAT_OPTION}\" 
\"${DESTINATION_VMDK}\""<br>
<ol>
<li>${VMKFSTOOLS_CMD} -i "${SOURCE_VMDK}" -a "${ADAPTER_FORMAT}" -d 
"${FORMAT_OPTION}" "${DESTINATION_VMDK}" &gt; "${VMDK_OUTPUT}" 
2&gt;&amp;1</li>
</ol>
+               ${VMKFSTOOLS_CMD} -i "${SOURCE_VMDK}" -a 
"${ADAPTER_FORMAT}" -d "${FORMAT_OPTION}" "${DESTINATION_VMDK}" 
2&gt;&amp;1 | tee "${VMDK_OUTPUT}" 										<br>
        fi<br>
<p>
        VMDK_EXIT_CODE=$?<br>
</p><ol>
<li>kill "${TAIL_PID}"</li>
<li>cat "${VMDK_OUTPUT}" &gt;&gt; "${REDIRECT}"</li>
</ol>
+       logger "logfile" "${VMDK_OUTPUT}"<br>
<ol>
<li>echo &gt;&gt; "${REDIRECT}"</li>
</ol>
        echo<br>
<hr>
Sorry, readable copy is here: <a class="jive-link-external" 
href="http://pastebin.com/vRciu4zR">http://pastebin.com/vRciu4zR</a><br>
<p>
row with symbol # you delete<br>
row with symbol + you add but without +<br>
<br>
After starting of ghetto script scheduled by cron problem with 
unfinished backup was back again but only with classic vSphere 4.x, no 
problem with ESXi. <br>
I don't know why but I think that reason lies in small buffer.<br>
My solution rest in usage util screen<br>
I download it here:<br>
<a class="jive-link-external" 
href="http://merlin.fit.vutbr.cz/mirrors/centos/5/os/x86_64/CentOS/screen-4.0.3-1.el5_4.1.x86_64.rpm">http://merlin.fit.vutbr.cz/mirrors/centos/5/os/x86_64/CentOS/screen-4.0.3-1.el5_4.1.x86_64.rpm</a><br>
and instaled:<br>
        rpm -Uvh screen-4.0.3-1.el5_4.1.x86_64.rpm<br>
I modified cron file like this:<br>
0 23 * * 1-5 screen -d -m -O -S ghetto 
/vmfs/volumes/local/_script/ghetto &lt;required parameters&gt; <br>
After that backup works perfect.  <br>
<br>
One my customer have mail server that fail to receive email from script.<br>
Solution is adding parameter -i for delay communication:<br>
"${NC_BIN}" -i 5 "${EMAIL_SERVER}" ...  <br>
<br>
Maybe this post will help someone.
					</p>
				</div>
				<a name="comments-19004"></a>
				<div id="comment-19004" class="jive-content-comment ">
					<span>
						<span>
							Nov 2, 2010 9:38 AM
						</span>
							<!--<a href="/people/vlho" title="Click to view vlho's profile">
<img class="jive-avatar" src="/people/vlho/avatar/16.png?a=-1" height="16" width="16" title="Click to view vlho's profile" alt="Click to view vlho's profile" />
</a>--><a href="http://communities.vmware.com/people/vlho" 
id="jive-A8MGo97wopBJ405H" class="jive-username-link" title="Click to 
view vlho's profile">vlho</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-18981" title="Go to message">vlho</a>
							</em>
					</span>
					<p id="comment-body-19004">
					Hi, I have noticed that descripted modification are unintelligible.
 Sorry.<br>
Here you can find transparent version:<br>
<a class="jive-link-external" href="http://pastebin.com/vRciu4zR">http://pastebin.com/vRciu4zR</a>
					</p>
				</div>
				<a name="comments-19037"></a>
				<div id="comment-19037" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 3, 2010 3:58 AM
						</span>
							<!--<a href="/people/dylan92" title="Click to view dylan92's profile">
<img class="jive-avatar" src="/people/dylan92/avatar/16.png?a=-1" height="16" width="16" title="Click to view dylan92's profile" alt="Click to view dylan92's profile" />
</a>--><a href="http://communities.vmware.com/people/dylan92" 
id="jive-Eoh5UwYk46JQ8BTk" class="jive-username-link" title="Click to 
view dylan92's profile">dylan92</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-18871" title="Go to message">avatar1481</a>
							</em>
					</span>
					<p id="comment-body-19037">
					Hi ,<br>
<br>
I have exactly the same error, <br>
</p><p>
2010-11-03 10:30:41 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-11-03" for test_fred<br>
2010-11-03 10:30:44 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-11-03" to be created<br>
2010-11-03 10:30:44 -- debug: Snapshot timeout set to: 900 seconds<br>
2010-11-03 10:30:45 -- debug: /sbin/vmkfstools -i 
"/vmfs/volumes/VM2/test_fred/test_fred.vmdk" -a "buslogic" -d 
"zeroedthick" 
"/vmfs/volumes/NAS2/test_fred/test_fred-2010-11-03_10-30-38/test_fred.vmdk"<br>
<br>
2010-11-03 10:30:45 -- info: ERROR: error in backing up of 
"/vmfs/volumes/VM2/test_fred/test_fred.vmdk" for test_fred<br>
2010-11-03 10:30:50 -- info: Removing snapshot from test_fred ...<br>
2010-11-03 10:30:50 -- info: Backup Duration: 9 Seconds<br>
2010-11-03 10:30:50 -- info: ERROR: Unable to backup test_fred due to 
error in VMDK backup<br>
<br>
Do you find a solution ?<br>
<br>
Best regards
					</p>
				</div>
				<a name="comments-19010"></a>
				<div id="comment-19010" class="jive-content-comment ">
					<span>
						<span>
							Nov 3, 2010 7:13 AM
						</span>
							<!--<a href="/people/kryptokowboy" title="Click to view kryptokowboy's profile">
<img class="jive-avatar" src="/people/kryptokowboy/avatar/16.png?a=-1" height="16" width="16" title="Click to view kryptokowboy's profile" alt="Click to view kryptokowboy's profile" />
</a>--><a href="http://communities.vmware.com/people/kryptokowboy" 
id="jive-1OQGlBsy02w00Lxs" class="jive-username-link" title="Click to 
view kryptokowboy's profile">kryptokowboy</a>&nbsp;&nbsp;says:
							<em>
in response to:								<a href="#comments-19037" title="Go to message">dylan92</a>
							</em>
					</span>
					<p id="comment-body-19010">
					I'm getting a very similar error:<br>
<br>
2010-11-03 01:01:12 -- info: ERROR: error in backing up <br>
of "/vmfs/volumes/APP-SVR-STORAGE/ATS-APP/ATS-APP_1.vmdk" for ATS-APP<br>
<br>
I have two other vmdk's on this server that backup fine. This is the 
only one having problems. It's a 300GB partition. I'm not using any kind
 of compression or anything other than the standard script. <br>
<br>
Any ideas what could cause this?
					</p>
				</div>
				<a name="comments-19135"></a>
				<div id="comment-19135" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 8, 2010 6:31 AM
						</span>
							<!--<a href="/people/vasilicht" title="Click to view vasilicht's profile">
<img class="jive-avatar" src="/people/vasilicht/avatar/16.png?a=-1" height="16" width="16" title="Click to view vasilicht's profile" alt="Click to view vasilicht's profile" />
</a>--><a href="http://communities.vmware.com/people/vasilicht" 
id="jive-6a1CwMcAWg57L35j" class="jive-username-link" title="Click to 
view vasilicht's profile">vasilicht</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-19135">
					Good Day.<br>
<br>
First of all thanks for great tools.<br>
I have one suggestion. Some times need to delete old backups before vm 
backup when there isn't  enough space on backup storage.<br>
I attached patch for this.<br>
<br>
diff -u old/ghettoVCB.conf new/ghettoVCB.conf<br>
--- old/ghettoVCB.conf	2010-09-17 19:03:56.000000000 +0300<br>
+++ new/ghettoVCB.conf	2010-11-08 12:27:00.000000000 +0200<br>
@@ -1,6 +1,7 @@<br>
 
VM_BACKUP_VOLUME=/vmfs/volumes/dlgCore-NFS-bigboi.VM-Backups/WILLIAM_BACKUPS<br>
 DISK_BACKUP_FORMAT=thin<br>
 VM_BACKUP_ROTATION_COUNT=3<br>
+DELETE_BEFORE_BACKUP=0<br>
 POWER_VM_DOWN_BEFORE_BACKUP=0<br>
 ENABLE_HARD_POWER_OFF=0<br>
 ITER_TO_WAIT_SHUTDOWN=3<br>
diff -u old/ghettoVCB.sh new/ghettoVCB.sh<br>
--- old/ghettoVCB.sh	2010-11-08 16:15:53.000000000 +0200<br>
+++ new/ghettoVCB.sh	2010-11-08 16:16:07.000000000 +0200<br>
@@ -17,6 +17,9 @@<br>
 # Number of backups for a given VM before deleting<br>
 VM_BACKUP_ROTATION_COUNT=3<br>
</p><p>
+# Delete a given VM before backup<br>
+DELETE_BEFORE_BACKUP=0<br>
+<br>
 # Shutdown guestOS prior to running backups and power them back on 
afterwards<br>
 # This feature assumes VMware Tools are installed, else they will not 
power down and loop forever<br>
 # 1=on, 0 =off<br>
@@ -291,6 +294,7 @@<br>
 	DEFAULT_VM_BACKUP_VOLUME="${VM_BACKUP_VOLUME}"<br>
 	DEFAULT_DISK_BACKUP_FORMAT="${DISK_BACKUP_FORMAT}"<br>
 	DEFAULT_VM_BACKUP_ROTATION_COUNT="${VM_BACKUP_ROTATION_COUNT}"<br>
+	DEFAULT_DELETE_BEFORE_BACKUP="${DELETE_BEFORE_BACKUP}"<br>
 	DEFAULT_POWER_VM_DOWN_BEFORE_BACKUP="${POWER_VM_DOWN_BEFORE_BACKUP}"<br>
 	DEFAULT_ENABLE_HARD_POWER_OFF="${ENABLE_HARD_POWER_OFF}"<br>
 	DEFAULT_ITER_TO_WAIT_SHUTDOWN="${ITER_TO_WAIT_SHUTDOWN}"<br>
@@ -309,6 +313,7 @@<br>
 	VM_BACKUP_VOLUME="${DEFAULT_VM_BACKUP_VOLUME}"<br>
 	DISK_BACKUP_FORMAT="${DEFAULT_DISK_BACKUP_FORMAT}"<br>
 	VM_BACKUP_ROTATION_COUNT="${DEFAULT_VM_BACKUP_ROTATION_COUNT}"<br>
+	DELETE_BEFORE_BACKUP="${DEFAULT_DELETE_BEFORE_BACKUP}"<br>
 	POWER_VM_DOWN_BEFORE_BACKUP="${DEFAULT_POWER_VM_DOWN_BEFORE_BACKUP}"<br>
 	ENABLE_HARD_POWER_OFF="${DEFAULT_ENABLE_HARD_POWER_OFF}"<br>
 	ITER_TO_WAIT_SHUTDOWN="${DEFAULT_ITER_TO_WAIT_SHUTDOWN}"<br>
@@ -411,6 +416,7 @@<br>
 	logger "info" "CONFIG - GHETTOVCB_PID = ${GHETTOVCB_PID}"<br>
 	logger "info" "CONFIG - VM_BACKUP_VOLUME = ${VM_BACKUP_VOLUME}"<br>
 	logger "info" "CONFIG - VM_BACKUP_ROTATION_COUNT = 
${VM_BACKUP_ROTATION_COUNT}"<br>
+	logger "info" "CONFIG - DELETE_BEFORE_BACKUP = 
${DELETE_BEFORE_BACKUP}"<br>
 	logger "info" "CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
${VM_BACKUP_DIR_NAMING_CONVENTION}"<br>
         logger "info" "CONFIG - DISK_BACKUP_FORMAT = 
${DISK_BACKUP_FORMAT}"<br>
         logger "info" "CONFIG - ADAPTER_FORMAT = ${ADAPTER_FORMAT}"<br>
@@ -448,7 +454,10 @@<br>
         fi<br>
</p><p>
 	LIST_BACKUPS=$(ls -t "${BACKUP_DIR_PATH}")<br>
-	BACKUPS_TO_KEEP=$(ls -t "${BACKUP_DIR_PATH}" | head 
-"${VM_BACKUP_ROTATION_COUNT}")<br>
+	logger "debug" "LIST_BACKUPS $LIST_BACKUPS"<br>
+	BACKUPS_TO_KEEP=$(ls -t "${BACKUP_DIR_PATH}" | head 
-$((${VM_BACKUP_ROTATION_COUNT} - ${DELETE_BEFORE_BACKUP})))<br>
+	logger "debug" "ls -t "${BACKUP_DIR_PATH}" | head 
-$((${VM_BACKUP_ROTATION_COUNT} - ${DELETE_BEFORE_BACKUP})) "<br>
+	logger "debug" "BACKUPS_TO_KEEP $BACKUPS_TO_KEEP"<br>
</p><p>
 	ORIG_IFS=${IFS}<br>
         IFS='<br>
@@ -612,6 +621,11 @@<br>
 				fi<br>
 	                fi<br>
</p><p>
+			if [ ${DELETE_BEFORE_BACKUP} -eq 1 ]; then<br>
+				logger "debug" "DELETE_BEFORE_BACKUP = ${DELETE_BEFORE_BACKUP}"<br>
+				checkVMBackupRotation "${BACKUP_DIR}"<br>
+			fi<br>
+<br>
 			# directory name of the individual Virtual Machine backup followed 
by naming convention followed by count<br>
 			
VM_BACKUP_DIR="${BACKUP_DIR}/${VM_NAME}-${VM_BACKUP_DIR_NAMING_CONVENTION}"<br>
 			mkdir -p "${VM_BACKUP_DIR}"<br>
@@ -804,9 +818,13 @@<br>
 						tar -cz -C "${BACKUP_DIR}" 
"${VM_NAME}-${VM_BACKUP_DIR_NAMING_CONVENTION}" -f 
"${BACKUP_DIR}/${VM_NAME}-${VM_BACKUP_DIR_NAMING_CONVENTION}.gz"<br>
 					fi<br>
                 	                rm -rf "${VM_BACKUP_DIR}"<br>
-					checkVMBackupRotation "${BACKUP_DIR}"<br>
+					if [ ${DELETE_BEFORE_BACKUP} -eq 0 ]; then<br>
+						checkVMBackupRotation "${BACKUP_DIR}"<br>
+					fi<br>
 	                        else<br>
-        	                        checkVMBackupRotation "${BACKUP_DIR}"<br>
+        	                        if [ ${DELETE_BEFORE_BACKUP} -eq 0 ]; 
then<br>
+						checkVMBackupRotation "${BACKUP_DIR}"<br>
+					fi<br>
                 	        fi<br>
                         	IFS=${TMP_IFS}<br>
 	                        VMDKS=""
					</p>
				</div>
				<a name="comments-19275"></a>
				<div id="comment-19275" class="jive-content-comment ">
					<span>
						<span>
							Nov 10, 2010 4:36 AM
						</span>
							<!--<a href="/people/eqj" title="Click to view eqj's profile">
<img class="jive-avatar" src="/people/eqj/avatar/16.png?a=-1" height="16" width="16" title="Click to view eqj's profile" alt="Click to view eqj's profile" />
</a>--><a href="http://communities.vmware.com/people/eqj" 
id="jive-rxBFl506Ym0uOtpo" class="jive-username-link" title="Click to 
view eqj's profile">eqj</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-19275">
					Apart from the backup file itself, does ghettoVCB leave any other 
files behind? Because I run a backup of a VM daily and every other day 
it fails with Out of Disk Space error.  If I run it again straight after
 it completes fine.<br>
<br>
Is there any kind of clean up I can perform after each backup? Backup 
rotation is set to 1.
					</p>
				</div>
				<a name="comments-19400"></a>
				<div id="comment-19400" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 12, 2010 4:55 PM
						</span>
							<!--<a href="/people/yulena" title="Click to view yulena's profile">
<img class="jive-avatar" src="/people/yulena/avatar/16.png?a=-1" height="16" width="16" title="Click to view yulena's profile" alt="Click to view yulena's profile" />
</a>--><a href="http://communities.vmware.com/people/yulena" 
id="jive-aj0iWAi0NDa1R5f0" class="jive-username-link" title="Click to 
view yulena's profile">yulena</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-19400">
					Hello everyone!!<br>
I have a problem :Failed to clone disk : Input/output error (327689).<br>
We use a Windows Services For Unix on Windows Xp sp2 in a Domain 
Controller  with kaspersky, but allow the ports used for WSFU.<br>
<br>
We program a task for the backup, and recently on logs we saw 
Input/output error (327689), dont finish the backup, but the machine 
with the WSFU reboots, and is the reason for the fail backup, but the 
machine reboot some minutes later to start the task.<br>
We have also strange character in the mappped config of Windows Services
 For Unix, 2 yen simbol and name of computer yen symbol user name.<br>
This  problem has 2 weeks, before of the problem<br>
 the backups works perfectly  with the script.<br>
<br>
Help please <img class="jive-emoticon" src="DOC-8760_files/sad.gif" 
alt=":(" border="0">
					</p>
				</div>
				<a name="comments-19570"></a>
				<div id="comment-19570" class="jive-content-comment ">
					<span>
						<span>
							Nov 16, 2010 2:28 PM
						</span>
							<!--<a href="/people/Paige" title="Click to view Paige's profile">
<img class="jive-avatar" src="/people/Paige/avatar/16.png?a=-1" height="16" width="16" title="Click to view Paige's profile" alt="Click to view Paige's profile" />
</a>--><a href="http://communities.vmware.com/people/Paige" 
id="jive-Tqa9JmDw0fu39MJk" class="jive-username-link" title="Click to 
view Paige's profile">Paige</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-19570">
					Trying this on an ESXI 4 host and when I run the script it says all
 VM's backed up OK but when I go to the folder containing the backup it 
only contains the .vmx file for the machine.  When I ran the dry run it 
showed it was finding the .vmdk files as well.  Anyone else had this 
happen or know the answer??<br>
<br>
Thanks!<br>
Paige<br>
<br>
Below is my log for when it runs<br>
:<br>
2010-11-16 20:45:42 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-11-16 20:45:42 -- info: CONFIG - GHETTOVCB_PID = 125057396<br>
2010-11-16 20:45:42 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/VMBackups/ServerBackups<br>
2010-11-16 20:45:42 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 2<br>
2010-11-16 20:45:42 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-11-16_20-45-42<br>
2010-11-16 20:45:42 -- info: CONFIG - DISK_BACKUP_FORMAT = thick<br>
2010-11-16 20:45:42 -- info: CONFIG - ADAPTER_FORMAT = <br>
2010-11-16 20:45:42 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-11-16 20:45:42 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-11-16 20:45:42 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-11-16 20:45:42 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-11-16 20:45:42 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-11-16 20:45:42 -- info: CONFIG - LOG_LEVEL = info<br>
2010-11-16 20:45:42 -- info: CONFIG - BACKUP_LOG_OUTPUT = 
/tmp/ghettovcb.log<br>
2010-11-16 20:45:42 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-11-16 20:45:42 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-11-16 20:45:42 -- info: CONFIG - VMDK_FILES_TO_BACKUP = <br>
2010-11-16 20:45:42 -- info: CONFIG - EMAIL_LOG = 0<br>
2010-11-16 20:45:42 -- info: <br>
<br>
2010-11-16 20:45:46 -- info: Initiate backup for labelserver<br>
2010-11-16 20:45:46 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-11-16" for labelserver<br>
2010-11-16 20:45:50 -- info: Removing snapshot from labelserver ...<br>
2010-11-16 20:45:55 -- info: Backup Duration: 9 Seconds<br>
2010-11-16 20:45:55 -- info: Successfully completed backup for 
labelserver!<br>
<br>
2010-11-16 20:45:55 -- info: ###### Final status: All VMs backed up OK! 
######<br>
<br>
2010-11-16 20:45:55 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
				<a name="comments-19960"></a>
				<div id="comment-19960" class="jive-content-comment 
jive-content-comment-alt">
					<span>
						<span>
							Nov 23, 2010 5:21 AM
						</span>
							<!--<a href="/people/buritto" title="Click to view buritto's profile">
<img class="jive-avatar" src="/people/buritto/avatar/16.png?a=-1" height="16" width="16" title="Click to view buritto's profile" alt="Click to view buritto's profile" />
</a>--><a href="http://communities.vmware.com/people/buritto" 
id="jive-D9enOtH51qC3Td35" class="jive-username-link" title="Click to 
view buritto's profile">buritto</a>&nbsp;&nbsp;says:
					</span>
					<p id="comment-body-19960">
					Hello <br>
First of all thanks for great tools.<br>
<br>
But with the new version i have on the file name no rotation-number like
 "Servername-2010-11-23_13-06-23--1"<br>
only  "Servername-2010-11-23_13-06-23"<br>
<br>
With the older Version is this no problem....   <br>
<br>
any  solution ?<br>
<br>
2010-11-23 13:19:36 -- info: ============================== ghettoVCB 
LOG START ==============================<br>
<br>
2010-11-23 13:19:36 -- debug: Succesfully acquired lock directory - 
/tmp/ghettoVCB.lock<br>
<br>
2010-11-23 13:19:36 -- debug: HOST BUILD: VMware ESXi 4.0.0 build-256968<br>
2010-11-23 13:19:36 -- debug: HOSTNAME: vserv02.vmml.local<br>
<br>
2010-11-23 13:19:36 -- info: CONFIG - GHETTOVCB_PID = 51057045<br>
2010-11-23 13:19:36 -- info: CONFIG - VM_BACKUP_VOLUME = 
/vmfs/volumes/cf59c794-d2dc67b1/Backups_VMs/VMSERV02<br>
2010-11-23 13:19:36 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>
2010-11-23 13:19:36 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTION = 
2010-11-23_13-19-36<br>
2010-11-23 13:19:36 -- info: CONFIG - DISK_BACKUP_FORMAT = zeroedthick<br>
2010-11-23 13:19:36 -- info: CONFIG - ADAPTER_FORMAT = buslogic<br>
2010-11-23 13:19:36 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>
2010-11-23 13:19:36 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>
2010-11-23 13:19:36 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>
2010-11-23 13:19:36 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>
2010-11-23 13:19:36 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>
2010-11-23 13:19:36 -- info: CONFIG - LOG_LEVEL = debug<br>
2010-11-23 13:19:36 -- info: CONFIG - BACKUP_LOG_OUTPUT = stdout<br>
2010-11-23 13:19:36 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>
2010-11-23 13:19:36 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>
2010-11-23 13:19:36 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>
2010-11-23 13:19:36 -- info: CONFIG - EMAIL_LOG = 0<br>
2010-11-23 13:19:36 -- info:<br>
<br>
2010-11-23 13:19:39 -- info: Initiate backup for tt<br>
2010-11-23 13:19:39 -- info: Creating Snapshot 
"ghettoVCB-snapshot-2010-11-23" for tt<br>
2010-11-23 13:19:40 -- debug: Waiting for snapshot 
"ghettoVCB-snapshot-2010-11-23" to be created<br>
2010-11-23 13:19:40 -- debug: Snapshot timeout set to: 900 seconds<br>
2010-11-23 13:19:42 -- debug: /sbin/vmkfstools -i 
"/vmfs/volumes/Prod_Store_V02/tt/tt.vmdk" -a "buslogic" -d "zeroedthick"
 
"/vmfs/volumes/cf59c794-d2dc67b1/Backups_VMs/VMSERV02/tt/tt-2010-11-23_13-19-36/tt.vmdk"<br>
<br>
2010-11-23 13:19:44 -- info: Removing snapshot from tt ...<br>
2010-11-23 13:19:49 -- info: Backup Duration: 10 Seconds<br>
2010-11-23 13:19:49 -- info: Successfully completed backup for tt!<br>
<br>
2010-11-23 13:19:49 -- info: ###### Final status: All VMs backed up OK! 
######<br>
<br>
2010-11-23 13:19:49 -- debug: Succesfully removed lock directory - 
/tmp/ghettoVCB.lock<br>
<br>
2010-11-23 13:19:49 -- info: ============================== ghettoVCB 
LOG END ================================
					</p>
				</div>
									</div>
								<a name="cf"></a>
							</div>
						</div>
				</div>
			</div>
			<!-- END main body column -->
			<!-- BEGIN sidebar column -->
			<div id="jive-body-sidebarcol-container">
				<div id="jive-body-sidebarcol">
<div id="jive-userbar-search">
	<form action="/search.jspa" method="post">
		<div>
				<label>Search VI: VMware ESXâ„¢ 3.5</label>
			<!--
			<select class="jive-search-community" name="communityID" id="communityID">
				<option value="" class="jive-search-community-all" >
All Communities				</option>
					<option value="3625" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMware Communities Help</option>
					<option value="2428" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMTN</option>
					<option value="2000" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>General</option>
					<option value="2003" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Virtualization Technology &amp; Industry</option>
					<option value="2629" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Performance &amp; VMmark</option>
					<option value="2427" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware VMmarkâ„¢</option>
					<option value="2004" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Security and Compliance</option>
					<option value="2007" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Replay-Based Debugging</option>
					<option value="2487" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Virtualizing Oracle</option>
					<option value="2871" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Exchange, Domino and RIM</option>
					<option value="2876" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Tools OS-Specific Packaging</option>
					<option value="2542" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Higher Education</option>
					<option value="3297" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Community Hardware Software</option>
					<option value="2805" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Virtual Lounge</option>
					<option value="2804" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMworld 2008</option>
					<option value="3064" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Intel</option>
					<option value="2412" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Virtual Machine &amp; Guest OS</option>
					<option value="3085" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Knowledge Base</option>
					<option value="3277" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Cares</option>
					<option value="2437" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Communities Website Feedback</option>
					<option value="2353" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Technical Resources</option>
					<option value="2193" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Product &amp; Feature Suggestions</option>
					<option value="3929" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>ASPLOS RESoLVE</option>
					<option value="2409" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Enterprise Strategy &amp; Planning</option>
					<option value="2921" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware vSphereâ„¢</option>
					<option value="2922" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere Upgrade &amp; Install</option>
					<option value="3068" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>QuickStart Series</option>
					<option value="2936" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware ESXâ„¢ 4</option>
					<option value="3033" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware ESXiâ„¢ 4</option>
					<option value="3216" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Goâ„¢</option>
					<option value="3039" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vMotion &amp; Resource Management</option>
					<option value="2942" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vSphereâ„¢ vNetwork</option>
					<option value="3036" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vSphereâ„¢ Storage</option>
					<option value="3049" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Availability: HA &amp; FT</option>
					<option value="3066" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Backup &amp; Recovery</option>
					<option value="3102" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Automation Tools</option>
					<option value="2530" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware vSphereâ„¢ PowerCLI</option>
					<option value="3482" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>vCenter Update Manager PowerCLI</option>
					<option value="2687" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>vSphere Management Assistant (vMA)</option>
					<option value="3087" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>vSphere Command-Line Interface</option>
					<option value="3498" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Project Onyx</option>
					<option value="3086" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Open Virtualization Format Tool</option>
					<option value="3364" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Script-O-Mania</option>
					<option value="3402" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>VMware Script-O-Mania: Contest Submissions</option>
					<option value="3740" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vSphere Hypervisor</option>
					<option value="3788" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware vCloud Director</option>
					<option value="2407" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Infrastructureâ„¢</option>
					<option value="2632" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VI: VMware ESXiâ„¢ 3.5</option>
					<option value="2411" class="jive-search-community-sub" style="padding-left: 30px;"
						selected="selected"
					>VI: VMware ESXâ„¢ 3.5</option>
					<option value="2410" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VI: VMware ESXÂ® 3.0</option>
					<option value="2408" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>ESX 2.x &amp; VirtualCenter 1.x</option>
					<option value="2423" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware vCenterâ„¢</option>
					<option value="2413" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCenterâ„¢ Server</option>
					<option value="3052" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCenterâ„¢ Server Heartbeatâ„¢</option>
					<option value="3060" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>AppSpeed</option>
					<option value="3047" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>CapacityIQ</option>
					<option value="3048" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Chargeback</option>
					<option value="2425" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Converter</option>
					<option value="2426" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Lab Manager</option>
					<option value="2747" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Lifecycle Manager</option>
					<option value="3055" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Orchestrator</option>
					<option value="2746" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Site Recovery Manager</option>
					<option value="2686" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Stage Manager</option>
					<option value="2958" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Update Manager</option>
					<option value="3561" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCenter QuickStart Series</option>
					<option value="3647" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCenter Configuration Manager: VCM</option>
					<option value="3648" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vCenter Application Discovery Manager: ADM</option>
					<option value="2833" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Serverâ„¢</option>
					<option value="2834" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Server 2</option>
					<option value="2837" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>General Issues</option>
					<option value="2835" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Installation &amp; Upgrade</option>
					<option value="2836" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Licensing</option>
					<option value="2838" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Remote Console</option>
					<option value="2839" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>OS Compatibility</option>
					<option value="2424" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Server 1</option>
					<option value="3873" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware vShield</option>
					<option value="2745" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Enterprise Desktop Products</option>
					<option value="2347" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Viewâ„¢ (with View Manager)</option>
					<option value="2666" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware ThinAppâ„¢</option>
					<option value="2597" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware ThinApp: Discussion Forum</option>
					<option value="2667" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware ThinApp: Feature Requests</option>
					<option value="2668" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware ThinApp: Journal</option>
					<option value="2669" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware ThinApp Virtual Lounge</option>
					<option value="3296" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware ThinApp: Application Packages</option>
					<option value="3291" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>ThinApp T-Shirt Sign-Up</option>
					<option value="2345" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware ACE</option>
					<option value="2343" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Desktop Products</option>
					<option value="2344" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Workstation</option>
					<option value="2348" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware FusionÂ® (for Mac)</option>
					<option value="2671" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Fusion Beta: Discussion Forum [LOCKED]</option>
					<option value="2346" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Player</option>
					<option value="2599" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Training &amp; Certification</option>
					<option value="2600" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Certification</option>
					<option value="2601" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VCP: VMware Certified Professional</option>
					<option value="3645" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VCAP: VMware Certified Advanced Professional</option>
					<option value="2830" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VCDX: VMware Certified Design Expert</option>
					<option value="2603" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Customer Education</option>
					<option value="2842" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Virtual Appliance Marketplace</option>
					<option value="2815" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Studio</option>
					<option value="2352" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Virtual Appliances</option>
					<option value="3717" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Service Manager: VSM</option>
					<option value="2297" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Archives</option>
					<option value="2305" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Beta Archives</option>
					<option value="2406" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VDM (Silverstone) Beta Community (LOCKED)</option>
					<option value="2397" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Server 2.0 Beta 1 [LOCKED]</option>
					<option value="2398" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Announcements</option>
					<option value="2400" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Installation and Upgrade</option>
					<option value="2401" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Web UI</option>
					<option value="2402" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Performance and Scalability</option>
					<option value="2403" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>OS Compatibility</option>
					<option value="2404" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>General Issues</option>
					<option value="2518" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Stage Manager 1.0 Beta [LOCKED]</option>
					<option value="2604" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Server 2.0 RC2 [LOCKED]</option>
					<option value="2605" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Announcements [LOCKED]</option>
					<option value="2606" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Installation and Upgrade [LOCKED]</option>
					<option value="2607" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Web UI [LOCKED]</option>
					<option value="2608" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Performance and Scalability [LOCKED]</option>
					<option value="2609" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>OS Compatibility [LOCKED]</option>
					<option value="2610" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>General Issues [LOCKED]</option>
					<option value="2644" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Remote Console [LOCKED]</option>
					<option value="2469" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>ESX 3i Installable Beta (LOCKED)</option>
					<option value="3098" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Studio 2.0 Beta Program [Locked]</option>
					<option value="3099" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>VMware Studio 2.0 Beta Documentation</option>
					<option value="2322" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>General Archives</option>
					<option value="2326" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Official Announcements Archives</option>
					<option value="2327" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Virtualization Technology &amp; Industry Archives</option>
					<option value="2328" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Security and Compliance Archives</option>
					<option value="2325" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMworld 2005 Archives</option>
					<option value="2329" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMworld 2006 Archives</option>
					<option value="2006" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMworld 2007 Archives</option>
					<option value="2349" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMTN Solutions - ARCHIVED</option>
					<option value="2350" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Submit a User Solution</option>
					<option value="2351" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>User Solutions</option>
					<option value="2806" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Community Hardware Software (old)</option>
					<option value="2298" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Infrastructure Archives</option>
					<option value="2300" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Strategy and Planning Archives</option>
					<option value="2301" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Installation and Upgrade Archives</option>
					<option value="2302" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Virtual Machine and Guest OS Archives</option>
					<option value="2303" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>ESX Server 3.x Configuration Archives</option>
					<option value="2304" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VirtualCenter 2.x Archives</option>
					<option value="2299" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>ESX Server 2.x - VC 1.x Archives</option>
					<option value="2330" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Desktop and Server Archives</option>
					<option value="2331" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Workstation Archives</option>
					<option value="2332" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware ACE Archives</option>
					<option value="2333" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Virtual Desktop Infrastructure (VDI) Archives</option>
					<option value="2334" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Player Archives</option>
					<option value="2335" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware Server Archives</option>
					<option value="2336" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Tools and Utilities Archives</option>
					<option value="2337" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>P2V Assistant Archives</option>
					<option value="2338" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Virtual Infrastructure SDK, CIM SDK, and Legacy Scripting Archives</option>
					<option value="2339" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Suggestion Archives</option>
					<option value="2340" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Product and Feature Suggestions Archives</option>
					<option value="2341" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Suggestions for VMTN Web Pages and Forums Archives</option>
					<option value="2342" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Support and Documentation Suggestions Archives</option>
					<option value="2194" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>VMware.com &amp; Store [CLOSED]</option>
					<option value="2195" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Support &amp; Knowledge Base [CLOSED]</option>
					<option value="2537" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Documentation Suggestions [CLOSED]</option>
					<option value="2764" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VI Toolkit for Windows Scripting Contest [Locked]</option>
					<option value="2196" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware User Groups (VMUGs)</option>
					<option value="3007" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Meetings / Events</option>
					<option value="3008" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Find your Local VMUG</option>
					<option value="3009" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Start a VMUG</option>
					<option value="2354" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMware Beta Programs</option>
					<option value="3420" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Beta Program Interest</option>
					<option value="2742" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>vCenter Admin Portal</option>
					<option value="2949" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>vCenter Server 2.5 on Linux</option>
					<option value="3004" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>vCenter Mobile Access</option>
					<option value="3478" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Workstation Beta</option>
					<option value="3479" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware ACE Beta</option>
					<option value="3480" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Player Beta</option>
					<option value="3557" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>VMware Fusion Beta</option>
					<option value="3159" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMware Developer</option>
					<option value="3160" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Learn</option>
					<option value="3176" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Learn Videos</option>
					<option value="3187" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Contribute Content</option>
					<option value="3188" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Thank You</option>
					<option value="3220" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Webinars and Sessions</option>
					<option value="3224" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Community Feedback</option>
					<option value="3166" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Documentation</option>
					<option value="3162" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Downloads</option>
					<option value="3163" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Forums</option>
					<option value="2416" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere Web Services SDK</option>
					<option value="2655" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Virtual Disk Development Kit</option>
					<option value="2417" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VIX API</option>
					<option value="2418" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere Guest SDK</option>
					<option value="2656" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere Client Plug-ins</option>
					<option value="2909" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VProbes</option>
					<option value="2954" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere SDK for Java</option>
					<option value="2981" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vCenter Lab Manager API</option>
					<option value="3081" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Orchestrator APIs</option>
					<option value="3088" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere SDK for Perl</option>
					<option value="3221" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCloudâ„¢ API</option>
					<option value="3237" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vNetwork APIs</option>
					<option value="3341" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vCenter Chargeback API</option>
					<option value="3825" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware ThinApp SDK</option>
					<option value="3831" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCenter Converter SDK</option>
					<option value="3597" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCloud SDK for Java</option>
					<option value="3895" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCloud SDK for .NET</option>
					<option value="3579" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware vCloud SDK for PHP</option>
					<option value="3164" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Sample Code</option>
					<option value="3076" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>SDK for Perl</option>
					<option value="3077" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere PowerCLI</option>
					<option value="3078" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vSphere CLI</option>
					<option value="3079" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Web Services SDK - Java</option>
					<option value="3080" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Web Services SDK - C#</option>
					<option value="3125" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Web Services SDK - Visual Basic</option>
					<option value="3233" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VDDK</option>
					<option value="3262" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VIX API</option>
					<option value="3989" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>vShield</option>
					<option value="3165" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Tech Exchange</option>
					<option value="3168" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Agenda</option>
					<option value="3169" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Hotel</option>
					<option value="3170" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Register</option>
					<option value="3177" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Videos</option>
					<option value="3178" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Forum</option>
					<option value="3623" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Sample Code</option>
					<option value="3367" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>GoVirtual.org</option>
					<option value="3313" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMware Infrastructure Operations (VIOPS)</option>
					<option value="3314" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Strategy</option>
					<option value="3315" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Applications</option>
					<option value="3340" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Oracle</option>
					<option value="3316" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Security</option>
					<option value="3317" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Management</option>
					<option value="3339" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Logging</option>
					<option value="3318" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Availability</option>
					<option value="3319" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Community</option>
					<option value="3421" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Moderators</option>
					<option value="3365" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMworld.com</option>
					<option value="3349" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMware User Groups (VMUGs)</option>
					<option value="3350" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Join a Group</option>
					<option value="3351" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Become a Member</option>
					<option value="3352" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Start a VMUG</option>
					<option value="3357" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Starting a VMUG</option>
					<option value="3359" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Thank You</option>
					<option value="3353" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Sponsors</option>
					<option value="3372" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Sponsor Form</option>
					<option value="3373" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Sponsor a VMUG</option>
					<option value="3354" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Events</option>
					<option value="3355" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Forums</option>
					<option value="2438" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>US - Northeast &amp; Mid-Atlantic</option>
					<option value="2226" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Albany Area VMware User Group</option>
					<option value="2224" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Buffalo Area VMware User Group</option>
					<option value="2219" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Central Ohio Area VMware User Group</option>
					<option value="2543" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Central PA Area VMware User Group</option>
					<option value="2257" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Cincinnati Area VMware User Group</option>
					<option value="2218" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Cleveland Area VMware User Group</option>
					<option value="2473" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Connecticut Area VMware User Group</option>
					<option value="2268" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Maryland Area VMware User Group</option>
					<option value="2241" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>New England Area VMware User Group</option>
					<option value="2264" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>New Jersey Area VMware User Group</option>
					<option value="2202" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>NY Metro VMware User Group</option>
					<option value="3758" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>OH SLED VMware User Group</option>
					<option value="2204" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Philadelphia VMware User Group</option>
					<option value="2458" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Richmond Area VMware User Group</option>
					<option value="2231" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Rochester Area VMware User Group</option>
					<option value="2239" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Syracuse Area VMware User Group</option>
					<option value="3001" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Toledo Area VMware User Group</option>
					<option value="2459" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Vermont Area VMware User Group</option>
					<option value="2201" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Washington DC Area VMware User Group</option>
					<option value="2236" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Western PA Area VMware User Group</option>
					<option value="3529" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Test</option>
					<option value="3891" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>West Virginia Area VMware User Group</option>
					<option value="3911" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Tidewater Area, VA</option>
					<option value="2439" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>US - Southeast</option>
					<option value="2207" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Atlanta Area VMware User Group</option>
					<option value="2256" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Baton Rouge Area VMware User Group</option>
					<option value="2478" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Birmingham Area VMware User Group</option>
					<option value="2529" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Charleston Area VMware User Group</option>
					<option value="2210" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Charlotte Area VMware User Group</option>
					<option value="2986" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Chattanooga Area VMware User Group</option>
					<option value="2266" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Columbia Area VMware User Group</option>
					<option value="2462" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Columbus GA Area VMware User Group</option>
					<option value="2221" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>East Tennessee Area VMware User Group</option>
					<option value="3265" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Gainesville Area VMware User Group</option>
					<option value="2267" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Greensboro Triad Area VMware User Group</option>
					<option value="2247" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Jacksonville Area VMware User Group</option>
					<option value="2259" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Memphis Area VMware User Group</option>
					<option value="2214" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Miami Area VMware User Group</option>
					<option value="3158" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Myrtle Beach Area VMware User Group</option>
					<option value="2249" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Nashville Area VMware User Group</option>
					<option value="2237" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Northwest SC Area VMware User Group</option>
					<option value="2246" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Orlando Area VMware User Group</option>
					<option value="2235" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Raleigh Area VMware User Group</option>
					<option value="2240" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>South Florida Area VMware User Group</option>
					<option value="2238" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Tallahassee Area VMware User Group</option>
					<option value="2232" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Tampa Area VMware User Group</option>
					<option value="2913" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Wilmington Area VMware User Group</option>
					<option value="3348" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Jackson Area VMware User Group</option>
					<option value="2197" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>US - Central</option>
					<option value="2230" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Austin Area VMware User group</option>
					<option value="2477" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Central Arkansas Area VMware User Group</option>
					<option value="2521" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Central Illinois Area VMware User Group</option>
					<option value="2205" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Chicago Area VMware User Group</option>
					<option value="3701" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>College Station VMware User Group</option>
					<option value="2198" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Dallas Area VMware User Group</option>
					<option value="2227" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Detroit Area VMware User Group</option>
					<option value="2212" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Houston Area VMware User Group</option>
					<option value="2213" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Indianapolis Area VMware User Group</option>
					<option value="2225" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Iowa Area VMware User Group</option>
					<option value="2443" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Kansas City Area VMware User Group</option>
					<option value="3278" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Lafayette, IN Area VMware User Group</option>
					<option value="3322" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Lansing Area VMware User Group</option>
					<option value="2258" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Louisville Area VMware User Group</option>
					<option value="3271" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Mid Missouri Area VMware User Group</option>
					<option value="2211" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Midwest Area (KY) VMware User Group</option>
					<option value="2217" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Minneapolis Area VMware User Group</option>
					<option value="2550" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>New Orleans Area VMware User Group</option>
					<option value="2992" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>North Dakota Area VMware User Group</option>
					<option value="2657" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Northern Indiana Area VMware User Group</option>
					<option value="2878" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Northwest Arkansas Area VMware User Group</option>
					<option value="2252" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Oklahoma City Area VMware User Group</option>
					<option value="2233" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Omaha Area VMware User Group</option>
					<option value="2265" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>San Antonio Area VMware User Group</option>
					<option value="3000" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>St Cloud Area VMware User Group</option>
					<option value="2215" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>St. Louis Area VMware User Group</option>
					<option value="2643" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Tulsa Area VMware User Group</option>
					<option value="2220" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Western MI Area VMware User Group</option>
					<option value="2216" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Wisconsin Area VMware User Group</option>
					<option value="2441" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>US - West</option>
					<option value="3279" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Anchorage Area VMware User Group</option>
					<option value="3182" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Bakersfield Area VMware User Group</option>
					<option value="2250" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Boise Area VMware User Group</option>
					<option value="3082" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Colorado Public Sector</option>
					<option value="2206" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Denver Area VMware User Group</option>
					<option value="2520" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>East Bay Area VMware User Group</option>
					<option value="2625" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Hawaii Area VMware User Group</option>
					<option value="2254" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Los Angeles Area VMware User Group</option>
					<option value="2248" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Las Vegas Area VMware User Group</option>
					<option value="2991" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>New Mexico Area VMware User Group</option>
					<option value="2222" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Northern CA VMware User Group</option>
					<option value="2993" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Northern UT Area VMware User Group</option>
					<option value="3942" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Orange County Area User Group</option>
					<option value="2234" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Phoenix Area VMware User Group</option>
					<option value="2251" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Portland Area VMware User Group</option>
					<option value="2262" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Sacramento Area VMware User Group</option>
					<option value="2229" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Salt Lake City Area VMware User Group</option>
					<option value="2261" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>San Diego Area VMware User Group</option>
					<option value="2998" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>San Francisco Area VMware User Group</option>
					<option value="3266" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Santa Barbara Area VMware User Group</option>
					<option value="2228" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Seattle Area VMware User Group</option>
					<option value="2245" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Silicon Valley VMware User Group</option>
					<option value="2654" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Spokane Area VMware User Group</option>
					<option value="2199" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Southern California Area VMware User Group</option>
					<option value="2244" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Tucson Area VMware User Group</option>
					<option value="2476" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>US - Federal</option>
					<option value="2813" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>FSI</option>
					<option value="2751" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>General Dynamics VMware User Group</option>
					<option value="3173" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Harris Corporation VMware User Group</option>
					<option value="2651" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Lockheed Martin VMware User Group</option>
					<option value="2652" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Northrop Grumman VMware User Group</option>
					<option value="2752" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Raytheon VMware User Group</option>
					<option value="2627" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Air Force VMware User Group</option>
					<option value="3878" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Army VMware User Group</option>
					<option value="2901" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Environmental Protection Agency VMware User Group</option>
					<option value="2899" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Healthcare VMware User Group</option>
					<option value="2801" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>National Oceanic and Atmospheric Administration VMware User Group</option>
					<option value="2812" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>U.S. Department of Health and Human Services</option>
					<option value="2811" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>U.S. Department of Veterans Affairs</option>
					<option value="2440" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Canada</option>
					<option value="2208" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Calgary Area VMware User Group</option>
					<option value="2916" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Edmonton Area VMware User Group</option>
					<option value="2988" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Halifax Area VMware User Group</option>
					<option value="2203" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Montreal Area VMware User Group</option>
					<option value="2990" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>New Brunswick Area VMware User Group</option>
					<option value="2914" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Okanagan BC Area VMware User Group</option>
					<option value="2223" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Ottawa Area VMware User Group</option>
					<option value="2915" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Quebec City Area VMware User Group</option>
					<option value="3503" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Saskatoon Area VMware User Group</option>
					<option value="2253" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>South Western Ontario Area VMware User Group</option>
					<option value="2263" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Toronto Area VMware User Group</option>
					<option value="2243" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Vancouver BC Area VMware User Group</option>
					<option value="2242" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Winnipeg Area VMware User Group</option>
					<option value="2269" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Asia Pacific</option>
					<option value="2270" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Australia &amp; New Zealand User Group</option>
					<option value="2538" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Adelaide Area VMware User Group</option>
					<option value="2470" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Auckland Area VMware User Group</option>
					<option value="2273" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Brisbane Area VMware User Group</option>
					<option value="2471" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Christchurch Area VMware User Group</option>
					<option value="2665" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Hobart Area VMware User Group</option>
					<option value="2271" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Melbourne Area VMware User Group</option>
					<option value="2274" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Perth Area VMware User Group</option>
					<option value="2272" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Sydney Area VMware User Group</option>
					<option value="2472" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>New Zealand Area VMware User Group</option>
					<option value="2957" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>China VMware User Group</option>
					<option value="2996" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Hong Kong Area VMware User Group</option>
					<option value="3110" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>India VMware User Group</option>
					<option value="3186" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Indonesia Area VMware User Group</option>
					<option value="2765" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Japan Online Forum</option>
					<option value="2841" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Malaysia Area VMware User Group</option>
					<option value="2810" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Singapore Area VMware User Group</option>
					<option value="2997" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Thailand Area VMware User Group</option>
					<option value="2275" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>EMEA</option>
					<option value="2289" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Austria VMware User Group</option>
					<option value="2539" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Baltic VMware User Group</option>
					<option value="2284" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Belgium VMware User Group</option>
					<option value="2843" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Croatia VMware User Group</option>
					<option value="2536" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Czech Republic VMware User Group</option>
					<option value="2283" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Denmark VMware User Group</option>
					<option value="2535" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Finland VMware User Group</option>
					<option value="2684" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>France VMware User Group</option>
					<option value="3738" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Germany VMware User Group</option>
					<option value="2282" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Germany Middle VMware User Group</option>
					<option value="2288" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Germany North VMware User Group</option>
					<option value="2281" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Germany South VMware User Group</option>
					<option value="2920" class="jive-search-community-sub" style="padding-left: 50px;"
						
					>Germany West VMware User Group</option>
					<option value="2682" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Hungary Area VMware User Group</option>
					<option value="2290" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Iberia VMware User Group</option>
					<option value="2994" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Ireland Area VMware User Group</option>
					<option value="2479" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Israel VMware User Group</option>
					<option value="2995" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Italy Area VMware User Group</option>
					<option value="2285" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Luxembourg User Group</option>
					<option value="2291" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Netherlands VMware User Group</option>
					<option value="2923" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Poland VMware User Group</option>
					<option value="3912" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Portugal VMware User Group</option>
					<option value="3945" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Romania VMware User Group</option>
					<option value="2872" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Russia VMware User Group</option>
					<option value="3244" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Scotland User Group</option>
					<option value="2858" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Serbia Area VMware User Group</option>
					<option value="2626" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Slovak User Group</option>
					<option value="3002" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Slovenia Area VMware User Group</option>
					<option value="2287" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Suisse Romande VMware User Group (Swiss)</option>
					<option value="2292" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Sweden VMware User Group</option>
					<option value="2631" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Swiss German VMware User Group</option>
					<option value="2912" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Turkey VMware User Group</option>
					<option value="2276" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>UK London Area User Group</option>
					<option value="2278" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>UK North User Group</option>
					<option value="2279" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>UK Public Sector North User Group</option>
					<option value="2280" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>UK Public Sector South User Group</option>
					<option value="2277" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>UK South User Group</option>
					<option value="3910" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>UAE VMUG</option>
					<option value="2293" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Latin America</option>
					<option value="2918" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Argentina VMware User Group</option>
					<option value="2294" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Brazil VMware User Group</option>
					<option value="2919" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Chile VMware User Group</option>
					<option value="2917" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Colombia VMware User Group</option>
					<option value="2295" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Mexico City Area VMware User Group</option>
					<option value="3003" class="jive-search-community-sub" style="padding-left: 40px;"
						
					>Puerto Rico Area VMware User Group</option>
					<option value="3466" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>User Group Meeting Request</option>
					<option value="3467" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>User Group Mentor Program Enrollment</option>
					<option value="3767" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>VMware Partner Exchange 2011</option>
					<option value="3768" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Experience</option>
					<option value="3773" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>At the Event</option>
					<option value="3774" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Who Should Attend</option>
					<option value="3775" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Why Attend</option>
					<option value="3776" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Alumni Program</option>
					<option value="3850" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Programs</option>
					<option value="3769" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Learn</option>
					<option value="3777" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Tracks &amp; Focus Area</option>
					<option value="3778" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Hands-On Labs</option>
					<option value="3779" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Pre-Conference Program</option>
					<option value="3851" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Certifications</option>
					<option value="3770" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Network</option>
					<option value="3780" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Expo Hall</option>
					<option value="3781" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Join the Conversation</option>
					<option value="3826" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Meet Up</option>
					<option value="3827" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>After Dark</option>
					<option value="3771" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Sponsor</option>
					<option value="3782" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Be a Sponsor</option>
					<option value="3783" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Expo Hall</option>
					<option value="3772" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Attend</option>
					<option value="3784" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Registration</option>
					<option value="3785" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Key Dates</option>
					<option value="3786" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Hotel &amp; Travel</option>
					<option value="3787" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>FAQ</option>
					<option value="2008" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>Private</option>
					<option value="3321" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Bit Bucket</option>
					<option value="3366" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>VMware Infrastructure Operations (VIOPS)</option>
					<option value="3804" class="jive-search-community-sub" style="padding-left: 10px;"
						
					>CTO</option>
					<option value="3806" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Polls</option>
					<option value="3807" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Events</option>
					<option value="3808" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Chief Technology Officer</option>
					<option value="3810" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3858" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3879" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3811" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Cloud Applications Architecture</option>
					<option value="3812" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3880" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3913" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3813" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>End User Computing</option>
					<option value="3814" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3881" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3914" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3815" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Emerging Devices</option>
					<option value="3816" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3859" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3882" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3817" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>High Performance Computing</option>
					<option value="3818" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3875" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3883" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3819" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Management</option>
					<option value="3820" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3884" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3915" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3821" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Public Sector</option>
					<option value="3822" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3860" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3885" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3823" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Security</option>
					<option value="3824" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3864" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3886" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3828" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Open Standards</option>
					<option value="3829" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3887" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3916" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3849" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Team</option>
					<option value="3852" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Advanced Development and Research</option>
					<option value="3854" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3888" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3917" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3853" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>EMEA CTO</option>
					<option value="3855" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3877" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
					<option value="3889" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3861" class="jive-search-community-sub" style="padding-left: 20px;"
						
					>Software as a Service and Application Services</option>
					<option value="3862" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Polls</option>
					<option value="3890" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Bio</option>
					<option value="3918" class="jive-search-community-sub" style="padding-left: 30px;"
						
					>Events</option>
			</select>
			-->
				<input name="communityID" value="2411" type="hidden">
			<input name="resultTypes" value="MESSAGE" type="hidden">
			<input name="resultTypes" value="COMMUNITY" type="hidden">
			<input name="resultTypes" value="BLOG" type="hidden">
			<input name="peopleEnabled" value="false" type="hidden">
			<input id="jive-query" name="q" class="jive-userbar-search-field" 
type="text">
			<input value="Search" class="btn-search-submit" type="submit">
			<a class="advanced" href="http://communities.vmware.com/search.jspa" 
onclick="if (jQuery.trim(jQuery('#jive-query').val()) != '') { 
jQuery('#jive-userbar-search form').submit(); return false; }">Advanced 
Search</a>
		</div>
	</form>
</div><!-- END #jive-userbar-search -->
<script type="text/javascript" charset="utf-8">
<!--
	var _isIE6 = (typeof window.XMLHttpRequest == "undefined");
	if(_isIE6){
		DD_belatedPNG.fix('#jive-userbar-search input.btn-search-submit');
	}
// -->
</script>

					<!-- BEGIN sidebar box 'ACTIONS' -->
						<div class="wrapper-blu">
							<div class="full">
								<div class="rounded">
									<div class="top">
										<div class="middle-right">
											<h2>Actions</h2>
										</div>
									</div>
									<div class="middle">
										<div class="middle-right">
											<div class="content">
												<ul>
				<li id="jive-link-document-pdf" style="">
					<a class="jive-link-pdf" 
href="http://communities.vmware.com/docs/DOC-8760.pdf" onclick="" 
title="">
						View as PDF
					</a>
				</li>
												</ul>
											</div>
										</div>
									</div>
									<div class="bottom">
										<div class="middle-right"></div>
									</div>
								</div>
							</div>
						</div>
					<!-- END sidebar box 'ACTIONS' -->
						
						
						
						
	<!-- BEGIN sidebar box 'Incoming Links' -->
	<div class="tech-side-nav" id="blog-nav-tags">
		<h3>Incoming Links</h3>
		<ul>
						<li>
							<a href="http://communities.vmware.com/message/1368781#1368781" 
class="jive-link-answer-correct">Re: ESXi 4 hosts 3 VMs</a>
						</li>
						<li>
							<a href="http://communities.vmware.com/message/1352730#1352730" 
class="jive-link-question">ghettoVCB</a>
						</li>
						<li>
							<a href="http://communities.vmware.com/message/1411551#1411551" 
class="jive-link-answer-correct">Re: Cron Issues again with GhettoVCB.sh
 script</a>
						</li>
						<li>
							<a href="http://communities.vmware.com/message/1412274#1412274" 
class="jive-link-answer-correct">Re: Which Backup Tool (on a budget) ?</a>
						</li>
						<li>
							<a href="http://communities.vmware.com/message/1103682#1103682" 
class="jive-link-message">Re: Free ESXi Backup Solution for Windows</a>
						</li>
		</ul>
	</div>
	<!-- END sidebar box 'Incoming Links' -->
							
							
							
							
	<!-- BEGIN sidebar box 'User Content' -->
	<div class="tech-side-nav">
		<h3>More by lamw</h3>
		<ul>
					<li>
						<a href="http://communities.vmware.com/docs/DOC-10595" 
class="jive-link-wiki"><span>Ghetto Tech Preview - ghettoVCB-restore.sh -
 Restoring VM's backed up from ghettoVCB to ESX(i) 3.5 and 4.x+</span></a>
					</li>
					<li>
						<a href="http://communities.vmware.com/thread/228077" 
class="jive-link-thread"><span>Ghetto Tech Preview - 
ghettoVCB-restore.sh</span></a>
					</li>
					<li>
						<a href="http://communities.vmware.com/thread/156469" 
class="jive-link-answer-correct"><span>64bit version of RCLI ?</span></a>
					</li>
					<li>
						<a href="http://communities.vmware.com/thread/153860" 
class="jive-link-answer-correct"><span>Commandline for removing VMs from
 "Inventory"</span></a>
					</li>
					<li>
						<a href="http://communities.vmware.com/thread/131228" 
class="jive-link-thread"><span>Script to find RDMs on ESX Hosts or VC</span></a>
					</li>
			<li><a href="http://communities.vmware.com/people/lamw" 
class="jive-sidebar-viewall">View lamw's profile</a></li>
		</ul>
	</div>
	<!-- END sidebar box 'User Content' -->
<!-- Div Class unknown is being used in the java script at bottom of page -->
<div style="display: none;" class="unknown">
	<div class="promo">
		<div>
			<h3>VMware Beta Programs</h3>
			<p>Want to be Considered for Future Beta Programs?</p>
			<a href="http://communities.vmware.com/community/beta/betainterest" 
class="more">Learn More</a>
		</div>
	</div>
</div>
<div style="display: none;" class="unknown">
	<div class="promo">
		<div>
			<h3>VMware Developer</h3>
			<p>Download SDKs, APIs, videos,<br> training, and more in the 
Developer community.</p>
			<a href="http://communities.vmware.com/community/developer" 
class="more">Learn More</a>
		</div>
	</div>
</div>
<div style="display: none;" class="unknown">
	<div class="promo">
    	<div>
			<h3>Developer<br> Sample Code</h3>
			<p>Increase your developer productivity with VMware API sample code.</p>
			<a 
href="http://communities.vmware.com/community/developer/codecentral" 
class="more">Learn More</a>
		</div>
	</div>
</div>
<div style="" class="unknown">
	<div class="promo">
    	<div>
			<h3>VMworld<br> Sessions &amp; Labs</h3>
			<p>Online access to the latest VMworld Sessions &amp; Labs and online
 services.</p>
			<a href="http://www.vmworld.com/community/subscription/" class="more">Learn
 more</a>
		</div>
	</div>
</div>
<div style="display: none;" class="unknown">
	<div class="promo">
    	<div>
			<h3>Purchase PSO Credits Online</h3>
			<p>Purchase credits to redeem training and consulting services 
online.</p>
			<a href="http://www.vmware.com/vmwarestore/buypsocredits.html" 
class="more">Buy Now</a>
		</div>
	</div>
</div>
<div style="display: none;" class="unknown">
	<div class="promo">
    	<div>
			<h3>Community Hardware Software</h3>
			<p>View reported configurations or report your own.</p>
			<a href="http://communities.vmware.com/cshwsw.jspa" class="more">Learn
 More</a>
		</div>
	</div>
</div>
<div style="display: none;" class="unknown">
	<div class="promo">
    	<div>
			<h3>Only VMware ... Delivers Nexus 1000V</h3> 
			<p>Ensure consistent, policy-based network capabilities to virtual 
machines across your data center.</p> 
			<a 
href="http://www.vmware.com/products/cisco-nexus-1000V/overview.html" 
class="more">Learn More</a> 
		</div>
	</div>
</div>
<script type="text/javascript" charset="utf-8">
	var rotatingAds = $$('div.unknown');
	rotatingAds.invoke('hide');
	rotatingAds[(Math.floor(Math.random()*rotatingAds.length))].show();
</script>

				</div>
			</div>
			<!-- END sidebar column -->
		</div>
		<!-- BEGIN main body -->
		<div id="jive-comment-post-block" style="display: none;">
			<form method="post" action="/doc-comment-create.jspa" 
name="jive-comment-post-form" onsubmit="if (!validatePost(true)) {return
 false;}; return true;">
				<input name="documentID" value="" type="hidden">
				<input name="parentCommentID" value="" type="hidden">
				<input name="commentMode" value="" type="hidden">
<input name="webwork.token.name" value="document.comment.token.DOC-8760"
 type="hidden">
<input name="document.comment.token.DOC-8760" 
value="8YGHIYLF9I2CEMDIG7G01O3QHUWK9YJE" type="hidden">
				<h2>Post a comment</h2>
					<div class="jive-comment-post-anonymous">
						<div>
							<input id="comment-author" name="name">
							<label for="comment-author">Name <span>(required)</span></label>
						</div>
						<div>
							<input id="comment-email" name="email">
							<label for="comment-email">Email Address <span>(required, will 
not be published)</span></label>
						</div>
						<div>
							<input id="comment-url" name="url">
							<label for="comment-url">Website Address</label>
						</div>
					</div>
				<div>
					<textarea name="body" rows="10" id="comment-body" 
class="jive-comment-textarea"></textarea>
				</div>
				<div style="display: none;" class="jive-doc-comment-preview" 
id="jive-doc-comment-preview"></div>
				<div>
					<input name="post" class="jive-button" value="Add Comment" 
type="submit">
					<input name="preview" class="comment-preview-button jive-button" 
value="Preview" id="comment-preview-button" onclick="previewComment(); 
return false;" type="button">
					&nbsp;&nbsp;&nbsp;&nbsp;
					<input name="cancel" class="jive-button" value="Cancel" 
onclick="toggleCommentForm(this.form.parentNode.id);return false;" 
type="button">
				</div>
			</form>
		</div>
		<div style="padding: 0pt 25px; clear: both;">
			<div class="jive-body-thread">
				<a 
href="http://communities.vmware.com/community/vmtn/vi/esx3.5?view=documents"
 class="jive-link-more">Up to Documents in VI: VMware ESXâ„¢ 3.5</a>
			</div>
		</div>
		<script type="text/javascript">
		<!--
			function vmwareToggleTabs(tab1, tab2) {
				jQuery('#'+tab1).show();
				jQuery('#'+tab2).hide();
				jQuery('#'+tab1+'-tab a').addClass('active');
				jQuery('#'+tab2+'-tab a').removeClass('active');
			}
			<!-- used to hold the currently open comment form -->
			var currentTargetID = "";
			<!-- load the correct tab when a comment is posted -->
			<!-- show form is an error occured while posting a comment -->
			var __postSubmitted = false;
			function validatePost() {
				if (!__postSubmitted) {
					__postSubmitted = true;
					return true;
				}
				return false;
			}
			function closeCurrentCommentForm() {
				// close current target, if exists
				if (currentTargetID != "") {
					var currentTarget = $(currentTargetID);
					if (currentTarget && currentTarget.getElementsByTagName("form").length != 0) {
						currentTarget.removeChild(currentTarget.getElementsByTagName("form")[0]);
						currentTargetID = "";
					}
				}
			}
			function toggleCommentForm(target, parentCommentID, commentMode) {
				// close the current target if exists
				if (target != currentTargetID) {
					closeCurrentCommentForm();
				}
				var targetElement = $(target);
				if (targetElement.getElementsByTagName("form").length == 0) {
					var form2clone = $('jive-comment-post-block').getElementsByTagName("form")[0].cloneNode(true);
					var elements = $A(form2clone.getElementsByTagName('INPUT'));
					for (var i = 0; i <elements.length; i++) {
						var e = elements[i];
						if (e.name == 'documentID') {
							e.value = 'DOC-8760';
						}
						else if (e.name == 'parentCommentID') {
							e.value = parentCommentID;
						}
						else if (e.name == 'commentMode') {
							e.value = commentMode;
						}
					}
					targetElement.appendChild(form2clone);
					currentTargetID = targetElement.id;
					Element.scrollTo(targetElement);
				} else {
					targetElement.removeChild(targetElement.getElementsByTagName("form")[0]);
					currentTargetID = "";
				}
			}
			function previewComment() {
				var taExpression = 'div#' + currentTargetID + ' textarea';
				var buExpression = 'div#' + currentTargetID + ' .comment-preview-button';
				var peExpression = 'div#' + currentTargetID + ' .jive-doc-comment-preview';
				var comment = $$(taExpression)[0];
				var button = $$(buExpression)[0];
				var preview = $$(peExpression)[0];
				button.value = 'Previewing...';
				Comment.previewComment(102, 8760, comment.value, {
					callback:function(data) {
						preview.innerHTML = data;
						button.value = 'Preview';
						new Effect.Appear(preview);
					}
				});
			}
		// -->
		</script>
						</div>
					</div><!-- END #jive-body or #jive-body-full -->
				</div><!-- END #jive-wrapper -->
			</div><!-- END #content-container -->
			<div id="top-of-page">
				<div id="iglobal-sites"><div id="global-sites"><div 
class="vmwarelogo"><a href="http://www.vmware.com/index.html">VMware</a></div><!--additional nav--><div
 class="ad-nav"><ul><li><a 
href="http://www.vmware.com/technical-resources/">Technical Resource 
Center</a></li><li><a href="http://www.vmware.com/communities/content/">Communities</a></li><li><a
 href="http://www.vmware.com/appliances/">Virtual Appliances</a></li><li><a
 href="http://www.vmware.com/vmwarestore/">Store</a></li><li><a 
href="http://www.vmware.com/accounts/">My Account</a></li></ul></div><!--navigation--><div
 class="nav"><ul><li class="first"><a 
href="http://www.vmware.com/solutions/cloud-computing/">Cloud Computing</a><div
 class="drop"><div class="t">&nbsp;</div><div class="c"><div 
class="drop-links"><div class="drop-links-left"><div class=""><h3>Cloud 
Computing and Virtualization</h3><ul><li><a 
href="http://www.vmware.com/solutions/cloud-computing/">Cloud Computing 
Overview</a></li></ul></div><div class=""><h3>The Promise of Cloud 
Computing</h3><ul><li><a 
href="http://www.vmware.com/solutions/cloud-computing/benefit-cloud-computing/security.html">Cloud
 Computing Security</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/benefit-cloud-computing/pooling.html">Pooling
 and Dynamic Resource Allocation</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/benefit-cloud-computing/automation.html">Automation
 and Cloud Management</a></li></ul></div><div class=""><h3>Private Cloud</h3><ul><li><a
 href="http://www.vmware.com/solutions/cloud-computing/private-cloud/">Private
 Cloud Computing</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/private-cloud/vmware-cloud.html">Build
 a Private Cloud</a></li></ul></div></div><div class="drop-links-right"><div
 class=""><h3>Public/Hybrid Cloud</h3><ul><li><a 
href="http://www.vmware.com/solutions/cloud-computing/public-cloud/">Public/Hybrid
 Cloud Computing</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/public-cloud/vcloud-datacenter-services.html">VMware
 vCloud Datacenter Services</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/public-cloud/vcloud-express.html">VMware
 vCloud Express</a></li></ul></div><div class=""><h3>For Cloud 
Developers and ISVs</h3><ul><li><a 
href="http://www.vmware.com/solutions/cloud-computing/developers-isvs/">Cloud
 Solutions for Developers and ISVs</a></li></ul></div><div class=""><h3>For
 Service Providers</h3><ul><li><a 
href="http://www.vmware.com/solutions/cloud-computing/service-providers/">Cloud
 Solutions for Service Providers</a></li></ul></div></div></div><div 
class="agenda"><ul><div class="mega-top">   <div class="mega-blue">    <div
 class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/files/pdf/analysts/Gartner-server-virtualization-leads-to-cloud-computing.pdf"
 target="_new">Gartner Report on Cloud Computing</a></h3><p>Download 
Gartner Report - "Server Virtualization: One Path That Leads to Cloud 
Computing" </p></li></div></div></div>      <div class="mega-top">   <div
 class="mega-green">    <div class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/solutions/cloud-computing/private-cloud/">Build
 a Private Cloud</a></h3><p>Discover how to begin the journey to build a
 private cloud, leveraging existing IT investments.</p></li></div></div></div></ul><div
 class="frame"><h3></h3><p></p><div>        </div></div></div></div><div
 class="b">&nbsp;</div></div></li><li><a 
href="http://www.vmware.com/virtualization/">Virtualize</a><div 
class="drop"><div class="t">&nbsp;</div><div class="c"><div 
class="drop-links"><div class="drop-links-left"><div class=""><h3>Understanding
 Virtualization</h3><ul><li><a 
href="http://www.vmware.com/virtualization/what-is-virtualization.html">Virtualization
 Basics</a></li><li><a 
href="http://www.vmware.com/virtualization/why-virtualize.html">Why 
Virtualize?</a></li><li><a 
href="http://www.vmware.com/virtualization/virtual-infrastructure.html">The
 Virtual Infrastructure</a></li><li><a 
href="http://www.vmware.com/virtualization/virtual-machine.html">Virtual
 Machines</a></li><li><a 
href="http://www.vmware.com/virtualization/history.html">History of 
Virtualization</a></li></ul></div><div class=""><h3>Why Choose VMware</h3><ul><li><a
 href="http://www.vmware.com/virtualization/why-choose-vmware.html">Greater
 Efficiency, Control and Flexibility</a></li></ul></div></div><div 
class="drop-links-right"><div class=""><h3>Cost Savings</h3><ul><li><a 
href="http://www.vmware.com/virtualization/cost-savings/">Overview</a></li><li><a
 href="http://www.vmware.com/virtualization/cost-savings/">Capex &amp; 
Opex Savings</a></li><li><a 
href="http://www.vmware.com/solutions/consolidation/">Reduce Server 
Costs</a></li></ul></div><div class=""><h3>Energy Efficiency</h3><ul><li><a
 href="http://www.vmware.com/virtualization/green-it/">Increase Energy 
Efficiency</a></li><li><a 
href="http://www.vmware.com/virtualization/green-it/pc.html">Lower 
Desktop Energy Consumption</a></li><li><a 
href="http://www.vmware.com/virtualization/green-it/greengrid.html">Green
 Grid</a></li></ul></div></div></div><div class="agenda"><ul><div 
class="mega-top">   <div class="mega-blue">    <div class="mega-bottom"><li><h3><a
 href="http://www.vmware.com/go/costperappcalc/" target="_new">The 
Leader in Virtualization</a></h3><p>VMware offers the highest efficiency
 and lowest cost-per-application in the industry.</p></li></div></div></div>
      <div class="mega-top">   <div class="mega-green">    <div 
class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/go/calculator" target="_new">Calculate Your 
Cost Savings</a></h3><p>Discover the true value of virtualization.</p></li></div></div></div></ul><div
 class="frame"><h3></h3><p></p><div>        </div></div></div></div><div
 class="b">&nbsp;</div></div></li><li><a 
href="http://www.vmware.com/solutions/">Solutions</a><div class="drop"><div
 class="t">&nbsp;</div><div class="c"><div class="drop-links"><div 
class="drop-links-left"><div class=""><h3>Datacenter</h3><ul><li><a 
href="http://www.vmware.com/solutions/datacenter/">Datacenter 
Virtualization Solutions</a></li><li><a 
href="http://www.vmware.com/solutions/virtualization-management/">Virtualization
 and Cloud Management</a></li><li><a 
href="http://www.vmware.com/solutions/business-continuity/">Business 
Continuity</a></li><li><a 
href="http://www.vmware.com/solutions/continuity/disasterrecovery.html">Disaster
 Recovery</a></li><li><a 
href="http://www.vmware.com/solutions/consolidation/">Server 
Consolidation</a></li><li><a 
href="http://www.vmware.com/solutions/remoteoffice/">Remote and Branch 
Office</a></li></ul></div><div class=""><h3>Desktop</h3><ul><li><a 
href="http://www.vmware.com/solutions/desktop/">Desktop Virtualization 
Solutions</a></li><li><a 
href="http://www.vmware.com/solutions/desktop/managed-service.html">Desktops
 as a Managed Service</a></li><li><a 
href="http://www.vmware.com/solutions/desktop/windows7-migration.html">Windows
 7 Migration</a></li><li><a 
href="http://www.vmware.com/solutions/desktop/remote-branch-office.html">Remote
 &amp; Branch Offices</a></li></ul></div><div class=""><h3>Cloud</h3><ul><li><a
 href="http://www.vmware.com/solutions/cloud-computing/">Cloud Computing
 Overview</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/private-cloud/">Private
 Cloud</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/public-cloud/">Public/Hybrid
 Cloud</a></li></ul></div><div class=""><h3>Dev/Test</h3><ul><li><a 
href="http://www.vmware.com/solutions/dev-test/">Dev / Test 
Virtualization Solutions</a></li></ul></div></div><div 
class="drop-links-right"><div class=""><h3>Enterprise Applications</h3><ul><li><a
 href="http://www.vmware.com/solutions/business-critical-apps/">Virtualizing
 Enterprise Applications</a></li><li><a 
href="http://www.vmware.com/solutions/business-critical-apps/exchange/">Exchange</a></li><li><a
 href="http://www.vmware.com/solutions/business-critical-apps/oracle/">Oracle</a></li><li><a
 href="http://www.vmware.com/solutions/business-critical-apps/sap/">SAP</a></li></ul></div><div
 class=""><h3>By Company Size</h3><ul><li><a 
href="http://www.vmware.com/solutions/company-size/individuals/">Individual</a></li><li><a
 href="http://www.vmware.com/solutions/smb/smb_home.html">Small and 
Midsize Business</a></li><li><a 
href="http://www.vmware.com/solutions/company-size/enterprise/">Enterprise</a></li></ul></div><div
 class=""><h3>By Industry</h3><ul><li><a 
href="http://www.vmware.com/solutions/education/">Education</a></li><li><a
 href="http://www.vmware.com/industry/government/">Government</a></li><li><a
 href="http://www.vmware.com/solutions/industry/healthcare/">Healthcare</a></li><li><a
 href="http://www.vmware.com/solutions/hosting/">Hosting Providers</a></li><li><a
 href="http://www.vmware.com/solutions/industry/non-profit/">Nonprofit</a></li></ul></div><div
 class=""><h3>Partner</h3><ul><li><a 
href="http://www.vmware.com/solutions/partners/">Partner Solutions &amp;
 Virtualization</a></li><li><a 
href="http://www.vmware.com/solutions/partners/alliances/global-alliances.html">Global
 Alliances</a></li></ul></div><div class=""><h3>Service Providers</h3><ul><li><a
 
href="http://www.vmware.com/solutions/cloud-computing/service-providers/">Solutions
 for Service Providers</a></li><li><a 
href="http://www.vmware.com/solutions/cloud-computing/developers-isvs/">Solutions
 for Developers &amp; ISVs</a></li></ul></div></div></div><div 
class="agenda"><ul><div class="mega-top">   <div class="mega-blue">    <div
 class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/go/VMWAREIFONLY?src=WWW_SMBCMP_SOL_NAV" 
target="_top">Less than 100 servers?</a></h3><p>Let us recommend an 
affordable VMware solution that will make your time and money count. Get
 a free assessment now.</p></li></div></div></div>      <div 
class="mega-top">   <div class="mega-green">    <div class="mega-bottom"><li><h3><a
 
href="http://www.vmware.com/resources/wp/virtualization101_register.html">Get
 a Free Virtualization Kit</a></h3><p>Discover the value of 
virtualization for your IT infrastructure</p></li></div></div></div></ul><div
 class="frame"><h3>Customer Case Studies</h3><p>See how companies 
worldwide are benefiting from VMware virtualization solutions.</p><div> 
   <a href="http://www.vmware.com/a/customers/" target="_top">View All 
Case Studies</a>    </div></div></div></div><div class="b">&nbsp;</div></div></li><li><a
 href="http://www.vmware.com/products/">Products</a><div class="drop"><div
 class="t">&nbsp;</div><div class="c"><div class="drop-links"><div 
class="drop-links-left"><div class=""><h3>Datacenter &amp; Cloud 
Infrastructure</h3><ul><li><a 
href="http://www.vmware.com/products/vsphere/">VMware vSphere</a></li><li><a
 href="http://www.vmware.com/products/vsphere-hypervisor/">VMware 
vSphere Hypervisor (ESXi)</a></li><li><a 
href="http://www.vmware.com/products/go/">VMware Go</a></li><li><a 
href="http://www.vmware.com/products/vcloud/">VMware vCloud Product 
Family</a></li><li><a 
href="http://www.vmware.com/products/vcloud-director/">VMware vCloud 
Director</a></li><li><a 
href="http://www.vmware.com/products/vcloud-request-manager/">VMware 
vCloud Request Manager</a></li><li><a 
href="http://www.vmware.com/products/vcenter/">VMware vCenter Product 
Family</a></li><li><a href="http://www.vmware.com/products/server/">VMware
 Server</a></li></ul></div><div class=""><h3>Security</h3><ul><li><a 
href="http://www.vmware.com/products/vshield/">VMware vShield Product 
Family</a></li><li><a href="http://www.vmware.com/products/vshield-app/">VMware
 vShield App</a></li><li><a 
href="http://www.vmware.com/products/vshield-edge/">VMware vShield Edge</a></li><li><a
 href="http://www.vmware.com/products/vshield-endpoint/">VMware vShield 
Endpoint</a></li></ul></div><div class=""><h3>Desktop &amp; End-User 
Computing</h3><ul><li><a href="http://www.vmware.com/products/view/">VMware
 View</a></li><li><a href="http://www.vmware.com/products/thinapp/">VMware
 ThinApp</a></li><li><a href="http://www.vmware.com/products/ace/">VMware
 ACE</a></li><li><a href="http://www.vmware.com/products/workstation/">VMware
 Workstation</a></li><li><a 
href="http://www.vmware.com/products/player/">VMware Player</a></li><li><a
 href="http://www.vmware.com/products/zimbra/">Zimbra</a></li><li><a 
href="http://www.vmware.com/products/mobile/">VMware Mobile 
Virtualization Platform (MVP)</a></li></ul></div><div class=""><h3>Mac 
Products</h3><ul><li><a href="http://www.vmware.com/products/fusion/">VMware
 Fusion</a></li></ul></div></div><div class="drop-links-right"><div 
class=""><h3>Infrastructure &amp; Operations Management</h3><ul><li><a 
href="http://www.vmware.com/products/vcenter-server/">VMware vCenter 
Server</a></li><li><a 
href="http://www.vmware.com/products/vcenter-server-heartbeat/">VMware 
vCenter Server Heartbeat</a></li><li><a 
href="http://www.vmware.com/products/vcenter-orchestrator/">VMware 
vCenter Orchestrator</a></li><li><a 
href="http://www.vmware.com/products/vcenter-capacityiq/">VMware vCenter
 CapacityIQ</a></li><li><a 
href="http://www.vmware.com/products/site-recovery-manager/">VMware 
vCenter Site Recovery Manager</a></li><li><a 
href="http://www.vmware.com/products/labmanager/">VMware vCenter Lab 
Manager</a></li><li><a 
href="http://www.vmware.com/products/configuration-manager/">VMware 
vCenter Configuration Manager</a></li><li><a 
href="http://www.vmware.com/products/converter/">VMware vCenter 
Converter</a></li></ul></div><div class=""><h3>Application Management</h3><ul><li><a
 href="http://www.vmware.com/products/application-discovery-manager/">VMware
 vCenter Application Discovery Manager</a></li><li><a 
href="http://www.vmware.com/products/vcenter-appspeed/">VMware vCenter 
AppSpeed</a></li><li><a 
href="http://www.vmware.com/appliances/getting-started/learn/vmware_studio.html">VMware
 Studio</a></li></ul></div><div class=""><h3>IT Business Management</h3><ul><li><a
 href="http://www.vmware.com/products/vcenter-chargeback/">VMware 
vCenter Chargeback</a></li><li><a 
href="http://www.vmware.com/products/service-manager/" target="blank">VMware
 Service Manager</a></li></ul></div><div class=""><h3>VMware vFabric 
Cloud Application Platform</h3><ul><li><a 
href="http://www.vmware.com/products/springsource-tcserver/">VMware 
vFabric tc Server</a></li><li><a 
href="http://www.vmware.com/products/springsource-hyperic/">VMware 
vFabric Hyperic</a></li><li><a 
href="http://www.vmware.com/products/vfabric-gemfire/">VMware vFabric 
GemFire</a></li><li><a 
href="http://www.vmware.com/products/enterprise-ready-server/" 
target="blank">VMware vFabric Enterprise Ready Server</a></li><li><a 
href="http://www.vmware.com/products/rabbitmq/" target="blank">VMware 
RabbittMQ</a></li></ul></div><div class=""><h3>Other</h3><ul><li><a 
href="http://www.vmware.com/products/sles-for-vmware/">SUSE Linux 
Enterprise Server for VMware</a></li></ul></div></div></div><div 
class="agenda"><ul><div class="mega-top">   <div class="mega-blue">    <div
 class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/go/tryvmwareview" target="_top">VMware View 
4.5</a></h3><p>Download a 60-day free trial of the industry's leading 
desktop virtualization solution.</p></li></div></div></div>      <div 
class="mega-top">   <div class="mega-green">    <div class="mega-bottom"><li><h3><a
 href="http://www.vmware.com/landing_pages/vpp/index.html">Volume 
Purchasing Program</a></h3><p>Save when you purchase VMware products in 
volume.</p></li></div></div></div></ul><div class="frame"><h3>Product 
Categories</h3><p>VMware offers a range of products for a range of 
different audiences. </p><div>    <a 
href="http://www.vmware.com/products/datacenter-virtualization.html">Datacenter
 &amp; Server Products</a>    </div><div>    <a 
href="http://www.vmware.com/products/desktop_virtualization.html">Desktop
 Products</a>    </div><div>    <a 
href="http://www.vmware.com/products/smb-products.html">SMB Products</a>
    </div><div>    <a 
href="http://www.vmware.com/products/dev-and-test-products.html">Dev / 
Test Products</a>    </div></div></div></div><div class="b">&nbsp;</div></div></li><li
 class="right-side"><a href="http://www.vmware.com/services/">Services </a><div
 class="drop"><div class="t">&nbsp;</div><div class="c"><div 
class="drop-links"><div class="drop-links-left"><div class=""><h3>Consulting
 Services</h3><ul><li><a 
href="http://www.vmware.com/services/consulting/">Consulting Services 
Overview</a></li><li><a 
href="http://www.vmware.com/services/by-product/datacenter.html">Datacenter
 Service Offerings</a></li><li><a 
href="http://www.vmware.com/services/by-product/desktop.html">Desktop 
Service Offerings</a></li><li><a 
href="http://www.vmware.com/services/by-solution/vmware-vcloud-consulting-services.html">VMware
 vCloud Consulting Service Offerings</a></li><li><a 
href="http://www.vmware.com/services/full-services-portfolio.html">Complete
 Service Offerings Portfolio</a></li></ul></div><div class=""><h3>Certification</h3><ul><li><a
 href="http://mylearn.vmware.com/portals/certification/?ui=www" 
target="_top">Get Certified</a></li><li><a 
href="http://mylearn.vmware.com/portals/certification/faqs.cfm?ui=www" 
target="_top">Certification FAQs</a></li></ul></div></div><div 
class="drop-links-right"><div class=""><h3>Education Services</h3><ul><li><a
 
href="http://mylearn.vmware.com/mgrreg/index.cfm?ui=www&amp;redirect=off"
 target="_top">Education Services Overview</a></li><li><a 
href="http://mylearn.vmware.com/portals/www/search/findcourse.cfm?ui=www"
 target="_top">Find a Class</a></li><li><a 
href="http://mylearn.vmware.com/MgrReg/mode.cfm?ui=www" target="_top">Delivery
 Options</a></li><li><a 
href="http://mylearn.vmware.com/ilearn/MgrReg/faq.cfm?ui=www&amp;category=Customer%20Education"
 target="_top">Education FAQs</a></li></ul></div><div class=""><h3>TAM 
Program</h3><ul><li><a href="http://www.vmware.com/services/tam/">Technical
 Account Managers</a></li></ul></div><div class=""><h3>Training &amp; 
Consulting Credits</h3><ul><li><a 
href="http://mylearn.vmware.com/portals/credits/?ui=www_edu" 
target="_top">Credits Overview</a></li><li><a 
href="http://store.vmware.com/store?Action=DisplayPage&amp;Env=BASE&amp;Locale=en_US&amp;SiteID=vmware&amp;id=ProductDetailsPage&amp;productID=108518900&amp;resid=ui5efAoBAlYAAAbFnMcAAAAi&amp;rests=1283889107043"
 target="_top">Purchase Online</a></li></ul></div></div></div><div 
class="agenda"><ul><div class="mega-top">   <div class="mega-blue">    <div
 class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/landing_pages/vi3_guarantee.html">VMware 
Guarantee Program</a></h3><p>Reduce your server costs by at least 50%.</p></li></div></div></div>
      <div class="mega-top">   <div class="mega-green">    <div 
class="mega-bottom"><li><h3><a 
href="http://mylearn.vmware.com/portals/consulting/?ui=con" 
target="_top">Create Engagement Request</a></h3><p>Engage with VMware's 
Consulting Services department now!</p></li></div></div></div></ul><div 
class="frame"><h3></h3><p></p><div>        </div></div></div></div><div 
class="b">&nbsp;</div></div></li><li class="right-side"><a 
href="http://www.vmware.com/support/">Support &amp; Downloads</a><div 
class="drop"><div class="t">&nbsp;</div><div class="c"><div 
class="drop-links"><div class="drop-links-left"><div class=""><h3>Product
 Support Centers</h3><ul><li><a 
href="http://www.vmware.com/support/product-support/">All Support 
Centers</a></li><li><a 
href="http://www.vmware.com/support/product-support/vsphere/">VMware 
vSphere</a></li><li><a 
href="http://www.vmware.com/support/product-support/vsphere-hypervisor/">VMware
 vSphere Hypervisor (ESXi)</a></li><li><a 
href="http://www.vmware.com/support/product-support/vi3/">VMware 
Infrastructure 3 (VI3)</a></li><li><a 
href="http://www.vmware.com/support/product-support/fusion/">VMware 
Fusion</a></li><li><a 
href="http://www.vmware.com/support/product-support/workstation/">VMware
 Workstation</a></li><li><a 
href="http://www.vmware.com/support/product-support/view/">VMware View</a></li><li><a
 href="http://www.vmware.com/support/product-support/server/">VMware 
Server</a></li></ul></div><div class=""><h3>Product Downloads</h3><ul><li><a
 href="http://downloads.vmware.com/d/" target="_top">All Downloads</a></li><li><a
 
href="http://downloads.vmware.com/d/info/datacenter_downloads/vmware_vsphere_4/4"
 target="_top">VMware vSphere</a></li><li><a 
href="http://downloads.vmware.com/d/info/datacenter_downloads/vmware_vsphere_hypervisor_esxi/4"
 target="_top">VMware vSphere Hypervisor (ESXi)</a></li><li><a 
href="http://downloads.vmware.com/d/info/datacenter_downloads/vmware_vcloud_director/1_0"
 target="_top">VMware vCloud Director</a></li><li><a 
href="http://downloads.vmware.com/d/info/desktop_downloads/vmware_workstation/7_0"
 target="_top">VMware Workstation</a></li><li><a 
href="http://downloads.vmware.com/d/info/desktop_downloads/vmware_fusion_for_the_mac/3_0"
 target="_top">VMware Fusion</a></li><li><a 
href="http://downloads.vmware.com/d/info/desktop_downloads/vmware_view/4_5"
 target="_top">VMware View</a></li><li><a 
href="http://downloads.vmware.com/d/info/datacenter_downloads/vmware_infrastructure_3/3_5"
 target="_top">VMware Infrastructure 3 (VI3)</a></li></ul></div></div><div
 class="drop-links-right"><div class=""><h3>Top Support Resources</h3><ul><li><a
 href="http://www.vmware.com/r/documentation.html">Documentation</a></li><li><a
 href="http://kb.vmware.com/" target="_top">Knowledge Base</a></li><li><a
 href="http://blogs.vmware.com/kbtv/" target="_top">KBTV (Technical 
Videos)</a></li><li><a href="http://communities.vmware.com/" 
target="_top">Communities</a></li><li><a 
href="http://www.vmware.com/resources/guides.html">Compatibility Guides</a></li><li><a
 href="http://www.vmware.com/technical-resources/techpapers.html">Technical
 Papers</a></li><li><a href="http://www.vmware.com/support/licensing/">Licensing
 Help</a></li><li><a href="http://www.vmware.com/security/advisories/">Security</a></li><li><a
 href="http://www.vmware.com/support/policies/">Support Policies &amp; 
Help Guides</a></li></ul></div><div class=""><h3>Account Resources</h3><ul><li><a
 href="http://www.vmware.com/accounts/">Account Login</a></li><li><a 
href="http://www.vmware.com/support/contacts/">File a Service Request</a></li><li><a
 href="http://www.vmware.com/support/sr/sr_history.jsp">View Filed 
Service Requests</a></li><li><a 
href="http://www.vmware.com/support/licensing/">Manage Product Licenses</a></li><li><a
 href="http://www.vmware.com/mysupport/contracts#wlp_trng_portal_page_2">Manage
 Support Contracts</a></li><li><a 
href="http://www.vmware.com/mysupport/orders?manage_account=manage_orders&amp;prod_evals_prod=&amp;lic_ser_prod=&amp;goBtn.x=45&amp;goBtn.y=11#wlp_trng_portal_page_0">View
 Orders</a></li><li><a 
href="http://www.vmware.com/account/secure/productRegistration.do?manage_account=reg_a_product&amp;prod_evals_prod=&amp;lic_ser_prod=&amp;goBtn.x=58&amp;goBtn.y=11">Register
 Products</a></li></ul></div></div></div><div class="agenda"><ul><div 
class="mega-top">   <div class="mega-blue">    <div class="mega-bottom"><li><h3><a
 href="http://www.vmware.com/support/contacts/">Contact Support</a></h3><p>Contact
 VMware Support for technical help, customer service questions and 
account assistance.</p></li></div></div></div>      <div 
class="mega-top">   <div class="mega-green">    <div class="mega-bottom"><li><h3><a
 href="http://www.vmware.com/support/services/">Support Options</a></h3><p>Review
 VMware's technical support options and purchase/renewal options.</p></li></div></div></div></ul><div
 class="frame"><h3>Free Product Evaluations</h3><p>Evaluate 
fully-functional VMware products to see how you can optimize and manage 
your IT infrastructure.</p><div>    <a 
href="http://www.vmware.com/tryvmware.html">Start your free evaluation 
now</a>    </div></div></div></div><div class="b">&nbsp;</div></div></li><li
 class="right-side"><a href="http://www.vmware.com/partners/">Partners</a><div
 class="drop"><div class="t">&nbsp;</div><div class="c"><div 
class="drop-links"><div class="drop-links-left"><div class=""><h3>Become
 a Partner</h3><ul><li><a 
href="http://www.vmware.com/partners/programs/">Partner Programs 
Overview</a></li><li><a 
href="http://www.vmware.com/partners/programs/ten-reasons-to-partner-vmware.html">Ten
 Reasons to Partner with VMware</a></li></ul></div><div class=""><h3>Channel
 Programs</h3><ul><li><a 
href="http://www.vmware.com/partners/programs/service-provider/">Service
 Provider</a></li><li><a 
href="http://www.vmware.com/partners/programs/solution-provider/">Solution
 Provider</a></li><li><a 
href="http://www.vmware.com/partners/programs/system-integrators/">System
 Integrator &amp; Outsourcer</a></li><li><a 
href="http://www.vmware.com/partners/programs/corporate-resellers/">Corporate
 Reseller</a></li><li><a 
href="http://www.vmware.com/partners/programs/training-centers/">Authorized
 Training Centers</a></li></ul></div><div class=""><h3>Alliance Programs</h3><ul><li><a
 href="http://www.vmware.com/partners/programs/alliances/">Technology 
Alliance Partner</a></li><li><a 
href="http://www.vmware.com/partners/programs/vmware-ready/">VMware 
Ready</a></li><li><a 
href="http://www.vmware.com/partners/alliances/programs/hardware_certification.html">Hardware
 Certification</a></li><li><a 
href="http://www.vmware.com/communitysource/">Community Source</a></li><li><a
 href="http://www.vmware.com/partners/programs/isv-center/">ISV Center</a></li></ul></div></div><div
 class="drop-links-right"><div class=""><h3>Already a Partner?</h3><ul><li><a
 href="http://www.vmware.com/partners/solution-competencies.html">Solution
 Competencies</a></li><li><a 
href="http://www.vmware.com/partners/programs/vmware-ready/">Get VMware 
Ready</a></li><li><a href="http://www.vmware.com/partners/sign-in.html">Partner
 Central</a></li><li><a 
href="https://na6.salesforce.com/secur/login_portal.jsp?orgId=00D400000009hQR&amp;portalId=06040000000D6Nb&amp;startURL=/apex/PRMPartnerUnivTab%3F%26stURLmLa%3Dhttp%253A%252F%252Fmylearn%252Evmware%252Ecom%252Fportals%252Fpartners%252F%253Fmenu%253Dhome"
 target="_top">Partner University</a></li></ul></div><div class=""><h3>For
 Customers</h3><ul><li><a href="http://www.vmware.com/partner-locator/">Find
 a Partner</a></li><li><a 
href="http://www.vmware.com/partners/alliances/">Browse Partner Products</a></li><li><a
 href="http://www.vmware.com/go/isvsupport">ISV Support Request</a></li><li><a
 href="http://www.vmware.com/solutions/partners/">Partner Solutions</a></li><li><a
 
href="http://www.vmware.com/solutions/partners/alliances/global-alliances.html">Global
 Alliances</a></li></ul></div><div class=""><h3>Education Programs</h3><ul><li><a
 href="http://www.vmware.com/partners/programs/vap/">VMware IT Academy</a></li><li><a
 href="http://www.vmware.com/partners/academic/">VMware Academic Program</a></li></ul></div></div></div><div
 class="agenda"><ul><div class="mega-top">   <div class="mega-blue">    <div
 class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/partners/alliances/">Product Catalog</a></h3><p>Market
 your solutions through VMware's Online Partner Product Catalog.</p></li></div></div></div>
      <div class="mega-top">   <div class="mega-green">    <div 
class="mega-bottom"><li><h3><a 
href="http://www.vmware.com/partners/programs/isv-center/">VMware ISV 
Center</a></h3><p>Explore, Support, and Deliver your solutions with the 
help of VMware.</p></li></div></div></div></ul><div class="frame"><h3>Partner
 News</h3><p>Stay current on the Global Channel News: Solutions, Events,
 and  more.</p><div>    <a href="http://blogs.vmware.com/partner/" 
target="_top">View Blog</a>    </div><div>    <a 
href="http://blogs.vmware.com/partner/subscribe_RSS.html" target="_top">Subscribe
 via RSS</a>    </div></div></div></div><div class="b">&nbsp;</div></div></li><li
 class="last right-side"><a href="http://www.vmware.com/company/">Company</a><div
 class="drop"><div class="t">&nbsp;</div><div class="c"><div 
class="drop-links"><div class="drop-links-left"><div class=""><h3>News</h3><ul><li><a
 href="http://www.vmware.com/company/news/releases/">News Releases</a></li><li><a
 href="http://www.vmware.com/company/news/articles/">Articles in the 
News</a></li><li><a 
href="http://www.vmware.com/company/news/awards.html">Awards</a></li></ul></div><div
 class=""><h3>Events</h3><ul><li><a 
href="http://www.vmware.com/company/events/tradeshows.html">Industry 
Events</a></li><li><a 
href="http://www.vmware.com/company/events/seminars/">Local Seminars</a></li><li><a
 href="http://www.vmware.com/company/events/webcasts/">Webcasts</a></li><li><a
 href="http://www.vmware.com/technical-resources/podcasts/" 
target="_top">Podcasts</a></li></ul></div></div><div 
class="drop-links-right"><div class=""><h3>About VMware</h3><ul><li><a 
href="http://www.vmware.com/company/leadership.html">Leadership</a></li><li><a
 href="http://www.vmware.com/company/jobs/">Jobs@ VMware</a></li><li><a 
href="http://www.vmware.com/company/contact.html">Contact Us</a></li><li><a
 href="http://www.vmware.com/company/green-at-vmware.html">Being Green 
at VMware</a></li><li><a 
href="http://www.vmware.com/company/office_locations.html">Office 
Locations</a></li><li><a href="http://www.vmware.com/company/customers/">Our
 Customers</a></li><li><a 
href="http://www.vmware.com/company/merchandise.html">Company 
Merchandise</a></li><li><a 
href="http://www.vmware.com/company/briefing_center/">VMware Briefing 
Center</a></li></ul></div><div class=""><h3>Investors and Media</h3><ul><li><a
 href="http://www.vmware.com/company/ir.html">Investor Relations</a></li><li><a
 href="http://www.vmware.com/company/mediaresource/">Media Resource 
Center</a></li></ul></div></div></div><div class="agenda"><ul><div 
class="mega-top">   <div class="mega-blue">    <div class="mega-bottom"><li><h3><a
 href="http://www.vmware.com/company/jobs/">Jobs at VMware</a></h3><p>Search
 job openings and apply today.</p></li></div></div></div>      <div 
class="mega-top">   <div class="mega-green">    <div class="mega-bottom"><li><h3><a
 
href="http://www.vmware.com/company/news/releases/springsource-close.html"
 target="_top">VMware Acquires SpringSource</a></h3><p>Combination Will 
Enable Customers...</p></li></div></div></div></ul><div class="frame"><h3>Customer
 Case Studies</h3><p>See how companies worldwide benefit from VMware 
Virtualization</p><div>    <a 
href="http://www.vmware.com/company/customers/">View all Case Studies</a>
    </div></div></div></div><div class="b">&nbsp;</div></div></li></ul></div></div></div>
				<div id="primary-navigation">
					<div class="visual">
						<div class="visual-entry">
							<h2><a href="http://communities.vmware.com/">Communities</a></h2>
<script type="text/javascript" charset="utf-8">
<!--
	function delCookie(name,path,domain) {
		var today = new Date();
		var deleteDate = new Date(today.getTime() - 48 * 60 * 60 * 1000); // minus 2 days
		var cookie = name + "="
			+ ((path == null) ? "" : "; path=" + path)
			+ ((domain == null) ? "" : "; domain=" + domain)
			+ "; expires=" + deleteDate;
		document.cookie = cookie;
	}
	function delOblixCookie() {
		// set focus to ok button
		var isNetscape = (document.layers);
		if (isNetscape == false || navigator.appVersion.charAt(0) >= 5) {
			for (var i=0; i < document.links.length; i++) {
				if (document.links[i].href == "javascript:top.close()") {
					document.links[i].focus();
					break;
				}
			}
		}
		delCookie('ObTEMC', '/');
		delCookie('ObSSOCookie', '/');
		// in case cookieDomain is configured
		// delete same cookie to all of subdomain
		var subdomain;
		var domain = new String(document.domain);
		var index = domain.indexOf(".");
		while (index > 0) {
			subdomain = domain.substring(index, domain.length);
			if (subdomain.indexOf(".", 1) > 0) {
				delCookie('ObTEMC', '/', subdomain);
				delCookie('ObSSOCookie', '/', subdomain);
			}
			domain = subdomain;
			index = domain.indexOf(".", 1);
		}
	}
// -->
</script>
	<div id="login-register">
			<a 
href="https://www.vmware.com/account/secure/customerRegistration.do?jiveSource=true&amp;"
 onclick="this.href += 'redirectURL='+window.location.href" 
class="btn-login-register">Login/Register</a>
	</div>
<ul id="section-nav">
				<li class="has-drop-down wide">
					<a href="http://communities.vmware.com/site-map.jspa" 
id="jiveUserMenu6Link"><span class="jive-userbar-community">All 
Communities</span></a>
					<div class="drop-down">
						<div class="t"></div>
						<div class="c">
<ul>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/help">VMware Communities 
Help</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/vmtn">VMTN</a></li>
<li style="padding: 0pt; width: 250px;"><ul>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/general">General</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/planning">Enterprise 
Strategy &amp; Planning</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/vsphere">VMware 
vSphereâ„¢</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/vcd">VMware vCloud 
Director</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/vi">VMware 
Infrastructureâ„¢</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/mgmt">VMware vCenterâ„¢</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/server">VMware 
Serverâ„¢</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/vshield">VMware 
vShield</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/entdesk">Enterprise 
Desktop Products</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/desktop">Desktop 
Products</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/certedu">Training 
&amp; Certification</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/vam">Virtual 
Appliance Marketplace</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/vsm">VMware Service 
Manager: VSM</a></li>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/vmtn/archive">Archives</a></li>
</ul></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/beta">VMware Beta Programs</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/developer">VMware 
Developer</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/govirtual">GoVirtual.org</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/viops">VMware 
Infrastructure Operations (VIOPS)</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/vmworld">VMworld.com</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/vmug">VMware User Groups 
(VMUGs)</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/partner-exchange">VMware 
Partner Exchange 2011</a></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/private">Private</a></li>
<li style="padding: 0pt; width: 250px;"><ul>
<li><a style="padding-left: 24px; width: 214px;" 
href="http://communities.vmware.com/community/private/bitbucket">Bit 
Bucket</a></li>
</ul></li>
<li><a style="padding-left: 12px; width: 226px;" 
href="http://communities.vmware.com/community/cto">CTO</a></li>
</ul>						</div>
						<div class="b"></div>
					</div>
				</li>
				<li class="has-drop-down right-side">
					<a href="http://communities.vmware.com/home.jspa" 
id="jiveUserMenu5Link"><span class="jive-userbar-navigation">Browse</span></a>
					<div class="drop-down">
						<div class="t"></div>
						<div class="c">
	<!-- BEGIN navigation -->
	<ul class="jive-userbar-menu-browse">
			<li><a href="http://communities.vmware.com/main-threads.jspa" 
class="jive-link-thread">Discussions</a></li>
			<li><a href="http://communities.vmware.com/main-documents.jspa" 
class="jive-link-wiki">Documents</a></li>
			<li><a href="http://communities.vmware.com/blogs" 
class="jive-link-blog">Blogs</a></li>
		<li><a href="http://communities.vmware.com/people" 
class="jive-link-people">People</a></li>
		<li><a href="http://communities.vmware.com/tags" class="jive-link-tag">Tags</a></li>
	</ul>
	<!-- END navigation -->
						</div>
						<div class="b"></div>
					</div>
				</li>
</ul>		
							<div id="jive-breadcrumb-custom">
								<span>



                <a href="http://communities.vmware.com/index.jspa">VMware
 Communities</a> &gt; 

                <a href="http://communities.vmware.com/community/vmtn">VMTN</a>
 &gt; 

                <a 
href="http://communities.vmware.com/community/vmtn/vi">VMware 
Infrastructureâ„¢</a> &gt; 

                <a 
href="http://communities.vmware.com/community/vmtn/vi/esx3.5">VI: VMware
 ESXâ„¢ 3.5</a> &gt; 


			<a 
href="http://communities.vmware.com/community/vmtn/vi/esx3.5?view=documents"
 class="jive-breadcrumb-last">Documents</a></span>
							</div><!-- END #jive-breadcrumb-custom -->
						</div>
					</div>
				</div><!-- END #primary-navigation -->
				<div id="isite-tools"><div id="site-tools"><link rel="stylesheet" 
type="text/css" href="DOC-8760_files/buttons.css"><ul><li>United States <a
 href="http://www.vmware.com/worldwide.html">[change]</a></li></ul></div></div>
				<div id="isearch-form"><div id="search-form"><script type="text/javascript"><!--function searchglobal_clear() {            if (document.frmSearchGLOBAL.q.value == "")document.frmSearchGLOBAL.q.value = "Search";elsedocument.frmSearchGLOBAL.q.value = "";}function searchglobal_submit() {            if ((document.frmSearchGLOBAL.q.value != "") && (document.frmSearchGLOBAL.q.value == "Search"))document.frmSearchGLOBAL.q.value = "";document.frmSearchGLOBAL.submit();}//--></script><form
 name="frmSearchGLOBAL" action="http://search.vmware.com/search" 
method="get" id="frmSearchGLOBAL"><fieldset><input name="cn" 
value="vmware" type="hidden"><input name="cc" value="www" type="hidden"><input
 name="client" value="VMware_Site" type="hidden"><input name="entqr" 
value="0" type="hidden"><input name="ud" value="1" type="hidden"><input 
name="output" value="xml_no_dtd" type="hidden"><input 
name="proxystylesheet" value="VMware_gsa_Site" type="hidden"><input 
name="site" value="VMware_Site" type="hidden"><input name="ie" 
value="UTF-8" type="hidden"><input name="oe" value="UTF-8" type="hidden"><input
 onfocus="javascript:searchglobal_clear();" name="q" value="Search" 
class="text-input" type="text"><input 
src="DOC-8760_files/btn-search.gif" 
onclick="javascript:searchglobal_submit();" class="btn-search" 
type="image"><!--<input type="image" onClick="javascript:searchglobal_submit();" src="http://www.vmware.com/files/images/tpl/button-search.gif" value="Go" class="search-button" />--></fieldset></form></div></div>
			</div><!-- END #top-of-page -->
			<div id="ifooter"><div id="footer"><div class="category-links"><div 
class="frame">  <div>    <h3> Community Resources </h3>    <ul><li> <a 
href="http://communities.vmware.com/community/developer/">Developer 
Center</a> </li>      <li> <a href="http://www.vmware.com/support/pubs/">Documentation</a>
 </li>      <li> <a 
href="http://www.vmware.com/resources/techresources/">Technical Papers</a>
 </li>      <li> <a href="http://www.vmware.com/resources/guides.html">Compatibility
 Guides</a> </li>    </ul></div>  <div>    <h3> VMworld </h3>    <ul><li>
 <a href="http://www.vmworld.com/">VMworld.com</a> </li>      <li> <a 
href="http://www.vmworld.com/vmworld/sessions.jspa">VMworld Session 
&amp; Labs</a> </li>    </ul></div>  <div>    <h3> Get Support </h3>    <ul><li>
 <a href="http://www.vmware.com/support/">Downloads &amp; Patches</a> </li>
      <li> <a href="http://www.vmware.com/support/product-support/">Product
 Support Centers</a> </li>      <li> <a 
href="http://www.vmware.com/support/licensing/">Manage Licenses</a> </li>
      <li> <a href="http://kb.vmware.com/">Search the KnowledgeBase</a> </li>
    </ul></div>  <div>    <h3> Other Links </h3>    <ul><li> <a 
href="http://www.vmware.com/company/contact.html">Contact Us</a> </li>  
    <li> <a href="http://www.vmware.com/company/">About VMware</a> </li>
      <li> <a href="http://www.vmware.com/company/jobs/">Jobs at VMware</a>
 </li>      <li> <a href="http://www.vmware.com/company/customers/">Customer
 Case Studies</a> </li>      <li> <a 
href="http://www.vmware.com/company/events/">Events</a> </li>    </ul></div></div></div><div
 class="footerbar"><p>Copyright Â© 2010 VMware, Inc. All rights reserved.</p><a
 href="http://vmware.simplefeed.net/subscription" class="rss">rss feed</a><ul
 id="navigation-bottom"><li><a 
href="http://www.vmware.com/company/contact.html">Contact Us</a></li><li><a
 href="http://www.vmware.com/help/legal.html">Legal</a></li><li><a 
href="http://www.vmware.com/help/privacy.html">Privacy</a></li><li><a 
href="http://www.vmware.com/help/accessibility.html">Accessibility</a></li><li><a
 href="http://www.vmware.com/site_index.html">Site Index</a></li><li><a 
href="http://www.vmware.com/help/">Help</a></li><li style="padding-top: 
1px; padding-bottom: 5px;">  <script src="DOC-8760_files/oo_engine.js" type="text/javascript"></script><a
 href="javascript:O_LC();">Feedback<img 
src="DOC-8760_files/sm_999_oo.gif" title="Feedback" style="margin-left: 
5px;" border="0"></a>  </li></ul></div></div></div>
		</div><!-- END #container -->
		<script src="DOC-8760_files/a" type="text/javascript"></script>
		<script type="text/javascript" src="DOC-8760_files/tracking.js"></script>
		<script type="text/javascript" src="DOC-8760_files/hbx.js"></script>
	<div style="display: none;" id="jive-overlay"></div><div 
style="display: none;" id="jive-lightbox"><div style="width: 250px; 
height: 250px;" id="jive-outerImageContainer"><div 
id="jive-imageContainer"><img id="jive-lightboxImage"><div 
id="jive-hoverNav"><a href="#" id="jive-prevLink"></a><a href="#" 
id="jive-nextLink"></a></div><div id="jive-loading"><a href="#" 
id="jive-loadingLink"><img src="DOC-8760_files/jive-image-loading.gif"></a></div></div></div><div
 id="jive-imageDataContainer"><div id="jive-imageData"><div 
id="jive-imageDetails"><span id="jive-caption"></span><span 
id="jive-numberDisplay"></span></div><div id="jive-bottomNav"><a 
href="#" id="jive-bottomNavClose"><img 
src="DOC-8760_files/jive-image-close.gif"></a></div></div></div></div></body></html>